(this.webpackJsonpcirrocumulus=this.webpackJsonpcirrocumulus||[]).push([[0],{419:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n(0),r=n.n(i),o=n(22),l=n(25),s=n(93),c=n(246),d=n(42),u=n(506),h=n(475),p=n(224),f=n(225),m=n(195),b=n(21),v=n(104),g=n.n(v),j=n(247),y=n.n(j),O=n(7),x=n(13),S=n(14),w=n(278),C=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(Object(w.a)(Error)),k=n(178),E=n(61),D=n.n(E),M=n(11),P=function(){function e(t,n){Object(O.a)(this,e),this.vector=t,this.indices=n}return Object(M.a)(e,[{key:"getName",value:function(){return this.vector.getName()}},{key:"size",value:function(){return this.indices.length}},{key:"get",value:function(e){return this.vector.get(this.indices[e])}}]),e}(),I=function(){function e(t,n){Object(O.a)(this,e),this.name=t,this.values=n}return Object(M.a)(e,[{key:"getName",value:function(){return this.name}},{key:"size",value:function(){return this.values.length}},{key:"get",value:function(e){return this.values[e]}},{key:"asArray",value:function(){return this.values}}]),e}();function T(e){var t=e.indexOf("/");if(-1===t)return{name:e,type:"X"};var n=e.substring(0,t);return{name:e.substring(t+1),type:n}}function z(e,t,n){var a={};return e.forEach((function(e){a[e.getName()]=function(e){for(var t=new Map,n=0,a=e.size();n<a;n++){var i=e.get(n),r=t.get(i)||0;t.set(i,r+1)}var o=Array.from(t.keys());o.sort(D()());var l=o.map((function(e){return t.get(e)}));return{categories:o,counts:l}}(e)})),t.forEach((function(e){a[e.getName()]=U(e)})),n.forEach((function(e){a[e.getName()]=U(e)})),a}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=[];return t.forEach((function(t){var i=e[t];if(null==i)throw t+" not found";var r=new I(t,i);null!=n&&(r=new P(r,n)),a.push(r)})),a}function _(e,t){if(null!=e.embeddings&&e.embeddings.forEach((function(e){if(e.coordinates&&Object.keys(e.coordinates).length>0&&(t[e.name]=e.coordinates),e.values)for(var n in e.values)t[n+"_"+e.name]=e.values[n]})),e.values)for(var n in e.values)t[n]=e.values[n]}function F(e){for(var t={X:[],obs:[]},n=0;n<e.length;n++){var a=T(e[n]),i=a.name,r=a.type,o=t[r];void 0===o&&(o=[],t[r]=o),o.push(i)}return t}function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];a=parseInt(a);for(var r=[],o=0;o<a;o++)r.push(e+"_"+o+1);var l=e+"_"+a;return null!=t&&(l=l+"_"+t+"_"+n),{name:e,dimensions:a,coordinate_columns:r,nbins:t,agg:n,full_name:l,precomputed:i}}function L(e){var t=new Set,n=new Set,a=[];if(e)for(var i=e.filters||[],r=0;r<i.length;r++){var o=i[r],l=o[0];if(Object(b.isObject)(l)){var s=N(l.basis,l.nbins,l.agg,l.ndim||2,l.precomputed);a.push(s)}else{var c=T(l),d=c.name,u=c.type;o[0]=d,"X"===u?t.add(d):n.add(d)}}return{basis:a,X:Array.from(t),obs:Array.from(n)}}function R(e,t,n){if(t.stats){var a=t.stats.dimensions||[],i=F(t.stats.measures||[]);e.summary=z(A(n,a),A(n,i.obs),A(n,i.X))}if(t.groupedStats){var r=t.groupedStats.dimensions||[],o=t.groupedStats.measures||[];r.length>0&&o.length>0&&(e.distribution=B(A(n,r[0]),A(n,o)))}if(t.selection){var l=t.selection.dimensions||[],s=t.selection.measures||[],c=t.selection.embeddings||[],d=F(s);e.selection={};var u=V(n,t.selection.filter);c.length>0&&(e.selection.coordinates={},c.forEach((function(t){var n=N(t.basis,t.nbins,t.agg,t.ndim||2,t.precomputed);e.selection.coordinates[n.full_name]={indices_or_bins:u}}))),l.length>0&&d.X.length>0&&(e.selection.distribution=B(A(n,l,u),A(n,s,u))),e.selection.count=u.length,e.selection.summary=z(A(n,l,u),A(n,d.obs,u),A(n,d.X,u))}}function B(e,t){for(var n={},a=e.length,i=e[0].size(),r=[],o=0;o<i;o++){for(var l=0;l<a;l++)r[l]=e[l].get(o);var s=r.join(", "),c=n[s];void 0===c&&(c={key:r.slice(),indices:[]},n[s]=c),c.indices.push(o)}for(var d=Object.keys(n),u=[],h=0;h<a;h++)u[h]=e[h].getName();var p=u.join("-"),f=[];return d.forEach((function(e){var a=n[e];t.forEach((function(e){var t=new P(e,a.indices),n=U(t),i={dimension:p,dimensions:u,categories:a.key,feature:e.getName(),mean:n.mean,fractionExpressed:n.numExpressed/t.size(),vector:t};f.push(i)}))})),f}function U(e){var t=Number.MAX_VALUE,n=-Number.MAX_VALUE,a=0,i=0;if(0===e.size())return{min:Number.NaN,max:Number.NaN,sum:Number.NaN,mean:Number.NaN,numExpressed:Number.NaN};for(var r=0,o=e.size();r<o;r++){var l=e.get(r);t=l<t?l:t,n=l>n?l:n,a+=l,0!==l&&i++}return{min:t,max:n,sum:a,mean:a/=e.size(),numExpressed:i}}function H(e,t,n){return"or"===n?new Set([].concat(Object(k.a)(e),Object(k.a)(t))):new Set(Object(k.a)(e).filter((function(e){return t.has(e)})))}function W(e,t){for(var n=new Set,a=0,i=e.length;a<i;a++)t(e[a])&&n.add(a);return n}function V(e,t){var n=null;if(t)for(var a=t.filters||[],i=t.combine||"and",r=function(t){var r=a[t],o=r[0],l=r[1],s=r[2],c=null;if(Object(b.isObject)(o)){var d=N(o.basis,o.nbins,o.agg,o.ndim||2,o.precomputed),u=d.coordinate_columns;if(s.points){if("index"!=(d.nbins?d.full_name:"index"))throw"Not implemented";c=new Set(s.points)}else{for(var h,p=s.path,f=function(t){var n=p[t],a=W(e[u[0]],(function(e){return e>=n.x&&e<=n.x+n.width})),i=W(e[u[1]],(function(e){return e>=n.y&&e<=n.y+n.height}));if(h=H(a,i,"and"),n.z){var r=W(e[u[2]],(function(e){return e>=n.z&&e<=n.z+n.depth}));h=H(h,r,"and")}},m=0;m<p.length;m++)f(m);c=c?H(h,c,i):h}}else{var v,g=T(o),j=e[g.name];if("in"===l)s=new Set(s),v=function(e){return s.has(e)};else if(">"===l)v=function(e){return e>s};else if("="===l)v=function(e){return e===s};else if("<"===l)v=function(e){return e<s};else if("!="===l)v=function(e){return e!==s};else if(">="===l)v=function(e){return e>=s};else{if("<="!==l)throw"Unknown filter: "+l;v=function(e){return e<=s}}c=W(j,v)}n=n?H(n,c,i):c},o=0;o<a.length;o++)r(o);return null!=n?Array.from(n):null}var G=function(){function e(){Object(O.a)(this,e)}return Object(M.a)(e,[{key:"init",value:function(e,t){var n=this;return this.id=e,this.key2data={},this.format="json",this.schema=null,(this.url.endsWith(".jsonl")||this.url.endsWith(".jsonl.gz"))&&(this.format="jsonl"),"json"!==this.format||t.endsWith(".json")||t.endsWith(".json.gz")||(t+="schema.json"),this.url=t,this.baseUrl=this.url.substring(0,this.url.lastIndexOf("/")+1),"jsonl"===this.format?new Promise((function(e,a){fetch(t+".idx.json").then((function(e){return e.json()})).then((function(e){n.key2bytes=e.index})).then((function(){fetch(t,n.getByteRange("schema")).then((function(e){return e.json()})).then((function(t){n.schema=t.schema,e()}))}))})):new Promise((function(e,a){fetch(t).then((function(e){return e.json()})).then((function(t){n.schema=t,e()}))}))}},{key:"getByteRange",value:function(e){var t=this.key2bytes[e];if(!t)throw e+" not found";return{headers:{Range:"bytes="+t[0]+"-"+t[1]}}}},{key:"_fetch",value:function(e){return"json"===this.format?fetch(this.baseUrl+e+".json").then((function(e){return e.json()})):fetch(this.url,this.getByteRange(e)).then((function(e){return e.json()}))}},{key:"fetchData",value:function(e){var t=this,n=[];return e.forEach((function(e){if(null==t.key2data[e]&&"__count"!==e){var a=t._fetch(e).then((function(n){if(Object(b.isArray)(n))t.key2data[e]=n;else if(n.index){for(var a=new Float32Array(t.schema.shape[0]),i=0,r=n.index.length;i<r;i++)a[n.index[i]]=n.value[i];t.key2data[e]=a}else t.key2data[e]=n}));n.push(a)}})),new Promise((function(e){Promise.all(n).then((function(){return e()}))}))}},{key:"getSelectedIdsPromise",value:function(e){var t=this,n=e.filter,a=L(n),i=a.basis,r=a.X,o=a.obs,l=[];return i.forEach((function(e){l.push(e.name)})),l.push("index"),l=l.concat(r).concat(o),new Promise((function(e){t.fetchData(l).then((function(){for(var a=V(t.key2data,n),i=t.getVector("index",a),r=[],o=0,l=i.size();o<l;o++)r.push(i.get(o));e({ids:r})}))}))}},{key:"getDataPromise",value:function(e,t){var n=this,a=[],i=[],r={};["stats","groupedStats","embedding","selection","values"].forEach((function(t){if(t in e){var n=e[t];Object(b.isArray)(n)||(n=[n]),n.forEach((function(e){e.dimensions&&(a=a.concat(e.dimensions)),e.measures&&(i=i.concat(e.measures))}))}}));var o=F(i),l=new Set;if(e.selection){var s=L(e.selection.filter),c=s.basis,d=s.X,u=s.obs;a=a.concat(u),i=i.concat(d);var h=e.selection.embeddings||[],p=[];h.forEach((function(e){var t=N(e.basis,e.nbins,e.agg,e.ndim||2,e.precomputed);l.add(t.name),p.push(t)})),e.selection.embeddings=p,c.forEach((function(e){l.add(e.name)}))}return e.embedding&&e.embedding.forEach((function(e){var t=N(e.basis,e.nbins,e.agg,e.ndim||2,e.precomputed);l.add(t.name),e.basis=t})),new Promise((function(i){n.fetchData(a.concat(o.obs).concat(o.X).concat(Array.from(l))).then((function(){if(e.embedding&&(r.embeddings=[],e.embedding.forEach((function(e){var t=n.getVector(e.basis.name).asArray();r.embeddings.push({name:e.basis.full_name,coordinates:t})}))),e.values){var a=e.values.dimensions||[],o=F(e.values.measures||[]),l={};a.concat(o.obs).concat(o.X).forEach((function(e){"__count"===e?(l[e]=new Int8Array(n.schema.shape[0]),l[e].fill(1)):l[e]=n.getVector(e).asArray()})),r.values=l}_(r,t),R(r,e,t),i(r)}))}))}},{key:"getSchemaPromise",value:function(){return Promise.resolve(this.schema)}},{key:"getVector",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.key2data[e],a=new I(e,n);return null!=t&&(a=new P(a,t)),a}},{key:"getFileUrl",value:function(e){return this.baseUrl+e}},{key:"getVectors",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=[];return e.forEach((function(e){var i=t.getVector(e,n);a.push(i)})),a}}]),e}();function X(e){var t=[];return e.forEach((function(e){for(var n=e.categories,a=e.name,i=0;i<e.values.length;i++)t.push({dimension:a,name:n[i],feature:e.values[i].name,mean:e.values[i].mean,fractionExpressed:e.values[i].fractionExpressed})})),t}var q=function(){function e(){Object(O.a)(this,e)}return Object(M.a)(e,[{key:"init",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.id=e,this.local=n,Promise.resolve()}},{key:"getSelectedIdsPromise",value:function(e,t){return e.id=this.id,this.local?null==t.index?this.getDataPromise({values:{dimensions:["index"]}},t).then((function(){for(var n=V(t,e.filter),a=[],i=t.index,r=0,o=n.length;r<o;r++)a.push(i[n[r]]);return{ids:a}})):void 0:fetch(It+"/selected_ids",{body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"getFileUrl",value:function(e){return It+"/file?id="+this.id+"&file="+e+"&access_token="+ea()}},{key:"getDataPromise",value:function(e,t){e.id=this.id;var n=e,a=this.local;this.local&&(n={},(e.embedding||e.values)&&(n.id=this.id,n.embedding=e.embedding,n.values=e.values));var i=JSON.stringify(n);return("{}"!==i?fetch(It+"/data",{body:i,method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+ea()}}).then((function(e){return e.json()})).then((function(e){return _(e,t),e})):Promise.resolve({})).then((function(n){return a?R(n,e,t):(n.distribution&&(n.distribution=X(n.distribution)),n.selection&&n.selection.distribution&&(n.selection.distribution=X(n.selection.distribution))),n}))}},{key:"getSchemaPromise",value:function(){return fetch(It+"/schema?id="+this.id,{headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}}]),e}(),Z=function(){function e(){Object(O.a)(this,e)}return Object(M.a)(e,[{key:"getUserPromise",value:function(){return fetch(It+"/user",{headers:{Authorization:"Bearer "+ea(),"Content-Type":"application/json"}}).then((function(e){return e.json()}))}},{key:"getDatasetsPromise",value:function(){return fetch(It+"/datasets",{headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"deleteDatasetPromise",value:function(e){return fetch(It+"/dataset",{body:JSON.stringify({id:e}),method:"DELETE",headers:{Authorization:"Bearer "+ea()}})}},{key:"upsertDatasetPromise",value:function(e,t){var n=null!=e;return null!=e&&(t.id=e),fetch(It+"/dataset",{body:JSON.stringify(t),method:n?"PUT":"POST",headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"getDatasetPromise",value:function(e){return fetch(It+"/dataset?id="+e,{method:"GET",headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"setCategoryNamePromise",value:function(e){return fetch(It+"/category_name",{body:JSON.stringify(e),method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+ea()}})}},{key:"upsertDatasetFilterPromise",value:function(e,t){return fetch(It+"/filter",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"upsertFeatureSet",value:function(e,t){return fetch(It+"/feature_set",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"deleteFeatureSet",value:function(e,t){return fetch(It+"/feature_set",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+ea()}})}},{key:"exportDatasetFiltersPromise",value:function(e){return fetch(It+"/export_filters?id="+e,{headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.ok?e.text():null}))}},{key:"deleteDatasetFilterPromise",value:function(e,t){return fetch(It+"/filter",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+ea()}})}},{key:"getDatasetFilterPromise",value:function(e,t){return fetch(It+"/filter?id="+e+"&ds_id="+t,{headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"getCategoryNamesPromise",value:function(e){return fetch(It+"/category_name?id="+e,{headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"getFiltersPromise",value:function(e){return fetch(It+"/filters?id="+e,{headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"submitJob",value:function(e){var t={id:e};return fetch(It+"/submit_job",{body:JSON.stringify(t),method:"POST",headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}},{key:"getJob",value:function(e){return fetch(It+"/job?id="+e,{headers:{Authorization:"Bearer "+ea()}}).then((function(e){return e.json()}))}}]),e}(),K=n(72),J=n(132),Y=n(16),$=n(83),Q=n(90),ee=n(39),te=n.n(ee),ne=n(112),ae=n(465),ie=n(424),re=n(279),oe=n(469),le=n(257),se=n.n(le),ce=n(258),de=n.n(ce),ue=n(253),he=n.n(ue),pe=n(256),fe=n.n(pe),me=n(251),be=n.n(me),ve=n(255),ge=n.n(ve),je=n(108),ye=n.n(je),Oe=n(259),xe=n.n(Oe),Se=n(252),we=n.n(Se),Ce=n(254),ke=n.n(Ce),Ee=n(168),De=n.n(Ee),Me=n(249),Pe=n.n(Me),Ie=n(250),Te=n.n(Ie),ze="cirro-active",Ae=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).setDragMode=function(e){a.props.onDragMode(e)},a.onShowLabels=function(){a.props.onShowLabels()},a.onShowAxis=function(){a.props.onShowAxis()},a.onShowFog=function(){a.props.onShowFog()},a.onGallery=function(){a.props.onGallery()},a.handleMoreOptions=function(){a.props.onMoreOptions()},a.setEditSelection=function(){a.props.onEditSelection()},a.handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){a.setState({saveImageEl:null}),a.props.onSaveImage(e)},a.state={saveImageEl:null},a}return Object(M.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dragmode,i=t.editSelection,o=t.showLabels,l=t.showAxis,s=this.state.saveImageEl;return Object(a.jsxs)(r.a.Fragment,{children:[this.props.onZoomIn&&Object(a.jsx)(ae.a,{title:"Zoom In",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:this.props.onZoomIn,children:Object(a.jsx)(Pe.a,{})})}),this.props.onZoomOut&&Object(a.jsx)(ae.a,{title:"Zoom Out",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:this.props.onZoomOut,children:Object(a.jsx)(Te.a,{})})}),this.props.onHome&&Object(a.jsx)(ae.a,{title:"Home",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"Home",onClick:this.props.onHome,children:Object(a.jsx)(be.a,{})})}),this.props.onDragMode&&Object(a.jsx)(ae.a,{title:"Lasso Select",children:Object(a.jsx)(ie.a,{edge:!1,size:"small",className:"lasso"===n?ze:"","aria-label":"Lasso Select",onClick:function(){return e.setDragMode("lasso")},children:Object(a.jsx)("svg",{className:"MuiSvgIcon-root",width:"24",height:"21",viewBox:"0 0 1031 1000",children:Object(a.jsx)("path",{d:"m1018 538c-36 207-290 336-568 286-277-48-473-256-436-463 10-57 36-108 76-151-13-66 11-137 68-183 34-28 75-41 114-42l-55-70 0 0c-2-1-3-2-4-3-10-14-8-34 5-45 14-11 34-8 45 4 1 1 2 3 2 5l0 0 113 140c16 11 31 24 45 40 4 3 6 7 8 11 48-3 100 0 151 9 278 48 473 255 436 462z m-624-379c-80 14-149 48-197 96 42 42 109 47 156 9 33-26 47-66 41-105z m-187-74c-19 16-33 37-39 60 50-32 109-55 174-68-42-25-95-24-135 8z m360 75c-34-7-69-9-102-8 8 62-16 128-68 170-73 59-175 54-244-5-9 20-16 40-20 61-28 159 121 317 333 354s407-60 434-217c28-159-121-318-333-355z",transform:"matrix(1 0 0 -1 0 850)"})})})}),this.props.onDragMode&&Object(a.jsx)(ae.a,{title:"Box Select",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"Box Select",onClick:function(){return e.setDragMode("select")},children:Object(a.jsx)(we.a,{className:"select"===n?ze:""})})}),this.props.onEditSelection&&Object(a.jsx)(ae.a,{title:"Append to selection",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"Append to selection",onClick:this.setEditSelection,children:Object(a.jsx)(he.a,{className:i?ze:""})})}),this.props.is3d&&Object(a.jsx)(ae.a,{title:this.props.animating?"Pause":"Animate",children:Object(a.jsxs)(ie.a,{edge:!1,size:"small","aria-label":this.props.animating?"Pause":"Animate",onClick:this.props.toggleAnimation,children:[!this.props.animating&&Object(a.jsx)(ke.a,{}),this.props.animating&&Object(a.jsx)(ge.a,{})]})}),this.props.onDragMode&&Object(a.jsx)(ae.a,{title:"Pan",children:Object(a.jsx)(ie.a,{edge:!1,size:"small",className:"pan"===n?ze:"","aria-label":"Pan",onClick:function(){return e.setDragMode("pan")},children:Object(a.jsx)("svg",{className:"MuiSvgIcon-root",viewBox:"0 0 1000 1000",height:"16",width:"16",children:Object(a.jsx)("path",{d:"m1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z",transform:"matrix(1 0 0 -1 0 850)"})})})}),this.props.onShowLabels&&Object(a.jsx)(ae.a,{title:"Show Categorical Labels",children:Object(a.jsx)(ie.a,{edge:!1,size:"small",className:o?ze:"","aria-label":"Show Labels",onClick:function(){return e.onShowLabels()},children:Object(a.jsx)(fe.a,{})})}),this.props.is3d&&this.props.onShowAxis&&Object(a.jsx)(ae.a,{title:"Show Axis",children:Object(a.jsx)(ie.a,{edge:!1,size:"small",className:l?ze:"","aria-label":"Show Axis",onClick:function(){return e.onShowAxis()},children:Object(a.jsx)(se.a,{})})}),this.props.is3d&&this.props.onShowFog&&Object(a.jsx)(ae.a,{title:"Show Fog",children:Object(a.jsx)(ie.a,{edge:!1,size:"small",className:this.props.showFog?ze:"","aria-label":"Show Fog",onClick:function(){return e.onShowFog()},children:Object(a.jsx)(de.a,{})})}),Object(a.jsx)(ae.a,{title:"Save Image",children:Object(a.jsx)(ie.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(a.jsx)(ye.a,{})})}),Object(a.jsxs)(re.a,{id:"save-image-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:this.handleSaveImageMenuClose,children:[Object(a.jsx)(oe.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(a.jsx)(oe.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),this.props.onMoreOptions&&Object(a.jsx)(ae.a,{title:"More Options",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"More Options",onClick:this.handleMoreOptions,children:Object(a.jsx)(De.a,{})})}),Object(a.jsx)(ae.a,{title:"Scroll To Gallery",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"Scroll To Gallery",onClick:this.onGallery,children:Object(a.jsx)(xe.a,{})})})]})}}]),n}(r.a.PureComponent),_e=n(260),Fe=n.n(_e),Ne=n(507),Le=Object(Ne.a)(".1f"),Re=Object(Ne.a)(".2f"),Be=Object(Ne.a)(","),Ue=Object(Ne.a)(".0f");function He(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:12,o=t.domain();if(o[0]!==o[1]){for(var l=10,s=e.createLinearGradient(0,0,i,r),c=Object(ne.a)().range([0,1]).domain(o).clamp(!0),d=o[0],u=(o[1]-o[0])/l,h=0;h<l;h++){h===l-1&&(d=o[1]);var p=c(d);if(!isNaN(p)){var f=t(d);s.addColorStop(p,f)}d+=u}e.fillStyle=s,e.fillRect(0,0,i,r),e.strokeStyle="LightGrey",e.strokeRect(0,0,i,r),a&&(e.textBaseline="top",e.fillStyle=n,e.textAlign="left",e.fillText(Le(o[0]),0,r+2),e.textAlign="right",e.fillText(Le(o[1]),i,r+2))}}var We=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).ref=r.a.createRef(),a.backingScale=1,a}return Object(M.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(t.font=Ve,He(t,r,i,this.props.label,a,n),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"render",value:function(){"undefined"!==typeof window&&"devicePixelRatio"in window&&(this.backingScale=window.devicePixelRatio);var e=this.props.height,t=this.props.width,n={width:t,height:e};return this.props.style&&(n=Object.assign({},n,this.props.style)),Object(a.jsx)("canvas",{width:t*this.backingScale,height:e*this.backingScale,ref:this.ref,style:n})}}]),n}(r.a.PureComponent);var Ve="12px Roboto Condensed,Helvetica,Arial,sans-serif",Ge="12px Helvetica,Arial,sans-serif";function Xe(e,t,n,a){var i,r=null,o={width:t.width,height:t.height},l=e.name;if("__count"===l&&(l="count"),"svg"!==a?((r=document.createElement("canvas")).width=100,r.height=100,i=r.getContext("2d")):i=new Fe.a(100,100),e.continuous)o.height+=150;else{var s=function(e,t,n){e.font="14px Helvetica";var a=e.measureText(t).width;return n.forEach((function(t){return a=Math.max(a,e.measureText(t).width)})),{width:a+14,height:12*n.length+4}}(i,l,e.colorScale.domain());o.width+=s.width,o.height=Math.max(s.height,t.height)}if("svg"===a?i=new window.C2S(o.width,o.height):(r.width=o.width*window.devicePixelRatio,r.height=o.height*window.devicePixelRatio,(i=r.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),i.fillStyle="white",i.fillRect(0,0,o.width,o.height)),n(i,t,a),e.continuous?(i.translate(t.width/2-75,t.height+2),He(i,e.colorScale)):(i.translate(t.width,2),function(e,t,n,a){e.font="14px Helvetica",e.textAlign="left",e.textBaseline="bottom";for(var i=0;i<a.length;i++){var r=a[i];e.fillStyle=t(r),e.fillRect(0,12*i,10,10),e.fillStyle="black",e.fillText(""+r,12,12*i+12)}}(i,e.colorScale,0,e.colorScale.domain())),"svg"===a){var c=i.getSerializedSvg(),d=new Blob([c],{type:"text/plain;charset=utf-8"});window.saveAs(d,l+".svg")}else r.toBlob((function(e){window.saveAs(e,l+".png",!0)}))}var qe=n(472),Ze=n(102),Ke=n(106),Je=n.n(Ke),Ye={Diverging:["interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral"],"Sequential (Single Hue)":["interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds"],"Sequential (Multi-Hue)":["interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateWarm","interpolateCool","interpolateCubehelixDefault","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateYlOrBr","interpolateYlOrRd"],Cyclical:["interpolateRainbow","interpolateSinebow"]},$e=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],Qe=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"],et="obs",tt="obsCat",nt="featureSet",at="metafeature";function it(e){for(var t=e.lastIndexOf("."),n=e.substring(t+1),a=!0,i=0,r=n.length;i<r;i++)if("0"!==n[i]){a=!1;break}return a&&(e=e.substring(0,e.lastIndexOf("."))),e}function rt(e){if("image"===e.type){for(var t=[],n=e.colorScale,a=function(e){return e.formatHex()},i=0,r=e.npoints;i<r;i++){var o=Object(K.e)(n(e.values[i]));t.push(a(o))}e.colors=t}else"scatter"===e.type?e.colors=function(e){for(var t=4,n=Object(ne.a)().domain([0,255]).range([0,1]),a=0,i=e.colorScale,r=e.x.length,o=new Float32Array(r*t),l=0;l<r;++l){var s=Object(K.e)(i(e.values[l]));o[a++]=n(s.r),o[a++]=n(s.g),o[a++]=n(s.b),o[a++]=1}return o}(e):"meta_image"===e.type&&function(){var t=e.colorScale,n=e.source,a=e.gallerySource,i=e.categoryToStats;if(i){var r=function(e){var r=i[e],o=e.replaceAll(" ","_");n.querySelectorAll('[id="'+o+'"]').forEach((function(e){e.style.fill=t(r.value)})),a.querySelectorAll('[id="'+o+'"]').forEach((function(e){e.style.fill=t(r.value)}))};for(var o in i)r(o)}}()}function ot(e){for(var t=e.length,n=new Uint32Array(t),a=0;a<t;a++)n[e[a]]=a+1;return n}function lt(e,t){for(var n=[],a=0,i=e.length;a<i;a++)n.push({value:e[a],index:a});return function(e,t){t?e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.index<t.index?-1:1})):e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.index<t.index?1:-1}));for(var n=new Uint32Array(e.length),a=0,i=e.length;a<i;a++)n[a]=e[a].index;return n}(n,t)}function st(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new Uint32Array(e),a=0;a<e;a++,t++)n[a]=t;return Object(qe.a)(n),n}function ct(e,t){for(var n=e.x,a=e.y,i=!1,r=0,o=t.length-1;r<t.length;o=r++){var l=t[r].x,s=t[r].y,c=t[o].x,d=t[o].y;s>a!=d>a&&n<(c-l)*(a-s)/(d-s)+l&&(i=!i)}return i}function dt(e){e.length>1&&(e=Je()(e));for(var t="M "+e[0].x+" "+e[0].y,n=1;n<e.length;n++)t+=" L "+e[n].x+" "+e[n].y;return t+=" Z"}function ut(e){return e.startsWith("interpolate")||(e="interpolate"+e),e}function ht(e){return Ze[ut(e)]}function pt(e,t){var n=[];t=new Set(t);for(var a=0,i=e.length;a<i;a++)t.has(e[a])&&n.push(a);return n}function ft(e,t){var n=new Set(t);e.forEach((function(e){var a=e.features;a&&a.forEach((function(e){n.has(e)||(t.push(e),n.add(e))}))}))}function mt(e,t){var n=[];return t.forEach((function(t){for(var a=0;a<e.length;a++)if(e[a].id===t){n.push(e[a]);break}})),n}function bt(e){var t=[],n=[],a=[],i=[],r=[],o=[];return e.forEach((function(e){"X"===e.type?t.push(e.value):e.type===et?n.push(e.value):e.type===tt?a.push(e.value):e.type===nt?i.push(e.value):e.type===at?o.push(e.value):"featureSetAdd"===e.type?r.push(e.value):console.log("Unknown type: "+e)})),{X:t,obs:n,obsCat:a,featureSets:i,metafeatures:o,featureSetsAdd:[]}}function vt(e,t,n){var a=function(e,t,n){return Math.min(Math.max(e,t),n)}((n-e)/(t-e),0,1);return a*a*(3-2*a)}function gt(e,t,n){return e*(1-n)+t*n}function jt(e,t,n,a,i,r){var o=new Y.Vector3;e.fillStyle=a.darkMode?"white":"black",e.strokeStyle=a.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",e.lineWidth=a.labelStrokeWidth,e.textAlign="center",e.textBaseline="middle";for(var l=i.width/2,s=i.height/2,c=0,d=0;c<t.length;c++,d+=3)o.x=n[d],o.y=n[d+1],o.z=n[d+2],o.project(r),o.x=o.x*l+l,o.y=-o.y*s+s,e.strokeText(t[c],o.x,o.y),e.fillText(t[c],o.x,o.y)}function yt(e,t){for(var n=0;n<e.visualizers.length;n++)if(e.visualizers[n].id===t)return e.visualizers[n]}var Ot=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t=a.props;Xe(t.traceInfo,t.chartSize,Object(b.bind)(a.drawContext,Object($.a)(a)),e)},a.onEditSelection=function(){a.props.chartOptions.editSelection=!a.props.chartOptions.editSelection,a.props.setChartOptions(a.props.chartOptions)},a.resetCamera=function(){a.scatterPlot.resetZoom()},a.onShowAxis=function(){var e=a.scatterPlot.scene.getObjectByName("axes");a.props.chartOptions.showAxis=!a.props.chartOptions.showAxis,e&&(e.visible=a.props.chartOptions.showAxis),a.props.setChartOptions(a.props.chartOptions)},a.onShowFog=function(){var e=yt(a.scatterPlot,St);a.props.chartOptions.showFog=!a.props.chartOptions.showFog,e.styles.fog.enabled=a.props.chartOptions.showFog,a.props.setChartOptions(a.props.chartOptions)},a.onDragMode=function(e){"pan"===e?a.scatterPlot.setInteractionMode("PAN"):"select"===e?(a.scatterPlot.setInteractionMode("SELECT"),a.scatterPlot.rectangleSelector.setSelectionMode("BOX")):"lasso"===e&&(a.scatterPlot.rectangleSelector.setSelectionMode("LASSO"),a.scatterPlot.setInteractionMode("SELECT")),a.props.chartOptions.dragmode=e,a.props.setChartOptions(a.props.chartOptions)},a.onToggleAnimation=function(){a.scatterPlot.orbitIsAnimating()?(a.scatterPlot.stopOrbitAnimation(),a.props.chartOptions.animating=!1):(a.scatterPlot.startOrbitAnimation(),a.props.chartOptions.animating=!0),a.props.setChartOptions(a.props.chartOptions)},a.containerElementRef=r.a.createRef(),a.tooltipElementRef=r.a.createRef(),a.scatterPlot=null,a.lastHoverIndex=-1,a.state={forceUpdate:!1},a}return Object(M.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.chartSize!==this.props.chartSize&&this.scatterPlot.resize(),this.init(),this.draw()}},{key:"componentDidMount",value:function(){this.init(),this.draw(),this.draw(),this.props.chartOptions.camera&&(this.scatterPlot.updateFromCameraDef(this.props.chartOptions.camera),this.props.chartOptions.camera=null,this.draw())}},{key:"componentWillUnmount",value:function(){}},{key:"calculatePointSize",value:function(e){var t=e.npoints,n=200/Math.log(t)/Math.log(8);return 3===e.dimensions?n:n/1.5}},{key:"drawContext",value:function(e,t,n){var a=this.props,i=a.obsCat,r=a.cachedData,o=a.traceInfo,l=a.markerOpacity,s=a.unselectedMarkerOpacity,c=a.selection,d=a.categoricalNames,u=a.chartOptions,h=this.calculatePointSize(o),p=this.props.pointSize,f=2*Math.PI,m=o.colors,b=o.positions,v=this.scatterPlot.camera,g=t.width,j=t.height;u.darkMode&&(e.fillStyle="black",e.fillRect(0,0,g,j));var y,O=g/2,x=j/2,S=Object(ne.a)().domain([0,1]).range([0,255]),w=o.npoints,C=3===o.dimensions,k=this.scatterPlot.scene.fog,E=yt(this.scatterPlot,St);if(!C){var D=.9/Math.atan(2),M=v.projectionMatrix.elements[0]+.3;y=h*(M<1?1+D*Math.atan(2*(M-1)):1+8.91267681314614*Math.atan(.02*(M-1)))}var P=y*p/4,I=new Y.Vector3,T=new Y.Vector4,z=E.points,A=z.modelViewMatrix.clone();A.multiplyMatrices(v.matrixWorldInverse,z.matrixWorld);var _,F=u.showFog,N=0===c.size;if(C){_=new Uint32Array(w);for(var L=0;L<w;L++)_[L]=L}else{for(var R=new Float32Array(w),B=0;B<w;B++)R[B]=b[3*B+2];_=lt(R,!0)}for(var U=0;U<w;U++){var H=_[U],W=3*H,V=4*H,G=N||c.has(H);I.x=b[W],I.y=b[W+1],I.z=b[W+2],I.project(v);var X=m[V],q=m[V+1],Z=m[V+2],K=G?l:s;if(C&&(T.x=b[W],T.y=b[W+1],T.z=b[W+2],T.w=1,T.applyMatrix4(A),P=(y=-h/T.z)*p/4,F)){var J=h/y*1.2,$=vt(k.near,k.far,J);X=gt(X,k.color.r,$),q=gt(q,k.color.g,$),Z=gt(Z,k.color.b,$)}I.x=I.x*O+O,I.y=-I.y*x+x,X=Math.round(S(X)),q=Math.round(S(q)),Z=Math.round(S(Z)),e.fillStyle="rgba("+X+","+q+","+Z+","+K+")",e.beginPath(),e.arc(I.x,I.y,P,0,f),e.closePath(),e.fill()}if(i.length>0){var Q=Dt(o.embedding,i,r),ee="svg"===n?"serif":"Roboto Condensed";e.font="bold "+u.labelFontSize+"px "+ee,jt(e,Pt(i,Q.labels,d),Q.positions,u,t,v)}}},{key:"init",value:function(){var e=this;if(null==this.scatterPlot){var t=this.containerElementRef.current;this.scatterPlot=Et(t,window.ApplePaySession,!0),"pan"===this.props.chartOptions.dragmode?this.scatterPlot.setInteractionMode("PAN"):"select"===this.props.chartOptions.dragmode?(this.scatterPlot.setInteractionMode("SELECT"),this.scatterPlot.rectangleSelector.setSelectionMode("BOX")):"lasso"===this.props.chartOptions.dragmode&&(this.scatterPlot.setInteractionMode("SELECT"),this.scatterPlot.rectangleSelector.setSelectionMode("LASSO"));var n=this.scatterPlot.scene.getObjectByName("axes");n&&(n.visible=this.props.chartOptions.showAxis),yt(this.scatterPlot,St).styles.fog.enabled=this.props.chartOptions.showFog,this.scatterPlot.hoverCallback=function(t){if(null==t)e.tooltipElementRef.current.innerHTML=" ";else{var n=e.props.traceInfo,a=n.positions,i=e.scatterPlot.camera,r=e.props.chartSize.width/2,o=e.props.chartSize.height/2,l=new Y.Vector3,s=-1;if(-1!==e.lastHoverIndex&&(l.x=a[3*e.lastHoverIndex],l.y=a[3*e.lastHoverIndex+1],l.z=a[3*e.lastHoverIndex+2],l.project(i),l.x=l.x*r+r,l.y=-l.y*o+o,Math.abs(l.x-t.x)<=2&&Math.abs(l.y-t.y)<=2&&(s=e.lastHoverIndex)),-1===s)for(var c=0,d=0;c<n.npoints;c++,4,d+=3)if(l.x=a[d],l.y=a[d+1],l.z=a[d+2],l.project(i),l.x=l.x*r+r,l.y=-l.y*o+o,Math.abs(l.x-t.x)<=2&&Math.abs(l.y-t.y)<=2){s=c;break}if(e.lastHoverIndex=s,-1!==s){var u=n.values[s],h=e.props.categoricalNames[n.name];if(h){var p=h[u];null!=p&&(u=p)}"number"===typeof u&&(u=Re(u)).endsWith(".00")&&(u=u.substring(0,u.lastIndexOf("."))),e.tooltipElementRef.current.innerHTML=""+u}else e.tooltipElementRef.current.innerHTML=" "}},this.scatterPlot.lassoCallback=function(t){for(var n=e.props.traceInfo,a=n.positions,i=e.scatterPlot.camera,r=e.props.chartSize.width/2,o=e.props.chartSize.height/2,l=new Y.Vector3,s=[],c=0,d=0;c<n.npoints;c++,4,d+=3)l.x=a[d],l.y=a[d+1],l.z=a[d+2],l.project(i),l.x=l.x*r+r,l.y=-l.y*o+o,ct(l,t)&&s.push(c);0===s.length?e.props.onDeselect({name:Tn(n.embedding)}):e.props.onSelected({name:Tn(n.embedding),clear:!e.props.chartOptions.editSelection,value:{basis:n.embedding,points:s}})},this.scatterPlot.boxCallback=function(t){if("PAN"!==e.scatterPlot.interactionMode){for(var n=e.props.traceInfo,a=n.positions,i=e.scatterPlot.camera,r=e.props.chartSize.width/2,o=e.props.chartSize.height/2,l=new Y.Vector3,s=[],c=0,d=0;c<n.npoints;c++,4,d+=3)l.x=a[d],l.y=a[d+1],l.z=a[d+2],l.project(i),l.x=l.x*r+r,l.y=-l.y*o+o,l.x>=t.x&&l.x<=t.x+t.width&&l.y>=t.y&&l.y<=t.y+t.height&&s.push(c);0===s.length?e.props.onDeselect({name:Tn(n.embedding)}):e.props.onSelected({name:Tn(n.embedding),clear:!e.props.chartOptions.editSelection,value:{basis:n.embedding,points:s}})}};var a=this.containerElementRef.current.querySelector("canvas");a.style.outline="0px";a.addEventListener("webglcontextlost",(function(t){console.log("lost webgl context"),t.preventDefault(),e.scatterPlot=null})),a.addEventListener("webglcontextrestored",(function(t){console.log("restored webgl context"),t.preventDefault(),e.setState({forceUpdate:!e.state.forceUpdate})}))}}},{key:"draw",value:function(){var e=this.props,t=e.obsCat,n=e.cachedData,a=e.traceInfo,i=e.markerOpacity,r=e.unselectedMarkerOpacity,o=e.selection,l=e.pointSize,s=e.chartOptions,c=e.categoricalNames;Mt(this.scatterPlot,a,o,i,r,l,c,s,t,n)}},{key:"render",value:function(){return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{className:this.props.classes.root,children:[Object(a.jsx)(Ae,{dragmode:this.props.chartOptions.dragmode,editSelection:this.props.chartOptions.editSelection,onGallery:this.props.onGallery,animating:this.props.chartOptions.animating,showFog:this.props.chartOptions.showFog,onShowFog:this.onShowFog,is3d:this.props.traceInfo&&null!=this.props.traceInfo.z,toggleAnimation:this.onToggleAnimation,onSaveImage:this.onSaveImage,onDragMode:this.onDragMode,onCopyImage:this.onCopyImage,onEditSelection:this.onEditSelection,onShowAxis:this.onShowAxis,onHome:this.resetCamera,showAxis:this.props.chartOptions.showAxis}),Object(a.jsx)(Q.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(a.jsx)("div",{style:{display:"inline-block",width:this.props.chartSize.width,height:this.props.chartSize.height},ref:this.containerElementRef})]})}}]),n}(r.a.PureComponent),xt=te()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},"& > .cirro-active":{fill:"rgb(220, 0, 78)",color:"rgb(220, 0, 78)"},"& > .cirro-inactive":{fill:"rgba(0, 0, 0, 0.26)",color:"rgba(0, 0, 0, 0.26)"},position:"absolute",top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(Ot),St="SPRITES",wt="SVG_LABELS";function Ct(e,t,n){var a=t[1]-t[0],i=n[1]-n[0];return(e-t[0])/a*i+n[0]}function kt(e){var t=1.2,n=e.width/e.height,a=-1.2,i=t,r=-1.2,o=t;n>1?(a*=n,i*=n):(o/=n,r/=n);var l=new Y.OrthographicCamera(a,i,o,r,-1e3,1e3);return l.up=new Y.Vector3(0,0,1),l.updateProjectionMatrix(),l.projectionMatrix.elements[0]}function Et(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Object(J.makeStyles)();i.label3D.fontSize=40;var r=new J.ScatterPlot(e,{camera:{},selectEnabled:!1,styles:i,interactive:a},t),o=[new J.ScatterPlotVisualizerSprites(i)];return n&&o.push(new J.ScatterPlotVisualizerSvgLabels(e,i)),r.setActiveVisualizers(o),r}function Dt(e,t,n){var a=[];t.forEach((function(e){var t=n[e];a.push(t)}));var i=Tn(e),r=n[i];if(null==r)throw"Coordinates not found for "+e.name;for(var o,l,s,c,d,u,h=r[e.name+"_1"],p=r[e.name+"_2"],f=r[e.name+"_3"],m=null!=f,b={},v=0,g=null!=e.spatial,j=h.length,y=t.length,O=0;O<j;O++){for(var x=[],S=0;S<y;S++)x.push(a[S][O]);var w=x.join(","),C=b[w];void 0===C&&(C={x:[],y:[],z:[],array:x},b[w]=C,v++),C.count++,C.x.push(h[O]),C.y.push(p[O]),m&&C.z.push(f[O])}if(!g){var k=function(e){return Math.abs(e[1]-e[0])};c=[1/0,-1/0],d=[1/0,-1/0],u=m?[1/0,-1/0]:[0,1];for(var E=0;E<j;E++){var D=h[E];D<c[0]&&(c[0]=D),D>c[1]&&(c[1]=D),(D=p[E])<d[0]&&(d[0]=D),D>d[1]&&(d[1]=D),m&&((D=f[E])<u[0]&&(u[0]=D),D>u[1]&&(u[1]=D))}var M=k(c),P=k(d),I=k(u),T=Math.max(M,P,I),z=function(e,t){return[e/T*-t,t*(e/T)]};o=z(M,1),l=z(P,1),s=z(I,1)}var A=[],_=new Float32Array(3*v),F=0;for(var N in b){var L=b[N];A.push(L.array),L.x.sort((function(e,t){return e-t})),L.y.sort((function(e,t){return e-t})),L.z.sort((function(e,t){return e-t}));var R=L.x.length/2,B=R%1?L.x[R-.5]:(L.x[R-1]+L.x[R])/2,U=R%1?L.y[R-.5]:(L.y[R-1]+L.y[R])/2,H=R%1?L.z[R-.5]:(L.z[R-1]+L.z[R])/2;g||(B=Ct(B,c,o),U=Ct(U,d,l),H=Ct(H,u,s)),_[F]=B,_[F+1]=U,_[F+2]=m?H:0,F+=3}return{labels:A,positions:_}}function Mt(e,t,n,a,i,r){for(var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,d=t.colors,u=t.positions,h=t.npoints,p=0===n.size,f=0,m=3,b=2;f<h;f++,m+=4,b+=3){var v=p||n.has(f);d[m]=v?a:i}e.scene.background=l.darkMode?new Y.Color("rgb(0, 0, 0)"):null,e.setDimensions(t.dimensions);var g=yt(e,St);g.styles.fog.enabled=l.showFog;var j=e.scene.getObjectByName("axes");j&&(j.visible=l.showAxis),e.setPointColors(d),e.setPointPositions(u);var y=new Float32Array(t.npoints);y.fill(r),e.setPointScaleFactors(y);var O=s.length>0,x=yt(e,wt);if(x&&(x.labelsActive=O,O)){var S=Tn(t.embedding)+"_"+s.join(","),w=c[S];null==w&&(w=Dt(t.embedding,s,c),c[S]=w),x.fillStyle=l.darkMode?"white":"black",x.shadowColor=l.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",x.shadowStroke=l.labelStrokeWidth,x.font="bold "+l.labelFontSize+"px Roboto Condensed";var C=Pt(s,w.labels,o);x.setLabels(C,w.positions)}e.render()}function Pt(e,t,n){var a=[],i=[];e.forEach((function(e){return i.push(n[e]||{})}));for(var r=0;r<t.length;r++){for(var o=t[r],l=[],s=0;s<o.length;s++){var c=i[s][o[s]];l.push(null!=c?c:o[s])}a.push(l.join(","))}return a}var It="api",Tt=["email"],zt="SET_EMBEDDING_LABELS",At="SET_DISTRIBUTION_PLOT_INTERPOLATOR",_t="SET_CHART_OPTIONS",Ft="SET_COMBINE_DATASET_FILTERS",Nt="SET_DATASET_FILTERS",Lt="SET_PRIMARY_TRACE_KEY",Rt="SET_CHART_SIZE",Bt="SET_PRIMARY_CHART_SIZE",Ut="SET_SERVER_INFO",Ht="SET_DATASET_FILTER",Wt="ADD_DATASET",Vt="DELETE_DATASET",Gt="UPDATE_DATASET",Xt="SET_GLOBAL_FEATURE_SUMMARY",qt="SET_SAVED_DATASET_STATE",Zt="SET_DOMAIN",Kt="SET_CATEGORICAL_COLOR",Jt="SET_CATEGORICAL_NAME",Yt="SET_MARKER_OPACITY",$t="SET_UNSELECTED_MARKER_OPACITY",Qt="SET_SELECTION",en="SET_FEATURE_SUMMARY",tn="SET_SEARCH_TOKENS",nn="SET_SELECTED_EMBEDDING",an="SET_NUMBER_OF_BINS",rn="SET_BIN_VALUES",on="SET_BIN_SUMMARY",ln="SET_MESSAGE",sn="SET_INTERPOLATOR",cn="SET_POINT_SIZE",dn="SET_EMAIL",un="SET_USER",hn="SET_DATASET",pn="SET_MARKERS",fn="SET_DIALOG",mn="MORE_OPTIONS_DIALOG",bn="EDIT_DATASET_DIALOG",vn="IMPORT_DATASET_DIALOG",gn="SAVE_DATASET_FILTER_DIALOG",jn="SAVE_FEATURE_SET_DIALOG",yn="HELP_DIALOG",On="DELETE_DATASET_DIALOG",xn="SET_DATASET_CHOICES",Sn="RESTORE_VIEW",wn="SET_DISTRIBUTION_DATA",Cn="SET_SELECTED_DISTRIBUTION_DATA",kn="SET_DISTRIBUTION_PLOT_OPTIONS",En="SET_EMBEDDING_DATA",Dn="SET_LOADING",Mn="SET_TAB",Pn="LOADING_APP";function In(e){return e.bin||e.precomputed}function Tn(e){var t=e.name;return e.dimensions&&(t+="_"+e.dimensions),(e.bin||e.precomputed)&&(t+="_"+e.nbins+"_"+e.agg),t}function zn(e){return e.name+"_"+Tn(e.embedding)}function An(e){var t={basis:e.name,ndim:e.dimensions};return e.precomputed&&(t.precomputed=!0),e.bin&&(t.nbins=e.nbins,t.agg=e.agg),t}function _n(){return function(e,t){window.gapi.auth2.getAuthInstance().signOut().then((function(){e({type:dn,payload:null}),e(da(null))}))}}function Fn(e){var t=[];for(var n in e){var a=e[n],i=null;if(window.Array.isArray(a))i=[n,"in",a];else if(null!=a.basis){var r=a.points;r.length>1?function(){var e=new Set;r.forEach((function(t){return t.forEach((function(t){return e.add(t)}))})),r=Array.from(e)}():r=r[0],i=[An(a.basis),"in",{points:r}]}else""===a.operation||isNaN(a.value)||null==a.value||(i=[n,a.operation,a.value]);null!=i&&t.push(i)}return t}function Nn(e){var t=Fn(e.datasetFilter);if(t.length>0){for(var n=e.dataset.obs,a=e.dataset.obsCat,i=0;i<t.length;i++)-1===a.indexOf(t[i][0])&&-1===n.indexOf(t[i][0])||(t[i][0]="obs/"+t[i][0]);return{filters:t,combine:e.combineDatasetFilters}}}function Ln(e){return{type:kn,payload:e}}function Rn(e){return{type:_t,payload:e}}function Bn(e){return function(t,n){t(function(e){return{type:Ft,payload:e}}(e)),t(Gn())}}function Un(e){return{type:Lt,payload:e}}function Hn(e){return{type:Ht,payload:e}}function Wn(e){return{type:Qt,payload:e}}function Vn(e){return{type:en,payload:e}}function Gn(){return function(e,t){e(la(!0));var n=t(),a=bt(n.searchTokens),i=Nn(n);ft(mt(n.markers,a.featureSets),a.X);var r={selection:{measures:a.X.concat(a.obs.map((function(e){return"obs/"+e}))),dimensions:a.obsCat}};i&&(r.selection.filter=i);var o=null==n.selection.chart||0===Object.keys(n.selection.chart).length;if(null==i)return o||e(Wn({chart:{}})),e(ua([])),e(Vn({})),void e(la(!1));var l=n.embeddings;r.selection.embeddings=l.map((function(e){return An(e)}));var s=n.cachedData;t().dataset.api.getDataPromise(r,s).then((function(t){e(ba(t.selection,!0))})).catch((function(t){ja(e,t)})).finally((function(){return e(la(!1))}))}}function Xn(e){return function(t,n){var a=e.name,i=e.value,r=e.clear,o=n().datasetFilter;if(i&&In(i.basis)){var l=n().cachedData[Tn(i.basis)].bins;i.points=function(e,t){for(var n=[],a=0,i=e.length;a<i;a++)n.push(t[e[a]]);return n}(i.points,l)}var s=!0;null==i?(s=null!=o[a],delete o[a]):r?o[a]={basis:i.basis,points:[i.points]}:null!=o[a]?o[a].points.push(i.points):o[a]={basis:i.basis,points:[i.points]};s&&(t(Hn(Object.assign({},o))),t(Gn()))}}function qn(e){return{type:Jt,payload:e}}function Zn(e){return{type:un,payload:e}}function Kn(){return function(e,t){var n=t().dataset,a=n.embeddings.map((function(e){return e.name})),i=["tissue_hires","fle","umap","tsne"],r={};a.forEach((function(e){for(var t=e.toLowerCase(),n=0;n<i.length;n++)if(-1!==t.indexOf(i[n])){r[e]=n;break}})),a.sort((function(e,t){return(e=r[e]||Number.MAX_VALUE)-(t=r[t]||Number.MAX_VALUE)})),a.length>0&&e(pa([n.embeddings[n.embeddings.map((function(e){return e.name})).indexOf(a[0])]]))}}function Jn(){return function(e,t){null==t().dataset&&1===t().datasetChoices.length&&e(ma(t().datasetChoices[0].id))}}function Yn(e){return function(t,n){if(null!=e.colorScheme){var a=ht(e.colorScheme);null!=a&&(e.colorScheme={name:e.colorScheme,value:a})}if(null!=e.datasetFilter)for(var i in e.datasetFilter){var r=e.datasetFilter[i];window.Array.isArray(r)||(r.uiValue=r.value)}else e.datasetFilter={};t(la(!0)),(null!=e.dataset?t(ma(e.dataset,!1,!1)):Promise.resolve()).then((function(){var t=n().dataset;if(e.embeddings){var a=t.embeddings.map((function(e){return Tn(e)})),i=[];e.embeddings.forEach((function(e){var n=a.indexOf(Tn(e));-1!==n&&i.push(t.embeddings[n])})),e.embeddings=i,null!=e.camera&&(e.chartOptions.camera=e.camera)}})).then((function(){return t(Hn(e.datasetFilter))})).then((function(){return t({type:Sn,payload:e})})).then((function(){return t(ga())})).then((function(){return t(Gn())})).then((function(){null!=e.distributionPlotOptions&&t(Ln(e.distributionPlotOptions));var n=e.primaryTraceKey;null==n&&e.embeddings&&e.embeddings.length>0&&null!=e.q&&e.q.length>0&&(n=e.q[0]+"_"+Tn(e.embeddings[0])),null!=n&&t(Un(n))})).finally((function(){return t(la(!1))})).catch((function(e){console.log(e),t(aa("Unable to restore saved view.")),t(Jn())}))}}function $n(){return function(e,t){var n={dataset:null},a=window.location.search.substring(3);if(a.length>0)try{n=JSON.parse(window.decodeURIComponent(a))}catch(i){return e(aa("Unable to restore saved view."))}null!=n.dataset?e(Yn(n)):e(Jn())}}function Qn(e){return function(t,n){if(window.gapi.auth2.getAuthInstance().isSignedIn.get()){var a=window.gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail();t(ha(a)),t((function(e,t){t().serverInfo.api.getUserPromise().then((function(t){return e(Zn(t))}))})),t(ya()).then((function(){e&&t($n())}))}}}function ea(){return"undefined"!==typeof window.gapi?window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token:""}function ta(e){return function(t,n){var a=e.name,i=e.url;if(""!==a&&""!==i){var r=e.readers,o=e.description,l=e.title;t(la(!0));var s=null!=e.dataset,c=n().serverInfo,d=!s||i!==e.dataset.url;Promise.resolve({ok:!0}).then((function(e){})).then((function(){return n().serverInfo.api.upsertDatasetPromise(e.dataset?e.dataset.id:null,{name:a,readers:r,description:o,title:l,url:i})})).then((function(e){var n={name:a,id:e.id,title:l,url:i,readers:r,description:o,owner:!0};s?(t(function(e){return{type:Gt,payload:e}}(n)),t(aa("Dataset updated"))):(t(function(e){return{type:Wt,payload:e}}(n)),c.email&&t(aa(d?"Please ensure that "+c.email+' is a "Storage Object Viewer"':"Dataset created")))})).finally((function(){t(la(!1)),t(ra(null))})).catch((function(e){ja(t,e)}))}}}function na(e){return function(t,n){t(la(!0)),n().serverInfo.api.deleteDatasetPromise(e.dataset.id).then((function(){t(da(null)),t(function(e){return{type:Vt,payload:e}}({id:e.dataset.id})),t(ra(null)),t(aa("Dataset deleted"))})).finally((function(){t(la(!1)),t(ra(null))})).catch((function(e){ja(t,e,"Unable to delete dataset. Please try again.")}))}}function aa(e){return{type:ln,payload:e}}function ia(e){return{type:En,payload:e}}function ra(e){return{type:fn,payload:e}}function oa(e){return{type:pn,payload:e}}function la(e){return{type:Dn,payload:e}}function sa(e){return{type:Mn,payload:e}}function ca(e){return{type:Pn,payload:e}}function da(e){return{type:hn,payload:e}}function ua(e){return{type:Cn,payload:e}}function ha(e){return{type:dn,payload:e}}function pa(e){return function(t,n){var a=n().embeddings;t({type:nn,payload:e}),t(ga((function(e){t({type:nn,payload:a})})))}}function fa(e){return{type:Nt,payload:e}}function ma(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a,i){n&&a(la(!0));for(var r=i().savedDatasetState[e],o=i().datasetChoices,l=null,s=0;s<o.length;s++)if(o[s].id===e){l=o[s];break}if(null==l)return a(la(!1)),a(aa("Unable to find dataset")),Promise.reject("Unable to find dataset");var c,d=Object.assign({},l);d.id=e,d.embeddings=[],d.features=[],d.obs=[],d.obsCat=[],a(da(d));var u,h=[];var p="direct"===d.access;return d.api=p?new G:new q,d.api.init(e,d.url).then((function(){var e=[];if(!p){var t=i().serverInfo.api.getCategoryNamesPromise(d.id).then((function(e){c=e})),n=i().serverInfo.api.getFiltersPromise(d.id).then((function(e){h=e}));e.push(t),e.push(n)}var a=d.api.getSchemaPromise().then((function(e){u=e}));return e.push(a),e})).then((function(e){return Promise.all(e)})).then((function(){return function(){if((u=Object.assign({},d,u)).embeddings)for(var n=0;n<u.embeddings.length;n++)null!=u.embeddings[n].nbins?(u.embeddings[n].bin=!0,u.embeddings[n].precomputed=!0):(u.embeddings[n].nbins=500,u.embeddings[n]._nbins=500,u.embeddings[n].bin=!1,u.embeddings[n].agg="max");u.api=d.api,u.features=u.var,u.features.sort((function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e[0]>="0"&&e[0]<="9"&&(e="zzzzzz"+e),t[0]>="0"&&t[0]<="9"&&(t="zzzzzz"+t),e<t?-1:e===t?0:1})),u.id=e,a(da(u)),null!=c&&c.forEach((function(e){a(qn({name:e.category,oldValue:e.original,value:e.new}))})),a(fa(h)),r?a(Yn(r)):t&&a(Kn())}()})).finally((function(){n&&a(la(!1))})).catch((function(e){ja(a,e,"Unable to retrieve dataset. Please try again.")}))}}function ba(e,t){return function(n,a){var i=a();if(e){var r=e.coordinates;if(null!=r){var o={};for(var l in r){var s=r[l].indices_or_bins,c=i.embeddings[i.embeddings.map((function(e){return Tn(e)})).indexOf(l)];if(null!=c){var d=s;if(In(c))d=pt(i.cachedData[Tn(c)].bins,s);o[l]={userPoints:new Set(d),points:s}}else console.log(l+" missing")}n(Wn({count:e.count,chart:o}))}else{var u=null==i.selection.chart||0===Object.keys(i.selection.chart).length;t&&!u&&n(Wn({count:e.count,chart:{}}))}if(e.summary){var h=t?e.summary:Object.assign(a().featureSummary,e.summary);n(Vn(Object.assign({},h)))}if(e.distribution){var p=i.selectedDistributionData;t&&(p=[]);var f=bt(i.searchTokens);ft(mt(i.markers,f.featureSets),f.X),n(ua(p=va(e.distribution,p,f)))}}}}function va(e,t,n){var a=[n.obsCat.join("-")];t=t.filter((function(e){return-1!==a.indexOf(e.dimension)&&-1!==n.X.indexOf(e.feature)})),e&&(e.forEach((function(e){for(var n=0;n<t.length;n++)if(t[n].dimension===e.dimension&&t[n].feature===e.feature){t.splice(n,1);break}})),t=t.concat(e));var i={};return n.X.forEach((function(e,t){i[e]=t})),t.sort((function(e,t){return(e=i[e.feature])-(t=i[t.feature])})),t}function ga(e){return function(t,n){var a=n();if(null!=a.dataset){t(la(!0));var i=bt(a.searchTokens);ft(mt(a.markers,i.featureSets),i.X);var r=(i.X.length>0||i.featureSets.length>0)&&i.obsCat.length>0,o=a.embeddings,l=a.distributionData,s=a.selectedDistributionData,c=a.embeddingData,m=a.globalFeatureSummary,b=a.cachedData,v=[],j=new Set,O=[],x=new Set,S=new Set,w=Nn(a);i.X.concat(i.obs).concat(i.obsCat).concat(i.metafeatures).forEach((function(e){S.add(e)}));var C=[];o.forEach((function(e){var t=Tn(e);if(x.add(t),null==b[t]&&(e.dimensions>0?v.push(e):(null==b[e.attrs.group]&&j.add(e.attrs.group),e.attrs.selection.forEach((function(e){null==b[e[0]]&&j.add(e[0])})),C.push(e))),In(e)){var n={values:[],embedding:e};S.forEach((function(e){null==b[e+"_"+t]&&n.values.push(e)})),n.values.length>0&&O.push(n)}}));var k=[];if(C.forEach((function(e){var t=Tn(e);if(null==b[t]){var n=a.dataset.api.getFileUrl(e.image),i=new Promise((function(e,a){fetch(n).then((function(e){return e.text()})).then((function(e){return document.createRange().createContextualFragment(e).firstElementChild})).then((function(n){if(n.querySelector("style")){var a=document.createElement("div");a.style.display="none",a.appendChild(n),document.body.appendChild(a);for(var i=n.querySelector("style"),r=i.sheet.rules,o=0;o<r.length;o++)for(var l=r[o],s=n.querySelectorAll(l.selectorText),c=l.styleMap,u=0;u<s.length;u++){var h,p=s[u],f=Object(d.a)(c.keys());try{for(f.s();!(h=f.n()).done;){var m=h.value;p.style[m]=c.get(m).toString()}}catch(v){f.e(v)}finally{f.f()}}a.remove(),i.remove()}b[t]=n,e()}))}));k.push(i)}})),null!=w)(function(e){var t=new Set,n=new Set;for(var a in e){var i=e[a];window.Array.isArray(i)?t.add(a):null!=i.basis?n.add(i.basis):""===i.operation||isNaN(i.value)||null==i.value||t.add(a)}return{features:t,basis:n}})(a.datasetFilter).features.forEach((function(e){null==b[e]&&j.add(e)}));S.forEach((function(e){null==b[e]&&j.add(e)})),c.forEach((function(e){var t=Tn(e.embedding),n=x.has(t)&&(S.has(e.name)||0===S.size&&"__count"===e.name);n&&(e.date=new Date),e.active=n}));var E=i.obsCat.slice(),D=[E.join("-")],M=new Set;if(r){var P={};l.forEach((function(e){P[e.name+"-"+e.feature]=!0})),D.forEach((function(e){i.X.forEach((function(t){null==P[e+"-"+t]&&M.add(t)}))}))}var I={};if(v.length>0||O.length>0){I.embedding=[];var T=v.map((function(e){return Tn(e)}));O.forEach((function(e){var t=An(e.embedding);t.dimensions=[],t.measures=[],t.coords=-1!==T.indexOf(Tn(e.embedding)),I.embedding.push(t),e.values.forEach((function(e){-1!==i.obsCat.indexOf(e)?t.dimensions.push(e):-1!==i.obs.indexOf(e)?t.measures.push("obs/"+e):t.measures.push(e)}))}));var z=O.map((function(e){return Tn(e.embedding)}));v.forEach((function(e){if(-1===z.indexOf(Tn(e))){var t=An(e);t.coords=!0,I.embedding.push(t)}}))}if(j.size>0){var A=a.dataset;I.values={measures:[],dimensions:[]},j.forEach((function(e){-1!==A.obsCat.indexOf(e)?I.values.dimensions.push(e):-1!==A.obs.indexOf(e)?I.values.measures.push("obs/"+e):-1!==i.metafeatures.indexOf(e)?I.values.measures.push("metagenes/"+e):I.values.measures.push(e)}))}var _=[],F=[],N=[];i.X.forEach((function(e){null==m[e]&&_.push(e)})),i.obs.forEach((function(e){null==m[e]&&F.push("obs/"+e)})),i.obsCat.forEach((function(e){null==m[e]&&N.push(e)})),(_.length>0||F.length>0||N.length>0)&&(I.stats={measures:_.concat(F),dimensions:N}),E.length>0&&M.size>0&&(I.groupedStats={measures:Array.from(M),dimensions:[E]}),null!=w&&(_.length>0||N.length>0)&&(I.selection={filter:w,measures:N.length>0?i.X:_,dimensions:i.obsCat});var L=[Object.keys(I).length>0?a.dataset.api.getDataPromise(I,b):Promise.resolve({})].concat(k);return Promise.all(L).then((function(e){var n=e[0],r=n.summary||{};for(var o in r)m[o]=r[o];t({type:Xt,payload:m}),function(e,t){var n=e.embeddings,a=e.embeddingData,i=e.dataset.obsCat,r=e.globalFeatureSummary,o=e.interpolator,l=e.dataset,s=e.cachedData,c=new Set;a.forEach((function(e){var t=Tn(e.embedding),n=e.name+"_"+t;c.add(n)})),0===t.size&&t.add("__count");n.forEach((function(e){var n=Tn(e),d=In(e),m=null!=e.spatial?e.spatial.type:e.type?e.type:"scatter",b="meta_image"!==m?s[n]:null,v="meta_image"!==m?b[e.name+"_1"]:null,j="meta_image"!==m?b[e.name+"_2"]:null,O="meta_image"!==m?b[e.name+"_3"]:null,x=d?b.bins:null;t.forEach((function(t){var b=t+"_"+n,S=t;if(!c.has(b)){d&&(S=b);var w=r[t],C=s[S];null!=C||"__count"!==t||d||(C=new Int8Array(l.shape[0])).fill(1);void 0!==C.value&&(C.purity,C=C.value);var k="__count"!==t&&-1!==i.indexOf(t),E=null;if(k){var D=w.categories,M=l.colors?l.colors[t]:null;null!=M&&M.length!==D.length&&(M=null),null==M&&(M=D.length<=10?p.a:D.length<=12?f.a:D.length<=20?$e:$e.concat(Qe)),(E=Object(h.a)(M).domain(D)).summary=w}else{if(y()(C)){for(var P=new Float32Array(l.shape[0]),I=0,T=C.index.length;I<T;I++)P[C.index[I]]=C.values[I];C=P}if(null==w||"__count"===t){for(var z=Number.MAX_VALUE,A=-Number.MAX_VALUE,_=0,F=0,N=C.length;F<N;F++){var L=C[F];z=L<z?L:z,A=L>A?L:A,_+=L}w={min:z,max:A,mean:_/C.length},r[t]=w}var R=[w.min,w.max];null==w.customMin||isNaN(w.customMin)||(R[0]=w.customMin),null==w.customMax||isNaN(w.customMax)||(R[1]=w.customMax),E=Object(u.a)(o.value).domain(R)}var B={embedding:Object.assign({},e),name:t,x:v,y:j,z:null!=O?O:void 0,bins:x,dimensions:null!=O?3:2,npoints:C.length,date:new Date,active:!0,colorScale:E,continuous:!k,isCategorical:k,values:C,type:m};if("scatter"===m&&(B.positions=function(e){var t,n=[1/0,-1/0],a=[1/0,-1/0],i=[1/0,-1/0],r=e.x.length,o=null!=e.z;o||(t=e.isCategorical?st(e.values.length,1):ot(lt(e.values,!0)),i[0]=0,i[1]=1);for(var l=0;l<r;l++){var s=e.x[l];s<n[0]&&(n[0]=s),s>n[1]&&(n[1]=s);var c=e.y[l];if(c<a[0]&&(a[0]=c),c>a[1]&&(a[1]=c),o){var d=e.z[l];d<i[0]&&(i[0]=d),d>i[1]&&(i[1]=d)}}for(var u=function(e){return Math.abs(e[1]-e[0])},h=u(n),p=u(a),f=u(i),m=Math.max(h,p,f),b=function(e,t){return[e/m*-t,t*(e/m)]},v=b(h,1),g=b(p,1),j=b(f,1),y=new Float32Array(3*r),O=0,x=0;x<r;x++)y[O++]=Ct(e.x[x],n,v),y[O++]=Ct(e.y[x],a,g),y[O++]=Ct(o?e.z[x]:t[x]/(t.length+1),i,j);return y}(B)),"meta_image"===m){var U=s[Tn(e)];if(B.source=U.cloneNode(!0),B.gallerySource=U.cloneNode(!0),"__count"!==B.name){for(var H=s[B.embedding.attrs.group],W=B.embedding.attrs.selection,G=V(s,{filters:W}),X={},q=0,Z=G.length;q<Z;q++){var K=G[q],J=H[K],Y=X[J];null==Y&&(Y=[],X[J]=Y),Y.push(B.values[K])}function $(e){var t={};if(k)for(var n in e){for(var a=e[n],i={},r=0,o=a.length;r<o;r++){var l=a[r];i[l]=(i[l]||0)+1}var s=0,c=void 0;for(var d in i){var u=i[d];u>s&&(s=u,c=d)}t[n]={value:c,n:a.length}}else for(var h in e){for(var p=e[h],f=0,m=0,b=p.length;m<b;m++)f+=p[m];var v=f/p.length;t[h]={value:v,n:p.length}}return t}B.categoryToStats=$(X)}}if(rt(B),"image"===m){B.indices=k?st(B.values.length):lt(B.values,!0);var Q=l.api.getFileUrl(e.spatial.image);B.tileSource=new g.a.ImageTileSource({url:Q,buildPyramid:!0,crossOriginPolicy:"Anonymous"})}a.push(B)}}))}))}(a,S),t(function(e){return{type:wn,payload:e}}(va(n.distribution,l,i))),t(ia(c.slice())),n.selection?t(ba(n.selection)):t(ua(va(null,s,i)))})).finally((function(){t(la(!1))})).catch((function(n){ja(t,n,"Unable to retrieve data. Please try again."),e&&e(n)}))}}}function ja(e,t,n){if(console.log(t),401===t.status)return e(aa("Your session has expired. Please login again.")),e(_n());null==n&&(n=t instanceof C?t.message:"An unexpected error occurred. Please try again."),e(aa(new Error(n)))}function ya(){return function(e,t){return e(la(!0)),t().serverInfo.api.getDatasetsPromise().then((function(t){e({type:xn,payload:t})})).finally((function(){e(la(!1))})).catch((function(t){ja(e,t,"Unable to retrieve datasets. Please try again.")}))}}var Oa=n(512),xa=n(476),Sa=n(486),wa=n(487),Ca=n(514),ka=n(505),Ea=n(277),Da=n(6),Ma=n(276),Pa=n.n(Ma),Ia=n(474),Ta=n(52),za=n(485),Aa=n(483),_a=n(477),Fa=n(467),Na=n(482),La=n(508),Ra=n(484),Ba=n(268),Ua=n.n(Ba),Ha=n(266),Wa=n.n(Ha),Va=n(267),Ga=n.n(Va),Xa=n(265),qa=n.n(Xa),Za=n(110),Ka=n.n(Za),Ja=n(479),Ya=n(468),$a=n(425),Qa=n(481),ei=n(480),ti=n(478),ni=n(263),ai=n.n(ni),ii=n(262),ri=n.n(ii),oi=n(264),li=n.n(oi),si=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleClick=function(e){a.setState({anchorEl:e.currentTarget,searchText:""})},a.handleClose=function(){a.setState({anchorEl:null,searchText:""})},a.handleCloseDatasetDetails=function(e){a.setState({datasetDetailsEl:null,selectedDataset:null})},a.handleListItemDetailsClick=function(e,t){a.setState({datasetDetailsEl:e.currentTarget}),a.props.serverInfo.api.getDatasetPromise(t).then((function(e){a.setState({selectedDataset:e})}))},a.handleListItemClick=function(e){e!==(null!=a.props.dataset?a.props.dataset.id:null)&&a.props.onChange(e),a.setState({anchorEl:null,searchText:""})},a.handleClearSearchText=function(){a.setState({searchText:""})},a.onSearchChange=function(e){a.setState({searchText:e.target.value})},a.state={anchorEl:null,searchText:"",datasetDetailsEl:null,selectedDataset:null},a}return Object(M.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,i=t.datasetChoices,o=null!=n?n.id:null;if(i.length<=1&&null!=o)return null;var l=this.state,s=l.anchorEl,c=l.searchText,d=l.selectedDataset,u=Boolean(this.state.anchorEl),h=i,p=this.state.searchText.toLowerCase().trim();""!=p&&(h=h.filter((function(e){return-1!==e.name.toLowerCase().indexOf(p)||null!=e.description&&-1!==e.description.toLowerCase().indexOf(p)})));var f=Boolean(this.state.datasetDetailsEl),m=d&&(d.title||d.description);return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)(Fa.a,{id:"dataset-details-selector",open:f,anchorEl:this.state.datasetDetailsEl,onClose:this.handleCloseDatasetDetails,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(a.jsxs)("div",{style:{width:500},children:[null==d&&Object(a.jsxs)("div",{children:[Object(a.jsx)(xa.a,{size:20})," Loading..."]}),d&&Object(a.jsx)(Q.a,{component:"h6",children:d.name}),!m&&Object(a.jsx)("div",{children:"No description available"}),d&&d.title&&Object(a.jsx)("div",{children:d.title}),d&&d.description&&Object(a.jsx)(Ka.a,{linkTarget:"_blank",children:d.description})]})}),Object(a.jsx)(_a.a,{variant:"contained",onClick:this.handleClick,color:null==o?"primary":"default",startIcon:Object(a.jsx)(ri.a,{}),children:"Open"}),Object(a.jsxs)(Fa.a,{open:u,anchorEl:s,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(a.jsx)(ti.a,{style:{padding:6},type:"text",placeholder:"Search",value:c,onChange:this.onSearchChange,fullWidth:!0,InputProps:""!==c.trim()?{endAdornment:Object(a.jsx)(Ja.a,{position:"end",children:Object(a.jsx)(ie.a,{"aria-label":"clear",onClick:this.handleClearSearchText,children:Object(a.jsx)(ai.a,{})})})}:null}),Object(a.jsx)(Ya.a,{style:{width:500},dense:!0,disablePadding:!0,component:"nav","aria-label":"datasets",children:h.map((function(t){var n=t.name;return t.title&&(n+=" - "+t.title),Object(a.jsxs)($a.a,{alignItems:"flex-start",selected:t.id===o,button:!0,onClick:function(n){return e.handleListItemClick(t.id)},children:[Object(a.jsx)(ei.a,{primary:n,style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}}),Object(a.jsx)(Qa.a,{children:Object(a.jsx)(ie.a,{onClick:function(n){return e.handleListItemDetailsClick(n,t.id)},edge:"end","aria-label":"summary",children:Object(a.jsx)(li.a,{})})})]},t.id)}))})]})]})}}]),n}(r.a.PureComponent),ci=Object(l.b)((function(e){return{dataset:e.dataset,datasetChoices:e.datasetChoices,serverInfo:e.serverInfo}}),(function(e){return{handleClose:function(t){e(ra(null))}}}))(si),di="max",ui=500,hi=.1,pi="Viridis",fi="Reds",mi={chartType:"dotplot",violinScale:"width",violinHeight:100,violinWidth:80,violinShowBoxplot:!0},bi={name:pi,value:ht(pi)},vi={name:fi,value:ht(fi)},gi={width:window.innerWidth-280,height:Math.max(300,window.innerHeight-410)},ji={animating:!1,dragmode:"pan",editSelection:!1,showAxis:!0,showFog:false,darkMode:false,labelFontSize:14,labelStrokeWidth:4};var yi=Object(s.c)({binSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:di,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case on:return t.payload;case hn:return di;case Sn:return null!=t.payload.binSummary?t.payload.binSummary:e;default:return e}},binValues:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case rn:return t.payload;case hn:return!1;case Sn:return null!=t.payload.binValues?t.payload.binValues:e;default:return e}},cachedData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn:return{}}return e},categoricalNames:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Jt:var n=e[t.payload.name];return void 0===n&&(n={},e[t.payload.name]=n),null==t.payload.value||""===t.payload.value?delete n[t.payload.oldValue]:n[t.payload.oldValue]=t.payload.value,Object.assign({},e);case hn:return{};default:return e}},chartOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ji,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _t:return Object.assign({},t.payload);case Sn:return t.payload.chartOptions?Object.assign(ji,t.payload.chartOptions):e;default:return e}},chartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rt:return t.payload;default:return e}},combineDatasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"and",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ft:return t.payload;case hn:return"and";case Sn:return null!=t.payload.combineDatasetFilters?t.payload.combineDatasetFilters:e;default:return e}},dataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn:return document.title=null==t.payload?"Cirro":t.payload.name+" - Cirro",t.payload;case Gt:if(t.payload.id===e.id)return document.title=t.payload.name+" - Cirro",Object.assign(e,t.payload);default:return e}},datasetChoices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case xn:return t.payload.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),t.payload;case dn:return null==t.payload?[]:e;case Wt:return e.push(t.payload),e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),e.slice();case Gt:case Vt:for(var n=-1,a=0;a<e.length;a++)if(e[a].id===t.payload.id){n=a;break}return-1!==n?(t.type===Gt?(e[n]=t.payload,e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1}))):e.splice(n,1),e.slice()):e;default:return e}},datasetFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn:return{};case Ht:return t.payload;case Sn:return null!=t.payload.datasetFilter?t.payload.datasetFilter:e;default:return e}},datasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn:return[];case Nt:return t.payload;default:return e}},dialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case fn:return t.payload;default:return e}},distributionData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Jt:return e.slice();case wn:return t.payload;case hn:return[];default:return e}},distributionPlotOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn:return mi;case kn:return Object.assign({},e,t.payload);case Sn:return null!=t.payload.distributionPlotOptions?t.payload.distributionPlotOptions:e;default:return e}},dotPlotInterpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case At:return t.payload;case Sn:return null!=t.payload.dotPlotInterpolator?t.payload.dotPlotInterpolator:e;default:return e}},email:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case dn:return t.payload;default:return e}},embeddingData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case En:return t.payload;case Qt:return e.slice();case Zt:return e.forEach((function(e,n){if(e.continuous&&e.name===t.payload.name){var a=t.payload.summary,i=[a.min,a.max];null==a.customMin||isNaN(a.customMin)||(i[0]=a.customMin),null==a.customMax||isNaN(a.customMax)||(i[1]=a.customMax),e.colorScale.domain(i),rt(e)}})),e.slice();case Kt:return e.forEach((function(e,n){if(!e.continuous&&e.name===t.payload.name){var a=e.colorScale.domain().indexOf(t.payload.value),i=e.colorScale.range();i[a]=t.payload.color,e.colorScale.range(i),rt(e)}})),e.slice();case sn:return e.forEach((function(e,n){if(e.continuous){var a=e.colorScale.domain();e.colorScale=Object(u.a)(t.payload.value).domain(a),rt(e)}})),e.slice();case hn:return[];default:return e}},embeddingLabels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case zt:return t.payload;case hn:return[];case Sn:return t.payload.embeddingLabels||[];default:return e}},embeddings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case nn:return t.payload;case hn:return[];case Sn:return null!=t.payload.embeddings?t.payload.embeddings:e;default:return e}},featureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case en:return t.payload;case hn:return{};default:return e}},globalFeatureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Xt:return t.payload;case hn:return{};default:return e}},interpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case sn:return t.payload;case Sn:return null!=t.payload.colorScheme?t.payload.colorScheme:e;default:return e}},loading:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Dn:return t.payload;default:return e}},loadingApp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!1,progress:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Pn:return t.payload;default:return e}},markerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yt:return t.payload;case hn:return 1;case Sn:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case pn:return t.payload;case hn:var n=null==t.payload?[]:t.payload.markers||[];if(Object(b.isPlainObject)(n)){var a=[];for(var i in n){var r=n[i];for(var o in r)a.push({category:i,name:o,id:i+"-"+o,readonly:!0,features:r[o]})}n=a}if(null!=t.payload&&null!=t.payload.markers_read_only)if(Object(b.isPlainObject)(t.payload.markers_read_only)){var l=t.payload.markers_read_only;for(var s in l){var c=l[s];for(var d in c)n.push({category:s,name:d,id:s+"-"+d,readonly:!0,features:c[d]})}}else t.payload.markers_read_only.forEach((function(e){e.readonly=!0,n.push(e)}));return n.forEach((function(e){null==e.id&&(e.id=e.category+"-"+e.name)})),n;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ln:return t.payload;default:return e}},numberOfBins:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ui,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case an:return t.payload;case hn:return ui;case Sn:return null!=t.payload.numberOfBins?t.payload.numberOfBins:e;default:return e}},pointSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case cn:return t.payload;case Sn:return null!=t.payload.pointSize?t.payload.pointSize:e;default:return e}},primaryChartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Bt:return t.payload;default:return e}},primaryTraceKey:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn:return null;case Lt:return t.payload;case En:var n=t.payload.filter((function(e){return e.active}));return 0===n.length?null:zn(n[n.length-1]);default:return e}},savedDatasetState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case qt:return t.payload;default:return e}},searchTokens:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case tn:return t.payload;case hn:return[];case Sn:return t.payload.q||[];default:return e}},selectedDistributionData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Jt:return e.slice();case Cn:return t.payload;case hn:return[];default:return e}},selection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{chart:{}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Qt:return t.payload;case hn:return{};default:return e}},serverInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ut:return t.payload;default:return e}},tab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"embedding",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Mn:return t.payload;default:return e}},unselectedMarkerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $t:return t.payload;case hn:return hi;case Sn:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case un:return t.payload;default:return e}}}),Oi=Object(Da.a)((function(e){return{root:{minWidth:50,textTransform:"none",fontWeight:e.typography.fontWeightRegular,marginRight:e.spacing(0),"&:hover":{color:"#40a9ff",opacity:1},"&$selected":{color:"#1890ff",fontWeight:e.typography.fontWeightMedium},"&:focus":{color:"#40a9ff"}},selected:{}}}))((function(e){return Object(a.jsx)(Na.a,Object(Ta.a)({disableRipple:!0},e))})),xi=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleTabChange=function(e,t){a.props.handleTab(t)},a.handleEmbeddingsChange=function(e){var t=e.target.value,n=[];t.forEach((function(e){e.precomputed||(e=Object.assign(e,{bin:a.props.binValues,nbins:a.props.numberOfBins,_nbins:a.props.numberOfBinsUI,agg:a.props.binSummary})),n.push(e)})),a.props.handleEmbeddings(n)},a.handleUserMenuClose=function(){a.setState({userMenuOpen:!1})},a.handleMoreMenuClose=function(){a.setState({moreMenuOpen:!1})},a.handleHelp=function(){a.props.handleDialog(yn)},a.handleUserMenuOpen=function(e){a.setState({userMenuOpen:!0,userMenuAnchorEl:e.currentTarget})},a.handleMoreMenuOpen=function(e){a.setState({moreMenuOpen:!0,moreMenuAnchorEl:e.currentTarget})},a.getLinkJson=function(){var e=a.props,t=e.chartOptions,n=e.combineDatasetFilters,i=e.primaryTraceKey,r=e.dataset,o=e.embeddingLabels,l=e.distributionPlotOptions,s=e.embeddings,c=e.searchTokens,d=e.datasetFilter,u=e.interpolator,h=e.markerOpacity,p=e.pointSize,f=e.unselectedMarkerOpacity,m=e.distributionData,b={dataset:r.id,embeddings:s.map((function(e){return e.bin?(delete(e=Object.assign({},e))._bin,e):{name:e.name,dimensions:e.dimensions}}))},v=t.ref;b.embeddings.length>0&&null!=v&&v.scatterPlot&&(b.camera=v.scatterPlot.getCameraDef()),null!=i&&(b.primaryTraceKey=i);var g={},j={showFog:false,darkMode:false,labelFontSize:14,labelStrokeWidth:4};for(var y in j){var O=t[y];O!==j[y]&&(g[y]=O)}1!==p&&(b.pointSize=p),b.chartOptions=g,c.length>0&&(b.q=c);var x={};for(var S in d){var w=d[S];window.Array.isArray(w)?x[S]=w:""===w.operation||isNaN(w.value)||null==w.value||(x[S]={operation:w.operation,value:w.value})}return Object.keys(x).length>0&&(b.datasetFilter=x),b.combineDatasetFilters=n,1!==h&&(b.markerOpacity=h),f!==hi&&(b.unselectedMarkerOpacity=f),m&&m.length>0&&(b.distributionPlotOptions=l),u.name!==pi&&(b.colorScheme=u.name),o.length>0&&(b.embeddingLabels=o),b},a.handleDataset=function(e){if(null!=a.props.dataset){var t=a.props.savedDatasetState,n=a.getLinkJson();n.dataset=null,t[a.props.dataset.id]=n,a.props.handleSavedDatasetState(t)}a.props.handleTab("embedding"),a.props.handleDataset(e)},a.copyLink=function(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname;t+="?q="+encodeURIComponent(JSON.stringify(a.getLinkJson()));var n=document.activeElement,i=document.createElement("textarea"),r="rtl"==document.documentElement.getAttribute("dir");i.style.fontSize="12pt",i.style.border="0",i.style.padding="0",i.style.margin="0",i.style.position="absolute",i.style[r?"right":"left"]="-9999px",i.setAttribute("readonly","");var o=window.pageYOffset||document.documentElement.scrollTop;i.style.top=o+"px",i.value=t,n.appendChild(i),i.select(),i.setSelectionRange(0,i.value.length),document.execCommand("copy");a.props.setMessage("Link copied"),n.addEventListener("click",(function e(t){document.activeElement.blur(),window.getSelection().removeAllRanges(),n.removeChild(i),n.removeEventListener("click",e)})),a.setState({moreMenuOpen:!1})},a.onDarkMode=function(){a.props.chartOptions.darkMode=!a.props.chartOptions.darkMode,a.props.handleChartOptions(a.props.chartOptions)},a.handleLogout=function(){a.setState({userMenuOpen:!1}),a.props.handleLogout()},a.handleImportDataset=function(e){a.props.handleDialog(vn),a.setState({moreMenuOpen:!1})},a.handleSettings=function(e){a.props.handleDialog(bn),a.setState({moreMenuOpen:!1})},a.handleDelete=function(e){a.props.handleDialog(On),a.setState({moreMenuOpen:!1})},a.handleShowDatasetDetails=function(e){a.setState({datasetDetailsEl:e.currentTarget})},a.handleCloseDatasetDetails=function(e){a.setState({datasetDetailsEl:null})},a.state={userMenuOpen:!1,userMenuAnchorEl:null,moreMenuOpen:!1,moreMenuAnchorEl:null},a}return Object(M.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,i=t.loadingApp,r=t.email,o=t.selection,l=t.classes,s=t.serverInfo,c=t.tab,d=t.user,u=Boolean(this.state.datasetDetailsEl),h=null!=n&&(n.title||n.description),p=null!=n&&null!=n.shape?n.shape:null,f=null!=n&&null!=p&&p[0]>0&&!isNaN(o.count),m=null!=d&&d.importer&&!i.loading,b=null!==n&&n.owner&&!i.loading,v=(m||null!=n)&&!i.loading,g=!i.loading&&null==r&&""!==s.clientId;return Object(a.jsx)(Aa.a,{position:"fixed",color:"default",className:l.appBar,children:Object(a.jsxs)(Ra.a,{variant:"dense",children:[null!=n&&Object(a.jsx)(Fa.a,{id:"dataset-details",open:u,anchorEl:this.state.datasetDetailsEl,onClose:this.handleCloseDatasetDetails,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(a.jsxs)("div",{style:{width:500},children:[n.title&&Object(a.jsx)(Q.a,{className:l.typography,children:n.title}),n.description&&Object(a.jsx)(Ka.a,{linkTarget:"_blank",children:n.description})]})}),null!=n&&Object(a.jsxs)(Q.a,{"aria-owns":this.state.datasetDetailsOpen?"dataset-details":void 0,"aria-haspopup":"true",component:"h3",children:[h&&Object(a.jsx)(_a.a,{onClick:this.handleShowDatasetDetails,children:Object(a.jsx)("b",{children:n.name})}),!h&&Object(a.jsx)("b",{children:n.name}),Object(a.jsxs)("small",{children:["\xa0",f&&null!=p&&Be(o.count)+" / ",null!=p&&Be(p[0])+" cells"]})]}),null!=n&&Object(a.jsxs)(La.a,{value:c,indicatorColor:"primary",textColor:"primary",onChange:this.handleTabChange,children:[Object(a.jsx)(Oi,{value:"embedding",label:"Embeddings"}),Object(a.jsx)(Oi,{value:"distribution",label:"Distributions"}),null!=n.results&&Object(a.jsx)(Oi,{value:"precomputed_results",label:"Results"})]}),Object(a.jsx)("div",{className:"cirro-condensed"}),Object(a.jsxs)("div",{style:{marginLeft:"auto"},children:[!i.loading&&!g&&Object(a.jsx)(ci,{onChange:this.handleDataset}),v&&Object(a.jsx)(ae.a,{title:"More",children:Object(a.jsx)(ie.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleMoreMenuOpen,children:Object(a.jsx)(qa.a,{})})}),v&&Object(a.jsxs)(re.a,{id:"more-menu",anchorEl:this.state.moreMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.moreMenuOpen,onClose:this.handleMoreMenuClose,children:[m&&Object(a.jsx)(oe.a,{onClick:this.handleImportDataset,children:"New Dataset"}),b&&Object(a.jsx)(oe.a,{onClick:this.handleSettings,children:"Edit Dataset"}),b&&Object(a.jsx)(oe.a,{onClick:this.handleDelete,children:"Delete Dataset"}),(m||b)&&null!=n&&Object(a.jsx)(za.a,{}),null!=n&&Object(a.jsx)(oe.a,{onClick:this.copyLink,children:"Copy Link "})]}),Object(a.jsx)(ae.a,{title:"Toggle Light/Dark Theme",children:Object(a.jsx)(ie.a,{edge:!1,className:this.props.chartOptions.darkMode?"cirro-active":"","aria-label":"Toggle Theme",onClick:function(){return e.onDarkMode()},children:Object(a.jsx)(Wa.a,{})})}),Object(a.jsx)(ae.a,{title:"Help",children:Object(a.jsx)(ie.a,{"aria-label":"Help",onClick:this.handleHelp,children:Object(a.jsx)(Ga.a,{})})}),null!=r&&""!==r&&Object(a.jsx)(ae.a,{title:r,children:Object(a.jsx)(ie.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleUserMenuOpen,children:Object(a.jsx)(Ua.a,{})})}),null!=r&&""!==r&&Object(a.jsx)(re.a,{id:"menu-user",anchorEl:this.state.userMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.userMenuOpen,onClose:this.handleUserMenuClose,children:Object(a.jsx)(oe.a,{onClick:this.handleLogout,children:"Sign Out"})}),g&&Object(a.jsx)(_a.a,{style:{whiteSpace:"nowrap"},variant:"outlined",color:"primary",onClick:this.props.handleLogin,children:"Sign In"})]})]})})}}]),n}(r.a.PureComponent),Si=Object(Da.a)((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},appBar:{width:"calc(100% - ".concat($o,"px)"),marginLeft:$o}}}))(Object(l.b)((function(e){return{dataset:e.dataset,chartOptions:e.chartOptions,embeddings:e.embeddings,embeddingLabels:e.embeddingLabels,searchTokens:e.searchTokens,primaryTraceKey:e.primaryTraceKey,binSummary:e.binSummary,binValues:e.binValues,combineDatasetFilters:e.combineDatasetFilters,datasetFilter:e.datasetFilter,markerOpacity:e.markerOpacity,pointSize:e.pointSize,unselectedMarkerOpacity:e.unselectedMarkerOpacity,savedDatasetState:e.savedDatasetState,datasetChoices:e.datasetChoices,dialog:e.dialog,distributionData:e.distributionData,email:e.email,interpolator:e.interpolator,loading:e.loading,loadingApp:e.loadingApp,message:e.message,selection:e.selection,serverInfo:e.serverInfo,user:e.user,tab:e.tab}}),(function(e,t){return{handleTab:function(t){e(sa(t))},setMessage:function(t){e(aa(t))},handleLogin:function(){e((function(e,t){window.gapi.auth2.getAuthInstance().signIn().then((function(t){e(Qn())}))}))},handleLogout:function(){e(_n())},handleSavedDatasetState:function(t){e({type:qt,payload:t})},handleDataset:function(t){e(ma(t))},handleDialog:function(t){e(ra(t))},handleChartOptions:function(t){e(Rn(t))}}}))(xi)),wi=n(489),Ci=n(488),ki=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleCancel()},a.handleDelete=function(){a.setState({loading:!0}),a.props.handleDelete({dataset:a.props.dataset})},a.state={open:!0},a}return Object(M.a)(n,[{key:"render",value:function(){return Object(a.jsxs)(Sa.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"delete-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(wa.a,{id:"delete-dataset-dialog-title",children:"Delete Dataset"}),Object(a.jsx)(Ci.a,{children:this.props.dataset&&Object(a.jsxs)("h3",{children:["Are you sure you want to delete ",this.props.dataset.name,"?"]})}),Object(a.jsxs)(wi.a,{children:[Object(a.jsx)(_a.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(_a.a,{disabled:this.state.loading,onClick:this.handleDelete,color:"primary",children:"Delete"})]})]})}}]),n}(r.a.PureComponent),Ei=Object(l.b)((function(e){return{dataset:e.dataset,email:e.email}}),(function(e){return{handleDelete:function(t){e(na(t))},handleCancel:function(t){e(ra(null))}}}))(ki),Di=n(20),Mi=n(433),Pi=n(431),Ii=n(428),Ti=n(426);function zi(e){return e.startsWith("interpolate")&&(e=e.substring("interpolate".length)),e}var Ai=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(){var e;Object(O.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).handleInterpolatorChange=function(t){var n=t.target.value;e.props.handleInterpolator({name:n,value:ht(n)})},e}return Object(M.a)(n,[{key:"getScale",value:function(e){return Object(u.a)(Ze[e]).domain([0,1])}},{key:"render",value:function(){var e=this,t=this.props.classes,n=ut(this.props.interpolator.name),i=174;return Object(a.jsxs)(Pi.a,{input:Object(a.jsx)(Ti.a,{}),className:t.select,onChange:this.handleInterpolatorChange,value:n,multiple:!1,children:[Object(a.jsx)(oe.a,{value:"Diverging",divider:!0,disabled:!0,children:"Diverging"},"Diverging"),Ye.Diverging.map((function(t){return Object(a.jsx)(oe.a,{title:zi(t),value:t,children:Object(a.jsx)(We,{width:i,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(a.jsx)(oe.a,{value:"Sequential (Single Hue)",divider:!0,disabled:!0,children:"Sequential (Single Hue)"},"Sequential (Single Hue)"),Ye["Sequential (Single Hue)"].map((function(t){return Object(a.jsx)(oe.a,{title:zi(t),value:t,children:Object(a.jsx)(We,{width:i,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(a.jsx)(oe.a,{value:"Sequential (Multi-Hue)",divider:!0,disabled:!0,children:"Sequential (Multi-Hue)"},"Sequential (Multi-Hue)"),Ye["Sequential (Multi-Hue)"].map((function(t){return Object(a.jsx)(oe.a,{title:zi(t),value:t,children:Object(a.jsx)(We,{width:i,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(a.jsx)(oe.a,{value:"Cyclical",divider:!0,disabled:!0,children:"Cyclical"},"Cyclical"),Ye.Cyclical.map((function(t){return Object(a.jsx)(oe.a,{title:zi(t),value:t,children:Object(a.jsx)(We,{width:i,label:!1,height:14,scale:e.getScale(t)})},t)}))]})}}]),n}(r.a.PureComponent),_i=te()((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1)}}}))(Ai);function Fi(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"black",o=t.domain(),l=(o[1]-o[0])/(n+1),s=[];s.push(o[0]);for(var c=o[0],d=0;d<n;d++)c+=l,s.push(c);s.push(o[1]);var u=20,h=Object(ne.a)().range([i,a-i]).domain([0,s.length-1]).clamp(!0),p=Object(ne.a)().range([1,9]).domain(o).clamp(!0);e.textBaseline="top",e.fillStyle=r,e.strokeStyle=r,e.textAlign="center";for(var f=0;f<s.length;f++){var m=h(f),b=p(s[f]);e.beginPath(),e.arc(m,10,b,0,2*Math.PI),e.stroke();var v=Le(100*s[f]);v.endsWith(".0")&&(v=v.substring(0,v.length-2)),e.fillText(v,m,u+2)}}var Ni=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).ref=r.a.createRef(),a.backingScale=1,a}return Object(M.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.font=Ve,t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(Fi(t,r,this.props.nsteps||3,a,20,i),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,n=this.props.width,i={width:n,height:t};return this.props.style&&(i=Object.assign({},i,this.props.style)),Object(a.jsx)("canvas",{width:n*e,height:t*e,ref:this.ref,style:i})}}]),n}(r.a.PureComponent),Li=12;function Ri(e,t){var n=[],a=0;if(e[0].length>0){a=e[0][0].name.length;for(var i=0;i<e[0][0].name.length;i++)n.push(0)}e.forEach((function(e){for(var i=e[0].name,r=0;r<a;r++)n[r]=Math.max(n[r],t.measureText(i[r]).width)}));for(var r=0;r<n.length;r++)n[r]+=6,n[r]+=Li;n[n.length-1]+=4;var o=0;return n.forEach((function(e){return o+=e})),{offsets:n,sum:o}}var Bi=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){var t,n;a.setState({saveImageEl:null}),"svg"===e?(t=new window.C2S(10,10)).font=Ge:(t=(n=document.createElement("canvas")).getContext("2d")).font=Ve;var i=a.getSize(t),r=i.height+i.y+35+40+10,o=Math.max(200,i.width+i.x);"svg"===e?(t=new window.C2S(o,r)).font=Ge:(n.width=o*window.devicePixelRatio,n.height=r*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.font=Ve);var l=a.props.textColor;if(t.fillStyle="white"===l?"black":"white",t.fillRect(0,0,o,r),a.drawContext(t,i),t.translate(4,i.height+i.y+4),He(t,a.props.colorScale,l),t.translate(-10,39),Fi(t,a.props.sizeScale,3,150,20,l),"svg"===e){var s=t.getSerializedSvg(),c=new Blob([s],{type:"text/plain;charset=utf-8"});window.saveAs(c,a.props.data[0][0].dimension+".svg")}else n.toBlob((function(e){window.saveAs(e,a.props.data[0][0].dimension+".png",!0)}))},a.divRef=r.a.createRef(),a.tooltipElementRef=r.a.createRef(),a.canvas=null,a.state={saveImageEl:null},a}return Object(M.a)(n,[{key:"redraw",value:function(){var e=this;if(null==this.props.data)return Object(a.jsx)("div",{});var t=1;if("undefined"!==typeof window&&"devicePixelRatio"in window&&(t=window.devicePixelRatio),null==this.canvas){this.canvas=document.createElement("canvas"),this.canvas.addEventListener("mousemove",(function(t){var n=t.target,a=e.props.sizeScale.range()[1],i=n.getBoundingClientRect(),r=[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop],o=Math.floor((r[0]-e.size.x)/(2*a)),l=Math.floor(r[1]/(2*a));if(o>=0&&o<e.props.data[0].length&&l>=0&&l<e.props.data.length){e.tooltipElementRef.current.innerHTML="";var s=e.props.data[l],c=s[o].mean,d=s[o].fractionExpressed,u=it(Re(c)),h=it(Le(100*d));e.tooltipElementRef.current.innerHTML="mean: "+u+", % expressed: "+h+", "+s[o].feature+", "+s[o].name.join(", ")}else e.tooltipElementRef.current.innerHTML=""})),this.canvas.addEventListener("mouseout",(function(t){e.tooltipElementRef.current.innerHTML=""})),this.divRef.current.append(this.canvas)}var n=this.size.height+this.size.y,i=this.size.width+this.size.x,r=this.canvas,o=r.getContext("2d");r.width=i*t,r.height=n*t,r.style.width=i+"px",r.style.height=n+"px",o.font=Ve,o.clearRect(0,0,i*t,n*t),o.scale(t,t),this.drawContext(o,this.size)}},{key:"drawContext",value:function(e,t){var n=this.props.data,a=this.props.colorScale,i=this.props.categoryColorScales,r=this.props.sizeScale,o=this.props.drawCircles,l=this.props.textColor,s=r.range()[1],c=2*s;n.forEach((function(n,i){for(var l=i*c+(o?s:0),d=0;d<n.length;d++){var u=n[d].mean,h=a(u);if(e.fillStyle=h,e.beginPath(),o){var p=d*c+s+t.x,f=n[d].fractionExpressed;e.arc(p,l,r(f),0,2*Math.PI)}else{var m=d*c+t.x;e.rect(m,l,c,c)}e.fill()}})),e.textAlign="left",e.textBaseline="middle",n.forEach((function(n,a){for(var r=n[0].name,o=a*c+s,d=0;d<r.length;d++){var u=t.xoffsets[d-1]||0;u>0&&(u+=4);var h=i[d];e.fillStyle=h(n[0].categories[d]),e.beginPath(),e.rect(u,o-s/2-3,Li,Li),e.fill(),e.stroke(),e.fillStyle=l,e.fillText(r[d],u+2+Li,o)}})),e.textAlign="right",e.textBaseline="top",n[0].forEach((function(n,a){var i=n.feature,r=a*c;e.save(),e.translate(t.x+r+4,t.height),e.rotate(-Math.PI/2),e.fillText(i,0,0),e.restore()})),e.setTransform(1,0,0,1,0,0)}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"getSize",value:function(e){var t=0,n=this.props.data;n[0].forEach((function(n){t=Math.max(t,e.measureText(n.feature).width)})),t+=4;var a=Ri(n,e),i=2*this.props.sizeScale.range()[1],r=n.length*i+4,o=n[0].length*i+4;return{xoffsets:a.offsets,x:a.sum,y:t,width:o,height:r}}},{key:"update",value:function(){var e=document.createElement("canvas").getContext("2d");e.font=Ve,this.size=this.getSize(e)}},{key:"render",value:function(){var e=this;this.update();var t=this.state.saveImageEl,n=this.props.data[0][0].dimension;return Object(a.jsxs)("div",{style:{position:"relative"},children:[Object(a.jsxs)("div",{children:[Object(a.jsxs)(Q.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[n,this.props.subtitle&&Object(a.jsxs)("small",{children:["(",this.props.subtitle,")"]})]}),Object(a.jsx)(ae.a,{title:"Save Image",children:Object(a.jsx)(ie.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(a.jsx)(ye.a,{})})}),Object(a.jsxs)(re.a,{id:"save-image-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:this.handleSaveImageMenuClose,children:[Object(a.jsx)(oe.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(a.jsx)(oe.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),Object(a.jsx)(Q.a,{color:"textPrimary",className:"cirro-condensed",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top",whiteSpace:"nowrap",width:500,minWidth:500,maxWidth:500,textOverflow:"ellipsis"}})]}),Object(a.jsx)("div",{ref:this.divRef})]})}}]),n}(r.a.PureComponent),Ui=n(510);function Hi(e,t){for(var n=0,a=e.length,i=0;i<a;i++){var r=e[i]-t;n+=r*=r}return a<=1?NaN:((a-=1)<1&&(a=1),n/a)}function Wi(e){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*e*e)}function Vi(e,t,n){var a=n.length,i=1/(a*e);return function(r){for(var o=0,l=0;l<a;l++)o+=t((r-n[l])/e);return i*o}}var Gi=n(515);function Xi(e,t,n,a,i,r,o,l,s){for(var c,d=r.violinScale,u=r.violinHeight,h=r.violinWidth,p=r.violinShowBoxplot,f=a.map((function(e){return e[0].name})),m=a[0].map((function(e){return e.feature})).indexOf(n),b=Number.MAX_VALUE,v=-Number.MAX_VALUE,g=-Number.MAX_VALUE,j=0;j<f.length;j++){var y=a[j][m];b=Math.min(b,y.density.x[0]),v=Math.max(v,y.density.x[y.density.x.length-1]),g=Math.max(g,y.density.max)}"area"===d&&(c=Object(ne.a)().domain([-g,g]).range([4,h-4]));var O=Object(ne.a)().domain([b,v]).range([u-1,1]).nice();e.strokeStyle=s;for(var x=e.lineCap,S=e.lineJoin,w=0;w<f.length;w++){e.save();var C=a[w][m];"width"===d&&(c=Object(ne.a)().domain([-C.density.max,C.density.max]).range([4,h-4])),e.lineCap="round",e.lineJoin="round";var k=C.density;e.translate(t.x+w*h,0),e.beginPath(),e.moveTo(c(k.y[0]),O(k.x[0]));for(var E=1,D=k.x.length;E<D;E++)e.lineTo(c(-k.y[E]),O(k.x[E]));for(var M=k.x.length-2;M>0;M--)e.lineTo(c(k.y[M]),O(k.x[M]));e.stroke(),e.lineCap=x,e.lineJoin=S,p&&(e.strokeRect(h/2-3,O(C.boxplotStats.q3),6,O(C.boxplotStats.q1)-O(C.boxplotStats.q3)),e.beginPath(),e.moveTo(h/2-3,O(C.boxplotStats.median)),e.lineTo(h/2-3+6,O(C.boxplotStats.median)),e.stroke(),e.beginPath(),e.moveTo(h/2,O(C.boxplotStats.upperAdjacentValue)),e.lineTo(h/2,O(C.boxplotStats.q3)),e.stroke(),e.beginPath(),e.moveTo(h/2,O(C.boxplotStats.q1)),e.lineTo(h/2,O(C.boxplotStats.lowerAdjacentValue)),e.stroke()),e.restore()}e.textAlign="right",e.textBaseline="middle",e.fillStyle=s,e.strokeStyle=s;var P=t.x-4;e.lineWidth=.5,e.beginPath(),e.moveTo(P+4,O(O.domain()[0])),e.lineTo(P+4,O(O.domain()[1])),e.stroke(),e.beginPath(),e.moveTo(P+4,O(O.domain()[0])),e.lineTo(t.width+t.x-4,O(O.domain()[0])),e.stroke(),e.lineWidth=1;var I=O.tickFormat(4);if(O.ticks(4).forEach((function(t){var n=O(t);e.fillText(I(t),P,n),e.beginPath(),e.moveTo(P,n),e.lineTo(P+4,n),e.stroke()})),o){e.textBaseline="middle",e.textAlign="left";for(var T=u+t.y-1,z=0;z<f.length;z++)for(var A=a[z][m],_=z*h+h/2,F=f[z],N=0;N<F.length;N++){var L=t.offsets[N-1]||0;L>0&&(L+=4);var R=l[N],B=A.categories[N];e.fillStyle=R(B),e.beginPath(),e.rect(t.x+_-Li+4,T-Li-L,Li,Li),e.fill(),e.stroke(),e.save(),e.fillStyle=s,e.translate(t.x+_,T-L-Li-2),e.rotate(-Math.PI/2),e.fillText(F[N],0,0),e.restore()}}}var qi=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).mousemove=function(e){var t=e.target,n=t.getBoundingClientRect(),i=a.props,r=i.data,o=i.feature,l=i.size,s=i.options,c=s.violinHeight,d=s.violinWidth,u=[e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop];if(u[0]<l.x||u[1]>=c)a.props.onTooltip(null);else{var h=Math.floor((u[0]-l.x)/d),p=r.map((function(e){return e[0].name}));if(h>=0&&h<p.length){var f=r[0].map((function(e){return e.feature})).indexOf(o);a.props.onTooltip(r[h][f])}else a.props.onTooltip(null)}},a.mouseout=function(e){a.props.onTooltip(null)},a.initialized=!1,a.canvasRef=r.a.createRef(),a.mousemove=Object(b.throttle)(a.mousemove,500),a}return Object(M.a)(n,[{key:"redraw",value:function(){var e=this.props,t=e.categoryColorScales,n=(e.colorScale,e.data),a=e.options,i=e.feature,r=e.size,o=e.textColor;if(null!=n){var l=a.violinHeight,s=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(s=window.devicePixelRatio);var c=this.canvasRef.current;this.initialized||(c.addEventListener("mousemove",this.mousemove),c.addEventListener("mouseout",this.mouseout),this.initialized=!0);var d=l+r.y,u=r.width+r.x,h=c.getContext("2d");c.width=u*s,c.height=d*s,c.style.width=u+"px",c.style.height=d+"px",h.font=Ve,h.clearRect(0,0,u*s,d*s),h.scale(s,s),Xi(h,r,i,n,0,a,!0,t,o)}}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=this.props.feature;return Object(a.jsxs)(Gi.a,{borderColor:"text.primary",border:1,style:{display:"inline-block",margin:2},children:[Object(a.jsx)(Q.a,{color:"textPrimary",component:"h4",style:{marginTop:"3.2px"},children:e}),Object(a.jsx)("canvas",{ref:this.canvasRef})]})}}]),n}(r.a.PureComponent),Zi=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){var t,n;a.setState({saveImageEl:null}),"svg"===e?(t=new window.C2S(10,10)).font=Ge:(t=(n=document.createElement("canvas")).getContext("2d")).font=Ve;var i=a.getSize(t),r=i.totalHeight+i.y+15+20,o=Math.max(200,i.width+i.x);"svg"===e?(t=new window.C2S(o,r)).font=Ge:(n.width=o*window.devicePixelRatio,n.height=r*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.font=Ve);var l="black";if(t.fillStyle="white",t.fillRect(0,0,o,r),a.drawContext(t,i),t.translate(4,i.totalHeight+i.y+4),He(t,a.props.colorScale,l),"svg"===e){var s=t.getSerializedSvg(),c=new Blob([s],{type:"text/plain;charset=utf-8"});window.saveAs(c,a.props.data[0][0].dimension+".svg")}else n.toBlob((function(e){window.saveAs(e,a.props.data[0][0].dimension+".png",!0)}))},a.onTooltip=function(e){if(e){var t=e.mean,n=e.boxplotStats.median,i=e.fractionExpressed,r=it(Re(t)),o=it(Re(n)),l=it(Le(100*i));a.tooltipElementRef.current.innerHTML="mean: "+r+", median: "+o+", % expressed: "+l+", "+e.name.join(", ")}else a.tooltipElementRef.current.innerHTML=""},a.tooltipElementRef=r.a.createRef(),a.canvas=null,a.state={saveImageEl:null},a}return Object(M.a)(n,[{key:"drawContext",value:function(e,t){for(var n=this.props,a=n.categoryColorScales,i=(n.colorScale,n.data),r=n.options,o=n.textColor,l=r.violinHeight,s=r.violinWidth,c=i[0].map((function(e){return e.feature})),d=i.map((function(e){return e[0].name})),u=0;u<c.length;u++)e.save(),e.translate(0,l*u),Xi(e,t,c[u],i,0,r,u===c.length-1,a,o),e.textBaseline="top",e.textAlign="middle",e.fillStyle=o,e.fillText(c[u],s*d.length/2,0),e.restore();e.setTransform(1,0,0,1,0,0)}},{key:"getSize",value:function(e){var t=this.props,n=t.data,a=t.options,i=a.violinHeight,r=a.violinWidth,o=n.map((function(e){return e[0].name})),l=n[0].map((function(e){return e.feature})),s=Ri(n,e),c=l.length*i+4,d=o.length*r+4;return{x:30,offsets:s.offsets,y:s.sum,width:d,totalHeight:c}}},{key:"render",value:function(){var e=this,t=this.state.saveImageEl,n=this.props,i=n.categoryColorScales,r=n.colorScale,o=n.data,l=n.options,s=n.textColor,c=o[0].map((function(e){return e.feature})),d=o[0][0].dimension,u=document.createElement("canvas").getContext("2d");u.font=Ve;var h=this.getSize(u);return Object(a.jsxs)("div",{style:{position:"relative"},children:[Object(a.jsxs)("div",{children:[Object(a.jsxs)(Q.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[d,this.props.subtitle&&Object(a.jsxs)("small",{children:["(",this.props.subtitle,")"]})]}),Object(a.jsx)(ae.a,{title:"Save Image",children:Object(a.jsx)(ie.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(a.jsx)(ye.a,{})})}),Object(a.jsxs)(re.a,{id:"save-image-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:this.handleSaveImageMenuClose,children:[Object(a.jsx)(oe.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(a.jsx)(oe.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),Object(a.jsx)(Q.a,{color:"textPrimary",className:"cirro-condensed",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top",whiteSpace:"nowrap",width:500,minWidth:500,maxWidth:500,textOverflow:"ellipsis"}})]}),c.map((function(t){return Object(a.jsx)(qi,{onTooltip:e.onTooltip,feature:t,data:o,categoryColorScales:i,options:l,size:h,textColor:s,colorScale:r},t)}))]})}}]),n}(r.a.PureComponent);function Ki(e,t){var n=[];e[0].dimensions.forEach((function(e){n.push(t[e]||{})})),e.forEach((function(e){var t=[];n.forEach((function(a,i){var r=n[i],o=e.categories[i],l=r[o];void 0!==l&&(o=l),t[i]=o,e.name=t}))}))}function Ji(e,t){var n={};e.forEach((function(e){var t=n[e.name];null==t&&(t=[],n[e.name]=t),t.push(e)}));var a=Object.keys(n),i=e[0].dimension;if(t.sortBy!==i){var r={},o={};e.forEach((function(e){e.feature===t.sortBy&&(r[e.name]=e.mean,o[e.name]=e.fractionExpressed)})),a.sort((function(e,t){var n=r[e],a=r[t],i=n===a?0:n>a?-1:1;return 0===i&&(i=(n=o[e])===(a=o[t])?0:n>a?-1:1),i}))}else{var l=D()({insensitive:!0});a.sort((function(e,t){return l(e,t)}))}for(var s=[],c=0;c<a.length;c++){var d=a[c];s.push(n[d])}return s}function Yi(e){var t=[Number.MAX_VALUE,-Number.MAX_VALUE],n=[Number.MAX_VALUE,-Number.MAX_VALUE];return e.forEach((function(e){t[0]=Math.min(e.fractionExpressed,t[0]),t[1]=Math.max(e.fractionExpressed,t[1]),n[0]=Math.min(e.mean,n[0]),n[1]=Math.max(e.mean,n[1])})),{mean:n,fraction:t}}var $i=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.setState({min:e.target.value}),a.updateMin(e.target.value)},a.updateMin=function(e){a.props.onDistributionPlotOptions({min:parseFloat(e)})},a.onMaxChange=function(e){a.setState({max:e.target.value}),a.updateMax(e.target.value)},a.updateMax=function(e){a.props.onDistributionPlotOptions({max:parseFloat(e)})},a.onMinSizeChange=function(e){a.setState({minSize:e.target.value}),a.updateMinSize(e.target.value)},a.updateMinSize=function(e){(e=parseFloat(e))>1&&(e/=100),a.props.onDistributionPlotOptions({minSize:e})},a.onSortOrderChanged=function(e){a.props.onDistributionPlotOptions({sortBy:e.target.value})},a.onMaxSizeChange=function(e){a.setState({sizeMax:e.target.value}),a.updateMaxSize(e.target.value)},a.updateMaxSize=function(e){(e=parseFloat(e))>1&&(e/=100),a.props.onDistributionPlotOptions({maxSize:e})},a.state={min:"",max:"",minSize:"",sizeMax:""},a.updateMinSize=Object(b.debounce)(a.updateMinSize,500),a.updateMaxSize=Object(b.debounce)(a.updateMaxSize,500),a.updateMin=Object(b.debounce)(a.updateMin,500),a.updateMax=Object(b.debounce)(a.updateMax,500),a}return Object(M.a)(n,[{key:"render",value:function(){var e,t=this.props,n=t.textColor,i=t.categoryColorScales,o=t.distributionData,l=t.distributionPlotOptions,s=t.categoricalNames,c=t.selectedData,d=t.interpolator;if(null==o||0===o.length)return null;var h=Yi(o),p=h.mean,f=h.fraction;if(null!=c&&c.length>0){var m=Yi(c);p[0]=Math.min(p[0],m.mean[0]),p[1]=Math.max(p[1],m.mean[1]),f[0]=Math.min(f[0],m.fraction[0]),f[1]=Math.max(f[1],m.fraction[1])}if(p[0]===p[1]&&p[1]++,f[0]===f[1]&&(f[0]=0,f[1]=1),p[0]>0&&(p[0]=0),f[0]>0&&(f[0]=0),f[1]<1&&(f[1]=1),null==l.min||isNaN(l.min)||(p[0]=l.min),null==l.max||isNaN(l.max)||(p[1]=l.max),null==l.minSize||isNaN(l.minSize)||(f[0]=l.minSize),null==l.maxSize||isNaN(l.maxSize)||(f[1]=l.maxSize),null==l.sortBy&&(l.sortBy=o[0].dimension),l.sortBy!==o[0].dimension){for(var b=!1,v=0;v<o.length;v++)if(o[v].feature===l.sortBy){b=!0;break}b||(l.sortBy=o[0].dimension)}var g=l.chartType,j=Object(u.a)(d.value).domain(p).clamp(!0),y=Object(ne.a)().domain(f).range([1,9]).clamp(!0),O=Le(j.domain()[0]),x=Le(j.domain()[1]);O===x&&(O=Re(j.domain()[0]),x=Re(j.domain()[1])),Ki(o,s),c&&Ki(c,s);var S=Ji(o,l),w=S[0].map((function(e){return e.feature}));if("violin"===g){var C=c?o.concat(c):o;w.forEach((function(e){C.forEach((function(t){if(t.feature===e&&null==t.density){for(var n=t.vector,a=new Float32Array(n.size()),i=0,r=a.length;i<r;i++)a[i]=n.get(i);t.boxplotStats=function(e){e=e.slice().sort((function(e,t){return e-t}));for(var t=Object(Ui.a)(e,.75),n=Object(Ui.a)(e,.25),a=Object(Ui.a)(e,.5),i=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=t+1.5*(t-n),l=n-1.5*(t-n),s=0,c=0,d=e.length;c<d;c++){var u=e[c];u<=o&&(i=Math.max(i,u)),u>=l&&(r=Math.min(r,u)),s+=u}var h=s/e.length;return r>n&&(r=n),i<t&&(i=t),{mean:h,upperAdjacentValue:i,lowerAdjacentValue:r,median:a,q3:t,q1:n,variance:Hi(e,h),n:e.length,x0:e[0]}}(a);var o=function(e){var t,n=Math.sqrt(e.variance),a=e.q3-e.q1;return(t=Math.min(n,a/1.34))||(t=n)||(t=Math.abs(e.x0))||(t=1),.9*t*Math.pow(e.n,-.2)}(t.boxplotStats);t.bandwidth=o,t.density=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,a=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=0,o=e.length;r<o;r++){var l=e[r];a=Math.min(a,l),i=Math.max(i,l)}for(var s=(i-a)/(n-1),c=new Float32Array(n),d=new Float32Array(n),u=0,h=Vi(t,Wi,e),p=0,f=a;p<n;p++,f+=s){var m=h(f);c[p]=f,d[p]=m,u=Math.max(u,m)}return{x:c,y:d,max:u}}(a,o)}}))}))}var k=[o[0].dimension].concat(w);return Object(a.jsxs)(r.a.Fragment,{children:["violin"!==g&&Object(a.jsx)(Bi,{categoryColorScales:i,colorScale:j,sizeScale:y,textColor:n,drawCircles:"dotplot"===g,data:S}),"violin"===g&&Object(a.jsx)(Zi,(e={categoryColorScales:i,colorScale:j,textColor:n,options:l},Object(Di.a)(e,"textColor",n),Object(Di.a)(e,"data",S),e)),"violin"!==g&&null!=c&&c.length>0?Object(a.jsx)(Bi,{categoryColorScales:i,colorScale:j,sizeScale:y,subtitle:"selection",textColor:n,drawCircles:"dotplot"===g,data:Ji(c,l)}):null,"violin"===g&&null!=c&&c.length>0?Object(a.jsx)(Zi,{categoryColorScales:i,colorScale:j,subtitle:"selection",options:l,textColor:n,data:Ji(c,l)}):null,"violin"!==g&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)(_i,{handleInterpolator:this.props.handleInterpolator,interpolator:d}),Object(a.jsxs)("div",{style:{color:n,width:174},children:[Object(a.jsx)(Q.a,{variant:"caption",children:O}),Object(a.jsx)(Q.a,{variant:"caption",style:{float:"right"},children:x})]}),Object(a.jsx)(Mi.a,{shrink:!0,variant:"standard",children:"Custom Mean"}),Object(a.jsx)(ti.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",onChange:this.onMinChange,label:"Min",value:this.state.min}),Object(a.jsx)(ti.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",onChange:this.onMaxChange,label:"Max",value:this.state.max})]}),"dotplot"===g&&Object(a.jsxs)("div",{style:{paddingTop:16},children:[Object(a.jsx)(Ni,{style:{display:"block"},width:150,textColor:n,label:!0,height:40,scale:y}),Object(a.jsx)(Mi.a,{style:{marginTop:16},shrink:!0,variant:"standard",children:"Custom Percent Expressed"}),Object(a.jsx)(ti.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",onChange:this.onMinSizeChange,label:"Min",value:this.state.minSize}),Object(a.jsx)(ti.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",onChange:this.onMaxSizeChange,label:"Max",value:this.state.maxSize})]}),Object(a.jsxs)(Ii.a,{className:this.props.classes.formControl,children:[Object(a.jsx)(Mi.a,{shrink:!0,children:"Sort By"}),Object(a.jsx)(Pi.a,{input:Object(a.jsx)(Ti.a,{size:"small"}),onChange:this.onSortOrderChanged,value:l.sortBy,children:k.map((function(e){return Object(a.jsx)(oe.a,{value:e,children:e},e)}))})]})]})}}]),n}(r.a.PureComponent),Qi=te()((function(e){return{root:{},formControl:{display:"block",margin:e.spacing(1)}}}))($i),er=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(M.a)(n,[{key:"render",value:function(){var e=this.props,t=e.cachedData,n=e.categoricalNames,i=e.chartOptions,o=e.distributionData,l=e.distributionPlotOptions,s=e.dotPlotInterpolator,c=e.embeddingData,d=e.globalFeatureSummary,u=e.handleInterpolator,f=e.onDistributionPlotOptions,m=e.selectedDistributionData;if(0===o.length)return Object(a.jsx)("h4",{children:"Please enter one or more categorical observations and one or more features."});var v=i.darkMode?"white":"black",g=Object(b.groupBy)(o,"dimension"),j=Object(b.groupBy)(m,"dimension");return Object(a.jsx)(r.a.Fragment,{children:Object.keys(g).map((function(e){var i=g[e],r=[];return i[0].dimensions.forEach((function(e){for(var t=!1,n=0;n<c.length;n++)if(e===c[n].name){r.push(c[n].colorScale),t=!0;break}t||r.push(Object(h.a)(p.a))})),Object(a.jsx)(Qi,{cachedData:t,categoryColorScales:r,distributionData:i,globalFeatureSummary:d,selectedData:j[e],interpolator:s,handleInterpolator:u,onDistributionPlotOptions:f,distributionPlotOptions:l,categoricalNames:n,textColor:v},e)}))})}}]),n}(r.a.PureComponent),tr=Object(l.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,distributionData:e.distributionData,distributionPlotOptions:e.distributionPlotOptions,dotPlotInterpolator:e.dotPlotInterpolator,embeddingData:e.embeddingData,globalFeatureSummary:e.globalFeatureSummary,selectedDistributionData:e.selectedDistributionData}}),(function(e){return{onDistributionPlotOptions:function(t){e(Ln(t))},handleInterpolator:function(t){e({type:At,payload:t})}}}))(er),nr=n(175),ar=n(429),ir=n(490);function rr(e){var t=e.children,n=e.value,i=e.index,r=Object(nr.a)(e,["children","value","index"]);return Object(a.jsx)("div",Object(Ta.a)(Object(Ta.a)({role:"tabpanel",hidden:n!==i,id:"editor-tabpanel-".concat(i),"aria-labelledby":"editor-tab-".concat(i)},r),{},{children:n===i&&Object(a.jsx)(Gi.a,{children:t})}))}var or=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.url.trim();if(""!==e&&""!==t){var n=a.state.description.trim(),i=a.state.title.trim();a.setState({loading:!0});var r=null;null!=a.state.readers&&(r=function(e){for(var t=e.split(","),n=new Set,a=0;a<t.length;a++){var i=t[a].trim().toLowerCase();""!==i&&n.add(i)}return Array.from(n)}(a.state.readers)),a.props.handleSave({dataset:a.props.dataset,name:e,title:i,description:n,url:t,readers:r})}},a.onTabChanged=function(e,t){a.setState({tabValue:t})},a.onEmailChanged=function(e){a.setState({readers:e.target.value})},a.onUrlChanged=function(e){a.setState({url:e.target.value})},a.onNameChanged=function(e){a.setState({name:e.target.value})},a.onDescriptionChanged=function(e){a.setState({description:e.target.value})},a.onTitleChanged=function(e){a.setState({title:e.target.value})},a.state={url:"",tabValue:0,name:null!=a.props.dataset?a.props.dataset.name:"",title:null!=a.props.title&&null!=a.props.dataset.title?a.props.dataset.title:"",description:null!=a.props.dataset&&null!=a.props.dataset.description?a.props.dataset.description:"",readers:"",loading:null!=a.props.dataset},a}return Object(M.a)(n,[{key:"componentDidMount",value:function(){if(null!=this.props.dataset){var e=this.props.dataset.readers;if(e){var t=e.indexOf(this.props.email);-1!==t&&e.splice(t,1),e=e.join(", ")}this.setState({name:this.props.dataset.name,description:null!=this.props.dataset.description?this.props.dataset.description:"",title:null!=this.props.dataset.title?this.props.dataset.title:"",loading:!1,url:this.props.dataset.url,readers:e})}}},{key:"render",value:function(){return Object(a.jsxs)(Sa.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-dialog-title",fullWidth:!0,maxWidth:"lg",children:[Object(a.jsxs)(wa.a,{id:"edit-dataset-dialog-title",children:[null==this.props.dataset?"New":"Edit"," Dataset"]}),Object(a.jsxs)(Ci.a,{children:[this.state.loading&&Object(a.jsx)(xa.a,{}),Object(a.jsx)(ti.a,{disabled:this.state.loading,autoComplete:"off",required:!0,value:this.state.name,helperText:"asfd",onChange:this.onNameChanged,margin:"dense",label:"Name",fullWidth:!0}),!this.state.loading&&Object(a.jsx)(ti.a,{required:!0,autoComplete:"off",value:this.state.url,onChange:this.onUrlChanged,margin:"dense",helperText:this.props.serverInfo.email?"Please ensure that "+this.props.serverInfo.email+' has "Storage Object Viewer" permissions':"",label:"URL ("+(this.props.serverInfo.email?"gs://my_bucket/my_dataset":"/Users/foo/my_dataset")+")",fullWidth:!0}),Object(a.jsx)(ti.a,{disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.title,onChange:this.onTitleChanged,margin:"dense",label:"Title",fullWidth:!0,inputProps:{maxLength:255}}),Object(a.jsx)("div",{children:Object(a.jsxs)(Ii.a,{children:[Object(a.jsx)(Mi.a,{children:"Summary"}),Object(a.jsx)("div",{style:{marginTop:36}}),Object(a.jsx)(ar.a,{children:Object(a.jsx)(ir.a,{href:"https://www.markdownguide.org/cheat-sheet/",target:"_blank",children:"Markdown Cheat Sheet"})})]})}),Object(a.jsxs)(La.a,{value:this.state.tabValue,onChange:this.onTabChanged,"aria-label":"description-editor",children:[Object(a.jsx)(Na.a,{label:"Write"}),Object(a.jsx)(Na.a,{label:"Preview"})]}),Object(a.jsx)(rr,{value:this.state.tabValue,index:0,children:Object(a.jsx)(ti.a,{disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.description,onChange:this.onDescriptionChanged,margin:"dense",fullWidth:!0,variant:"outlined",rows:8,rowsMax:8,multiline:!0,inputProps:{maxLength:1e3}})}),Object(a.jsx)(rr,{value:this.state.tabValue,index:1,children:""!==this.state.description&&Object(a.jsx)(Gi.a,{border:1,children:Object(a.jsx)(Ka.a,{linkTarget:"_blank",children:this.state.description})})}),!this.state.loading&&""!==this.props.serverInfo.clientId&&Object(a.jsx)(ti.a,{value:this.state.readers,onChange:this.onEmailChanged,margin:"dense",label:"Share",helperText:"Enter comma separated list of emails",fullWidth:!0,multiline:!0})]}),Object(a.jsxs)(wi.a,{children:[Object(a.jsx)(_a.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(_a.a,{disabled:this.state.loading,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(r.a.PureComponent),lr=Object(l.b)((function(e){return{dataset:e.dialog===bn?e.dataset:null,email:e.email,serverInfo:e.serverInfo}}),(function(e){return{handleSave:function(t){e(ta(t))},handleCancel:function(t){e(ra(null))},handleError:function(t){e(aa(t))}}}))(or),sr=n(169),cr=n.n(sr),dr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handlePopoverClose=function(e){a.setState({contextmenuEl:null,anchorEl:null})},a.handleColorChange=function(e){a.setState({color:e.target.value})},a.handleNameChange=function(e){a.setState({name:e.target.value})},a.handleColorChangeApply=function(e){a.props.handleColorChange({name:a.props.name,value:a.state.categoryValue,color:a.state.color}),a.setState({forceUpdate:!a.state.forceUpdate})},a.handleNameChangeApply=function(e){a.props.handleNameChange({name:a.props.name,oldValue:a.state.categoryValue,value:a.state.name}),a.setState({name:"",contextmenuEl:null,anchorEl:null})},a.handleEditColor=function(e){a.setState((function(e,t){return{anchorEl:e.contextmenuEl,contextmenuEl:null,menu:"color"}}),(function(){}))},a.handleEditName=function(e){a.setState((function(e,t){return{anchorEl:e.contextmenuEl,contextmenuEl:null,menu:"name",name:""}}),(function(){}))},a.handleContextmenuClose=function(e){a.setState({contextmenuEl:null})},a.handleClick=function(e,t,n){a.props.clickEnabled&&(n.preventDefault(),a.props.handleClick({name:a.props.name,value:e,shiftKey:n.shiftKey,metaKey:n.metaKey}))},a.handleContextmenu=function(e,t,n){a.props.clickEnabled&&(n.preventDefault(),n.stopPropagation(),a.setState({contextmenuEl:n.target,categoryValue:e,color:a.props.scale(e)}))},a.state={contextmenuEl:null,anchorEl:null,color:null,name:"",categoryValue:null,forceUpdate:!1,menu:null},a}return Object(M.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.scale,i=t.datasetFilter,o=t.name,l=t.featureSummary,s=t.maxHeight,c=t.globalFeatureSummary,d=t.nObs,u=t.nObsSelected,h=t.categoricalNames,p=this.props.clickEnabled,f=i[o],m=l[o],b={};if(null!=m)for(var v=0;v<m.counts.length;v++)b[m.categories[v]]=m.counts[v];var g=c[o],j=g.categories,y=h[o]||{},O=D()({insensitive:!0});j.sort((function(e,t){var n=y[e];null!=n&&(e=n);var a=y[t];return null!=a&&(t=a),O(e,t)})),p=p&&j.length>1;var x={maxHeight:s,display:"inline-block"};this.props.style&&(x=Object.assign({},x,this.props.style));var S=y[this.state.categoryValue]||this.state.categoryValue;return Object(a.jsxs)("div",{className:"cirro-chart-legend",style:x,children:[Object(a.jsxs)(Sa.a,{open:Boolean(this.state.anchorEl),onClose:this.handlePopoverClose,"aria-labelledby":"edit-category-dialog-title",children:[Boolean(this.state.anchorEl)&&"color"==this.state.menu&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)(wa.a,{id:"edit-category-dialog-title",children:["Edit ",S," Color"]}),Object(a.jsx)(Ci.a,{children:Object(a.jsx)("input",{type:"color",value:this.state.color,onChange:this.handleColorChange,style:{width:100}})}),Object(a.jsxs)(wi.a,{children:[Object(a.jsx)(_a.a,{onClick:this.handlePopoverClose,color:"primary",children:"Close"}),Object(a.jsx)(_a.a,{onClick:this.handleColorChangeApply,color:"primary",children:"Apply"})]})]}),Boolean(this.state.anchorEl)&&"name"==this.state.menu&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)(wa.a,{id:"edit-category-dialog-title",children:["Edit ",S," Name"]}),Object(a.jsx)(Ci.a,{children:Object(a.jsx)(ti.a,{type:"text",onChange:this.handleNameChange,value:this.state.name})}),Object(a.jsxs)(wi.a,{children:[Object(a.jsx)(_a.a,{onClick:this.handlePopoverClose,color:"primary",children:"Cancel"}),Object(a.jsx)(_a.a,{onClick:this.handleNameChangeApply,color:"primary",children:"OK"})]})]})]}),Object(a.jsxs)(re.a,{anchorEl:this.state.contextmenuEl,open:Boolean(this.state.contextmenuEl),onClose:this.handleContextmenuClose,children:[Object(a.jsx)(oe.a,{onClick:this.handleEditName,children:"Edit Name"}),Object(a.jsx)(oe.a,{onClick:this.handleEditColor,children:"Edit Color"})]}),Object(a.jsxs)("table",{style:{textAlign:"left"},children:[Object(a.jsx)("thead",{children:Object(a.jsxs)("tr",{children:[p&&Object(a.jsx)("td",{}),Object(a.jsx)("td",{}),Object(a.jsx)("td",{children:Object(a.jsx)("small",{children:"all"})}),Object(a.jsx)("td",{children:Object(a.jsx)("small",{children:null!=m?"selection":null})})]})}),Object(a.jsx)("tbody",{children:j.map((function(t,i){var r=null==f||-1!==f.indexOf(t)?1:.4,o=g.counts[i],l=b[t]||0,s=null==m?0:l/u,c=Le(100*o/d)+"%",h=t,v=y[t];void 0!==v&&(h=v);var j=null==m?null:Le(100*s)+"%";return Object(a.jsxs)("tr",{style:{cursor:p?"pointer":null,opacity:r},onContextMenu:function(n){return e.handleContextmenu(t,i,n)},onClick:function(n){return e.handleClick(t,i,n)},children:[p&&Object(a.jsx)("td",{children:Object(a.jsx)("div",{style:{display:"inline-block",width:10,height:10,background:n(t)}})}),Object(a.jsxs)("td",{children:[Object(a.jsx)("div",{style:{maxWidth:140,textOverflow:"ellipsis",overflow:"hidden",display:"inline-block",userSelect:"none"},title:""+h,children:""+h}),Object(a.jsx)(ie.a,{style:{padding:0,fontSize:14},size:"small",onClick:function(n){return e.handleContextmenu(t,i,n)},"aria-label":"Menu","aria-haspopup":"true",children:Object(a.jsx)(cr.a,{fontSize:"inherit"})})]}),Object(a.jsx)("td",{children:Object(a.jsx)(ae.a,{title:c,children:Object(a.jsx)("span",{children:Be(o)})})}),m&&Object(a.jsx)("td",{children:Object(a.jsx)(ae.a,{title:j,children:Object(a.jsx)("div",{children:Be(l)})})})]},t)}))})]})]})}}]),n}(r.a.PureComponent),ur=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(M.a)(n,[{key:"getTable",value:function(e,t,n){return Object(a.jsxs)("table",{children:[Object(a.jsx)("thead",{children:Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{}),e.map((function(e){return Object(a.jsx)("td",{children:Object(a.jsx)("small",{children:e})},e)}))]})}),Object(a.jsxs)("tbody",{children:[Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["Mean",":"]}),Object(a.jsx)("td",{children:Le(n.mean)}),t&&Object(a.jsx)("td",{children:Le(t.mean)})]}),null!=n.numExpressed&&Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["% Expressed",":"]}),Object(a.jsx)("td",{children:Ue(100*n.numExpressed/this.props.nObs)}),t&&Object(a.jsx)("td",{children:Ue(100*t.numExpressed/this.props.nObsSelected)})]}),(null==n.numExpressed||0!==n.min)&&Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["Min",":"]}),Object(a.jsx)("td",{children:Le(n.min)}),t&&Object(a.jsx)("td",{children:Le(t.min)})]}),Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["Max",":"]}),Object(a.jsx)("td",{children:Le(n.max)}),t&&Object(a.jsx)("td",{children:Le(t.max)})]})]})]})}},{key:"render",value:function(){var e=this.props,t=e.name,n=e.featureSummary,i=e.globalFeatureSummary,o=n[t],l=i[t],s=["all"];return null!=o&&s.push("selection"),Object(a.jsx)(r.a.Fragment,{children:null!=l&&"__count"!==t&&this.getTable(s,o,l)})}}]),n}(r.a.PureComponent),hr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleOperationChanged=function(e){var t=e.target.value;a.props.handleUpdate({name:a.props.name,operation:t,update:!0})},a.handleValueUpdate=function(){var e=a.getFilter(),t=parseFloat(e.uiValue);a.props.handleUpdate({name:a.props.name,value:t,update:!0})},a.handleValueChange=function(e){var t=a.getFilter();t.uiValue=e.target.value,a.props.handleUpdate({name:a.props.name,operation:t.operation,value:t.value,update:!1}),a.handleValueUpdate()},a.handleValueUpdate=Object(b.debounce)(a.handleValueUpdate,500),a}return Object(M.a)(n,[{key:"getFilter",value:function(){var e=this.props.datasetFilter[this.props.name];return null==e&&(e={operation:">",value:NaN,uiValue:""},this.props.datasetFilter[this.props.name]=e),e}},{key:"render",value:function(){var e=this.props.name,t=this.getFilter(),n=e+"_filter";return Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)(Mi.a,{shrink:!0,id:n+"_label",children:"Filter"}),Object(a.jsxs)(Pi.a,{labelId:n+"_label",id:n,style:{marginRight:6},value:t.operation,onChange:this.handleOperationChanged,children:[Object(a.jsx)(oe.a,{value:""}),Object(a.jsx)(oe.a,{value:">",children:">"}),Object(a.jsx)(oe.a,{value:"<",children:"<"}),Object(a.jsx)(oe.a,{value:"=",children:"="}),Object(a.jsx)(oe.a,{value:">=",children:">="}),Object(a.jsx)(oe.a,{value:"<=",children:"<="}),Object(a.jsx)(oe.a,{value:"!=",children:"!="})]}),Object(a.jsx)(ti.a,{onChange:this.handleValueChange,value:t.uiValue,style:{maxWidth:60}})]})}}]),n}(r.a.PureComponent),pr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.setState({min:e.target.value}),a.onMinUpdate(parseFloat(e.target.value))},a.onMinUpdate=function(e){isNaN(e)?delete a.props.globalFeatureSummary[a.props.name].customMin:a.props.globalFeatureSummary[a.props.name].customMin=e,a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})},a.onMaxChange=function(e){a.setState({max:e.target.value}),a.onMaxUpdate(parseFloat(e.target.value))},a.onMaxUpdate=function(e){isNaN(e)?delete a.props.globalFeatureSummary[a.props.name].customMax:a.props.globalFeatureSummary[a.props.name].customMax=e,a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})},a.state={min:"",max:""},a.onMinUpdate=Object(b.debounce)(a.onMinUpdate,500),a.onMaxUpdate=Object(b.debounce)(a.onMaxUpdate,500),a}return Object(M.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.name!==this.props.name&&this.setState({min:"",max:""})}},{key:"render",value:function(){var e=this.props,t=e.scale,n=e.name,i=e.nObs,r=e.nObsSelected,o=e.featureSummary,l=e.globalFeatureSummary,s=e.maxHeight,c=e.datasetFilter,d=e.handleUpdate,u=e.selected,h={display:"inline-block",verticalAlign:"top"};return this.props.style&&(h=Object.assign({},h,this.props.style)),Object(a.jsxs)("div",{className:"cirro-condensed",style:h,children:[Object(a.jsx)(ur,{name:n,selected:u,summary:t.summary,featureSummary:o,nObs:i,nObsSelected:r,globalFeatureSummary:l,maxHeight:s}),"__count"!==n&&this.props.handleDomain&&Object(a.jsx)(Mi.a,{shrink:!0,variant:"standard",children:"Custom Color Scale"}),"__count"!==n&&this.props.handleDomain&&Object(a.jsx)(ti.a,{InputLabelProps:{shrink:!0},margin:"none",style:{maxWidth:60,marginRight:4,marginTop:0},size:"small",type:"text",onChange:this.onMinChange,label:"Min",value:this.state.min}),"__count"!==n&&this.props.handleDomain&&Object(a.jsx)(ti.a,{InputLabelProps:{shrink:!0},margin:"none",style:{maxWidth:60,marginTop:0},size:"small",type:"text",onChange:this.onMaxChange,label:"Max",value:this.state.max}),"__count"!==n&&Object(a.jsx)(hr,{datasetFilter:c,name:n,handleUpdate:d})]})}}]),n}(r.a.PureComponent),fr=function(){function e(t,n){var a=this;Object(O.a)(this,e),this._viewer=t,this.backingScale=1,this._containerWidth=0,this._containerHeight=0,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.width="100%",this._canvas.style.height="100%",this._viewer.canvas.appendChild(this._canvas),this.onRedraw=n.onRedraw||function(){},this.clearBeforeRedraw="undefined"===typeof n.clearBeforeRedraw||n.clearBeforeRedraw,this._viewer.addHandler("update-viewport",(function(){a.resize(),a._updateCanvas()})),this._viewer.addHandler("open",(function(){a.resize(),a._updateCanvas()}))}return Object(M.a)(e,[{key:"canvas",value:function(){return this._canvas}},{key:"context2d",value:function(){return this._canvas.getContext("2d")}},{key:"clear",value:function(){this._canvas.getContext("2d").clearRect(0,0,this._containerWidth*this.backingScale,this._containerHeight*this.backingScale)}},{key:"resize",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio);var t=this.backingScale!==e;this.backingScale=e,(this._containerWidth!==this._viewer.container.clientWidth||t)&&(this._containerWidth=this._viewer.container.clientWidth,this._canvas.setAttribute("width",e*this._containerWidth),this._canvas.setAttribute("width",e*this._containerWidth)),(this._containerHeight!==this._viewer.container.clientHeight||t)&&(this._containerHeight=this._viewer.container.clientHeight,this._canvas.setAttribute("height",e*this._containerHeight),this._canvas.setAttribute("height",e*this._containerHeight))}},{key:"_updateCanvas",value:function(){var e=this._viewer.viewport.getZoom(!0);this.clearBeforeRedraw&&this.clear();for(var t=this._canvas.getContext("2d"),n=0,a=this._viewer.world.getItemCount();n<a;n++){var i=this._viewer.world.getItemAt(n);if(i){var r=i.viewportToImageZoom(e),o=i.imageToViewportCoordinates(0,0,!0),l=this._viewer.viewport.pixelFromPoint(o,!0);t.scale(this.backingScale,this.backingScale),t.translate(l.x,l.y),t.scale(r,r),this.onRedraw({index:n,context:t,x:l.x,y:l.y,zoom:r}),t.setTransform(1,0,0,1,0,0)}}}}],[{key:"getTileIndexFromPixel",value:function(e,t){for(var n=e.viewport.pointFromPixel(t),a=0,i=e.world.getItemCount();a<i;a++){var r=e.world.getItemAt(a),o=new window.OpenSeadragon.Rect(n.x,n.y,0,0),l=r._viewportToTiledImageRectangle(o).getTopLeft(),s=r.source;if(l.x>=0&&l.x<=1&&l.y>=0&&l.y<=1/s.aspectRatio)return a}return-1}}]),e}(),mr="http://www.w3.org/2000/svg",br=function(){function e(t){Object(O.a)(this,e);var n=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(mr,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(mr,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("update-viewport",(function(){n.resize()})),this._viewer.addHandler("open",(function(){n.resize()})),this._viewer.addHandler("rotate",(function(e){n.resize()})),this._viewer.addHandler("resize",(function(){n.resize()})),this.resize()}return Object(M.a)(e,[{key:"node",value:function(){return this._node}},{key:"resize",value:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));var e=this._viewer.viewport.pixelFromPoint(new g.a.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0);this._viewer.world.getItemCount()>0&&(t=this._viewer.world.getItemAt(0).viewportToImageZoom(t));var n=this._viewer.viewport.getRotation();this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+t+") rotate("+n+")")}}]),e}();function vr(e,t){return t*(e.embedding.spatial.spot_diameter?e.embedding.spatial.spot_diameter/2:20)}function gr(e,t,n,a,i,r,o){if(r.length>0){e.textAlign="center",e.textBaseline="middle";var l=Math.ceil(a.labelFontSize/t);e.fillStyle="white",e.strokeStyle="rgba(0,0,0,0.9)",e.lineWidth=a.labelStrokeWidth,e.font=l+"px Roboto Condensed,Helvetica,Arial,sans-serif";for(var s=Dt(n.embedding,r,o),c=Pt(r,s.labels,i),d=0,u=0,h=c.length;d<h;d++,u+=3){var p=s.positions[u],f=s.positions[u+1];e.strokeText(""+c[d],p,f),e.fillText(""+c[d],p,f)}}}function jr(e,t,n,a,i,r,o){e.lineWidth=2/t,e.setLineDash&&e.setLineDash([2,2]);var l=0===a.size,s=n.indices;if(l){e.globalAlpha=i;for(var c=0;c<n.x.length;c++){var d=s[c],u=n.x[d],h=n.y[d];e.fillStyle=n.colors[d],e.beginPath(),e.arc(u,h,o,0,2*Math.PI,!0),e.fill()}}else{e.globalAlpha=r;for(var p=0;p<n.x.length;p++){var f=s[p],m=n.x[f],b=n.y[f];a.has(f)||(e.fillStyle=n.colors[f],e.beginPath(),e.arc(m,b,o,0,2*Math.PI,!0),e.fill())}e.globalAlpha=i;for(var v=0;v<n.x.length;v++){var g=s[v],j=n.x[g],y=n.y[g];a.has(g)&&(e.fillStyle=n.colors[g],e.beginPath(),e.arc(j,y,o,0,2*Math.PI,!0),e.fill())}}e.globalAlpha=1,e.setLineDash&&e.setLineDash([])}var yr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t=a.props.traceInfo,n=a.viewer.source.levels[a.viewer.source.levels.length-1].context2D.canvas;Xe(t,{width:n.width,height:n.height},Object(b.bind)(a.drawContext,Object($.a)(a)),e)},a.onEditSelection=function(){a.props.chartOptions.editSelection=!a.props.chartOptions.editSelection,a.props.setChartOptions(a.props.chartOptions)},a.onZoomIn=function(){a.viewer.viewport.zoomBy(a.viewer.zoomPerClick/1),a.viewer.viewport.applyConstraints()},a.onZoomOut=function(){a.viewer.viewport.zoomBy(1/a.viewer.zoomPerClick),a.viewer.viewport.applyConstraints()},a.onHome=function(){a.viewer.viewport.goHome(),a.viewer.viewport.applyConstraints()},a.onDragMode=function(e){a.props.chartOptions.dragmode=e,a.props.setChartOptions(a.props.chartOptions)},a.id=Object(b.uniqueId)("cirro-image"),a.tooltipElementRef=r.a.createRef(),a.state={loading:!1},a}return Object(M.a)(n,[{key:"findPointsInPolygon",value:function(e){for(var t=this.props.traceInfo,n=[],a=0;a<t.x.length;a++)ct({x:t.x[a],y:t.y[a]},e)&&n.push(a);return n}},{key:"findPointsInRectangle",value:function(e){for(var t=this.props.traceInfo,n=vr(t,this.props.pointSize),a=[],i=parseFloat(e.getAttribute("x")),r=parseFloat(e.getAttribute("y")),o=i+parseFloat(e.getAttribute("width")),l=r+parseFloat(e.getAttribute("height")),s=0;s<t.x.length;s++){var c=t.x[s],d=t.y[s];c<=o&&i<=c+n&&d<=l&&r<=d+n&&a.push(s)}return a}},{key:"findPointIndex",value:function(e,t){for(var n=this.props.traceInfo,a=vr(n,this.props.pointSize),i=0;i<n.x.length;i++)if(Math.abs(n.x[i]-e)<=a&&Math.abs(n.y[i]-t)<=a)return i;return-1}},{key:"setTooltip",value:function(e,t){var n=this.props.traceInfo,a=this.findPointIndex(e,t);if(-1!=a){var i=n.values[a],r=this.props.categoricalNames[n.name];if(r){var o=r[i];null!=o&&(i=o)}"number"===typeof i&&(i=Re(i)).endsWith(".00")&&(i=i.substring(0,i.lastIndexOf("."))),this.tooltipElementRef.current.innerHTML=""+i}else this.tooltipElementRef.current.innerHTML=" "}},{key:"drawContext",value:function(e,t){var n=this.viewer.source.levels[this.viewer.source.levels.length-1].context2D.canvas;null==t&&(t={width:n.width,height:n.height});var a=Math.min(t.width/n.width,t.height/n.height);e.drawImage(n,0,0,n.width*a,n.height*a),this._drawOverlay({context:e,zoom:a})}},{key:"_drawOverlay",value:function(e){var t=e.context,n=this.props.traceInfo,a=this.props.selection,i=this.props.markerOpacity,r=this.props.unselectedMarkerOpacity,o=vr(n,this.props.pointSize);jr(t,e.zoom,n,a,i,r,o),gr(t,e.zoom,n,this.props.chartOptions,this.props.categoricalNames,this.props.obsCat,this.props.cachedData)}},{key:"createViewer",value:function(){var e=this;this.viewer&&this.viewer.destroy(),this.props.traceInfo.tileSource.ready?this.setState({loading:!1}):(this.setState({loading:!0}),this.props.traceInfo.tileSource.addOnceHandler("ready",(function(t){e.setState({loading:!1})}))),this.viewer=new g.a({id:this.id,gestureSettingsMouse:{dblClickToZoom:!0,clickToZoom:!1},autoResize:!0,showFullPageControl:!1,collectionMode:!1,showNavigationControl:!1,tileSources:this.props.traceInfo.tileSource});var t=this.viewer,n=this;this.canvasOverlay=new fr(this.viewer,{onRedraw:function(e){n._drawOverlay(e)}});var a=[],i=[0,0],r={x:0,y:0,width:0,height:0};this.viewer.innerTracker.moveHandler=function(e){if(null==n.tooltipElementRef.current)n.tooltipElementRef.current.innerHTML=" ";else if("pan"===n.props.chartOptions.dragmode&&t.world.getItemCount()>0){var a=e.position,i=t.viewport.pointFromPixel(a),r=t.world.getItemAt(0).viewportToImageCoordinates(i,!0);n.setTooltip(r.x,r.y)}else n.tooltipElementRef.current.innerHTML=" "},this.viewer.addHandler("canvas-drag",(function(e){if(("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode)&&t.world.getItemCount()>0){e.preventDefaultAction=!0;var o=e.position,c=t.viewport.pointFromPixel(o),d=t.world.getItemAt(0).viewportToImageCoordinates(c,!0);a.push({x:d.x,y:d.y}),"lasso"===n.props.chartOptions.dragmode?(a=Je()(a),l.setAttribute("d",dt(a))):(r.x=Math.min(d.x,i[0]),r.y=Math.max(d.y,i[1]),r.width=Math.max(d.x,i[0])-r.x,r.height=r.y-Math.min(d.y,i[1]),s.setAttribute("x",""+r.x),s.setAttribute("y",""+(r.y-r.height)),s.setAttribute("width",""+r.width),s.setAttribute("height",""+r.height))}})),this.viewer.addHandler("canvas-press",(function(e){if("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var o=e.position,s=t.viewport.pointFromPixel(o),c=t.world.getItemAt(0).viewportToImageCoordinates(s,!0);"lasso"===n.props.chartOptions.dragmode?((a=[]).push({x:c.x,y:c.y}),a=Je()(a),l.setAttribute("d",dt(a))):(i=[c.x,c.y],r={x:i[0],y:i[1],width:1,height:1})}})),this.viewer.addHandler("canvas-release",(function(e){if("lasso"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var t=n.findPointsInPolygon(a);a=[],l.setAttribute("d",""),n.props.onSelected({name:Tn(n.props.traceInfo.embedding),clear:!n.props.chartOptions.editSelection,value:{basis:n.props.traceInfo.embedding,points:t}})}else if("select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var i=n.findPointsInRectangle(s);s.removeAttribute("x"),s.removeAttribute("y"),s.removeAttribute("width"),s.removeAttribute("height"),n.props.onSelected({name:Tn(n.props.traceInfo.embedding),clear:!n.props.chartOptions.editSelection,value:{basis:n.props.traceInfo.embedding,points:i}})}})),t.addHandler("canvas-exit",(function(e){n.tooltipElementRef.current&&(n.tooltipElementRef.current.innerHTML=" ")}));var o=new br(t),l=document.createElementNS("http://www.w3.org/2000/svg","path"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");[l,s].forEach((function(e){e.setAttribute("stroke","black"),e.setAttribute("stroke-width","3px"),e.setAttribute("fill","#0bb"),e.setAttribute("fill-opacity","0.3"),e.setAttribute("stroke-dasharray","2 2"),o.node().appendChild(e)}))}},{key:"componentDidUpdate",value:function(e,t,n){this.canvasOverlay&&this.canvasOverlay._updateCanvas()}},{key:"componentWillUnmount",value:function(){this.viewer&&this.viewer.destroy(),this.viewer=null}},{key:"componentDidMount",value:function(){null==this.viewer&&this.createViewer(this.props.traceInfo.url)}},{key:"render",value:function(){return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{className:this.props.classes.root,children:[Object(a.jsx)(Ae,{dragmode:this.props.chartOptions.dragmode,editSelection:this.props.chartOptions.editSelection,onGallery:this.props.onGallery,animating:!1,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,is3d:!1,onHome:this.onHome,onSaveImage:this.onSaveImage,onDragMode:this.onDragMode,onEditSelection:this.onEditSelection}),Object(a.jsx)(Q.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(a.jsx)("div",{style:{display:"inline-block",width:this.props.chartSize.width,height:this.props.chartSize.height},id:this.id}),this.state.loading&&Object(a.jsx)(xa.a,{style:{position:"absolute",left:this.props.chartSize.width/2,top:this.props.chartSize.height/2},size:20})]})}}]),n}(r.a.PureComponent),Or=te()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},position:"absolute",zIndex:1,top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(yr),xr=n(491),Sr=n(176),wr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t,n=null,i=a.props,r=i.chartSize,o=i.traceInfo,l={width:r.width,height:r.height},s=o.name;if("__count"===s&&(s="count"),"svg"!==e){(n=document.createElement("canvas")).width=l.width*window.devicePixelRatio,n.height=l.height*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.fillStyle="white",t.fillRect(0,0,l.width,l.height);var c=(new XMLSerializer).serializeToString(o.source),d="data:image/svg+xml;base64,"+btoa(c);t.fillStyle="black";var u=new Image;u.src=d,u.onload=function(){t.drawImage(u,0,0),n.toBlob((function(e){window.saveAs(e,s+".png",!0)}))}}else{var h=new Blob([(new XMLSerializer).serializeToString(o.source)],{type:"text/plain;charset=utf-8"});window.saveAs(h,s+".svg")}},a.updateSvg=function(){var e=a.containerElementRef.current;e.innerHTML="";var t,n=a.props.traceInfo.source;n.setAttribute("width",a.props.chartSize.width),n.setAttribute("height",a.props.chartSize.height),e.append(n);var i=n.childNodes||n.children;if(i.length>0&&"g"===i[0].nodeName&&"true"===i[0].getAttribute("cirro-zoom")&&(t=i[0]),!t){var r=new Set(["defs","metadata","style"]);(t=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("cirro-zoom","true");var o=n.childNodes||n.children;if(o&&o.length>0)for(var l=o.length;l>0;l--)r.has(o[o.length-l].nodeName)||t.appendChild(o[o.length-l]);n.appendChild(t)}var s=Object(Sr.a)().scaleExtent([.1,10]).on("zoom",(function(e){var n=e.transform;t.setAttribute("transform",n)}));a.d3Zoom=s,Object(xr.a)(n).call(s)},a.onHome=function(){Object(xr.a)(a.props.traceInfo.source).call(a.d3Zoom.transform,Sr.b.scale(1))},a.onZoomIn=function(){Object(xr.a)(a.props.traceInfo.source).call(a.d3Zoom.scaleBy,1.5)},a.onZoomOut=function(){Object(xr.a)(a.props.traceInfo.source).call(a.d3Zoom.scaleBy,.5)},a.containerElementRef=r.a.createRef(),a.tooltipElementRef=r.a.createRef(),a}return Object(M.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.updateSvg();var t=this.containerElementRef.current;t.addEventListener("mousemove",(function(t){if("path"===t.target.nodeName){var n=e.props.traceInfo.categoryToStats,a=t.target.id;if(a=a.replaceAll("_"," "),n){var i=n[a];i&&("__count"!==e.props.traceInfo.name?e.props.traceInfo.isCategorical?a+=", mode: "+i.value+", # spots: "+Be(i.n):a+=", mean: "+Re(i.value)+", # spots: "+Be(i.n):a+=", # spots: "+Be(i.n))}e.tooltipElementRef.current.innerHTML=a}else e.tooltipElementRef.current.innerHTML=""})),t.addEventListener("mouseleave",(function(t){e.tooltipElementRef.current.innerHTML=""}))}},{key:"componentDidUpdate",value:function(e,t,n){if(this.props.traceInfo.source!==e.traceInfo.source)Object(xr.a)(e.traceInfo.source).on(".zoom",null),this.updateSvg();else if(this.props.chartSize.width!==e.chartSize.width||this.props.chartSize.height!==e.chartSize.height){var a=this.props.traceInfo.source;a.setAttribute("width",this.props.chartSize.width),a.setAttribute("height",this.props.chartSize.height),Object(xr.a)(a).call(this.d3Zoom.transform,Sr.b.scale(1))}}},{key:"render",value:function(){return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{className:this.props.classes.root,children:[Object(a.jsx)(Ae,{onGallery:this.props.onGallery,animating:!1,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,is3d:!1,onHome:this.onHome,onSaveImage:this.onSaveImage}),Object(a.jsx)(Q.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(a.jsx)("div",{style:{display:"inline-block"},ref:this.containerElementRef})]})}}]),n}(r.a.PureComponent),Cr=te()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},position:"absolute",zIndex:1,top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(wr),kr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleExpandClick=function(e){e.preventDefault(),a.setState({showDetails:!a.state.showDetails})},a.state={showDetails:!0},a}return Object(M.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.traceInfo.name!==this.props.traceInfo.name&&this.setState({showDetails:!0})}},{key:"render",value:function(){var e=this.props,t=e.cachedData,n=e.categoricalNames,i=e.chartOptions,r=e.dataset,o=e.datasetFilter,l=e.embeddingLabels,s=e.featureSummary,c=e.globalFeatureSummary,d=e.markerOpacity,u=e.nObsSelected,h=e.onChartOptions,p=e.onColorChange,f=e.onDeselect,m=e.onDimensionFilterUpdated,b=e.onDomain,v=e.onGallery,g=e.onMeasureFilterUpdated,j=e.onNameChange,y=e.onSelect,O=e.pointSize,x=e.primaryChartSize,S=e.searchTokens,w=e.selection,C=e.shape,k=e.traceInfo,E=e.unselectedMarkerOpacity,D=bt(S).obsCat.filter((function(e){return-1!==l.indexOf(e)})),M="__count"===k.name?"":k.name;return Object(a.jsxs)("div",{style:{position:"relative"},children:[Object(a.jsxs)(Gi.a,{color:"text.primary",style:{marginTop:"3.2px",position:"absolute",textAlign:"right",right:8,zIndex:1e3},children:[""!==M?Object(a.jsx)(ae.a,{title:"Embedding: "+k.embedding.name,children:Object(a.jsx)(ir.a,{onClick:this.handleExpandClick,children:Object(a.jsxs)(Q.a,{color:"textPrimary",style:{marginRight:14},component:"h4",children:[M," ",k.continuous?null:Object(a.jsxs)("small",{children:["(",c[k.name].categories.length,")"]})]})})}):null,k.continuous?Object(a.jsx)(pr,{handleDomain:b,width:140,showColorScheme:!1,height:30,style:{display:this.state.showDetails?"block":"none"},handleUpdate:g,datasetFilter:o,scale:k.colorScale,featureSummary:s,globalFeatureSummary:c,nObs:C[0],nObsSelected:u,maxHeight:null,name:k.name},k.name):Object(a.jsx)(dr,{style:{display:this.state.showDetails?"block":"none"},datasetFilter:o,handleClick:m,handleColorChange:p,handleNameChange:j,categoricalNames:n,name:k.name,scale:k.colorScale,maxHeight:300,clickEnabled:!0,nObs:C[0],nObsSelected:u,globalFeatureSummary:c,featureSummary:s},k.name)]}),"scatter"===k.type&&Object(a.jsx)(xt,{traceInfo:k,cachedData:t,obsCat:D,chartSize:x,setChartOptions:h,chartOptions:i,categoricalNames:n,selection:w,onDeselect:f,onSelected:y,pointSize:O,markerOpacity:d,unselectedMarkerOpacity:E,color:k.colors,onGallery:v}),"meta_image"===k.type&&Object(a.jsx)(Cr,{traceInfo:k,cachedData:t,chartSize:x,setChartOptions:h,chartOptions:i,dataset:r,categoricalNames:n,markerOpacity:d,onGallery:v}),"image"===k.type&&Object(a.jsx)(Or,{cachedData:t,obsCat:D,setChartOptions:h,chartOptions:i,style:{display:"inline-block"},traceInfo:k,pointSize:O,chartSize:x,categoricalNames:n,selection:w,onInitialized:this.onInitialized,markerOpacity:d,unselectedMarkerOpacity:E,onDeselect:f,onSelected:y,onGallery:v})]})}}]),n}(r.a.PureComponent),Er=Object(l.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,dataset:e.dataset,datasetFilter:e.datasetFilter,embeddingChartSize:e.embeddingChartSize,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,featureSummary:e.featureSummary,globalFeatureSummary:e.globalFeatureSummary,markerOpacity:e.markerOpacity,nObsSelected:e.selection.count,pointSize:e.pointSize,primaryChartSize:e.primaryChartSize,primaryTraceKey:e.primaryTraceKey,shape:e.dataset.shape,searchTokens:e.searchTokens,unselectedMarkerOpacity:e.unselectedMarkerOpacity}}),(function(e){return{onChartOptions:function(t){e(Rn(t))},onDomain:function(t){e({type:Zt,payload:t})},onDimensionFilterUpdated:function(t){var n;e((n=t,function(e,t){for(var a,i=n.name,r=n.value,o=n.shiftKey,l=n.metaKey,s=t().datasetFilter,c=t().embeddingData,d=0;d<c.length;d++)if(c[d].name===i){a=c[d].colorScale.domain();break}var u=s[i];if(null==u&&(u=[],s[i]=u),o&&u.length>0){var h=a.indexOf(u[u.length-1]),p=a.indexOf(r);if(p>h)for(var f=h;f<=p;f++){var m=u.indexOf(r);-1!==m&&u.splice(m,1),u.push(a[f])}else for(var b=h;b>=p;b--){var v=u.indexOf(r);-1!==v&&u.splice(v,1),u.push(a[b])}}else{var g=u.indexOf(r);l||(u=[],s[i]=u),-1!==g?(u.splice(g,1),0===u.length&&delete s[i]):u.push(r)}e(Hn(s)),e(Gn())}))},onColorChange:function(t){e({type:Kt,payload:t})},onNameChange:function(t){var n;e((n=t,function(e,t){var a=t().dataset.id;(t().serverInfo.fancy?t().serverInfo.api.setCategoryNamePromise({c:n.name,o:n.oldValue,n:n.value,id:a}):Promise.resolve()).then((function(){return e(qn(n))}))}))},onMeasureFilterUpdated:function(t){var n;e((n=t,function(e,t){var a=n.name,i=n.operation,r=n.value,o=n.update,l=t().datasetFilter,s=l[a];null==s&&(s={operation:">",value:NaN},l[a]=s),o&&(null!=r&&(o=isNaN(r)?isNaN(r)!==isNaN(s.value):r!==s.value),null!=i&&(o=o||i!==s.operation&&!isNaN(s.value))),null!=i&&(s.operation=i),null!=r&&(s.value=r),e(Hn(Object.assign({},l))),o&&e(Gn())}))},onSelect:function(t){e(Xn(t))},onDeselect:function(t){e(Xn(t))}}}))(kr),Dr=new Set,Mr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).resizeListener=function(){var e=window.innerWidth-280,t=Math.max(300,window.innerHeight-410);a.props.handlePrimaryChartSize({width:e,height:t})},window.addEventListener("resize",a.resizeListener),a}return Object(M.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeListener)}},{key:"render",value:function(){var e=this.props,t=e.primaryTraceKey,n=e.embeddingData,i=e.selection,r=e.onGallery,o=e.primaryChartSize,l=n.filter((function(e){return zn(e)===t})),s=1===l.length?l[0]:null,c=Dr;if(s){var d=Tn(s.embedding),u=null!=i&&null!=i.chart?i.chart[d]:null;c=u?u.userPoints:Dr}return null==s?Object(a.jsx)("div",{style:{height:o.height}}):Object(a.jsx)(Er,{onGallery:r,traceInfo:s,selection:c})}}]),n}(r.a.PureComponent),Pr=Object(l.b)((function(e){return{embeddingData:e.embeddingData,primaryTraceKey:e.primaryTraceKey,primaryChartSize:e.primaryChartSize,selection:e.selection}}),(function(e){return{handlePrimaryChartSize:function(t){e({type:Bt,payload:t})}}}))(Mr),Ir=n(271),Tr=n.n(Ir),zr=n(199),Ar=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onSelect=function(e){e.preventDefault(),a.props.onSelect(a.props.traceInfo)},a.state={url:null,overlayUrl:null,loading:!1,forceUpdate:!1},a.elementRef=r.a.createRef(),a}return Object(M.a)(n,[{key:"draw",value:function(){var e=this,t=this.props,n=t.obsCat,a=t.cachedData,i=t.scatterPlot,r=t.chartSize,o=t.categoricalNames,l=t.containerElement,s=t.traceInfo,c=t.markerOpacity,d=t.unselectedMarkerOpacity,u=t.selection,h=t.chartOptions,p=t.pointSize,f=Tn(s.embedding),m=null!=u&&null!=u.chart?u.chart[f]:null,b=m?m.userPoints:new Set;if("scatter"===s.type){yt(i,St).zoomFactor=this.zoomFactor,Mt(i,s,b,c,d,p,o,h,n,a);var v=l.querySelector("canvas"),g=null;if(n.length>0&&r>=600){var j=Dt(s.embedding,n,a),y=document.createElement("canvas");y.width=r*window.devicePixelRatio,y.height=r*window.devicePixelRatio;var O=y.getContext("2d");O.scale(window.devicePixelRatio,window.devicePixelRatio),O.font="bold "+h.labelFontSize+"px Roboto Condensed",jt(O,Pt(n,j.labels,o),j.positions,h,{width:r,height:r},i.camera),g=y.toDataURL()}this.setState({url:v.toDataURL(),overlayUrl:g,loading:!1,element:null})}else if("image"===s.type)if(s.tileSource.ready){var x=document.createElement("canvas");x.width=r*window.devicePixelRatio,x.height=r*window.devicePixelRatio;var S=x.getContext("2d");S.scale(window.devicePixelRatio,window.devicePixelRatio),function(e,t,n,a,i,r,o,l,s,c,d){if(n.tileSource.ready){var u=n.tileSource.levels[n.tileSource.levels.length-1].context2D.canvas;null==t&&(t={width:u.width,height:u.height});var h=Math.min(t.width/u.width,t.height/u.height);e.drawImage(u,0,0,u.width*h,u.height*h),e.scale(h,h),jr(e,h,n,a,i,r,d),gr(e,h,n,o,l,s,c),e.setTransform(1,0,0,1,0,0)}}(S,{width:r,height:r},s,b,c,d,h,o,n,a,vr(s,p)),this.setState({url:x.toDataURL(),overlayUrl:null,loading:!1,element:null}),x=null}else this.setState({url:null,overlayUrl:null,loading:!0,element:null}),s.tileSource.addOnceHandler("ready",(function(){e.setState({loading:!1})}));else{var w=this.elementRef.current;w.innerHTML="";var C=s.gallerySource;C.setAttribute("width",r),C.setAttribute("height",r),w.append(C),this.setState({url:null,overlayUrl:null,loading:!1})}}},{key:"componentDidMount",value:function(){this.zoomFactor=kt(this.props.primaryChartSize),this.draw()}},{key:"componentDidUpdate",value:function(e,t){e.primaryChartSize!==this.props.primaryChartSize&&(this.zoomFactor=kt(this.props.primaryChartSize)),this.draw()}},{key:"render",value:function(){var e=this.props.traceInfo.name;return"__count"===e&&(e=""),Object(a.jsx)(Gi.a,{borderColor:"text.primary",border:1,style:{display:"inline-block",margin:2},children:Object(a.jsxs)("div",{style:{position:"relative",width:this.props.chartSize,height:this.props.chartSize,cursor:"pointer"},children:[Object(a.jsx)(ae.a,{title:"Embedding: "+this.props.traceInfo.embedding.name,children:Object(a.jsx)(Q.a,{color:"textPrimary",component:"h4",onClick:this.onSelect,style:{marginTop:"3.2px",position:"absolute",right:4,zIndex:1e3},children:e})}),this.state.loading&&Object(a.jsx)(xa.a,{style:{position:"absolute",left:this.props.chartSize/2,top:this.props.chartSize/2},size:20}),Object(a.jsx)("div",{onClick:this.onSelect,ref:this.elementRef,style:{position:"absolute",left:0,top:0}}),this.state.url&&Object(a.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(a.jsx)("img",{alt:"",src:this.state.url,width:this.props.chartSize*window.devicePixelRatio,height:this.props.chartSize*window.devicePixelRatio,onClick:this.onSelect,style:{width:this.props.chartSize,height:this.props.chartSize}})}),this.state.overlayUrl&&Object(a.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(a.jsx)("img",{alt:"",src:this.state.overlayUrl,onClick:this.onSelect,style:{width:this.props.chartSize,height:this.props.chartSize}})})]})})}}]),n}(r.a.PureComponent);function _r(e){var t=document.createElement("div");return t.style.position="absolute",t.style.left="-9999px",t.style.width=e+"px",t.style.height=e+"px",t}var Fr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onChartSelected=function(e){a.props.handlePrimaryTraceKey(zn(e)),window.scrollTo(0,0)},a.onSortEnd=function(e,t){e[t.oldIndex].sortIndex=t.newIndex,e[t.newIndex].sortIndex=t.oldIndex,a.props.handleEmbeddingData(a.props.embeddingData.slice())},a.containerElement=_r(a.props.chartSize),document.body.appendChild(a.containerElement),a.scatterPlot=Et(a.containerElement,null!=window.ApplePaySession,!1,!1),a.emptySet=new Set,a}return Object(M.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.cachedData,i=t.categoricalNames,o=t.chartSize,l=t.chartOptions,s=t.embeddingData,c=t.embeddingLabels,d=t.markerOpacity,u=t.pointSize,h=t.primaryChartSize,p=t.searchTokens,f=t.selection,m=t.unselectedMarkerOpacity;this.containerElement.style.width!==this.props.chartSize+"px"&&(document.body.removeChild(this.containerElement),this.containerElement=_r(this.props.chartSize),document.body.appendChild(this.containerElement),this.scatterPlot=Et(this.containerElement,window.ApplePaySession,!1,!1));for(var b=s.filter((function(e){return e.active})),v=0;v<b.length;v++)null==b[v].sortIndex&&(b[v].sortIndex=v);b.sort((function(e,t){return e.sortIndex-t.sortIndex}));var g=bt(p).obsCat.filter((function(e){return-1!==c.indexOf(e)})),j=Object(zr.b)((function(t){var r=t.traceInfo;return Object(a.jsx)(Ar,{traceInfo:r,obsCat:g,cachedData:n,scatterPlot:e.scatterPlot,markerOpacity:d,chartOptions:l,pointSize:u,chartSize:o,categoricalNames:i,primaryChartSize:h,unselectedMarkerOpacity:m,selection:f,containerElement:e.containerElement,onSelect:e.onChartSelected},zn(r))})),y=Object(zr.a)((function(e){var t=e.items;return Object(a.jsx)("ul",{style:{padding:0},children:t.map((function(e,t){return Object(a.jsx)(j,{index:t,traceInfo:e},zn(e))}))})}));return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)(Q.a,{variant:"subtitle1",children:["Gallery",Object(a.jsx)(ae.a,{title:"Drag gallery charts to reorder. Click chart to set primary view.",children:Object(a.jsx)(Tr.a,{style:{verticalAlign:"text-bottom"}})})]}),Object(a.jsx)(y,{distance:2,axis:"xy",items:b,onSortEnd:function(t){return e.onSortEnd(b,t)}})]})}}]),n}(r.a.PureComponent),Nr=Object(l.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,chartSize:e.chartSize,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,markerOpacity:e.markerOpacity,pointSize:e.pointSize,primaryChartSize:e.primaryChartSize,primaryTraceKey:e.primaryTraceKey,searchTokens:e.searchTokens,selection:e.selection,unselectedMarkerOpacity:e.unselectedMarkerOpacity}}),(function(e){return{handlePrimaryTraceKey:function(t){e(Un(t))},handleEmbeddingData:function(t){e(ia(t))}}}))(Fr),Lr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleClose()},a.state={open:!0},a}return Object(M.a)(n,[{key:"render",value:function(){return Object(a.jsxs)(Sa.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"help-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(wa.a,{id:"help-dataset-dialog-title",children:"Help"}),Object(a.jsxs)(Ci.a,{children:[Object(a.jsx)(Q.a,{variant:"h6",children:"Primary Embedding Controls"}),Object(a.jsx)(Q.a,{variant:"subtitle1",children:"3-d Plot"}),"Rotate: Mouse left click.",Object(a.jsx)("br",{}),"Pan: Mouse right click.",Object(a.jsx)("br",{}),"Zoom: Mouse wheel.",Object(a.jsx)("br",{}),Object(a.jsx)(Q.a,{variant:"subtitle1",children:"2-d Plot"}),"Pan: Mouse left click.",Object(a.jsx)("br",{}),"Zoom: Mouse wheel.",Object(a.jsx)("br",{}),Object(a.jsx)(za.a,{}),Object(a.jsx)(Q.a,{variant:"h6",children:"Gallery"}),"Drag chart to reorder. Click plot to set primary view.",Object(a.jsx)(za.a,{}),Object(a.jsx)(Q.a,{variant:"h6",children:"Dot Plot"}),"Enter one or more categorical observations and one or more features.",Object(a.jsx)(za.a,{}),Object(a.jsxs)(Q.a,{variant:"h6",children:["Additional documentation is available ",Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"http://cirrocumulus.readthedocs.io/",children:"here"}),"."]})]})]})}}]),n}(r.a.PureComponent),Rr=Object(l.b)((function(e){return{}}),(function(e){return{handleClose:function(t){e(ra(null))}}}))(Lr),Br=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleClose()},a.onLabelFontSizeUpdate=function(e){!isNaN(e)&&e>0&&(a.props.chartOptions.labelFontSize=e,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelFontSize:e}))},a.onLabelFontSize=function(e){a.setState({labelFontSize:e.target.value}),a.onLabelFontSizeUpdate(e.target.value)},a.onLabelStrokeWidth=function(e){a.setState({labelStrokeWidth:e.target.value})},a.onLabelStrokeWidthUpdate=function(e){!isNaN(e)&&e>=0&&(a.props.chartOptions.labelStrokeWidth=e,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelStrokeWidth:e}))},a.state={labelFontSize:"",labelStrokeWidth:""},a.onLabelFontSizeUpdate=Object(b.debounce)(a.onLabelFontSizeUpdate,500),a.onLabelStrokeWidthUpdate=Object(b.debounce)(a.onLabelStrokeWidthUpdate,500),a}return Object(M.a)(n,[{key:"componentDidMount",value:function(){this.setState({labelFontSize:this.props.chartOptions.labelFontSize,labelStrokeWidth:this.props.chartOptions.labelStrokeWidth})}},{key:"render",value:function(){return Object(a.jsxs)(Sa.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"more-options-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(wa.a,{id:"more-options-dialog-title",children:"More Options"}),Object(a.jsxs)(Ci.a,{children:[Object(a.jsx)(ti.a,{value:this.state.labelFontSize,onChange:this.onLabelFontSize,margin:"dense",label:"Label Font Size",fullWidth:!0}),Object(a.jsx)(ti.a,{value:this.state.labelStrokeWidth,onChange:this.onLabelStrokeWidth,margin:"dense",label:"Label Shadow Size",fullWidth:!0})]})]})}}]),n}(r.a.PureComponent),Ur=Object(l.b)((function(e){return{chartOptions:e.chartOptions}}),(function(e){return{handleChartOptions:function(t){e(Rn(t))},handleClose:function(){e(ra(null))}}}))(Br),Hr=n(492),Wr=n(493),Vr=n(494),Gr=n(495),Xr=n(496),qr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleClick=function(e,t){e.stopPropagation()},a}return Object(M.a)(n,[{key:"render",value:function(){var e=this,t=this.props.dataset;if(null==t||null==t.results)return null;var n=t.results.columns,i=t.results.rows;return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)("div",{style:{maxHeight:600,overflow:"auto"},children:Object(a.jsxs)(Hr.a,{stickyHeader:!0,size:"small",children:[Object(a.jsx)(Wr.a,{children:Object(a.jsx)(Vr.a,{children:n.map((function(e){return Object(a.jsx)(Gr.a,{children:e.field},e.field)}))})}),Object(a.jsx)(Xr.a,{children:i.map((function(t){return Object(a.jsx)(Vr.a,{hover:!0,onClick:function(n){return e.handleClick(n,t)},role:"checkbox","aria-checked":!1,tabIndex:-1,selected:null===t.id,children:n.map((function(e){return Object(a.jsx)(Gr.a,{children:t[e.field]},e.field)}))},t.id)}))})]})}),Object(a.jsx)("div",{})]})}}]),n}(r.a.PureComponent),Zr=Object(l.b)((function(e){return{dataset:e.dataset}}),(function(e,t){return{onDistributionPlotOptions:function(t){e(Ln(t))}}}))(qr),Kr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onNotesChanged=function(e){a.setState({notes:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.notes;null!=t&&(t=t.trim()),a.setState({loading:!0}),a.props.handleSave({name:e,notes:t})},a.state={open:!0,name:"",notes:""},a}return Object(M.a)(n,[{key:"componentDidMount",value:function(){null==this.props.savedFilter?this.setState({name:"",notes:"",create:!0}):this.setState({name:this.props.savedFilter.name,notes:this.props.savedFilter.notes})}},{key:"render",value:function(){var e=this.state,t=e.name,n=e.notes,i=e.create;return Object(a.jsxs)(Sa.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-filter-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsxs)(wa.a,{id:"edit-dataset-filter-dialog-title",children:[i?"Create":"Edit"," Filter"]}),Object(a.jsxs)(Ci.a,{children:[Object(a.jsx)(ti.a,{required:!0,value:t,autoComplete:"off",onChange:this.onNameChanged,margin:"dense",label:"Name",fullWidth:!0}),Object(a.jsx)(ti.a,{required:!1,autoComplete:"off",value:n,onChange:this.onNotesChanged,margin:"dense",label:"Notes",fullWidth:!0})]}),Object(a.jsxs)(wi.a,{children:[Object(a.jsx)(_a.a,{onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(_a.a,{disabled:0===t.trim().length,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(r.a.PureComponent),Jr=Object(l.b)((function(e){return{savedFilter:e.savedDatasetFilter}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t(),i=Nn(a),r={ds_id:a.dataset.id};null!=n.filterId&&(r.id=n.filterId);var o={},l=!1;if(n.name!==o.name&&(r.name=n.name,l=!0),n.notes!==o.notes&&(r.notes=n.notes,l=!0),Object(b.isEqual)(i,o.value)||(r.value=i,l=!0),l){for(var s in r)o[s]=r[s];e(la(!0)),t().serverInfo.api.upsertDatasetFilterPromise(r,null!=n.filterId).then((function(a){r.id=a.id;var i=t().datasetFilters;if(null!=n.filterId){for(var o=0;o<i.length;o++)if(i[o].id===a.id){i[o]=r;break}}else i.push(r);e(fa(i.slice())),e(aa("Filter saved"))})).finally((function(){e(la(!1)),e(ra(null))})).catch((function(t){ja(e,t,"Unable to save filter. Please try again.")}))}else e(ra(null))}))},handleCancel:function(t){e(ra(null))},handleError:function(t){e(aa(t))}}}))(Kr),Yr=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onCategoryChanged=function(e){a.setState({category:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.category;null!=t&&(t=t.trim()),a.setState({loading:!0}),a.props.handleSave({name:e,category:t})},a.state={open:!0,name:"",category:""},a}return Object(M.a)(n,[{key:"render",value:function(){var e=this.state,t=e.name,n=e.category;return Object(a.jsxs)(Sa.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-set-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(wa.a,{id:"edit-set-dialog-title",children:"Create Set"}),Object(a.jsxs)(Ci.a,{children:[Object(a.jsx)(ti.a,{required:!0,autoComplete:"off",value:t,onChange:this.onNameChanged,margin:"dense",label:"Set Name",fullWidth:!0}),Object(a.jsx)(ti.a,{required:!0,autoComplete:"off",value:n,onChange:this.onCategoryChanged,margin:"dense",label:"Set Category",fullWidth:!0})]}),Object(a.jsxs)(wi.a,{children:[Object(a.jsx)(_a.a,{onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(_a.a,{disabled:0===t.trim().length||0===n.trim().length,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(r.a.PureComponent),$r=Object(l.b)((function(e){return{savedFilter:e.savedDatasetFilter}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t(),i=bt(a.searchTokens).X,r={ds_id:a.dataset.id,name:n.name,features:i,category:n.category};e(la(!0)),t().serverInfo.api.upsertFeatureSet(r,!1).then((function(a){var r=t().markers;r.push({category:n.category,name:n.name,features:i,id:a.id}),e(oa(r.slice())),e(aa("Set saved"))})).finally((function(){e(la(!1)),e(ra(null))})).catch((function(t){ja(e,t,"Unable to save set. Please try again.")}))}))},handleCancel:function(t){e(ra(null))},handleError:function(t){e(aa(t))}}}))(Yr),Qr=n(517),eo=n(511),to=n(502),no=n(501),ao=n(516),io=n(504),ro=n(503),oo=n(518),lo=n(198),so=n.n(lo),co=n(275),uo=n.n(co),ho=n(273),po=n.n(ho),fo=n(274),mo=n.n(fo),bo=n(197),vo=n.n(bo),go=n(47),jo=n(499),yo=n(30),Oo=n(498),xo=n(497),So=n(500),wo=n(513),Co=n(272);function ko(e){var t=e.data,n=e.index,a=e.style;return r.a.cloneElement(t[n],{style:Object(Ta.a)(Object(Ta.a)({},a),{},{top:a.top+0})})}var Eo=r.a.createContext({}),Do=r.a.forwardRef((function(e,t){var n=r.a.useContext(Eo);return Object(a.jsx)("div",Object(Ta.a)(Object(Ta.a)({ref:t},e),n))})),Mo=r.a.forwardRef((function(e,t){var n=e.children,i=Object(nr.a)(e,["children"]),o=r.a.Children.toArray(n),l=Object(yo.a)(),s=Object(xo.a)(l.breakpoints.up("sm"),{noSsr:!0}),c=o.length,d=s?24:36,u=function(e){return d};return Object(a.jsx)("div",{ref:t,children:Object(a.jsx)(Eo.Provider,{value:i,children:Object(a.jsx)(Co.a,{itemData:o,height:(c>8?8*d:o.map(u).reduce((function(e,t){return e+t}),0))+0,width:"100%",outerElementType:Do,innerElementType:"ul",itemSize:function(e){return u(o[e])},overscanCount:5,itemCount:c,children:ko},c)})})})),Po=Object(Oo.a)({paper:{width:230},listbox:{"& ul":{padding:0,margin:0}}}),Io=function(e){return[Object(a.jsx)(jo.a,{disableGutters:!0,component:"div",children:Object(a.jsx)(Q.a,{noWrap:!0,children:e.group})}),e.children]};function To(e){var t=Po(),n=r.a.createRef();function i(t,n){var a=[];n.forEach((function(t){if(""!==(t=t.toLowerCase().trim().replace(/"/g,"")))for(var n=0;n<e.options.length;n++){var i=e.options[n];if((null!=i.text?i.text:i).toLowerCase()===t){a.push(i);break}}})),e.onChange(t,a)}function o(e){n.current.style.background=e?"#1976d2":""}function l(e){e.preventDefault(),e.stopPropagation(),o(!1)}var s=Object(So.a)({matchFrom:"any"}),c=e.onChipClick?function(t,n){e.onChipClick(t,n)}:null,d=e.getOptionSelected;null==d&&(d=e.groupBy?function(e,t){return e.id===t.id&&e.group===t.group}:function(e,t){return e===t});var u=e.getChipText;null==u&&(u=function(e){return e});var h=e.getChipIcon;null==h&&(h=function(e){return null});var p=e.getChipTitle;null==p&&(p=function(e){return null});var f=e.getOptionLabel;null==f&&(f=e.groupBy?function(e){return e.text}:function(e){return e});var m=e.renderOption;return null==m&&(m=e.groupBy?function(e){return Object(a.jsx)(Q.a,{title:e.text,noWrap:!0,children:e.text})}:function(e){return Object(a.jsx)(Q.a,{title:e,noWrap:!0,children:e})}),Object(a.jsx)(wo.a,{multiple:!0,ref:n,filterOptions:s,disableListWrap:!0,classes:t,getOptionSelected:d,value:e.value,openOnFocus:!0,filterSelectedOptions:!0,getOptionLabel:f,groupBy:e.groupBy?function(e){return e.group}:null,blurOnSelect:!0,ChipProps:{size:"small"},ListboxComponent:Mo,renderGroup:Io,options:e.options,autoHighlight:!0,onChange:e.onChange,renderTags:function(e,t){return e.map((function(e,n){return Object(a.jsx)(ao.a,Object(Ta.a)({variant:"default",onClick:c?function(t){return c(t,e)}:null,label:u(e),title:p(e),size:"small",icon:h(e)},t({index:n})))}))},renderInput:function(t){return Object(a.jsx)(ti.a,Object(Ta.a)(Object(Ta.a)({margin:"dense"},t),{},{label:e.label,helperText:e.helperText}))},renderOption:m,onPaste:function(e){var t=e.clipboardData.getData("text/plain");null!=t&&t.length>0&&(e.preventDefault(),e.stopPropagation(),i(e,t.split(/[\n,\t]/)))},onDrop:function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files,n=new FileReader;n.onload=function(e){i(e,e.target.result.split(/[\n,\t]/))},n.onerror=function(e){alert("Unable to read file.")},n.readAsText(t[0]),o(!1)},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),o(!0)},onDragEnd:l,onDragLeave:l})}var zo=D()({insensitive:!0}),Ao=Object(go.a)((function(e,t){var n=new Set;e.forEach((function(e){n.add(e[t])}));var a=Array.from(n);return a.sort(zo),a})),_o=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(){var e;Object(O.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).onChange=function(t,n,a){e.props.dataset.results.facets[a]=n;e.props.dataset.results.columns},e}return Object(M.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,i=t.classes,r=n?n.results:null;if(null==r)return null;var o=r.columns;return null==r.facets&&(r.facets={}),null==r.allRows&&(r.allRows=r.rows),o.map((function(t){return Object(a.jsx)(Ii.a,{className:i.formControl,children:Object(a.jsx)(To,{label:t.field,multiple:!0,options:Ao(r.allRows,t.field),value:r.facets[t.field],onChange:function(n,a){return e.onChange(n,a,t.field)}})},t.field)}))}}]),n}(r.a.PureComponent),Fo=te()((function(e){return{formControl:{display:"block",minWidth:200,margin:e.spacing(0,1)}}}))(Object(l.b)((function(e){return{dataset:e.dataset}}),(function(e,t){return{onDistributionPlotOptions:function(t){e(Ln(t))}}}))(_o)),No=D()({insensitive:!0}),Lo=[{value:.1,label:"10%"},{value:.25,label:"25%"},{value:.5,label:"50%"},{value:.75,label:"75%"},{value:1,label:"100%"},{value:1.5,label:"150%"},{value:2,label:"200%"},{value:3,label:"300%"},{value:4,label:"400%"}],Ro=[{value:300,label:"Small"},{value:500,label:"Medium"},{value:800,label:"Large"}],Bo=[{value:"max",label:"Maximum"},{value:"mean",label:"Mean"},{value:"sum",label:"Sum"}],Uo=Object(go.a)((function(e,t){var n=[];return e.forEach((function(e){n.push({group:"Continuous",text:e,id:e})})),t.forEach((function(e){n.push({group:"Categorical",text:e,id:e})})),n.sort((function(e,t){var n=No(e.group,t.group);return 0!==n?n:No(e.text,t.text)})),n})),Ho=Object(go.a)((function(e){var t=[];return e.forEach((function(e){t.push({text:e.name+(3===e.dimensions?" 3d":""),id:Tn(e)})})),t.sort((function(e,t){return No(e.text.toLowerCase(),t.text.toLowerCase())})),t})),Wo=Object(go.a)((function(e){if(e){var t=e.slice();return t.sort(No),t}})),Vo=Object(go.a)((function(e,t){var n=e.map((function(e){return{group:e.category,text:e.name,id:e.id}}));return n.forEach((function(e){var n=e.group,a=n.lastIndexOf(" (");-1!==a&&(n=n.substring(0,a));var i=(t[n]||{})[e.text];null!=i&&(e.text=i)})),n.sort((function(e,t){var n=No(e.group,t.group);return 0!==n?n:No(e.text,t.text)})),n})),Go=te()({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0}},expanded:{}})(eo.a),Xo=te()({root:{backgroundColor:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:43,"&$expanded":{minHeight:43}},content:{"&$expanded":{margin:0}},expanded:{}})(no.a),qo=te()((function(e){return{root:{padding:0}}}))(to.a),Zo=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).onMarkerOpacityChange=function(e,t){a.setState({opacity:t}),a.updateMarkerOpacity(t)},a.updateMarkerOpacity=function(e){var t=parseFloat(e);t>=0&&t<=1&&a.props.handleMarkerOpacity(t)},a.onUnselectedMarkerOpacityChange=function(e,t){a.setState({unselectedOpacity:t}),a.updateUnselectedMarkerOpacity(t)},a.updateUnselectedMarkerOpacity=function(e){var t=parseFloat(e);t>=0&&t<=1&&a.props.handleUnselectedMarkerOpacity(t)},a.openDatasetFilter=function(e){a.props.handleOpenDatasetFilter(e)},a.deleteDatasetFilter=function(e){a.props.handleDeleteDatasetFilter(e)},a.onPointSizeChange=function(e){a.props.handlePointSize(e.target.value)},a.onFeaturesChange=function(e,t){a.props.handleSearchTokens(t,"X")},a.onMetafeaturesChange=function(e,t){a.props.handleSearchTokens(t,at)},a.onObservationsIconClick=function(e,t){a.props.handleEmbeddingLabel(t),e.stopPropagation()},a.onObservationsChange=function(e,t){var n=[];t.forEach((function(e){void 0!==e.text?n.push(e.text):n.push(e)})),a.props.handleSearchTokens(n,et)},a.onSaveFeatureList=function(){a.props.handleDialog(jn)},a.onEmbeddingsChange=function(e,t){var n=[],i=a.props.dataset.embeddings.map((function(e){return Tn(e)}));t.forEach((function(e){var t=void 0!==e.id?e.id:e,r=i.indexOf(t),o=a.props.dataset.embeddings[r];o.precomputed||(o=Object.assign(o,{bin:a.props.binValues,nbins:a.props.numberOfBins,agg:a.props.binSummary})),n.push(o)})),a.props.handleEmbeddings(n)},a.onFeatureSetsChange=function(e,t){var n=[];t.forEach((function(e){void 0!==e.id?n.push(e.id):n.push(e)})),a.props.handleSearchTokens(n,nt)},a.onFeatureSetClick=function(e,t){for(var n=t.id,i=e.target,r=a.props.markers,o=null,l=0;l<r.length;l++)if(r[l].id===n){o=r[l];break}null==o&&console.log(n+" not found"),e.stopPropagation(),a.setState({featureSetAnchorEl:i,featureSet:o})},a.onFeatureSetMenuClose=function(e){a.setState({featureSetAnchorEl:null,featureSet:null})},a.onViewFeatureSet=function(e){e.stopPropagation(),a.setState({featureSetAnchorEl:null,featureSetView:!0})},a.onCloseViewFeatureSetDialog=function(e){e.stopPropagation(),a.setState({featureSet:null,featureSetView:!1})},a.onDeleteFeatureSet=function(e){e.stopPropagation();var t=a.props.searchTokens,n=a.state.featureSet.id,i=t.filter((function(e){return e.type===nt&&e.value.id!==n}));a.props.handleSearchTokens(i,nt),a.props.handleDeleteFeatureSet(n),a.setState({featureSetAnchorEl:null,featureSet:null})},a.onFilterChipClicked=function(e){a.onFeatureClick(e,e.target.innerText)},a.onFeatureClick=function(e,t){e.stopPropagation();for(var n=void 0!==t.text?t.text:t,i=a.props.embeddingData.filter((function(e){return e.active})),r=0;r<i.length;r++)if(i[r].name==n){"embedding"!==a.props.tab&&a.props.handleTab("embedding"),a.props.handlePrimaryTraceKey(zn(i[r]));break}},a.onChartSizeChange=function(e){var t=e.target.value;a.props.handleChartSize(t)},a.onBinSummaryChange=function(e){var t=e.target.value;a.props.handleBinSummary(t);for(var n=a.props.embeddings,i=0;i<n.length;i++)n[i].precomputed||(n[i]=Object.assign(n[i],{agg:t}));a.props.handleEmbeddings(n.slice(0))},a.handleBinValuesChange=function(e){var t=e.target.checked;a.props.handleBinValues(t);for(var n=a.props.embeddings,i=0;i<n.length;i++)n[i].precomputed||(n[i]=Object.assign(n[i],{bin:t}));a.props.handleEmbeddings(n.slice(0))},a.handleSelectedCellsClick=function(e){e.preventDefault(),a.props.downloadSelectedIds()},a.handleDifferentialExpression=function(e){e.preventDefault(),a.props.handleDifferentialExpression()},a.onDatasetFilterChipDeleted=function(e){a.props.removeDatasetFilter(e)},a.onDatasetFilterCleared=function(){a.props.removeDatasetFilter(null)},a.onDatasetFilterSaved=function(){a.props.handleDialog(gn)},a.handleCombineDatasetFilters=function(e){a.props.handleCombineDatasetFilters(e.target.checked?"or":"and")},a.onChartTypeChange=function(e){a.props.onDistributionPlotOptions({chartType:e.target.value})},a.onViolinScaleChange=function(e){a.props.onDistributionPlotOptions({violinScale:e.target.value})},a.onViolinShowBoxplot=function(e){a.props.onDistributionPlotOptions({violinShowBoxplot:e.target.checked})},a.state={featureSetAnchorEl:null,featureSet:null,featureSetView:!1,opacity:e.markerOpacity,unselectedOpacity:e.unselectedMarkerOpacity},a.updateMarkerOpacity=Object(b.debounce)(a.updateMarkerOpacity,500),a.updateUnselectedMarkerOpacity=Object(b.debounce)(a.updateUnselectedMarkerOpacity,500),a}return Object(M.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.markerOpacity!==this.props.markerOpacity&&this.setState({opacity:this.props.markerOpacity}),e.unselectedMarkerOpacity!==this.props.unselectedMarkerOpacity&&this.setState({unselectedOpacity:this.props.unselectedMarkerOpacity})}},{key:"render",value:function(){var e=this,t=this.props,n=t.binSummary,i=t.binValues,o=t.categoricalNames,l=t.chartSize,s=t.classes,c=t.combineDatasetFilters,d=t.dataset,u=t.datasetFilter,h=t.datasetFilters,p=t.distributionPlotOptions,f=t.embeddingLabels,m=t.embeddings,v=t.interpolator,g=t.markers,j=t.pointSize,y=t.searchTokens,O=t.selection,x=t.serverInfo,S=t.tab,w=p.chartType,C=Fn(u),k=[],E=!1;C.forEach((function(e){"object"===typeof e[0]?E=!0:k.push(e[0])})),k.sort((function(e,t){return(e=e.toLowerCase())<(t=t.toLowerCase())?-1:e===t?0:1})),E&&k.push("selection");var D=this.props.savedDatasetFilter;null==D&&(D={});var M=bt(y),P=mt(g,M.featureSets),I=d.features,T=Wo(d.metafeatures),z=null!=d.precomputed,A=d.obsCat,_=d.obs,F=Uo(_,A),N=Vo(g,o),L=Ho(d.embeddings),R=Ho(m),B=x.fancy,U=this.state.featureSetAnchorEl,H=this.state.featureSet;return Object(a.jsxs)("div",{className:s.root,children:[Object(a.jsxs)(Sa.a,{open:this.state.featureSetView,onClose:this.onCloseViewFeatureSetDialog,"aria-labelledby":"view-set-dialog-title",fullWidth:!0,maxWidth:"lg",children:[Object(a.jsx)(wa.a,{id:"view-set-dialog-title",children:H?H.name:""}),Object(a.jsx)(Ci.a,{children:Object(a.jsx)(ti.a,{value:H?H.features.join("\n"):"",margin:"dense",fullWidth:!0,readOnly:!0,variant:"outlined",multiline:!0})})]}),Object(a.jsxs)(re.a,{id:"feature-set-menu",anchorEl:U,open:Boolean(U),onClose:this.onFeatureSetMenuClose,children:[Object(a.jsx)(oe.a,{onClick:this.onViewFeatureSet,children:"View"}),Object(a.jsx)(oe.a,{divider:!0}),Object(a.jsx)(oe.a,{disabled:H&&H.readonly,onClick:this.onDeleteFeatureSet,children:"Delete"})]}),Object(a.jsxs)(Go,{style:"embedding"===S||"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(a.jsx)(Xo,{children:Object(a.jsx)("div",{children:"View"})}),Object(a.jsx)(qo,{style:{flexDirection:"column"},children:Object(a.jsxs)("div",{children:["embedding"===S&&L.length>0&&Object(a.jsx)(Ii.a,{className:s.formControl,children:Object(a.jsx)(To,{label:"Embeddings",options:L,getChipTitle:function(e){return e.text},value:R,getChipText:function(e){return e.text},renderOption:function(e){return Object(a.jsx)(Q.a,{noWrap:!0,children:e.text})},getOptionLabel:function(e){return e.text},getOptionSelected:function(e,t){return-1!==Object(b.findIndex)(R,(function(t){return t.id===e.id}))},onChange:this.onEmbeddingsChange})}),I.length>0&&Object(a.jsx)(Ii.a,{className:s.formControl,children:Object(a.jsx)(To,{onChipClick:this.onFeatureClick,label:"Genes/Features",options:I,value:M.X,onChange:this.onFeaturesChange,helperText:"Enter or paste list"})}),F.length>0&&Object(a.jsx)(Ii.a,{className:s.formControl,children:Object(a.jsx)(To,{label:"Cell Metadata",options:F,value:M.obsCat.concat(M.obs),onChipClick:this.onFeatureClick,groupBy:!0,getChipIcon:function(t){return-1!==M.obsCat.indexOf(t)?Object(a.jsx)(po.a,{onClick:function(n){e.onObservationsIconClick(n,t)},title:"Toggle Show/Hide Labels",style:{marginLeft:4,marginTop:0,marginRight:0,marginBottom:0},className:"MuiChip-deleteIcon MuiChip-deleteIconSmall"+(-1!==f.indexOf(t)?" cirro-active":"")}):null},getOptionSelected:function(e,t){return e.id===t},onChange:this.onObservationsChange})}),T&&T.length>0&&Object(a.jsx)(Ii.a,{className:s.formControl,children:Object(a.jsx)(To,{onChipClick:this.onMetaFeatureClick,label:"Metagenes/Features",options:T,value:M.metafeatures,onChange:this.onMetafeaturesChange})}),B&&N.length>0&&Object(a.jsxs)(Ii.a,{className:s.formControl,children:[Object(a.jsx)(To,{label:"Sets",options:N,value:P,onChipClick:this.onFeatureSetClick,getChipTitle:function(e){return e.category+", "+e.name},getChipIcon:function(t){return Object(a.jsx)(cr.a,{onClick:function(n){e.onFeatureSetClick(n,t)}})},groupBy:!0,onChange:this.onFeatureSetsChange,getOptionSelected:function(e,t){return e.id===t.id},getChipText:function(e){return e.name}}),B&&M.X.length>0&&Object(a.jsx)(ae.a,{title:"Save Current Feature List",children:Object(a.jsx)(ie.a,{size:"small",onClick:this.onSaveFeatureList,children:Object(a.jsx)(vo.a,{})})})]})]})})]}),Object(a.jsxs)(Go,{style:"embedding"===S||"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(a.jsx)(Xo,{children:Object(a.jsx)("div",{children:"Filters"})}),Object(a.jsx)(qo,{children:Object(a.jsxs)("div",{style:{marginLeft:10,maxHeight:500},children:[Object(a.jsxs)(ro.a,{component:"label",alignContent:"flex-start",container:!0,alignItems:"center",spacing:0,children:[Object(a.jsx)(ro.a,{item:!0,children:Object(a.jsx)(Mi.a,{shrink:!0,variant:"standard",children:"Combine Filters"})}),Object(a.jsx)(ro.a,{item:!0,children:"AND"}),Object(a.jsx)(ro.a,{item:!0,children:Object(a.jsx)(Qr.a,{size:"small",checked:"or"===c,onChange:this.handleCombineDatasetFilters})}),Object(a.jsx)(ro.a,{item:!0,children:"OR"})]}),k.length>0&&!isNaN(O.count)&&Object(a.jsx)(r.a.Fragment,{children:Object(a.jsxs)("div",{style:{marginBottom:2},children:[Be(O.count)+" / "+Be(d.shape[0])+": ",k.map((function(t){return Object(a.jsx)(ao.a,{onDelete:function(){e.onDatasetFilterChipDeleted(t)},onClick:e.onFilterChipClicked,size:"small",variant:"default",style:{marginRight:2,verticalAlign:"bottom"},label:t},t)})),Object(a.jsx)(za.a,{}),Object(a.jsxs)(ro.a,{container:!0,alignItems:"center",className:s.toolbar,children:[Object(a.jsx)(ae.a,{title:"Clear All",children:Object(a.jsx)(ie.a,{size:"small",disabled:0===k.length,onClick:this.onDatasetFilterCleared,children:Object(a.jsx)(mo.a,{})})}),B&&Object(a.jsx)(ae.a,{title:"Save Filter",children:Object(a.jsx)(ie.a,{size:"small",disabled:0===k.length,onClick:this.onDatasetFilterSaved,children:Object(a.jsx)(vo.a,{})})}),Object(a.jsx)(ae.a,{title:"Download Selected IDs",children:Object(a.jsx)(ie.a,{size:"small",disabled:0===k.length,onClick:this.handleSelectedCellsClick,children:Object(a.jsx)(so.a,{})})}),!1,!1]})]})})]})})]}),Object(a.jsxs)(Go,{style:"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(a.jsx)(Xo,{children:Object(a.jsx)("div",{children:"Distribution Options"})}),Object(a.jsx)(qo,{children:Object(a.jsxs)("div",{style:{marginTop:8},children:["violin"===w&&Object(a.jsxs)(Ii.a,{className:s.formControl,children:[Object(a.jsx)(Mi.a,{id:"violin-scale-label",children:"Scale"}),Object(a.jsxs)(Pi.a,{className:s.select,labelId:"violin-scale-label",value:p.violinScale,onChange:this.onViolinScaleChange,children:[Object(a.jsx)(oe.a,{value:"area",children:"Area"}),Object(a.jsx)(oe.a,{value:"width",children:"Width"})]}),Object(a.jsx)(ar.a,{children:'If "area", violins have the same area. If "width", violins have the same maximum width.'})]}),"violin"===w&&Object(a.jsx)("div",{children:Object(a.jsx)(io.a,{control:Object(a.jsx)(Qr.a,{value:"violinShowBoxplot",checked:p.violinShowBoxplot,onChange:this.onViolinShowBoxplot}),label:"Show Box Plot"})}),Object(a.jsxs)(Ii.a,{className:s.formControl,children:[Object(a.jsx)(Mi.a,{id:"dist-chart-type-label",children:"Chart Type"}),Object(a.jsxs)(Pi.a,{className:s.select,labelId:"dist-chart-type-label",value:w,onChange:this.onChartTypeChange,children:[Object(a.jsx)(oe.a,{value:"dotplot",children:"Dot Plot"}),Object(a.jsx)(oe.a,{value:"heatmap",children:"Heatmap"}),Object(a.jsx)(oe.a,{value:"violin",children:"Violin"})]})]})]})})]}),Object(a.jsxs)(Go,{style:"embedding"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(a.jsx)(Xo,{children:Object(a.jsx)("div",{children:"Embedding Options"})}),Object(a.jsx)(qo,{children:Object(a.jsxs)("div",{children:[Object(a.jsx)(Mi.a,{style:{marginLeft:8,marginTop:8},shrink:!0,children:"Marker Opacity"}),Object(a.jsx)(oo.a,{min:0,max:1,step:.01,style:{marginLeft:10,width:"86%"},valueLabelDisplay:"auto",value:this.state.opacity,onChange:this.onMarkerOpacityChange,"aria-labelledby":"continuous-slider"}),Object(a.jsx)(Mi.a,{style:{marginLeft:8,marginTop:8},shrink:!0,children:"Filtered Marker Opacity"}),Object(a.jsx)(oo.a,{min:0,max:1,step:.01,style:{marginLeft:10,width:"86%"},valueLabelDisplay:"auto",value:this.state.unselectedOpacity,onChange:this.onUnselectedMarkerOpacityChange,"aria-labelledby":"continuous-slider"}),Object(a.jsxs)(Ii.a,{className:s.formControl,children:[Object(a.jsx)(Mi.a,{htmlFor:"point_size",children:"Marker Size"}),Object(a.jsx)(Pi.a,{className:s.select,input:Object(a.jsx)(Ti.a,{id:"point_size"}),onChange:this.onPointSizeChange,value:j,multiple:!1,children:Lo.map((function(e){return Object(a.jsx)(oe.a,{value:e.value,children:Object(a.jsx)(ei.a,{primary:e.label})},e.label)}))})]}),Object(a.jsxs)(Ii.a,{className:s.formControl,children:[Object(a.jsx)(Mi.a,{htmlFor:"chart_size",children:"Gallery Chart Size"}),Object(a.jsx)(Pi.a,{className:s.select,input:Object(a.jsx)(Ti.a,{id:"chart_size"}),onChange:this.onChartSizeChange,value:l,multiple:!1,children:Ro.map((function(e){return Object(a.jsx)(oe.a,{value:e.value,children:Object(a.jsx)(ei.a,{primary:e.label})},e.label)}))})]}),Object(a.jsxs)(Ii.a,{className:s.formControl,children:[Object(a.jsx)(Mi.a,{htmlFor:"color-scheme",children:"Color Scale"}),Object(a.jsx)(_i,{handleInterpolator:this.props.handleInterpolator,interpolator:v})]}),Object(a.jsx)(ae.a,{title:"More Options",children:Object(a.jsx)(ie.a,{edge:!1,size:"small","aria-label":"More Options",onClick:this.props.onMoreOptions,children:Object(a.jsx)(De.a,{})})}),!z&&!1,!z&&i&&Object(a.jsxs)(Ii.a,{className:s.formControl,children:[Object(a.jsx)(Mi.a,{htmlFor:"summary",children:"Bin Summary"}),Object(a.jsx)(Pi.a,{className:s.select,input:Object(a.jsx)(Ti.a,{id:"summary"}),onChange:this.onBinSummaryChange,value:n,children:Bo.map((function(e){return Object(a.jsx)(oe.a,{value:e.value,children:Object(a.jsx)(ei.a,{primary:e.label})},e.value)}))})]})]})})]}),B&&Object(a.jsxs)(Go,{style:"embedding"===S||"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(a.jsx)(Xo,{children:Object(a.jsx)("div",{children:"Saved Filters"})}),Object(a.jsx)(qo,{children:Object(a.jsxs)("div",{style:{width:"100%"},children:[0===h.length&&Object(a.jsx)(Gi.a,{color:"text.secondary",style:{paddingLeft:10},children:"No saved filters"}),h.length>0&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)(Ya.a,{dense:!0,children:h.map((function(t){return Object(a.jsxs)($a.a,{"data-key":t.id,button:!0,selected:t.id===D.id,onClick:function(n){return e.openDatasetFilter(t.id)},children:[Object(a.jsx)(ei.a,{primary:t.name}),Object(a.jsx)(Qa.a,{onClick:function(n){return e.deleteDatasetFilter(t.id)},children:Object(a.jsx)(ie.a,{edge:"end","aria-label":"delete",children:Object(a.jsx)(uo.a,{})})})]},t.id)}))}),Object(a.jsxs)("div",{style:{marginLeft:10},children:[Object(a.jsx)(za.a,{}),Object(a.jsx)(ae.a,{title:"Export Filters",children:Object(a.jsx)(ie.a,{size:"small",onClick:this.props.handleExportDatasetFilters,children:Object(a.jsx)(so.a,{})})})]})]})]})})]}),Object(a.jsxs)(Go,{style:"precomputed_results"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(a.jsx)(Xo,{children:Object(a.jsx)("div",{children:"Filter"})}),Object(a.jsx)(qo,{style:{flexDirection:"column"},children:Object(a.jsx)(Fo,{})})]})]})}}]),n}(r.a.PureComponent),Ko=te()((function(e){return{root:{display:"flex",width:"100%",flexDirection:"column"},formControl:{display:"block",minWidth:200,margin:e.spacing(0,1)},select:{minWidth:200},toolbar:{"& hr":{margin:e.spacing(0,.5)}}}}))(Object(l.b)((function(e){return{binSummary:e.binSummary,binValues:e.binValues,categoricalNames:e.categoricalNames,chartSize:e.chartSize,combineDatasetFilters:e.combineDatasetFilters,dataset:e.dataset,datasetFilter:e.datasetFilter,datasetFilters:e.datasetFilters,distributionPlotOptions:e.distributionPlotOptions,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,embeddings:e.embeddings,interpolator:e.interpolator,markerOpacity:e.markerOpacity,markers:e.markers,numberOfBins:e.numberOfBins,pointSize:e.pointSize,primaryTraceKey:e.primaryTraceKey,savedDatasetFilter:e.savedDatasetFilter,searchTokens:e.searchTokens,selection:e.selection,serverInfo:e.serverInfo,tab:e.tab,unselectedMarkerOpacity:e.unselectedMarkerOpacity}}),(function(e,t){return{handleDialog:function(t){e(ra(t))},handleTab:function(t){e(sa(t))},handlePrimaryTraceKey:function(t){e(Un(t))},handleInterpolator:function(t){e({type:sn,payload:t})},handleChartSize:function(t){e({type:Rt,payload:t})},handleCombineDatasetFilters:function(t){e(Bn(t))},downloadSelectedIds:function(){e((function(e,t){e(la(!0));var n=t(),a=Nn(n);n.dataset.api.getSelectedIdsPromise({filter:a},n.cachedData).then((function(e){var t=new Blob([e.ids.join("\n")],{type:"text/plain;charset=utf-8"});Object(m.saveAs)(t,"selection.txt")})).finally((function(){e(la(!1))})).catch((function(t){ja(e,t)}))}))},removeDatasetFilter:function(t){var n;e((n=t,function(e,t){if(null==n)e(Hn({}));else{var a=t().datasetFilter;if("selection"===n)for(var i in a)null!=a[i].basis&&delete a[i];else delete a[n];e(Hn(Object.assign({},a)))}e(Gn())}))},handleEmbeddings:function(t){e(pa(t))},handleNumberOfBins:function(t){var n;e((n=t,function(e,t){t().numberOfBins!==n&&e({type:an,payload:n})}))},handlePointSize:function(t){e({type:cn,payload:t})},handleMarkerOpacity:function(t){e({type:Yt,payload:t})},handleEmbeddingLabel:function(t){var n;e((n=t,function(e,t){var a=t().embeddingLabels,i=a.indexOf(n);return-1===i?a.push(n):a.splice(i,1),e({type:zt,payload:a.slice()})}))},handleUnselectedMarkerOpacity:function(t){e({type:$t,payload:t})},onMoreOptions:function(){e(ra(mn))},handleBinSummary:function(t){var n;e((n=t,function(e,t){e({type:on,payload:n})}))},handleBinValues:function(t){e({type:rn,payload:t})},handleSearchTokens:function(t,n){e(function(e,t){return function(n,a){var i=a(),r=i.searchTokens,o=[t];if(t===et&&o.push(tt),r=r.filter((function(e){return-1===o.indexOf(e.type)})),t===et){var l=i.dataset.obsCat;e.forEach((function(e){var t=-1!==l.indexOf(e)?tt:et;r.push({value:e,type:t})}))}else r=r.concat(e.map((function(e){return{value:e,type:t}})));n({type:tn,payload:r.slice()}),n(ga())}}(null==t?[]:t,n))},handleOpenDatasetFilter:function(t){var n;e((n=t,function(e,t){e(la(!0)),t().serverInfo.api.getDatasetFilterPromise(n,t().dataset.id).then((function(t){t.id=n;var a=JSON.parse(t.value),i={};a.filters.forEach((function(e){var t=e[1],n=e[0],a=n.indexOf("/");-1!==a&&(n=n.substring(a+1)),i[n]="in"===t?e[2]:{operation:e[1],value:e[2]}})),e(Hn(i)),e(Gn())})).finally((function(){e(la(!1))})).catch((function(t){ja(e,t,"Unable to retrieve filter. Please try again.")}))}))},handleDeleteDatasetFilter:function(t){var n;e((n=t,function(e,t){e(la(!0)),t().serverInfo.api.deleteDatasetFilterPromise(n,t().dataset.id).then((function(){for(var a=t().datasetFilters,i=0;i<a.length;i++)if(a[i].id===n){a.splice(i,1);break}e(fa(a.slice())),e(aa("Filter deleted"))})).finally((function(){e(la(!1)),e(ra(null))})).catch((function(t){ja(e,t,"Unable to delete filter. Please try again.")}))}))},handleExportDatasetFilters:function(){e((function(e,t){e(la(!0)),t().serverInfo.api.exportDatasetFiltersPromise(t().dataset.id).then((function(t){if(null!=t){var n=new Blob([t],{type:"text/plain;charset=utf-8"});Object(m.saveAs)(n,"filters.csv")}else ja(e,"Unable to export filters")})).finally((function(){e(la(!1))})).catch((function(t){ja(e,t)}))}))},handleDeleteFeatureSet:function(t){var n;e((n=t,function(e,t){e(la(!0)),t().serverInfo.api.deleteFeatureSet(n,t().dataset.id).then((function(a){for(var i=t().markers,r=0;r<i.length;r++)if(i[r].id===n){i.splice(r,1);break}e(oa(i.slice())),e(aa("Set deleted"))})).finally((function(){e(la(!1))})).catch((function(t){ja(e,t,"Unable to delete set. Please try again.")}))}))},handleDifferentialExpression:function(t){e((function(e,t){var n;function a(){t().serverInfo.api.getJob(n).then((function(t){"complete"===t.status?console.log(t):"error"===t.status?ja(e,new C("Unable to complete job. Please try again.")):window.setTimeout(a,3e4)})).catch((function(t){ja(e,t,"Unable to get job. Please try again.")}))}e(la(!0)),t().serverInfo.api.submitJob(t().dataset.id).then((function(t){e(aa("Job submitted")),n=t.id,window.setTimeout(a,3e4)})).finally((function(){e(la(!1))})).catch((function(t){ja(e,t,"Unable to submit job. Please try again.")}))}))},onDistributionPlotOptions:function(t){e(Ln(t))}}}))(Zo)),Jo=Object(Ea.a)({palette:{type:"light"}}),Yo=Object(Ea.a)({palette:{type:"dark"}}),$o=240,Qo=function(e){Object(x.a)(n,e);var t=Object(S.a)(n);function n(e){var a;return Object(O.a)(this,n),(a=t.call(this,e)).handleMessageClose=function(){a.props.setMessage(null)},a.onGallery=function(){window.scrollTo(0,a.galleryRef.current.offsetTop)},a.state={tab:"embedding"},a.galleryRef=r.a.createRef(),a}return Object(M.a)(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.chartOptions,i=e.dataset,o=e.dialog,l=e.loading,s=e.loadingApp,c=e.message,d=e.tab,u=n.darkMode?Yo:Jo,h=u.palette.primary.main,p=n.darkMode?"black":"white";return Object(a.jsx)(Ia.a,{theme:u,children:Object(a.jsxs)("div",{className:t.root,children:[(o===bn||o===vn)&&Object(a.jsx)(lr,{}),o===On&&Object(a.jsx)(Ei,{}),o===gn&&Object(a.jsx)(Jr,{}),o===yn&&Object(a.jsx)(Rr,{}),o===mn&&Object(a.jsx)(Ur,{}),o===jn&&Object(a.jsx)($r,{}),Object(a.jsx)(Si,{}),Object(a.jsx)(Ca.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper},anchor:"left",children:null!=i&&Object(a.jsx)(Ko,{},i.id)}),Object(a.jsxs)("main",{style:{backgroundColor:p,color:h},className:t.content,children:[s.loading&&Object(a.jsx)("div",{children:Object(a.jsxs)("h2",{children:["Loading",Object(a.jsx)(ka.a,{style:{width:"90%"},variant:"determinate",value:s.progress})]})}),null!=i&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{role:"tabpanel",hidden:"embedding"!==d,children:[Object(a.jsx)(Pr,{onGallery:this.onGallery}),Object(a.jsx)("div",{ref:this.galleryRef,children:Object(a.jsx)(Nr,{})})]}),Object(a.jsx)("div",{role:"tabpanel",hidden:"distribution"!==d,children:Object(a.jsx)(tr,{})}),Object(a.jsx)("div",{role:"tabpanel",hidden:"precomputed_results"!==d,children:Object(a.jsx)(Zr,{})})]})]}),l&&Object(a.jsx)(Sa.a,{"aria-labelledby":"loading-dialog-title",open:!0,children:Object(a.jsxs)(wa.a,{id:"loading-dialog-title",children:[Object(a.jsx)(xa.a,{size:20})," Loading..."]})}),null!=c&&Object(a.jsx)(Oa.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},ContentProps:{"aria-describedby":"message-id"},onClose:this.handleMessageClose,open:!0,autoHideDuration:6e3,action:[Object(a.jsx)(ie.a,{"aria-label":"Close",color:"inherit",onClick:this.handleMessageClose,children:Object(a.jsx)(Pa.a,{})},"close")],message:Object(a.jsx)("span",{id:"message-id",children:c instanceof Error?c.message:c})})]})})}}]),n}(i.PureComponent),el=Object(Da.a)((function(e){return{root:{display:"flex"},appBar:{width:"calc(100% - ".concat($o,"px)"),marginLeft:$o},drawer:{width:$o,flexShrink:0},drawerPaper:{width:$o},toolbar:e.mixins.toolbar,content:{flexGrow:1,paddingTop:e.spacing(6.5),paddingLeft:e.spacing(1)}}}))(Object(l.b)((function(e){return{dataset:e.dataset,dialog:e.dialog,loading:e.loading,loadingApp:e.loadingApp,message:e.message,tab:e.tab,chartOptions:e.chartOptions}}),(function(e){return{handleDialog:function(t){e(ra(t))},setMessage:function(t){e(aa(t))}}}))(Qo)),tl=Object(s.d)(yi,Object(s.a)(c.a));tl.dispatch((function(e,t){e(ca({loading:!0,progress:0}));var n=(new Date).getTime();return window.setTimeout((function a(){if(t().loadingApp.loading){var i=((new Date).getTime()-n)/1e3,r=Math.min(100,i/32*100);e(ca({loading:!0,progress:r})),r<100&&window.setTimeout(a,300)}}),500),fetch(It+"/server").then((function(e){return e.json()})).then((function(t){if(t.api=new Z,null==t.clientId&&(t.clientId=""),null==t.fancy&&(t.fancy=!0),e({type:Ut,payload:t}),""===t.clientId)e(ca({loading:!1})),e(ha("server"===t.mode?"":null)),"server"===t.mode&&e(Zn({importer:!0})),e(ya()).then((function(){e($n())}));else{console.log(((new Date).getTime()-n)/1e3+" startup time");var a=document.createElement("script");a.type="text/javascript",a.src="https://apis.google.com/js/api.js",a.onload=function(n){window.gapi.load("client:auth2",(function(){window.gapi.client.init({clientId:t.clientId,scope:Tt.join(" ")}).then((function(){e(ca({loading:!1,progress:0})),e(Qn(!0))}))}))},document.getElementsByTagName("head")[0].appendChild(a)}})).catch((function(t){console.log(t),e(ca({loading:!1,progress:0})),ja(e,"Unable to load app. Please try again.")}))})),Object(o.render)(Object(a.jsx)(l.a,{store:tl,children:Object(a.jsx)(el,{})}),document.getElementById("root"))}},[[419,1,2]]]);
//# sourceMappingURL=main.0b154f61.chunk.js.map