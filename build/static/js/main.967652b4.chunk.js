(this.webpackJsonpcirrocumulus=this.webpackJsonpcirrocumulus||[]).push([[0],{426:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(22),o=n(24),s=n(94),l=n(250),c=n(42),u=n(492),d=n(232),h=n(233),p=n(197),f=n(16),b=n(107),m=n.n(b),v=n(251),g=n.n(v),j=n(8),x=n(13),O=n(14),y=n(283),S=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(j.a)(this,n),t.apply(this,arguments)}return n}(Object(y.a)(Error)),C=n(181),w=n(45),k=n.n(w),E=n(9),M=function(){function e(t,n){Object(j.a)(this,e),this.vector=t,this.indices=n}return Object(E.a)(e,[{key:"getName",value:function(){return this.vector.getName()}},{key:"size",value:function(){return this.indices.length}},{key:"get",value:function(e){return this.vector.get(this.indices[e])}}]),e}(),z=n(478),I=n(75),D=n(115),A=n(512),T=n(105),P=n(109),N=n.n(P),R=n(132),F=n(17),_=n(85),L=n(76),U=n(31),B=n.n(U),H=n(469),J=n(287),W=n(284),V=n(473),G=n(261),X=n.n(G),Z=n(262),q=n.n(Z),K=n(257),Y=n.n(K),$=n(260),Q=n.n($),ee=n(255),te=n.n(ee),ne=n(259),ae=n.n(ne),ie=n(111),re=n.n(ie),oe=n(264),se=n.n(oe),le=n(256),ce=n.n(le),ue=n(258),de=n.n(ue),he=n(263),pe=n.n(he),fe=n(253),be=n.n(fe),me=n(254),ve=n.n(me),ge=n(1),je="cirro-active",xe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).setDragMode=function(e){a.props.onDragMode(e)},a.onShowLabels=function(){a.props.onShowLabels()},a.onShowAxis=function(){a.props.onShowAxis()},a.onShowFog=function(){a.props.onShowFog()},a.onGallery=function(){a.props.onGallery()},a.handleMoreOptions=function(){a.props.onMoreOptions()},a.setEditSelection=function(){a.props.onEditSelection()},a.handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){a.setState({saveImageEl:null}),a.props.onSaveImage(e)},a.state={saveImageEl:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dragmode,a=t.editSelection,r=t.showLabels,o=t.showAxis,s=this.state.saveImageEl;return Object(ge.jsxs)(i.a.Fragment,{children:[this.props.onZoomIn&&Object(ge.jsx)(H.a,{title:"Zoom In",children:Object(ge.jsx)(J.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:this.props.onZoomIn,children:Object(ge.jsx)(be.a,{})})}),this.props.onZoomOut&&Object(ge.jsx)(H.a,{title:"Zoom Out",children:Object(ge.jsx)(J.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:this.props.onZoomOut,children:Object(ge.jsx)(ve.a,{})})}),this.props.onHome&&Object(ge.jsx)(H.a,{title:"Home",children:Object(ge.jsx)(J.a,{edge:!1,size:"small","aria-label":"Home",onClick:this.props.onHome,children:Object(ge.jsx)(te.a,{})})}),this.props.onDragMode&&Object(ge.jsx)(H.a,{title:"Lasso Select",children:Object(ge.jsx)(J.a,{edge:!1,size:"small",className:"lasso"===n?je:"","aria-label":"Lasso Select",onClick:function(){return e.setDragMode("lasso")},children:Object(ge.jsx)("svg",{className:"MuiSvgIcon-root",width:"24",height:"21",viewBox:"0 0 1031 1000",children:Object(ge.jsx)("path",{d:"m1018 538c-36 207-290 336-568 286-277-48-473-256-436-463 10-57 36-108 76-151-13-66 11-137 68-183 34-28 75-41 114-42l-55-70 0 0c-2-1-3-2-4-3-10-14-8-34 5-45 14-11 34-8 45 4 1 1 2 3 2 5l0 0 113 140c16 11 31 24 45 40 4 3 6 7 8 11 48-3 100 0 151 9 278 48 473 255 436 462z m-624-379c-80 14-149 48-197 96 42 42 109 47 156 9 33-26 47-66 41-105z m-187-74c-19 16-33 37-39 60 50-32 109-55 174-68-42-25-95-24-135 8z m360 75c-34-7-69-9-102-8 8 62-16 128-68 170-73 59-175 54-244-5-9 20-16 40-20 61-28 159 121 317 333 354s407-60 434-217c28-159-121-318-333-355z",transform:"matrix(1 0 0 -1 0 850)"})})})}),this.props.onDragMode&&Object(ge.jsx)(H.a,{title:"Box Select",children:Object(ge.jsx)(J.a,{edge:!1,size:"small","aria-label":"Box Select",onClick:function(){return e.setDragMode("select")},children:Object(ge.jsx)(ce.a,{className:"select"===n?je:""})})}),this.props.onEditSelection&&Object(ge.jsx)(H.a,{title:"Append to selection",children:Object(ge.jsx)(J.a,{edge:!1,size:"small","aria-label":"Append to selection",onClick:this.setEditSelection,children:Object(ge.jsx)(Y.a,{className:a?je:""})})}),this.props.is3d&&Object(ge.jsx)(H.a,{title:this.props.animating?"Pause":"Animate",children:Object(ge.jsxs)(J.a,{edge:!1,size:"small","aria-label":this.props.animating?"Pause":"Animate",onClick:this.props.toggleAnimation,children:[!this.props.animating&&Object(ge.jsx)(de.a,{}),this.props.animating&&Object(ge.jsx)(ae.a,{})]})}),this.props.onDragMode&&Object(ge.jsx)(H.a,{title:"Pan",children:Object(ge.jsx)(J.a,{edge:!1,size:"small",className:"pan"===n?je:"","aria-label":"Pan",onClick:function(){return e.setDragMode("pan")},children:Object(ge.jsx)("svg",{className:"MuiSvgIcon-root",viewBox:"0 0 1000 1000",height:"16",width:"16",children:Object(ge.jsx)("path",{d:"m1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z",transform:"matrix(1 0 0 -1 0 850)"})})})}),this.props.onShowLabels&&Object(ge.jsx)(H.a,{title:"Show Categorical Labels",children:Object(ge.jsx)(J.a,{edge:!1,size:"small",className:r?je:"","aria-label":"Show Labels",onClick:function(){return e.onShowLabels()},children:Object(ge.jsx)(Q.a,{})})}),this.props.is3d&&this.props.onShowAxis&&Object(ge.jsx)(H.a,{title:"Show Axis",children:Object(ge.jsx)(J.a,{edge:!1,size:"small",className:o?je:"","aria-label":"Show Axis",onClick:function(){return e.onShowAxis()},children:Object(ge.jsx)(X.a,{})})}),this.props.is3d&&this.props.onShowFog&&Object(ge.jsx)(H.a,{title:"Show Fog",children:Object(ge.jsx)(J.a,{edge:!1,size:"small",className:this.props.showFog?je:"","aria-label":"Show Fog",onClick:function(){return e.onShowFog()},children:Object(ge.jsx)(q.a,{})})}),Object(ge.jsx)(H.a,{title:"Save Image",children:Object(ge.jsx)(J.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(ge.jsx)(re.a,{})})}),Object(ge.jsxs)(W.a,{id:"save-image-menu",anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:this.handleSaveImageMenuClose,children:[Object(ge.jsx)(V.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(ge.jsx)(V.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),this.props.onMoreOptions&&Object(ge.jsx)(H.a,{title:"More Options",children:Object(ge.jsx)(J.a,{edge:!1,size:"small","aria-label":"More Options",onClick:this.handleMoreOptions,children:Object(ge.jsx)(pe.a,{})})}),Object(ge.jsx)(H.a,{title:"Scroll To Gallery",children:Object(ge.jsx)(J.a,{edge:!1,size:"small","aria-label":"Scroll To Gallery",onClick:this.onGallery,children:Object(ge.jsx)(se.a,{})})})]})}}]),n}(i.a.PureComponent),Oe=n(265),ye=n.n(Oe),Se=n(513),Ce=Object(Se.a)(".1f"),we=Object(Se.a)(".2f"),ke=Object(Se.a)(","),Ee=Object(Se.a)(".0f");function Me(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:12,o=t.domain();if(o[0]!==o[1]){for(var s=10,l=e.createLinearGradient(0,0,i,r),c=Object(D.a)().range([0,1]).domain(o).clamp(!0),u=o[0],d=(o[1]-o[0])/s,h=0;h<s;h++){h===s-1&&(u=o[1]);var p=c(u);if(!isNaN(p)){var f=t(u);l.addColorStop(p,f)}u+=d}e.fillStyle=l,e.fillRect(0,0,i,r),e.strokeStyle="LightGrey",e.strokeRect(0,0,i,r),a&&(e.textBaseline="top",e.fillStyle=n,e.textAlign="left",e.fillText(Ce(o[0]),0,r+2),e.textAlign="right",e.fillText(Ce(o[1]),i,r+2))}}var ze=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).ref=i.a.createRef(),a.backingScale=1,a}return Object(E.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(t.font=Ie,Me(t,r,i,this.props.label,a,n),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"render",value:function(){"undefined"!==typeof window&&"devicePixelRatio"in window&&(this.backingScale=window.devicePixelRatio);var e=this.props.height,t=this.props.width,n={width:t,height:e};return this.props.style&&(n=Object.assign({},n,this.props.style)),Object(ge.jsx)("canvas",{width:t*this.backingScale,height:e*this.backingScale,ref:this.ref,style:n})}}]),n}(i.a.PureComponent);var Ie="12px Roboto Condensed,Helvetica,Arial,sans-serif",De="12px Helvetica,Arial,sans-serif";function Ae(e,t,n,a){var i,r=null,o={width:t.width,height:t.height},s=e.name;if("__count"===s&&(s="count"),"svg"!==a?((r=document.createElement("canvas")).width=100,r.height=100,i=r.getContext("2d")):i=new ye.a(100,100),e.continuous)o.height+=150;else{var l=function(e,t,n){e.font="14px Helvetica";var a=e.measureText(t).width;return n.forEach((function(t){return a=Math.max(a,e.measureText(t).width)})),{width:a+14,height:12*n.length+4}}(i,s,e.colorScale.domain());o.width+=l.width,o.height=Math.max(l.height,t.height)}if("svg"===a?i=new window.C2S(o.width,o.height):(r.width=o.width*window.devicePixelRatio,r.height=o.height*window.devicePixelRatio,(i=r.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),i.fillStyle="white",i.fillRect(0,0,o.width,o.height)),n(i,t,a),e.continuous?(i.translate(t.width/2-75,t.height+2),Me(i,e.colorScale)):(i.translate(t.width,2),function(e,t,n,a){e.font="14px Helvetica",e.textAlign="left",e.textBaseline="bottom";for(var i=0;i<a.length;i++){var r=a[i];e.fillStyle=t(r),e.fillRect(0,12*i,10,10),e.fillStyle="black",e.fillText(""+r,12,12*i+12)}}(i,e.colorScale,0,e.colorScale.domain())),"svg"===a){var c=i.getSerializedSvg(),u=new Blob([c],{type:"text/plain;charset=utf-8"});window.saveAs(u,s+".svg")}else r.toBlob((function(e){window.saveAs(e,s+".png",!0)}))}function Te(e,t,n){var a=function(e,t,n){return Math.min(Math.max(e,t),n)}((n-e)/(t-e),0,1);return a*a*(3-2*a)}function Pe(e,t,n){return e*(1-n)+t*n}function Ne(e,t,n,a,i,r){var o=new F.Vector3;e.fillStyle=a.darkMode?"white":"black",e.strokeStyle=a.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",e.lineWidth=a.labelStrokeWidth,e.textAlign="center",e.textBaseline="middle";for(var s=i.width/2,l=i.height/2,c=0,u=0;c<t.length;c++,u+=3)o.x=n[u],o.y=n[u+1],o.z=n[u+2],o.project(r),o.x=o.x*s+s,o.y=-o.y*l+l,e.strokeText(t[c],o.x,o.y),e.fillText(t[c],o.x,o.y)}function Re(e,t){for(var n=0;n<e.visualizers.length;n++)if(e.visualizers[n].id===t)return e.visualizers[n]}var Fe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t=a.props;Ae(t.traceInfo,t.chartSize,Object(f.bind)(a.drawContext,Object(_.a)(a)),e)},a.resetCamera=function(){a.scatterPlot.resetZoom()},a.onShowAxis=function(){var e=a.scatterPlot.scene.getObjectByName("axes");a.props.chartOptions.showAxis=!a.props.chartOptions.showAxis,e&&(e.visible=a.props.chartOptions.showAxis),a.props.setChartOptions(a.props.chartOptions)},a.onShowFog=function(){var e=Re(a.scatterPlot,Le);a.props.chartOptions.showFog=!a.props.chartOptions.showFog,e.styles.fog.enabled=a.props.chartOptions.showFog,a.props.setChartOptions(a.props.chartOptions)},a.onDragMode=function(e){"pan"===e?a.scatterPlot.setInteractionMode("PAN"):"select"===e?(a.scatterPlot.setInteractionMode("SELECT"),a.scatterPlot.rectangleSelector.setSelectionMode("BOX")):"lasso"===e&&(a.scatterPlot.rectangleSelector.setSelectionMode("LASSO"),a.scatterPlot.setInteractionMode("SELECT")),a.props.chartOptions.dragmode=e,a.props.setChartOptions(a.props.chartOptions)},a.onToggleAnimation=function(){a.scatterPlot.orbitIsAnimating()?(a.scatterPlot.stopOrbitAnimation(),a.props.chartOptions.animating=!1):(a.scatterPlot.startOrbitAnimation(),a.props.chartOptions.animating=!0),a.props.setChartOptions(a.props.chartOptions)},a.containerElementRef=i.a.createRef(),a.tooltipElementRef=i.a.createRef(),a.scatterPlot=null,a.lastHoverIndex=-1,a.state={forceUpdate:!1},a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.chartSize!==this.props.chartSize&&this.scatterPlot.resize(),this.init(),this.draw()}},{key:"componentDidMount",value:function(){this.init(),this.draw(),this.draw(),this.props.chartOptions.camera&&(this.scatterPlot.updateFromCameraDef(this.props.chartOptions.camera),this.props.chartOptions.camera=null,this.draw())}},{key:"componentWillUnmount",value:function(){}},{key:"calculatePointSize",value:function(e){var t=e.npoints,n=200/Math.log(t)/Math.log(8);return 3===e.dimensions?n:n/1.5}},{key:"drawContext",value:function(e,t,n){var a=this.props,i=a.obsCat,r=a.cachedData,o=a.traceInfo,s=a.markerOpacity,l=a.unselectedMarkerOpacity,c=a.selection,u=a.categoricalNames,d=a.chartOptions,h=this.calculatePointSize(o),p=this.props.pointSize,f=2*Math.PI,b=o.colors,m=o.positions,v=this.scatterPlot.camera,g=t.width,j=t.height;d.darkMode&&(e.fillStyle="black",e.fillRect(0,0,g,j));var x,O=g/2,y=j/2,S=Object(D.a)().domain([0,1]).range([0,255]),C=o.npoints,w=3===o.dimensions,k=this.scatterPlot.scene.fog,E=Re(this.scatterPlot,Le);if(!w){var M=.9/Math.atan(2),z=v.projectionMatrix.elements[0]+.3;x=h*(z<1?1+M*Math.atan(2*(z-1)):1+8.91267681314614*Math.atan(.02*(z-1)))}var I=x*p/4,A=new F.Vector3,T=new F.Vector4,P=E.points,N=P.modelViewMatrix.clone();N.multiplyMatrices(v.matrixWorldInverse,P.matrixWorld);var R,_=d.showFog,L=0===c.size;if(w){R=new Uint32Array(C);for(var U=0;U<C;U++)R[U]=U}else{for(var B=new Float32Array(C),H=0;H<C;H++)B[H]=m[3*H+2];R=pt(B,!0)}for(var J=0;J<C;J++){var W=R[J],V=3*W,G=4*W,X=L||c.has(W);A.x=m[V],A.y=m[V+1],A.z=m[V+2],A.project(v);var Z=b[G],q=b[G+1],K=b[G+2],Y=X?s:l;if(w&&(T.x=m[V],T.y=m[V+1],T.z=m[V+2],T.w=1,T.applyMatrix4(N),I=(x=-h/T.z)*p/4,_)){var $=h/x*1.2,Q=Te(k.near,k.far,$);Z=Pe(Z,k.color.r,Q),q=Pe(q,k.color.g,Q),K=Pe(K,k.color.b,Q)}A.x=A.x*O+O,A.y=-A.y*y+y,Z=Math.round(S(Z)),q=Math.round(S(q)),K=Math.round(S(K)),e.fillStyle="rgba("+Z+","+q+","+K+","+Y+")",e.beginPath(),e.arc(A.x,A.y,I,0,f),e.closePath(),e.fill()}if(i.length>0){var ee=Ve(o.embedding,i,r),te="svg"===n?"serif":"Roboto Condensed";e.font="bold "+d.labelFontSize+"px "+te,Ne(e,Xe(i,ee.labels,u),ee.positions,d,t,v)}}},{key:"init",value:function(){var e=this;if(null==this.scatterPlot){var t=this.containerElementRef.current;this.scatterPlot=Je(t,window.ApplePaySession,!0),"pan"===this.props.chartOptions.dragmode?this.scatterPlot.setInteractionMode("PAN"):"select"===this.props.chartOptions.dragmode?(this.scatterPlot.setInteractionMode("SELECT"),this.scatterPlot.rectangleSelector.setSelectionMode("BOX")):"lasso"===this.props.chartOptions.dragmode&&(this.scatterPlot.setInteractionMode("SELECT"),this.scatterPlot.rectangleSelector.setSelectionMode("LASSO"));var n=this.scatterPlot.scene.getObjectByName("axes");n&&(n.visible=this.props.chartOptions.showAxis),Re(this.scatterPlot,Le).styles.fog.enabled=this.props.chartOptions.showFog,this.scatterPlot.hoverCallback=function(t){if(null==t)e.tooltipElementRef.current.innerHTML=" ";else{var n=e.props.traceInfo,a=n.positions,i=e.scatterPlot.camera,r=e.props.chartSize.width/2,o=e.props.chartSize.height/2,s=new F.Vector3,l=-1;if(-1!==e.lastHoverIndex&&(s.x=a[3*e.lastHoverIndex],s.y=a[3*e.lastHoverIndex+1],s.z=a[3*e.lastHoverIndex+2],s.project(i),s.x=s.x*r+r,s.y=-s.y*o+o,Math.abs(s.x-t.x)<=2&&Math.abs(s.y-t.y)<=2&&(l=e.lastHoverIndex)),-1===l)for(var c=0,u=0;c<n.npoints;c++,4,u+=3)if(s.x=a[u],s.y=a[u+1],s.z=a[u+2],s.project(i),s.x=s.x*r+r,s.y=-s.y*o+o,Math.abs(s.x-t.x)<=2&&Math.abs(s.y-t.y)<=2){l=c;break}if(e.lastHoverIndex=l,-1!==l){var d=n.values[l],h=e.props.categoricalNames[n.name];if(h){var p=h[d];null!=p&&(d=p)}"number"===typeof d&&(d=we(d)).endsWith(".00")&&(d=d.substring(0,d.lastIndexOf("."))),e.tooltipElementRef.current.innerHTML=""+d}else e.tooltipElementRef.current.innerHTML=" "}},this.scatterPlot.lassoCallback=function(t,n){for(var a=e.props.traceInfo,i=a.positions,r=e.scatterPlot.camera,o=e.props.chartSize.width/2,s=e.props.chartSize.height/2,l=new F.Vector3,c=new Set,u=0,d=0;u<a.npoints;u++,4,d+=3)l.x=i[d],l.y=i[d+1],l.z=i[d+2],l.project(r),l.x=l.x*o+o,l.y=-l.y*s+s,bt(l,t)&&c.add(u);0===c.size?e.props.onSelected({name:ma(a.embedding)}):e.props.onSelected({name:ma(a.embedding),clear:!n,value:{basis:a.embedding,indices:c}})},this.scatterPlot.boxCallback=function(t,n){if("PAN"!==e.scatterPlot.interactionMode){for(var a=e.props.traceInfo,i=a.positions,r=e.scatterPlot.camera,o=e.props.chartSize.width/2,s=e.props.chartSize.height/2,l=new F.Vector3,c=new Set,u=0,d=0;u<a.npoints;u++,4,d+=3)l.x=i[d],l.y=i[d+1],l.z=i[d+2],l.project(r),l.x=l.x*o+o,l.y=-l.y*s+s,l.x>=t.x&&l.x<=t.x+t.width&&l.y>=t.y&&l.y<=t.y+t.height&&c.add(u);0===c.size?e.props.onSelected({name:ma(a.embedding)}):e.props.onSelected({name:ma(a.embedding),clear:!n,value:{basis:a.embedding,indices:c}})}};var a=this.containerElementRef.current.querySelector("canvas");a.style.outline="0px";a.addEventListener("webglcontextlost",(function(t){console.log("lost webgl context"),t.preventDefault(),e.scatterPlot=null})),a.addEventListener("webglcontextrestored",(function(t){console.log("restored webgl context"),t.preventDefault(),e.setState({forceUpdate:!e.state.forceUpdate})}))}}},{key:"draw",value:function(){var e=this.props,t=e.obsCat,n=e.cachedData,a=e.traceInfo,i=e.markerOpacity,r=e.unselectedMarkerOpacity,o=e.selection,s=e.pointSize,l=e.chartOptions,c=e.categoricalNames;Ge(this.scatterPlot,a,o,i,r,s,c,l,t,n)}},{key:"render",value:function(){return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)("div",{className:this.props.classes.root,children:[Object(ge.jsx)(xe,{dragmode:this.props.chartOptions.dragmode,onGallery:this.props.onGallery,animating:this.props.chartOptions.animating,showFog:this.props.chartOptions.showFog,onShowFog:this.onShowFog,is3d:this.props.traceInfo&&null!=this.props.traceInfo.z,toggleAnimation:this.onToggleAnimation,onSaveImage:this.onSaveImage,onDragMode:this.onDragMode,onCopyImage:this.onCopyImage,onShowAxis:this.onShowAxis,onHome:this.resetCamera,showAxis:this.props.chartOptions.showAxis}),Object(ge.jsx)(L.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(ge.jsx)("div",{style:{display:"inline-block",width:this.props.chartSize.width,height:this.props.chartSize.height},ref:this.containerElementRef})]})}}]),n}(i.a.PureComponent),_e=B()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},"& > .cirro-active":{fill:"rgb(220, 0, 78)",color:"rgb(220, 0, 78)"},"& > .cirro-inactive":{fill:"rgba(0, 0, 0, 0.26)",color:"rgba(0, 0, 0, 0.26)"},position:"absolute",top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(Fe),Le="SPRITES",Ue="SVG_LABELS";function Be(e,t,n){var a=t[1]-t[0],i=n[1]-n[0];return(e-t[0])/a*i+n[0]}function He(e){var t=1.2,n=e.width/e.height,a=-1.2,i=t,r=-1.2,o=t;n>1?(a*=n,i*=n):(o/=n,r/=n);var s=new F.OrthographicCamera(a,i,o,r,-1e3,1e3);return s.up=new F.Vector3(0,0,1),s.updateProjectionMatrix(),s.projectionMatrix.elements[0]}function Je(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Object(R.makeStyles)();i.label3D.fontSize=40;var r=new R.ScatterPlot(e,{camera:{},selectEnabled:!1,styles:i,interactive:a},t),o=[new R.ScatterPlotVisualizerSprites(i)];return n&&o.push(new R.ScatterPlotVisualizerSvgLabels(e,i)),r.setActiveVisualizers(o),r}function We(e){for(var t=Object(D.a)().domain([0,255]).range([0,1]),n=0,a=e.colorScale,i=e.x.length,r=new Float32Array(4*i),o=0;o<i;++o){var s=Object(I.e)(a(e.values[o]));r[n++]=t(s.r),r[n++]=t(s.g),r[n++]=t(s.b),r[n++]=1}return r}function Ve(e,t,n){var a=[];t.forEach((function(e){var t=n[e];a.push(t)}));var i=ma(e),r=n[i];if(null==r)throw new Error("Coordinates not found for "+e.name);for(var o,s,l,c,u,d,h=r[e.name+"_1"],p=r[e.name+"_2"],f=r[e.name+"_3"],b=null!=f,m={},v=0,g=null!=e.spatial,j=h.length,x=t.length,O=0;O<j;O++){for(var y=[],S=0;S<x;S++)y.push(a[S][O]);var C=y.join(","),w=m[C];void 0===w&&(w={x:[],y:[],z:[],array:y},m[C]=w,v++),w.count++,w.x.push(h[O]),w.y.push(p[O]),b&&w.z.push(f[O])}if(!g){var k=function(e){return Math.abs(e[1]-e[0])};c=[1/0,-1/0],u=[1/0,-1/0],d=b?[1/0,-1/0]:[0,1];for(var E=0;E<j;E++){var M=h[E];M<c[0]&&(c[0]=M),M>c[1]&&(c[1]=M),(M=p[E])<u[0]&&(u[0]=M),M>u[1]&&(u[1]=M),b&&((M=f[E])<d[0]&&(d[0]=M),M>d[1]&&(d[1]=M))}var z=k(c),I=k(u),D=k(d),A=Math.max(z,I,D),T=function(e,t){return[e/A*-t,t*(e/A)]};o=T(z,1),s=T(I,1),l=T(D,1)}var P=[],N=new Float32Array(3*v),R=0;for(var F in m){var _=m[F];P.push(_.array),_.x.sort((function(e,t){return e-t})),_.y.sort((function(e,t){return e-t})),_.z.sort((function(e,t){return e-t}));var L=_.x.length/2,U=L%1?_.x[L-.5]:(_.x[L-1]+_.x[L])/2,B=L%1?_.y[L-.5]:(_.y[L-1]+_.y[L])/2,H=L%1?_.z[L-.5]:(_.z[L-1]+_.z[L])/2;g||(U=Be(U,c,o),B=Be(B,u,s),H=Be(H,d,l)),N[R]=U,N[R+1]=B,N[R+2]=b?H:0,R+=3}return{labels:P,positions:N}}function Ge(e,t,n,a,i,r){for(var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,u=t.colors,d=t.positions,h=t.npoints,p=0===n.size,f=0,b=3,m=2;f<h;f++,b+=4,m+=3){var v=p||n.has(f);u[b]=v?a:i}e.scene.background=s.darkMode?new F.Color("rgb(0, 0, 0)"):null,e.setDimensions(t.dimensions);var g=Re(e,Le);g.styles.fog.enabled=s.showFog;var j=e.scene.getObjectByName("axes");j&&(j.visible=s.showAxis),e.setPointColors(u),e.setPointPositions(d);var x=new Float32Array(t.npoints);x.fill(r),e.setPointScaleFactors(x);var O=l.length>0,y=Re(e,Ue);if(y&&(y.labelsActive=O,O)){var S=ma(t.embedding)+"_"+l.join(","),C=c[S];null==C&&(C=Ve(t.embedding,l,c),c[S]=C),y.fillStyle=s.darkMode?"white":"black",y.shadowColor=s.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",y.shadowStroke=s.labelStrokeWidth,y.font="bold "+s.labelFontSize+"px Roboto Condensed";var w=Xe(l,C.labels,o);y.setLabels(w,C.positions)}e.render()}function Xe(e,t,n){var a=[],i=[];e.forEach((function(e){return i.push(n[e]||{})}));for(var r=0;r<t.length;r++){for(var o=t[r],s=[],l=0;l<o.length;l++){var c=i[l][o[l]];s.push(null!=c?c:o[l])}a.push(s.join(","))}return a}var Ze={Diverging:["interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral"],"Sequential (Single Hue)":["interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds"],"Sequential (Multi-Hue)":["interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateWarm","interpolateCool","interpolateCubehelixDefault","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateYlOrBr","interpolateYlOrRd"],Cyclical:["interpolateRainbow","interpolateSinebow"]},qe=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],Ke=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"],Ye="obs",$e="obsCat",Qe="X",et="featureSet",tt="metafeature",nt="count",at="image",it="scatter",rt="meta_image",ot="min_max_feature",st="min_max_category",lt="none";function ct(e){function t(t){return e}return t.invert=t,t.domain=t.range=function(t){return arguments.length?e=t[0]:[e,e]},t.copy=function(){return ct(e)},t}function ut(e){for(var t=e.lastIndexOf("."),n=e.substring(t+1),a=!0,i=0,r=n.length;i<r;i++)if("0"!==n[i]){a=!1;break}return a&&(e=e.substring(0,e.lastIndexOf("."))),e}function dt(e){if(e.type===at){for(var t=[],n=e.colorScale,a=function(e){return e.formatHex()},i=0,r=e.npoints;i<r;i++){var o=Object(I.e)(n(e.values[i]));t.push(a(o))}e.colors=t}else e.type===it?e.colors=We(e):e.type===rt&&function(){var t=e.colorScale,n=e.source,a=e.gallerySource,i=e.categoryToStats;if("__count"!==e.name){var r=function(e){var r=i[e],o=e.replaceAll(" ","_");n.querySelectorAll('[id="'+o+'"]').forEach((function(e){var n=void 0===r.value?"#f0f0f0":t(r.value);e.style.fill=n})),a.querySelectorAll('[id="'+o+'"]').forEach((function(e){var n=void 0===r.value?"#f0f0f0":t(r.value);e.style.fill=n}))};for(var o in i)r(o)}else{var s=function(e){var t=i[e],r=e.replaceAll(" ","_");n.querySelectorAll('[id="'+r+'"]').forEach((function(e){0===t.n?(void 0===e.dataset.fill&&(e.dataset.fill=e.style.fill),e.style.fill="#f0f0f0"):void 0!==e.dataset.fill&&(e.style.fill=e.dataset.fill)})),a.querySelectorAll('[id="'+r+'"]').forEach((function(e){0===t.n?(void 0===e.dataset.fill&&(e.dataset.fill=e.style.fill),e.style.fill="#f0f0f0"):void 0!==e.dataset.fill&&(e.style.fill=e.dataset.fill)}))};for(var l in i)s(l)}}()}function ht(e){for(var t=e.length,n=new Uint32Array(t),a=0;a<t;a++)n[e[a]]=a+1;return n}function pt(e,t){for(var n=[],a=0,i=e.length;a<i;a++)n.push({value:e[a],index:a});return function(e,t){t?e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.index<t.index?-1:1})):e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.index<t.index?1:-1}));for(var n=new Uint32Array(e.length),a=0,i=e.length;a<i;a++)n[a]=e[a].index;return n}(n,t)}function ft(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new Uint32Array(e),a=0;a<e;a++,t++)n[a]=t;return Object(z.a)(n),n}function bt(e,t){for(var n=e.x,a=e.y,i=!1,r=0,o=t.length-1;r<t.length;o=r++){var s=t[r].x,l=t[r].y,c=t[o].x,u=t[o].y;l>a!=u>a&&n<(c-s)*(a-l)/(u-l)+s&&(i=!i)}return i}function mt(e){e.length>1&&(e=N()(e));for(var t="M "+e[0].x+" "+e[0].y,n=1;n<e.length;n++)t+=" L "+e[n].x+" "+e[n].y;return t+=" Z"}function vt(e){return e.startsWith("interpolate")||(e="interpolate"+e),e}function gt(e){return T[vt(e)]}function jt(e){var t=Object(A.a)(e.value).clamp(!0).unknown("#f0f0f0");if(e.reversed){var n=t.interpolator();t.interpolator((function(e){return n(1-e)}))}return t}function xt(e,t){var n=new Set(t);e.forEach((function(e){var a=e.features;a&&a.forEach((function(e){n.has(e)||(t.push(e),n.add(e))}))}))}function Ot(e,t){var n=[];return t.forEach((function(t){for(var a=0;a<e.length;a++)if(e[a].id===t){n.push(e[a]);break}})),n}function yt(e){var t=[],n=[],a=[],i=[],r=[];return e.forEach((function(e){e.type===Qe?t.push(e.value):e.type===Ye?n.push(e.value):e.type===$e?a.push(e.value):e.type===et?i.push(e.value):e.type===tt?r.push(e.value):console.log("Unknown type: "+e)})),{X:t,obs:n,obsCat:a,featureSets:i,metafeatures:r,featureSetsAdd:[]}}var St=function(){function e(t,n){Object(j.a)(this,e),this.name=t,this.values=n}return Object(E.a)(e,[{key:"getName",value:function(){return this.name}},{key:"size",value:function(){return this.values.length}},{key:"get",value:function(e){return this.values[e]}},{key:"asArray",value:function(){return this.values}}]),e}();function Ct(e){var t=e.indexOf("/");if(-1===t)return{name:e,type:Qe};var n=e.substring(0,t);return{name:e.substring(t+1),type:n}}function wt(e,t,n){var a={};return e.forEach((function(e){a[e.getName()]=function(e){for(var t=new Map,n=0,a=e.size();n<a;n++){var i=e.get(n),r=t.get(i)||0;t.set(i,r+1)}var o=Array.from(t.keys());o.sort(k()());var s=o.map((function(e){return t.get(e)}));return{categories:o,counts:s}}(e)})),t.forEach((function(e){a[e.getName()]=Tt(e)})),n.forEach((function(e){a[e.getName()]=Tt(e)})),a}function kt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=[];return t.forEach((function(t){var i=e[t];if(null==i)throw new Error(t+" not found");var r=new St(t,i);null!=n&&(r=new M(r,n)),a.push(r)})),a}function Et(e,t){if(null!=e.embeddings&&e.embeddings.forEach((function(e){if(e.coordinates&&Object.keys(e.coordinates).length>0&&(t[e.name]=e.coordinates),e.values)for(var n in e.values)t[n+"_"+e.name]=e.values[n]})),e.values)for(var n in e.values)t[n]=e.values[n]}function Mt(e){for(var t={X:[],obs:[]},n=0;n<e.length;n++){var a=Ct(e[n]),i=a.name,r=a.type,o=t[r];void 0===o&&(o=[],t[r]=o),o.push(i)}return t}function zt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];a=parseInt(a);for(var r=[],o=0;o<a;o++)r.push(e+"_"+o+1);var s=e+"_"+a;return null!=t&&(s=s+"_"+t+"_"+n),{name:e,dimensions:a,coordinate_columns:r,nbins:t,agg:n,full_name:s,precomputed:i}}function It(e){var t=new Set,n=new Set,a=[];if(e)for(var i=e.filters||[],r=0;r<i.length;r++){var o=i[r],s=o[0];if(Object(f.isObject)(s)){var l=zt(s.basis,s.nbins,s.agg,s.ndim||2,s.precomputed);a.push(l)}else{var c=Ct(s),u=c.name,d=c.type;o[0]=u,"X"===d?t.add(u):n.add(u)}}return{basis:a,X:Array.from(t),obs:Array.from(n)}}function Dt(e,t,n){if(t.stats){var a=t.stats.dimensions||[],i=Mt(t.stats.measures||[]);e.summary=wt(kt(n,a),kt(n,i.obs),kt(n,i.X))}if(t.groupedStats){var r=t.groupedStats.dimensions||[],o=Mt(t.groupedStats.measures||[]);r.length>0&&o.X.length>0&&(e.distribution=At(kt(n,r[0]),kt(n,o.X)))}if(t.selection){var s=t.selection.dimensions||[],l=Mt(t.selection.measures||[]);e.selection={},e.selection.indices=Ft(n,t.selection.filter);var c=Array.from(e.selection.indices);s.length>0&&l.X.length>0&&(e.selection.distribution=At(kt(n,s,c),kt(n,l.X,c))),e.selection.summary=wt(kt(n,s,c),kt(n,l.obs,e.selection.indices),kt(n,l.X,c))}}function At(e,t){for(var n={},a=e.length,i=e[0].size(),r=[],o=0;o<i;o++){for(var s=0;s<a;s++)r[s]=e[s].get(o);var l=r.join(", "),c=n[l];void 0===c&&(c={key:r.slice(),indices:[]},n[l]=c),c.indices.push(o)}for(var u=Object.keys(n),d=[],h=0;h<a;h++)d[h]=e[h].getName();var p=d.join("-"),f=[];return u.forEach((function(e){var a=n[e];t.forEach((function(e){var t=new M(e,a.indices),n=Tt(t),i={dimension:p,dimensions:d,categories:a.key,feature:e.getName(),mean:n.mean,percentExpressed:n.numExpressed/t.size()*100,vector:t};f.push(i)}))})),f}function Tt(e){var t=Number.MAX_VALUE,n=-Number.MAX_VALUE,a=0,i=0;if(0===e.size())return{min:Number.NaN,max:Number.NaN,sum:Number.NaN,mean:Number.NaN,numExpressed:Number.NaN};for(var r=0,o=e.size();r<o;r++){var s=e.get(r);t=s<t?s:t,n=s>n?s:n,a+=s,0!==s&&i++}return{min:t,max:n,sum:a,mean:a/=e.size(),numExpressed:i}}function Pt(e,t,n){return"or"===n?new Set([].concat(Object(C.a)(e),Object(C.a)(t))):new Set(Object(C.a)(e).filter((function(e){return t.has(e)})))}function Nt(e,t){for(var n=new Set,a=0,i=e.length;a<i;a++)t(e[a])&&n.add(a);return n}function Rt(e){var t,n=e[1],a=e[2];if("in"===n)a=new Set(a),t=function(e){return a.has(e)};else if(">"===n)t=function(e){return e>a};else if("="===n)t=function(e){return e===a};else if("<"===n)t=function(e){return e<a};else if("!="===n)t=function(e){return e!==a};else if(">="===n)t=function(e){return e>=a};else{if("<="!==n)throw"Unknown filter: "+n;t=function(e){return e<=a}}return t}function Ft(e,t){var n=null;if(t)for(var a=t.filters||[],i=t.combine||"and",r=0;r<a.length;r++){var o=a[r],s=o[0],l=o[2],c=null;if(Object(f.isObject)(s)){var u=zt(s.basis,s.nbins,s.agg,s.ndim||2,s.precomputed),d=u.coordinate_columns;if(l.indices){if("__index"!=(u.nbins?u.full_name:"index"))throw"Not implemented";c=l.indices}else{for(var h=void 0,p=l.path,b=function(t){var n=p[t],a=Nt(e[d[0]],(function(e){return e>=n.x&&e<=n.x+n.width})),i=Nt(e[d[1]],(function(e){return e>=n.y&&e<=n.y+n.height}));if(h=Pt(a,i,"and"),n.z){var r=Nt(e[d[2]],(function(e){return e>=n.z&&e<=n.z+n.depth}));h=Pt(h,r,"and")}},m=0;m<p.length;m++)b(m);c=c?Pt(h,c,i):h}}else if("__index"===s)c=new Set(l);else{var v=Ct(s);c=Nt(e[v.name],Rt(o))}n=n?Pt(n,c,i):c}return n}var _t=function(){function e(){Object(j.a)(this,e)}return Object(E.a)(e,[{key:"init",value:function(e,t){return this.id=e,this.key2data={},this.format="json",this.schema=null,(this.url.endsWith(".jsonl")||this.url.endsWith(".jsonl.gz"))&&(this.format="jsonl"),"json"!==this.format||t.endsWith(".json")||t.endsWith(".json.gz")||(t+="schema.json"),this.url=t,this.baseUrl=this.url.substring(0,this.url.lastIndexOf("/")+1),Promise.resolve()}},{key:"getByteRange",value:function(e){var t=this.key2bytes[e];if(!t)throw new Error(e+" not found");return{headers:{Range:"bytes="+t[0]+"-"+t[1]}}}},{key:"_fetch",value:function(e){return"json"===this.format?fetch(this.baseUrl+e+".json").then((function(e){return e.json()})):fetch(this.url,this.getByteRange(e)).then((function(e){return e.json()}))}},{key:"fetchData",value:function(e){var t=this,n=[];return e.forEach((function(e){if(null==t.key2data[e]&&"__count"!==e){var a=t._fetch(e).then((function(n){if(Object(f.isArray)(n))t.key2data[e]=n;else if(n.index){for(var a=new Float32Array(t.schema.shape[0]),i=0,r=n.index.length;i<r;i++)a[n.index[i]]=n.value[i];t.key2data[e]=a}else t.key2data[e]=n}));n.push(a)}})),new Promise((function(e){Promise.all(n).then((function(){return e()}))}))}},{key:"getSelectedIdsPromise",value:function(e){var t=this,n=e.filter,a=It(n),i=a.basis,r=a.X,o=a.obs,s=[];return i.forEach((function(e){s.push(e.name)})),s.push("index"),s=s.concat(r).concat(o),new Promise((function(e){t.fetchData(s).then((function(){for(var a=Array.from(Ft(t.key2data,n)),i=t.getVector("index",a),r=[],o=0,s=i.size();o<s;o++)r.push(i.get(o));e({ids:r})}))}))}},{key:"getDataPromise",value:function(e,t){var n=this,a=[],i=[],r={};["stats","groupedStats","embedding","selection","values"].forEach((function(t){if(t in e){var n=e[t];Object(f.isArray)(n)||(n=[n]),n.forEach((function(e){e.dimensions&&(a=a.concat(e.dimensions)),e.measures&&(i=i.concat(e.measures))}))}}));var o=Mt(i),s=new Set;if(e.selection){var l=It(e.selection.filter),c=l.basis,u=l.X,d=l.obs;a=a.concat(d),i=i.concat(u);var h=e.selection.embeddings||[],p=[];h.forEach((function(e){var t=zt(e.basis,e.nbins,e.agg,e.ndim||2,e.precomputed);s.add(t.name),p.push(t)})),e.selection.embeddings=p,c.forEach((function(e){s.add(e.name)}))}return e.embedding&&e.embedding.forEach((function(e){var t=zt(e.basis,e.nbins,e.agg,e.ndim||2,e.precomputed);s.add(t.name),e.basis=t})),new Promise((function(i){n.fetchData(a.concat(o.obs).concat(o.X).concat(Array.from(s))).then((function(){if(e.embedding&&(r.embeddings=[],e.embedding.forEach((function(e){var t=n.getVector(e.basis.name).asArray();r.embeddings.push({name:e.basis.full_name,coordinates:t})}))),e.values){var a=e.values.dimensions||[],o=Mt(e.values.measures||[]),s={};a.concat(o.obs).concat(o.X).forEach((function(e){"__count"===e?(s[e]=new Int8Array(n.schema.shape[0]),s[e].fill(1)):s[e]=n.getVector(e).asArray()})),r.values=s}Et(r,t),Dt(r,e,t),i(r)}))}))}},{key:"getSchemaPromise",value:function(){if(null!=this.schema)return Promise.resolve(this.schema);var e=this.url,t=this;return"jsonl"===this.format?new Promise((function(n,a){fetch(e+".idx.json").then((function(e){return e.json()})).then((function(e){t.key2bytes=e.index})).then((function(){fetch(e,t.getByteRange("schema")).then((function(e){return e.json()})).then((function(e){t.schema=e.schema,n()}))}))})):new Promise((function(n,a){fetch(e).then((function(e){return e.json()})).then((function(e){t.schema=e,n(e)}))}))}},{key:"getVector",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.key2data[e],a=new St(e,n);return null!=t&&(a=new M(a,t)),a}},{key:"getFileUrl",value:function(e){return this.baseUrl+e}},{key:"getJob",value:function(e,t){return fetch(this.baseUrl+"uns/"+e+".json").then((function(e){return e.json()}))}},{key:"getJobs",value:function(){return[]}},{key:"getVectors",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=[];return e.forEach((function(e){var i=t.getVector(e,n);a.push(i)})),a}}]),e}(),Lt=n(481),Ut=n(482),Bt=n(483),Ht=n(484),Jt=n(485),Wt=n(516),Vt=n(486),Gt=n(487),Xt=n(488),Zt=n(489),qt=n(490),Kt=n(522),Yt=n(432),$t=n(480),Qt=n(479),en=n(172),tn=n.n(en),nn="RdBu";function an(e){void 0===e.options&&(e.options={}),void 0===e.interpolator&&(e.interpolator={name:nn,value:gt(nn),reversed:!0,scale:lt});var t,n=e.groups,a=e.data;if(void 0===e.columns){for(var i=k()({insensitive:!0}),r=new Array(n.length),o=0,s=e.groups.length;o<s;o++)r[o]=o;e.columns=r,e.columns.sort((function(t,n){return i(e.groups[t],e.groups[n])}))}if(void 0===e.rowFilters){var l=[];e.fields.forEach((function(e){l.push([e,">",NaN,""])})),e.rowFilters=l}if(void 0===e.ntop&&(e.ntop=10,e.ntopUI=10),void 0===e.sortedRows){for(var c=new Array(a.length),u=0,d=a.length;u<d;u++)c[u]=u;e.sortedRows=[];for(var h=0,p=n.length;h<p;h++)e.sortedRows.push(c)}if(void 0===e.by){e.by=e.fields[0];for(var f=0;f<e.fields.length;f++)if(-1!==e.fields[f].toLowerCase().indexOf("score")){e.by=e.fields[f];break}}function b(e){for(var t=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=0,o=a.length;r<o;r++)for(var s=0;s<n.length;s++){var l=n[s]+":"+e,c=a[r][l];null==c||isNaN(c)||(t=Math.min(t,c),i=Math.max(i,c))}return[t,i]}(void 0===e.sortByGroup&&(e.sortByGroup=e.groups[0]),void 0===e.color&&(e.color=e.fields[0]),void 0===e.size&&(e.size=e.fields[0]),void 0===e.rowSortOrder&&(e.rowSortOrder=[]),void 0===e.rows&&rn(e),void 0===e.colorScale)&&(t=e.interpolator.scale!==lt?[0,1]:b(e.color),isNaN(e.options.min)||(t[0]=e.options.min),isNaN(e.options.max)||(t[1]=e.options.max),e.colorScale=jt(e.interpolator).domain(t));if(void 0===e.sizeScaleReversed&&(e.sizeScaleReversed=null!=e.size&&-1!==e.size.indexOf("pval")),void 0===e.sizeScale)if("(None)"!==e.size){var m=b(e.size);isNaN(e.options.minSize)||(m[0]=e.options.minSize),isNaN(e.options.maxSize)||(m[1]=e.options.maxSize),e.sizeScale=Object(D.a)().domain(m).range(e.sizeScaleReversed?[18,2]:[2,18]).clamp(!0)}else e.sizeScale=ct(18)}function rn(e){var t=e.by,n=e.groups,a=n.length;e.sortedRows=[];for(var i=function(a){for(var i=[],r=0,o=e.data.length;r<o;r++)i.push(r);var s=n[a]+":"+t;i.sort((function(t,n){var a=e.data[t][s],i=e.data[n][s],r=null==a||isNaN(a),o=null==i||isNaN(i);return r&&o?0:r?1:o?-1:i-a})),e.sortedRows.push(i)},r=0;r<a;r++)i(r);var o=e.rowFilters,s=[];o.forEach((function(e){isNaN(e[2])||s.push({field:e[0],f:Rt(e)})}));var l=s.length;e.sortedFilteredRows=[];for(var c=0;c<a;c++){for(var u=n[c],d=[],h=e.sortedRows[c],p=0,f=h.length;p<f;p++){for(var b=!0,m=h[p],v=0;v<l;v++){var g=s[v],j=u+":"+g.field,x=e.data[m][j];if(!g.f(x)||null==x||isNaN(x)){b=!1;break}}b&&d.push(m)}e.sortedFilteredRows.push(d)}on(e)}function on(e){for(var t=new Set,n=e.groups.indexOf(e.sortByGroup),a=[n],i=0;i<e.groups.length;i++)i!==n&&a.push(i);for(var r=0;r<e.groups.length;r++)for(var o=e.sortedFilteredRows[a[r]],s=Math.min(e.ntop,o.length),l=0;l<s;l++)t.add(o[l]);e.rows=Array.from(t)}var sn=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onBrowseJobs=function(e){a.setState({showDialog:!0})},a.onCloseJobs=function(){a.setState({showDialog:!1})},a.onSelectJob=function(e){a.props.setJobResult(e),a.setState({showDialog:!1})},a.onDeleteJob=function(e,t){e.stopPropagation(),a.setState({browseJob:t})},a.onDeleteJobOK=function(e){a.props.onDeleteJob(e),a.setState({browseJob:null})},a.onDeleteJobCancel=function(){a.setState({browseJob:null})},a.getJobResult=function(e){var t=a.props,n=t.jobResults,i=t.jobResultId;return null==e&&(e=i),Object(f.find)(n,(function(t){return t.id===e}))},a.exportJobResult=function(e){var t=a.getJobResult(),n=[];n.push("id"),t.columns.forEach((function(e){var a=t.groups[e];t.fields.forEach((function(e){n.push("\t"),n.push(a+":"+e)}))})),n.push("\n");for(var i=function(e){n.push(t.data[e].index),t.columns.forEach((function(a){var i=t.groups[a];t.fields.forEach((function(a){var r=i+":"+a,o=t.data[e][r];n.push("\t"),n.push(o)}))})),n.push("\n")},r=0;r<t.data.length;r++)i(r);var o=new Blob([n.join("")],{type:"text/plain;charset=utf-8"});window.saveAs(o,t.name+".tsv")},a.handleClick=function(e,t){e.stopPropagation();for(var n=a.props.searchTokens,i=a.getJobResult().data[t].index,r=-1,o=0;o<n.length;o++)if(n[o].value===i){r=o;break}if(-1===r){var s=a.props.dataset;n.push({value:i,type:-1!==s.obs.indexOf(i)?Ye:Qe})}else n.splice(r,1);a.props.onSearchTokens(n.slice())},a.sortColumns=function(){for(var e=a.getJobResult(),t=e.columnSortOrder,n=e.groups,i=e.data,r=new Array(n.length),o=0,s=n.length;o<s;o++)r[o]=o;var l=t.length;if(l.length>0){for(var c=[],u=0;u<l;u++){for(var d=t[u].field,h=void 0,p=0;p<i.length;p++)if(i[p].index===d){h=p;break}c.push(h)}r.sort((function(t,n){for(var a=0;a<l;a++){var r=c[a],o=i[r][e.color]-i[r][e.color];if(0!==o)return o;var s=i[r][e.size]-i[r][e.size];if(0!==s)return s}return t-n}))}e.columns=r},a.state={showDialog:!1},a}return Object(E.a)(n,[{key:"render",value:function(){var e,t,n,a,r,o=this,s=this.props,l=s.email,c=s.jobResultId,u=s.jobResults,d=s.classes,h=s.searchTokens,p=this.getJobResult(),f=new Set;h.forEach((function(e){e.type===Qe&&f.add(e.value)}));var b,m,v,g=!1,j=0,x=0,O=null,y=!0;if(null!=p){e=p.data,t=p.color,n=p.by,a=p.size,r=p.groups,p.interpolator.scale!==lt&&(O=Object(D.a)().range([0,1]),v=[],p.interpolator.scale===ot?p.rows.forEach((function(n){var a=Number.MAX_VALUE,i=-Number.MAX_VALUE;p.columns.forEach((function(o){var s=r[o]+":"+t,l=e[n][s];null==l||isNaN(l)||(a=l<a?l:a,i=l>i?l:i)})),v.push([a,i])})):p.interpolator.scale===st&&p.columns.forEach((function(n){var a=Number.MAX_VALUE,i=-Number.MAX_VALUE;p.rows.forEach((function(o){var s=r[n]+":"+t,l=e[o][s];null==l||isNaN(l)||(a=l<a?l:a,i=l>i?l:i)})),v.push([a,i])}))),y="(None)"!==p.size;for(var S=0;S<r.length;S++)if(r[S].length>2){g=!0;break}if(b=p.rows,g){var C=document.createElement("span");C.style.position="absolute",C.style.left="-1000000px",C.className=".MuiTableCell-head .MuiTableCell-root",document.body.append(C);for(var w=0;w<r.length;w++)C.innerText=r[w],j=Math.max(j,C.getBoundingClientRect().width);C.remove(),j+=2,j=Math.min(j,300),x=Math.cos(45)*j}m=Math.max(p.sizeScale.range()[0],p.sizeScale.range()[1])}function k(e){return null==e||isNaN(e)?"NaN":we(e)}for(var E=!1,M=0;M<u.length;M++){if(!(""+u[M].id).startsWith("cirro-")){E=!0;break}}var z=null==c&&u.length>0||u.length>1;return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)(Kt.a,{color:"text.primary",children:[Object(ge.jsxs)(Qt.a,{container:!0,alignItems:"center",className:d.toolbar,children:[z&&Object(ge.jsx)(Yt.a,{size:"small",onClick:this.onBrowseJobs,variant:"outlined",color:"primary",children:"Browse All Results"}),z&&p&&Object(ge.jsx)($t.a,{orientation:"vertical",flexItem:!0}),p&&Object(ge.jsx)(Yt.a,{size:"small",onClick:this.exportJobResult,variant:"outlined",color:"primary",children:"Export"})]}),p&&Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)(L.a,{style:{marginBottom:x+8},component:"h3",color:"textPrimary",children:[Object(ge.jsx)("b",{children:p.name}),"\xa0",Object(ge.jsx)("small",{children:ke(b.length)+" / "+ke(p.data.length)+" features"})]}),Object(ge.jsx)("div",{style:{paddingTop:6},children:p.rows.length>0&&Object(ge.jsxs)(Lt.a,{stickyHeader:!0,className:d.table,children:[Object(ge.jsx)(Ut.a,{children:Object(ge.jsxs)(Bt.a,{children:[Object(ge.jsx)(Ht.a,{style:{backgroundColor:"unset",textAlign:"center"}},"__id"),p.columns.map((function(e){var t=r[e];return g?Object(ge.jsx)(Ht.a,{title:t,className:d.rotateHeader,children:Object(ge.jsx)("div",{className:d.rotateHeaderDiv,children:Object(ge.jsx)("span",{style:{width:j},className:d.rotateHeaderSpan,children:t})})},t):Object(ge.jsx)(Ht.a,{style:{backgroundColor:"unset"},className:d.td,children:t},t)}))]})}),Object(ge.jsx)(Jt.a,{children:b.map((function(i,s){var l=e[i].index,c=f.has(l);return p.interpolator.scale===ot&&O.domain(v[s]),Object(ge.jsxs)(Bt.a,{className:d.tr,hover:!0,onClick:function(e){return o.handleClick(e,i)},role:"checkbox",tabIndex:-1,children:[Object(ge.jsxs)(Ht.a,{className:d.rowHeader,component:"th",children:[Object(ge.jsx)(Wt.a,{className:d.checkbox,checked:c}),l]},"id"),p.columns.map((function(o,s){var l=r[o],c=l+":"+t,u=l+":"+a,h=l+":"+n,f=e[i][c],b=e[i][u],g=e[i][h],j=n+":"+k(g);if(t!==n&&(j+=", "+t+":"+k(f)),a!==n&&y&&a!==t&&(j+=", "+a+":"+k(b)),null==f||isNaN(f))return Object(ge.jsx)(Ht.a,{className:d.td,title:j},l);var x=p.sizeScale(b);p.interpolator.scale===st&&O.domain(v[s]);var S=O?O(f):f,C=p.colorScale(S);return Object(ge.jsx)(Ht.a,{className:d.td,title:j,children:Object(ge.jsx)("div",{className:d.dot,style:{marginLeft:(m-x)/2,width:x,height:x,backgroundColor:C}})},l)}))]},i)}))})]})})]})]}),Object(ge.jsxs)(Vt.a,{open:null!=this.state.browseJob,onClose:this.onDeleteJobCancel,"aria-labelledby":"confirm-dialog-title","aria-describedby":"conform-dialog-description",children:[Object(ge.jsx)(Gt.a,{id:"confirm-dialog-title",children:"Confirm Delete"}),Object(ge.jsx)(Xt.a,{children:Object(ge.jsxs)(Zt.a,{id:"confirm-dialog-description",children:["Are you sure you want to delete ",this.state.browseJob?this.state.browseJob.name:"","?"]})}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{onClick:this.onDeleteJobCancel,children:"Cancel"}),Object(ge.jsx)(Yt.a,{variant:"contained",onClick:function(e){return o.onDeleteJobOK(o.state.browseJob.id)},color:"primary",autoFocus:!0,children:"OK"})]})]}),Object(ge.jsxs)(Vt.a,{onClose:this.onCloseJobs,"aria-labelledby":"job-results-title",open:this.state.showDialog,children:[Object(ge.jsx)(Gt.a,{id:"job-results-title",onClose:this.onCloseJobs,children:"Results"}),Object(ge.jsx)(Xt.a,{children:Object(ge.jsxs)(Lt.a,{size:"small",stickyHeader:!0,children:[Object(ge.jsx)(Ut.a,{children:Object(ge.jsxs)(Bt.a,{children:[Object(ge.jsx)(Ht.a,{children:"Name"}),Object(ge.jsx)(Ht.a,{children:"Type"}),E&&Object(ge.jsx)(Ht.a,{children:"Status"})]})}),Object(ge.jsx)(Jt.a,{children:u.map((function(e){var t=e.name;e.title&&(t+=" - "+e.title);var n=(""+e.id).startsWith("cirro-"),a=n||"complete"===e.status,i="de"===e.type?"Differential Expression":"Correlation",r=n?"complete":e.status;return Object(ge.jsxs)(Bt.a,{className:d.deleteTr,hover:!0,selected:e.id===c,onClick:a?function(t){return o.onSelectJob(e.id)}:null,role:"checkbox",tabIndex:-1,children:[Object(ge.jsx)(Ht.a,{children:t}),Object(ge.jsx)(Ht.a,{children:i}),E&&Object(ge.jsxs)(Ht.a,{children:[r,l==e.email&&!n&&Object(ge.jsx)(J.a,{edge:"end","aria-label":"delete",onClick:function(t){return o.onDeleteJob(t,e)},children:Object(ge.jsx)(tn.a,{})})]})]},e.id)}))})]})})]})]})}}]),n}(i.a.PureComponent),ln=B()((function(e){return{dot:{borderRadius:"50%",display:"inlineBlock",border:"1px solid lightgray"},toolbar:{"& hr":{margin:e.spacing(0,.5)}},table:{borderCollapse:"collapse",position:"relative",width:"unset"},tr:{cursor:"pointer"},deleteTr:{cursor:"pointer","& span":{display:"none"},"&:hover span":{display:"block",position:"absolute",right:0,top:0}},rotateHeader:{top:0,padding:1,background:"transparent",whiteSpace:"nowrap"},checkbox:{padding:0},rotateHeaderDiv:{position:"absolute",bottom:0,left:0,textAlign:"left",transform:"translate(calc(50%),0) rotate(315deg)",transformOrigin:"0% calc(50%)",width:"100%"},rotateHeaderSpan:{position:"absolute",bottom:0,left:0,overflow:"hidden",textOverflow:"ellipsis"},td:{padding:1,whiteSpace:"nowrap",width:27,minWidth:27,maxWidth:27},rowHeader:{padding:1,whiteSpace:"nowrap"}}}))(Object(o.b)((function(e){return{dataset:e.dataset,email:e.email,jobResultId:e.jobResult,jobResults:e.jobResults,searchTokens:e.searchTokens,tab:e.tab}}),(function(e,t){return{onSearchTokens:function(t){var n;e((n=t,function(e,t){e({type:Bn,payload:n}),e(ii())}))},onDeleteJob:function(t){e(function(e){return function(t,n){t(Va(!0)),n().dataset.api.deleteJob(e).then((function(){var a=n().jobResults,i=Object(f.findIndex)(a,(function(t){return t.id===e}));a.splice(i,1),n().jobResult===e&&t(Ka(null)),t(qa(a.slice()))})).finally((function(){t(Va(!1))})).catch((function(e){oi(t,e,"Unable to delete result. Please try again.")}))}}(t))},setTab:function(t){e(Ga(t))},setJobResult:function(t){e(function(e){return function(t,n){var a=n().jobResults,i=Object(f.find)(a,(function(t){return t.id===e}));if(null!=i.data)return an(i),t(Ka(e));t(Va(!0)),n().dataset.api.getJob(e,!0).then((function(a){var i=n().jobResults,r=Object(f.find)(i,(function(t){return t.id===e}));for(var o in a)r[o]=a[o];an(r),t(Ka(e))})).finally((function(){t(Va(!1))})).catch((function(e){oi(t,e,"Unable to retrieve result. Please try again.")}))}}(t))}}}))(sn)),cn=n(491),un=n(179);function dn(e,t){var n={},a=e.categoryToIndices,i=0===t.size;for(var r in a){for(var o=a[r],s={},l=0,c=0,u=0,d=o.length;u<d;u++){var h=o[u];if(i||t.has(h)){var p=e.values[h];e.continuous?l+=p:s[p]=(s[p]||0)+1,c++}}if(e.continuous){var f=l/c;n[r]={value:0===c?void 0:(f-e.mean)/e.stdev,n:c}}else{var b=0,m=void 0;for(var v in s){var g=s[v];g>b&&(b=g,m=v)}n[r]={value:m,n:c}}}return n}var hn=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t,n=null,i=a.props,r=i.chartSize,o=i.traceInfo,s={width:r.width,height:r.height},l=o.name;if("__count"===l&&(l="count"),"svg"!==e){(n=document.createElement("canvas")).width=s.width*window.devicePixelRatio,n.height=s.height*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.fillStyle="white",t.fillRect(0,0,s.width,s.height);var c=(new XMLSerializer).serializeToString(o.source),u="data:image/svg+xml;base64,"+btoa(c);t.fillStyle="black";var d=new Image;d.src=u,d.onload=function(){t.drawImage(d,0,0),n.toBlob((function(e){window.saveAs(e,l+".png",!0)}))}}else{var h=new Blob([(new XMLSerializer).serializeToString(o.source)],{type:"text/plain;charset=utf-8"});window.saveAs(h,l+".svg")}},a.updateSvg=function(){var e=a.containerElementRef.current;e.innerHTML="";var t,n=a.props.traceInfo.source;n.setAttribute("width",a.props.chartSize.width),n.setAttribute("height",a.props.chartSize.height),e.append(n);var i=n.childNodes||n.children;if(i.length>0&&"g"===i[0].nodeName&&"true"===i[0].getAttribute("cirro-zoom")&&(t=i[0]),!t){var r=new Set(["defs","metadata","style"]);(t=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("cirro-zoom","true");var o=n.childNodes||n.children;if(o&&o.length>0)for(var s=o.length;s>0;s--)r.has(o[o.length-s].nodeName)||t.appendChild(o[o.length-s]);n.appendChild(t)}var l=Object(un.a)().scaleExtent([.1,10]).on("zoom",(function(e){var n=e.transform;t.setAttribute("transform",n)}));a.d3Zoom=l,Object(cn.a)(n).call(l)},a.onHome=function(){Object(cn.a)(a.props.traceInfo.source).call(a.d3Zoom.transform,un.b.scale(1))},a.onZoomIn=function(){Object(cn.a)(a.props.traceInfo.source).call(a.d3Zoom.scaleBy,1.5)},a.onZoomOut=function(){Object(cn.a)(a.props.traceInfo.source).call(a.d3Zoom.scaleBy,.5)},a.containerElementRef=i.a.createRef(),a.tooltipElementRef=i.a.createRef(),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.updateSvg();var t=this.containerElementRef.current;t.addEventListener("mousemove",(function(n){if(t.style.cursor=null,"path"===n.target.nodeName){var a=e.props.traceInfo.categoryToStats,i=n.target.id,r=i=i.replaceAll("_"," ");if(a){t.style.cursor="pointer";var o=a[i];if(o){var s=e.props.traceInfo.fullCategoryToStats[i],l=o!==s;"__count"!==e.props.traceInfo.name&&(e.props.traceInfo.continuous?r+=", z-score: "+ut(we(o.value))+(l?" ("+ut(we(s.value))+")":""):r+=", mode: "+o.value+(l?" ("+s.value+")":"")),r+=", # spots: "+ke(o.n)+(l?" / "+ke(s.n):"")}}e.tooltipElementRef.current.innerHTML=r}else e.tooltipElementRef.current.innerHTML=""})),t.addEventListener("mouseleave",(function(t){e.tooltipElementRef.current.innerHTML=""})),t.addEventListener("click",(function(t){if("path"===t.target.nodeName){var n=e.props.traceInfo.categoryToIndices,a=t.target.id,i=n[a=a.replaceAll("_"," ")];i&&i.length>0?e.props.onSelected({name:ma(e.props.traceInfo.embedding),clear:!t.metaKey&&!t.ctrlKey,value:{basis:e.props.traceInfo.embedding,indices:new Set(i),id:a}}):e.props.onSelected({name:ma(e.props.traceInfo.embedding)})}else e.props.onSelected({name:ma(e.props.traceInfo.embedding)})}))}},{key:"componentDidUpdate",value:function(e,t,n){if(this.tooltipElementRef.current.innerHTML="",this.props.traceInfo.source!==e.traceInfo.source)Object(cn.a)(e.traceInfo.source).on(".zoom",null),this.updateSvg();else if(this.props.chartSize.width!==e.chartSize.width||this.props.chartSize.height!==e.chartSize.height){var a=this.props.traceInfo.source;a.setAttribute("width",this.props.chartSize.width),a.setAttribute("height",this.props.chartSize.height),Object(cn.a)(a).call(this.d3Zoom.transform,un.b.scale(1))}}},{key:"render",value:function(){return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)("div",{className:this.props.classes.root,children:[Object(ge.jsx)(xe,{onGallery:this.props.onGallery,animating:!1,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,is3d:!1,onHome:this.onHome,onSaveImage:this.onSaveImage}),Object(ge.jsx)(L.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(ge.jsx)("div",{style:{display:"inline-block"},ref:this.containerElementRef})]})}}]),n}(i.a.PureComponent),pn=B()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},position:"absolute",zIndex:1,top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(hn);function fn(e){var t=[];return e.forEach((function(e){for(var n=e.categories,a=e.name,i=0;i<e.values.length;i++)t.push({dimension:a,name:n[i],feature:e.values[i].name,mean:e.values[i].mean,percentExpressed:e.values[i].percentExpressed})})),t}var bn=function(){function e(){Object(j.a)(this,e)}return Object(E.a)(e,[{key:"init",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.id=e,this.local=n,Promise.resolve()}},{key:"getSelectedIdsPromise",value:function(e,t){return e.id=this.id,this.local?null==t.index?this.getDataPromise({values:{dimensions:["index"]}},t).then((function(){for(var n=Array.from(Ft(t,e.filter)),a=[],i=t.index,r=0,o=n.length;r<o;r++)a.push(i[n[r]]);return{ids:a}})):void 0:fetch(vn+"/selected_ids",{body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"getFileUrl",value:function(e){return vn+"/file?id="+this.id+"&file="+e+"&access_token="+_a()}},{key:"getJob",value:function(e,t){return fetch(vn+"/job?id="+e+"&ds_id="+this.id+(t?"":"&status=1"),{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"getJobs",value:function(e){return fetch(vn+"/jobs?id="+e,{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"deleteJob",value:function(e){return fetch(vn+"/job",{body:JSON.stringify({id:e}),method:"DELETE",headers:{Authorization:"Bearer "+_a()}})}},{key:"getDataPromise",value:function(e,t){e.id=this.id;var n=e,a=this.local;this.local&&(n={},(e.embedding||e.values)&&(n.id=this.id,n.embedding=e.embedding,n.values=e.values));var i=JSON.stringify(n);return("{}"!==i?fetch(vn+"/data",{body:i,method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+_a()}}).then((function(e){return e.json()})).then((function(e){return Et(e,t),e})):Promise.resolve({})).then((function(n){return a?Dt(n,e,t):(n.distribution&&(n.distribution=fn(n.distribution)),n.selection&&n.selection.distribution&&(n.selection.distribution=fn(n.selection.distribution))),n}))}},{key:"getSchemaPromise",value:function(){return fetch(vn+"/schema?id="+this.id,{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}}]),e}(),mn=function(){function e(){Object(j.a)(this,e)}return Object(E.a)(e,[{key:"getUserPromise",value:function(){return fetch(vn+"/user",{headers:{Authorization:"Bearer "+_a(),"Content-Type":"application/json"}}).then((function(e){return e.json()}))}},{key:"getDatasetsPromise",value:function(){return fetch(vn+"/datasets",{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"deleteDatasetPromise",value:function(e){return fetch(vn+"/dataset",{body:JSON.stringify({id:e}),method:"DELETE",headers:{Authorization:"Bearer "+_a()}})}},{key:"upsertDatasetPromise",value:function(e,t){var n=null!=e;return null!=e&&(t.id=e),fetch(vn+"/dataset",{body:JSON.stringify(t),method:n?"PUT":"POST",headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"getDatasetPromise",value:function(e){return fetch(vn+"/dataset?id="+e,{method:"GET",headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"setCategoryNamePromise",value:function(e){return fetch(vn+"/category_name",{body:JSON.stringify(e),method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+_a()}})}},{key:"upsertDatasetFilterPromise",value:function(e,t){return fetch(vn+"/filter",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"upsertFeatureSet",value:function(e,t){return fetch(vn+"/feature_set",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"deleteFeatureSet",value:function(e,t){return fetch(vn+"/feature_set",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+_a()}})}},{key:"exportDatasetFiltersPromise",value:function(e){return fetch(vn+"/export_filters?id="+e,{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.ok?e.text():null}))}},{key:"deleteDatasetFilterPromise",value:function(e,t){return fetch(vn+"/filter",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+_a()}})}},{key:"getDatasetFilterPromise",value:function(e,t){return fetch(vn+"/filter?id="+e+"&ds_id="+t,{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"getCategoryNamesPromise",value:function(e){return fetch(vn+"/category_name?id="+e,{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"getFiltersPromise",value:function(e){return fetch(vn+"/filters?id="+e,{headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}},{key:"submitJob",value:function(e){return fetch(vn+"/submit_job",{body:JSON.stringify(e),method:"POST",headers:{Authorization:"Bearer "+_a()}}).then((function(e){return e.json()}))}}]),e}(),vn="api",gn=["email"],jn="SET_EMBEDDING_LABELS",xn="SET_DISTRIBUTION_PLOT_INTERPOLATOR",On="SET_CHART_OPTIONS",yn="SET_COMBINE_DATASET_FILTERS",Sn="SET_DATASET_FILTERS",Cn="SET_ACTIVE_FEATURE",wn="SET_CHART_SIZE",kn="SET_PRIMARY_CHART_SIZE",En="SET_SERVER_INFO",Mn="SET_DATASET_FILTER",zn="ADD_DATASET",In="DELETE_DATASET",Dn="UPDATE_DATASET",An="SET_GLOBAL_FEATURE_SUMMARY",Tn="SET_SAVED_DATASET_STATE",Pn="SET_DOMAIN",Nn="SET_CATEGORICAL_COLOR",Rn="SET_CATEGORICAL_NAME",Fn="SET_MARKER_OPACITY",_n="SET_UNSELECTED_MARKER_OPACITY",Ln="SET_SELECTION",Un="SET_FEATURE_SUMMARY",Bn="SET_SEARCH_TOKENS",Hn="SET_SELECTED_EMBEDDING",Jn="SET_MESSAGE",Wn="SET_INTERPOLATOR",Vn="SET_POINT_SIZE",Gn="SET_EMAIL",Xn="SET_USER",Zn="SET_DATASET",qn="SET_MARKERS",Kn="SET_DIALOG",Yn="MORE_OPTIONS_DIALOG",$n="EDIT_DATASET_DIALOG",Qn="IMPORT_DATASET_DIALOG",ea="SAVE_DATASET_FILTER_DIALOG",ta="SAVE_FEATURE_SET_DIALOG",na="HELP_DIALOG",aa="DELETE_DATASET_DIALOG",ia="SET_DATASET_CHOICES",ra="RESTORE_VIEW",oa="SET_DISTRIBUTION_DATA",sa="SET_SELECTED_DISTRIBUTION_DATA",la="SET_DISTRIBUTION_PLOT_OPTIONS",ca="SET_EMBEDDING_DATA",ua="SET_LOADING",da="SET_TAB",ha="LOADING_APP",pa="SET_JOB_RESULTS",fa="SET_JOB_RESULT";function ba(e){return e.bin||e.precomputed}function ma(e){var t=e.name;return e.dimensions&&(t+="_"+e.dimensions),(e.bin||e.precomputed)&&(t+="_"+e.nbins+"_"+e.agg),t}function va(e){return e.name+"_"+ma(e.embedding)}function ga(e){var t={basis:e.name,ndim:e.dimensions};return e.precomputed&&(t.precomputed=!0),e.bin&&(t.nbins=e.nbins,t.agg=e.agg),t}function ja(){return function(e,t){window.gapi.auth2.getAuthInstance().signOut().then((function(){e({type:Gn,payload:null}),e(Za(null))}))}}function xa(e){return Oa(e.dataset,e.datasetFilter,e.combineDatasetFilters)}function Oa(e,t,n){var a=function(e){var t=[],n=new Set;for(var a in e){var i=e[a];Array.isArray(i)&&i.forEach((function(e){e.indices.forEach((function(e){return n.add(e)}))}))}for(var r in n.size>0&&t.push(["__index","in",n]),e){var o=e[r],s=null;Array.isArray(o)||("in"===o.operation?s=[r,o.operation,o.value]:null==o.operation||""===o.operation||isNaN(o.value)||null==o.value||(s=[r,o.operation,o.value]),null!=s&&t.push(s))}return t}(t);if(a.length>0){for(var i=e.obs,r=e.obsCat,o=0;o<a.length;o++){var s=a[o];"__index"===s[0]?s[2]=Array.from(s[2]):-1===r.indexOf(s[0])&&-1===i.indexOf(s[0])||(s[0]="obs/"+s[0])}return{filters:a,combine:n}}}function ya(e){return{type:la,payload:e}}function Sa(e){return{type:On,payload:e}}function Ca(e){return function(t,n){t(function(e){return{type:yn,payload:e}}(e)),t(za())}}function wa(e){return{type:Cn,payload:e}}function ka(e){return{type:Mn,payload:e}}function Ea(e){return{type:Ln,payload:e}}function Ma(e){return{type:Un,payload:e}}function za(){return function(e,t){e(Va(!0));var n=t(),a=yt(n.searchTokens),i=xa(n);xt(Ot(n.markers,a.featureSets),a.X);var r={selection:{measures:a.X.concat(a.obs.map((function(e){return"obs/"+e}))),dimensions:a.obsCat}};if(i&&(r.selection.filter=i),null==i)return 0!==n.selection.size&&e(Ea(new Set)),e(Ya([])),e(Ma({})),void e(Va(!1));var o=n.cachedData;t().dataset.api.getDataPromise(r,o).then((function(t){e(ni(t.selection,!0))})).catch((function(t){oi(e,t)})).finally((function(){return e(Va(!1))}))}}function Ia(e){return{type:Pn,payload:e}}function Da(e){return{type:Rn,payload:e}}function Aa(e){return{type:Xn,payload:e}}function Ta(){return function(e,t){var n=t().dataset,a=n.embeddings.map((function(e){return e.name})),i=["tissue_hires","fle","umap","tsne"],r={};a.forEach((function(e){for(var t=e.toLowerCase(),n=0;n<i.length;n++)if(-1!==t.indexOf(i[n])){r[e]=n;break}})),a.sort((function(e,t){return(e=r[e]||Number.MAX_VALUE)-(t=r[t]||Number.MAX_VALUE)})),a.length>0&&e(Qa([n.embeddings[n.embeddings.map((function(e){return e.name})).indexOf(a[0])]]))}}function Pa(){return function(e,t){null==t().dataset&&1===t().datasetChoices.length&&e(ti(t().datasetChoices[0].id))}}function Na(e){return function(t,n){if(null!=e.colorScheme&&(e.colorScheme.value=gt(e.colorScheme.name)),null==e.datasetFilter)e.datasetFilter={};else for(var a in e.datasetFilter){var i=e.datasetFilter[a];i.operation&&(i.uiValue=i.value)}t(Va(!0)),(null!=e.dataset?t(ti(e.dataset,!1,!1)):Promise.resolve()).then((function(){var t=n().dataset;if(e.embeddings){var a=t.embeddings.map((function(e){return ma(e)})),i=[];e.embeddings.forEach((function(e){var n=a.indexOf(ma(e));-1!==n&&i.push(t.embeddings[n])})),e.embeddings=i,null!=e.camera&&(e.chartOptions.camera=e.camera)}})).then((function(){return t(ka(e.datasetFilter))})).then((function(){return t({type:ra,payload:e})})).then((function(){return t(ii())})).then((function(){return t(za())})).then((function(){null!=e.distributionPlotOptions&&t(ya(e.distributionPlotOptions));var a=e.activeFeature;null==a&&e.embeddings&&e.embeddings.length>0&&null!=e.q&&e.q.length>0&&(a={name:e.q[0],type:ri(n().dataset,e.q[0]),embeddingKey:e.q[0]+"_"+ma(e.embeddings[0])}),null!=a&&t(wa(a))})).finally((function(){return t(Va(!1))})).catch((function(e){console.log(e),t(Ba("Unable to restore saved view.")),t(Pa())}))}}function Ra(){return function(e,t){var n={dataset:null},a=window.location.search.substring(3);if(a.length>0)try{n=JSON.parse(window.decodeURIComponent(a))}catch(i){return e(Ba("Unable to restore saved view."))}null!=n.dataset?e(Na(n)):e(Pa())}}function Fa(e){return function(t,n){if(window.gapi.auth2.getAuthInstance().isSignedIn.get()){var a=window.gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail();t($a(a)),t((function(e,t){t().serverInfo.api.getUserPromise().then((function(t){return e(Aa(t))}))})),t(si()).then((function(){e&&t(Ra())}))}}}function _a(){return"undefined"!==typeof window.gapi?window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token:""}function La(e){return function(t,n){var a=e.name,i=e.url;if(""!==a&&""!==i){var r=e.readers,o=e.description,s=e.title,l=e.species;t(Va(!0));var c=null!=e.dataset,u=n().serverInfo,d=!c||i!==e.dataset.url;Promise.resolve({ok:!0}).then((function(e){})).then((function(){return n().serverInfo.api.upsertDatasetPromise(e.dataset?e.dataset.id:null,{name:a,readers:r,description:o,title:s,species:l,url:i})})).then((function(e){var n={name:a,id:e.id,title:s,url:i,species:l,readers:r,description:o,owner:!0};c?(t(function(e){return{type:Dn,payload:e}}(n)),t(Ba("Dataset updated"))):(t(function(e){return{type:zn,payload:e}}(n)),u.email&&t(Ba(d?"Please ensure that "+u.email+' is a "Storage Object Viewer"':"Dataset created")))})).finally((function(){t(Va(!1)),t(Ja(null))})).catch((function(e){oi(t,e)}))}}}function Ua(e){return function(t,n){t(Va(!0)),n().serverInfo.api.deleteDatasetPromise(e.dataset.id).then((function(){t(Za(null)),t(function(e){return{type:In,payload:e}}({id:e.dataset.id})),t(Ja(null)),t(Ba("Dataset deleted"))})).finally((function(){t(Va(!1)),t(Ja(null))})).catch((function(e){oi(t,e,"Unable to delete dataset. Please try again.")}))}}function Ba(e){return{type:Jn,payload:e}}function Ha(e){return{type:ca,payload:e}}function Ja(e){return{type:Kn,payload:e}}function Wa(e){return{type:qn,payload:e}}function Va(e){return{type:ua,payload:e}}function Ga(e){return{type:da,payload:e}}function Xa(e){return{type:ha,payload:e}}function Za(e){return{type:Zn,payload:e}}function qa(e){return{type:pa,payload:e}}function Ka(e){return{type:fa,payload:e}}function Ya(e){return{type:sa,payload:e}}function $a(e){return{type:Gn,payload:e}}function Qa(e){return function(t,n){var a=n().embeddings;t({type:Hn,payload:e}),t(ii((function(e){t({type:Hn,payload:a})})))}}function ei(e){return{type:Sn,payload:e}}function ti(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a,i){n&&a(Va(!0));for(var r=i().savedDatasetState[e],o=i().datasetChoices,s=null,l=0;l<o.length;l++)if(o[l].id===e){s=o[l];break}if(null==s)return a(Va(!1)),a(Ba("Unable to find dataset")),Promise.reject("Unable to find dataset");var c,u=Object.assign({},s);u.id=e,u.embeddings=[],u.features=[],u.obs=[],u.obsCat=[];var d,h=[],p=[];var f="direct"===u.access;u.api=f?new _t:new bn;var b=[u.api.init(e,u.url),u.api.getJobs(e).then((function(e){p=e})),u.api.getSchemaPromise().then((function(e){d=e}))];if(!f){var m=i().serverInfo.api.getCategoryNamesPromise(u.id).then((function(e){c=e})),v=i().serverInfo.api.getFiltersPromise(u.id).then((function(e){h=e}));b.push(m),b.push(v)}return Promise.all(b).then((function(){return function(){if((d=Object.assign({},u,d)).embeddings)for(var n=0;n<d.embeddings.length;n++)null!=d.embeddings[n].nbins?(d.embeddings[n].bin=!0,d.embeddings[n].precomputed=!0):(d.embeddings[n].nbins=500,d.embeddings[n]._nbins=500,d.embeddings[n].bin=!1,d.embeddings[n].agg="max");d.api=u.api,d.features=d.var,d.features.sort((function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e[0]>="0"&&e[0]<="9"&&(e="zzzzzz"+e),t[0]>="0"&&t[0]<="9"&&(t="zzzzzz"+t),e<t?-1:e===t?0:1})),d.id=e,a(Za(d)),d.results&&d.results.length>0&&(p=p.concat(d.results)),a(qa(p)),null!=c&&c.forEach((function(e){a(Da({name:e.category,oldValue:e.original,value:e.new}))})),a(ei(h)),r?a(Na(r)):t&&a(Ta())}()})).finally((function(){n&&a(Va(!1))})).catch((function(e){oi(a,e,"Unable to retrieve dataset. Please try again.")}))}}function ni(e,t){return function(n,a){var i=a();if(e){if(n(Ea(e.indices)),e.summary)n(Ma(t?e.summary:Object.assign({},a().featureSummary,e.summary)));if(e.distribution){var r=i.selectedDistributionData;t&&(r=[]);var o=yt(i.searchTokens);xt(Ot(i.markers,o.featureSets),o.X),n(Ya(r=ai(e.distribution,r,o)))}}}}function ai(e,t,n){var a=[n.obsCat.join("-")];t=t.filter((function(e){return-1!==a.indexOf(e.dimension)&&-1!==n.X.indexOf(e.feature)})),e&&(e.forEach((function(e){for(var n=0;n<t.length;n++)if(t[n].dimension===e.dimension&&t[n].feature===e.feature){t.splice(n,1);break}})),t=t.concat(e));var i={};return n.X.forEach((function(e,t){i[e]=t})),t.sort((function(e,t){return(e=i[e.feature])-(t=i[t.feature])})),t}function ii(e){return function(t,n){var a=n();if(null!=a.dataset){t(Va(!0));var i=yt(a.searchTokens);xt(Ot(a.markers,i.featureSets),i.X);var r=(i.X.length>0||i.featureSets.length>0)&&i.obsCat.length>0,o=a.embeddings,s=a.distributionData,l=a.selectedDistributionData,p=a.embeddingData,f=a.globalFeatureSummary,b=a.cachedData,v=[],j=new Set,x=[],O=new Set,y=new Set,S=xa(a);i.X.concat(i.obs).concat(i.obsCat).concat(i.metafeatures).forEach((function(e){y.add(e)}));var C=[];o.forEach((function(e){var t=ma(e);if(O.add(t),null==b[t]&&(e.dimensions>0?v.push(e):(null==b[e.attrs.group]&&j.add(e.attrs.group),e.attrs.selection.forEach((function(e){null==b[e[0]]&&j.add(e[0])})),C.push(e))),ba(e)){var n={values:[],embedding:e};y.forEach((function(e){null==b[e+"_"+t]&&n.values.push(e)})),n.values.length>0&&x.push(n)}}));var w=[];if(C.forEach((function(e){var t=ma(e);if(null==b[t]){var n=a.dataset.api.getFileUrl(e.image),i=new Promise((function(e,a){fetch(n).then((function(e){return e.text()})).then((function(e){return document.createRange().createContextualFragment(e).firstElementChild})).then((function(n){if(n.querySelector("style")){var a=document.createElement("div");a.style.display="none",a.appendChild(n),document.body.appendChild(a);for(var i=n.querySelector("style"),r=i.sheet.rules,o=0;o<r.length;o++)for(var s=r[o],l=n.querySelectorAll(s.selectorText),u=s.styleMap,d=0;d<l.length;d++){var h,p=l[d],f=Object(c.a)(u.keys());try{for(f.s();!(h=f.n()).done;){var m=h.value;p.style[m]=u.get(m).toString()}}catch(v){f.e(v)}finally{f.f()}}a.remove(),i.remove()}b[t]=n,e()}))}));w.push(i)}})),null!=S)(function(e){var t=new Set,n=new Set;for(var a in e){var i=e[a];Array.isArray(i)||("in"===i.operation?t.add(a):""===i.operation||isNaN(i.value)||null==i.value||t.add(a))}return{features:t,basis:n}})(a.datasetFilter).features.forEach((function(e){null==b[e]&&j.add(e)}));y.forEach((function(e){null==b[e]&&j.add(e)})),p.forEach((function(e){var t=ma(e.embedding),n=O.has(t)&&(y.has(e.name)||0===y.size&&"__count"===e.name);n&&(e.date=new Date),e.active=n}));var k=i.obsCat.slice(),E=[k.join("-")],M=new Set;if(r){var z={};s.forEach((function(e){z[e.name+"-"+e.feature]=!0})),E.forEach((function(e){i.X.forEach((function(t){null==z[e+"-"+t]&&M.add(t)}))}))}var I={};if(v.length>0||x.length>0){I.embedding=[];var D=v.map((function(e){return ma(e)}));x.forEach((function(e){var t=ga(e.embedding);t.dimensions=[],t.measures=[],t.coords=-1!==D.indexOf(ma(e.embedding)),I.embedding.push(t),e.values.forEach((function(e){-1!==i.obsCat.indexOf(e)?t.dimensions.push(e):-1!==i.obs.indexOf(e)?t.measures.push("obs/"+e):t.measures.push(e)}))}));var A=x.map((function(e){return ma(e.embedding)}));v.forEach((function(e){if(-1===A.indexOf(ma(e))){var t=ga(e);t.coords=!0,I.embedding.push(t)}}))}if(j.size>0){var T=a.dataset;I.values={measures:[],dimensions:[]},j.forEach((function(e){-1!==T.obsCat.indexOf(e)?I.values.dimensions.push(e):-1!==T.obs.indexOf(e)?I.values.measures.push("obs/"+e):-1!==i.metafeatures.indexOf(e)?I.values.measures.push("metagenes/"+e):I.values.measures.push(e)}))}var P=[],N=[],R=[];i.X.forEach((function(e){null==f[e]&&P.push(e)})),i.obs.forEach((function(e){null==f[e]&&N.push("obs/"+e)})),i.obsCat.forEach((function(e){null==f[e]&&R.push(e)})),(P.length>0||N.length>0||R.length>0)&&(I.stats={measures:P.concat(N),dimensions:R}),k.length>0&&M.size>0&&(I.groupedStats={measures:Array.from(M),dimensions:[k]}),null!=S&&(P.length>0||R.length>0)&&(I.selection={filter:S,measures:R.length>0?i.X:P,dimensions:i.obsCat});var F=[Object.keys(I).length>0?a.dataset.api.getDataPromise(I,b):Promise.resolve({})].concat(w);return Promise.all(F).then((function(e){var n=e[0],r=n.summary||{};for(var o in r)f[o]=r[o];t({type:An,payload:f}),function(e,t){var n=e.embeddings,a=e.embeddingData,i=e.globalFeatureSummary,r=e.interpolator,o=e.dataset,s=e.cachedData,l=new Set;a.forEach((function(e){var t=ma(e.embedding),n=e.name+"_"+t;l.add(n)})),0===t.size&&t.add("__count");n.forEach((function(n){var p=ma(n),f=ba(n),b=null!=n.spatial?n.spatial.type:n.type?n.type:it,v=b!==rt?s[p]:null,j=b!==rt?v[n.name+"_1"]:null,x=b!==rt?v[n.name+"_2"]:null,O=b!==rt?v[n.name+"_3"]:null,y=f?v.bins:null;t.forEach((function(t){var v=t+"_"+p,S=t;if(!l.has(v)){f&&(S=v);var C=i[t],w=s[S];null!=w||"__count"!==t||f||(w=new Int8Array(o.shape[0])).fill(1);void 0!==w.value&&(w.purity,w=w.value);var k=ri(o,t),E=k===$e,M=null;if(E){var z=C.categories,I=o.colors?o.colors[t]:null;null!=I&&I.length!==z.length&&(I=null),null==I&&(I=z.length<=10?d.a:z.length<=12?h.a:z.length<=20?qe:qe.concat(Ke)),(M=Object(u.a)(I).domain(z)).summary=C}else{if(g()(w)){for(var D=new Float32Array(o.shape[0]),A=0,T=w.index.length;A<T;A++)D[w.index[A]]=w.values[A];w=D}if(null==C||"__count"===t){for(var P=Number.MAX_VALUE,N=-Number.MAX_VALUE,R=0,F=0,_=w.length;F<_;F++){var L=w[F];P=L<P?L:P,N=L>N?L:N,R+=L}C={min:P,max:N,mean:R/w.length},i[t]=C}var U=[C.min,C.max];null==C.customMin||isNaN(C.customMin)||(U[0]=C.customMin),null==C.customMax||isNaN(C.customMax)||(U[1]=C.customMax),M=jt(r).domain(U)}if(b===rt&&null==n.categoryToIndices){var B=s[n.attrs.group],H={},J=Ft(s,{filters:n.attrs.selection});if(0===J.size)throw new Error("No passing indices found");var W,V=Object(c.a)(J);try{for(V.s();!(W=V.n()).done;){var G=W.value,X=B[G],Z=H[X];void 0===Z&&(Z=[],H[X]=Z),Z.push(G)}}catch(de){V.e(de)}finally{V.f()}n.categoryToIndices=H}var q={embedding:Object.assign({},n),name:t,featureType:k,x:j,y:x,z:null!=O?O:void 0,bins:y,dimensions:null!=O?3:2,npoints:w.length,date:new Date,active:!0,colorScale:M,continuous:!E,isCategorical:E,values:w,type:b};if(b===it&&(q.positions=function(e){var t,n=[1/0,-1/0],a=[1/0,-1/0],i=[1/0,-1/0],r=e.x.length,o=null!=e.z;o||(t=e.isCategorical?ft(e.values.length,1):ht(pt(e.values,!0)),i[0]=0,i[1]=1);for(var s=0;s<r;s++){var l=e.x[s];l<n[0]&&(n[0]=l),l>n[1]&&(n[1]=l);var c=e.y[s];if(c<a[0]&&(a[0]=c),c>a[1]&&(a[1]=c),o){var u=e.z[s];u<i[0]&&(i[0]=u),u>i[1]&&(i[1]=u)}}for(var d=function(e){return Math.abs(e[1]-e[0])},h=d(n),p=d(a),f=d(i),b=Math.max(h,p,f),m=function(e,t){return[e/b*-t,t*(e/b)]},v=m(h,1),g=m(p,1),j=m(f,1),x=new Float32Array(3*r),O=0,y=0;y<r;y++)x[O++]=Be(e.x[y],n,v),x[O++]=Be(e.y[y],a,g),x[O++]=Be(o?e.z[y]:t[y]/(t.length+1),i,j);return x}(q)),b===rt){var K=s[ma(n)];if(q.source=K.cloneNode(!0),q.zscore=!0,q.gallerySource=K.cloneNode(!0),q.categoryToIndices=n.categoryToIndices,q.continuous){M.domain([-3,3]);var Y=0,$=0;for(var Q in n.categoryToIndices)for(var ee=n.categoryToIndices[Q],te=0,ne=ee.length;te<ne;te++)Y+=q.values[ee[te]],$++;Y/=$;var ae=0;for(var ie in n.categoryToIndices)for(var re=n.categoryToIndices[ie],oe=0,se=re.length;oe<se;oe++){var le=q.values[re[oe]]-Y;ae+=le*=le}var ce=ae/($-1);q.mean=Y,q.stdev=Math.sqrt(ce)}q.fullCategoryToStats=dn(q,new Set),q.categoryToStats=0===e.selection.size?q.fullCategoryToStats:dn(q,e.selection)}if(dt(q),b===at){q.indices=E?ft(w.length):pt(w,!0);var ue=o.api.getFileUrl(n.spatial.image);q.tileSource=new m.a.ImageTileSource({url:ue,buildPyramid:!0,crossOriginPolicy:"Anonymous"})}a.push(q)}}))}))}(a,y),t(function(e){return{type:oa,payload:e}}(ai(n.distribution,s,i))),t(Ha(p.slice())),n.selection?t(ni(n.selection,!1)):t(Ya(ai(null,l,i)))})).finally((function(){t(Va(!1))})).catch((function(n){oi(t,n,"Unable to retrieve data. Please try again."),e&&e(n)}))}}}function ri(e,t){return"__count"===t?nt:-1!==e.obsCat.indexOf(t)?$e:-1!==e.obs.indexOf(t)?Ye:Qe}function oi(e,t,n){if(console.log(t),401===t.status)return e(Ba("Your session has expired. Please login again.")),e(ja());null==n&&(n=t instanceof S?t.message:"An unexpected error occurred. Please try again."),e(Ba(new Error(n)))}function si(){return function(e,t){return e(Va(!0)),t().serverInfo.api.getDatasetsPromise().then((function(t){e({type:ia,payload:t})})).finally((function(){e(Va(!1))})).catch((function(t){oi(e,t,"Unable to retrieve datasets. Please try again.")}))}}var li=n(520),ci=n(493),ui=n(521),di=n(511),hi=n(282),pi=n(6),fi=n(281),bi=n.n(fi),mi=n(477),vi=n(52),gi=n(499),ji=n(471),xi=n(498),Oi=n(514),yi=n(500),Si=n(275),Ci=n.n(Si),wi=n(273),ki=n.n(wi),Ei=n(274),Mi=n.n(Ei),zi=n(272),Ii=n.n(zi),Di=n(114),Ai=n.n(Di),Ti=n(495),Pi=n(472),Ni=n(431),Ri=n(497),Fi=n(496),_i=n(494),Li=n(270),Ui=n.n(Li),Bi=n(269),Hi=n.n(Bi),Ji=n(271),Wi=n.n(Ji),Vi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleClick=function(e){a.setState({anchorEl:e.currentTarget,searchText:""})},a.handleClose=function(){a.setState({anchorEl:null,searchText:""})},a.handleCloseDatasetDetails=function(e){a.setState({datasetDetailsEl:null,selectedDataset:null})},a.handleListItemDetailsClick=function(e,t){a.setState({datasetDetailsEl:e.currentTarget}),a.props.serverInfo.api.getDatasetPromise(t).then((function(e){a.setState({selectedDataset:e})}))},a.handleListItemClick=function(e){e!==(null!=a.props.dataset?a.props.dataset.id:null)&&a.props.onChange(e),a.setState({anchorEl:null,searchText:""})},a.handleClearSearchText=function(){a.setState({searchText:""})},a.onSearchChange=function(e){a.setState({searchText:e.target.value})},a.state={anchorEl:null,searchText:"",datasetDetailsEl:null,selectedDataset:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,a=t.datasetChoices,r=null!=n?n.id:null;if(a.length<=1&&null!=r)return null;var o=this.state,s=o.anchorEl,l=o.searchText,c=o.selectedDataset,u=Boolean(this.state.anchorEl),d=a,h=this.state.searchText.toLowerCase().trim();""!=h&&(d=d.filter((function(e){return-1!==e.name.toLowerCase().indexOf(h)||null!=e.description&&-1!==e.description.toLowerCase().indexOf(h)})));var p=Boolean(this.state.datasetDetailsEl),b=c&&(c.title||c.description),m=Object(f.groupBy)(d,"species"),v=Object.keys(m);return v.sort(),Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsx)(ji.a,{id:"dataset-details-selector",open:p,anchorEl:this.state.datasetDetailsEl,onClose:this.handleCloseDatasetDetails,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(ge.jsxs)("div",{style:{width:500},children:[null==c&&Object(ge.jsxs)("div",{children:[Object(ge.jsx)(ci.a,{size:20})," Loading..."]}),c&&Object(ge.jsx)(L.a,{component:"h6",children:c.name}),!b&&Object(ge.jsx)("div",{children:"No description available"}),c&&c.title&&Object(ge.jsx)("div",{children:c.title}),c&&c.description&&Object(ge.jsx)(Ai.a,{linkTarget:"_blank",children:c.description})]})}),Object(ge.jsx)(Yt.a,{variant:"contained",onClick:this.handleClick,color:null==r?"primary":"default",startIcon:Object(ge.jsx)(Hi.a,{}),children:"Open"}),Object(ge.jsxs)(ji.a,{open:u,anchorEl:s,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(ge.jsx)(_i.a,{style:{padding:6},type:"text",placeholder:"Search",value:l,onChange:this.onSearchChange,fullWidth:!0,InputProps:""!==l.trim()?{endAdornment:Object(ge.jsx)(Ti.a,{position:"end",children:Object(ge.jsx)(J.a,{"aria-label":"clear",onClick:this.handleClearSearchText,children:Object(ge.jsx)(Ui.a,{})})})}:null}),v.map((function(t){var n="null"===t?"Other":t,a=m[t];return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsx)(L.a,{component:"h2",children:n}),Object(ge.jsx)(Pi.a,{style:{width:500},dense:!0,disablePadding:!0,component:"nav","aria-label":"datasets",children:a.map((function(t){var n=t.name;return t.title&&(n+=" - "+t.title),Object(ge.jsxs)(Ni.a,{alignItems:"flex-start",selected:t.id===r,button:!0,onClick:function(n){return e.handleListItemClick(t.id)},children:[Object(ge.jsx)(Fi.a,{primary:n,style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}}),Object(ge.jsx)(Ri.a,{children:Object(ge.jsx)(J.a,{onClick:function(n){return e.handleListItemDetailsClick(n,t.id)},edge:"end","aria-label":"summary",children:Object(ge.jsx)(Wi.a,{})})})]},t.id)}))})]},t)}))]})]})}}]),n}(i.a.PureComponent),Gi=Object(o.b)((function(e){return{dataset:e.dataset,datasetChoices:e.datasetChoices,serverInfo:e.serverInfo}}),(function(e){return{handleClose:function(t){e(Ja(null))}}}))(Vi),Xi=.1,Zi="Viridis",qi="Reds",Ki={chartType:"dotplot",violinScale:"width",violinHeight:100,violinWidth:80,violinShowBoxplot:!0},Yi={name:Zi,value:gt(Zi),reversed:!1},$i={name:qi,value:gt(qi),reversed:!1,scale:lt},Qi={width:window.innerWidth-280,height:Math.max(300,window.innerHeight-410)},er={animating:!1,dragmode:"pan",showGalleryLabels:!1,showAxis:!0,showFog:false,darkMode:false,labelFontSize:14,labelStrokeWidth:4};function tr(e){for(var t=k()({insensitive:!0}),n={},a=0;a<e.length;a++){var i=n[e[a].name],r=a;void 0!==i&&(r=Math.min(r,i)),n[e[a].name]=r}return e.sort((function(e,a){if(e.name===a.name){var i=t(e.embedding.name,a.embedding.name);if(0!==i)return i}return(void 0!==e.sortIndex?e.sortIndex:n[e.name])-(void 0!==a.sortIndex?a.sortIndex:n[a.name])})),e}var nr=Object(s.c)({activeFeature:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return null;case Cn:return t.payload;case ca:var n=t.payload.filter((function(e){return e.active}));if(0===n.length)return null;var a=n[n.length-1],i=va(a);return{name:a.name,type:a.featureType,embeddingKey:i};default:return e}},cachedData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return{}}return e},categoricalNames:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rn:var n=e[t.payload.name];return void 0===n&&(n={},e[t.payload.name]=n),null==t.payload.value||""===t.payload.value?delete n[t.payload.oldValue]:n[t.payload.oldValue]=t.payload.value,Object.assign({},e);case Zn:return{};default:return e}},chartOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:er,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case On:return Object.assign({},t.payload);case ra:return t.payload.chartOptions?Object.assign(er,t.payload.chartOptions):e;default:return e}},chartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case wn:return t.payload;default:return e}},combineDatasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"and",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case yn:return t.payload;case Zn:return"and";case ra:return null!=t.payload.combineDatasetFilters?t.payload.combineDatasetFilters:e;default:return e}},dataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return document.title=null==t.payload?"Cirro":t.payload.name+" - Cirro",t.payload;case Dn:if(t.payload.id===e.id)return document.title=t.payload.name+" - Cirro",Object.assign(e,t.payload);default:return e}},datasetChoices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ia:return t.payload.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),t.payload;case Gn:return null==t.payload?[]:e;case zn:return e.push(t.payload),e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),e.slice();case Dn:case In:for(var n=-1,a=0;a<e.length;a++)if(e[a].id===t.payload.id){n=a;break}return-1!==n?(t.type===Dn?(e[n]=t.payload,e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1}))):e.splice(n,1),e.slice()):e;default:return e}},datasetFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return{};case Mn:return t.payload;case ra:return null!=t.payload.datasetFilter?t.payload.datasetFilter:e;default:return e}},datasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return[];case Sn:return t.payload;default:return e}},dialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Kn:return t.payload;default:return e}},distributionData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rn:return e.slice();case oa:return t.payload;case Zn:return[];default:return e}},distributionPlotOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ki,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return Ki;case la:return Object.assign({},e,t.payload);case ra:return null!=t.payload.distributionPlotOptions?t.payload.distributionPlotOptions:e;default:return e}},distributionPlotInterpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$i,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case xn:return Object.assign({},$i,t.payload);case ra:if(null!=t.payload.distributionPlotInterpolator){var n=Object.assign({},$i,t.payload.distributionPlotInterpolator);return n.value=gt(n.name),n}default:return e}},email:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Gn:return t.payload;default:return e}},embeddingData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ca:return tr(t.payload);case Ln:return e.forEach((function(e){e.type===rt&&(e.categoryToStats=0===t.payload.size?e.fullCategoryToStats:dn(e,t.payload),dt(e))})),e.slice();case Pn:return e.forEach((function(e){if(e.continuous&&e.name===t.payload.name){var n=t.payload.summary,a=e.type===rt?[-3,3]:[n.min,n.max];e.type===rt?(null==n.customZMin||isNaN(n.customZMin)||(a[0]=n.customZMin),null==n.customZMax||isNaN(n.customZMax)||(a[1]=n.customZMax)):(null==n.customMin||isNaN(n.customMin)||(a[0]=n.customMin),null==n.customMax||isNaN(n.customMax)||(a[1]=n.customMax)),e.colorScale.domain(a),dt(e)}})),e.slice();case Nn:return e.forEach((function(e){if(!e.continuous&&e.name===t.payload.name){var n=e.colorScale.domain().indexOf(t.payload.value),a=e.colorScale.range();a[n]=t.payload.color,e.colorScale.range(a),dt(e)}})),e.slice();case Wn:return e.forEach((function(e){if(e.continuous){var n=e.colorScale.domain();e.colorScale=jt(t.payload).domain(n),dt(e)}})),e.slice();case Zn:return[];default:return e}},embeddingLabels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jn:return t.payload;case Zn:return[];case ra:return t.payload.embeddingLabels||[];default:return e}},embeddings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Hn:return t.payload;case Zn:return[];case ra:return null!=t.payload.embeddings?t.payload.embeddings:e;default:return e}},featureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Un:return t.payload;case Zn:return{};default:return e}},globalFeatureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case An:return t.payload;case Zn:return{};default:return e}},interpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Wn:return t.payload;case ra:return null!=t.payload.colorScheme?t.payload.colorScheme:e;default:return e}},jobResult:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return null;case fa:return t.payload;default:return e}},jobResults:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return[];case pa:return t.payload;default:return e}},loading:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return t.payload;default:return e}},loadingApp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!1,progress:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ha:return t.payload;default:return e}},markerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Fn:return t.payload;case Zn:return 1;case ra:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case qn:return t.payload;case Zn:var n=null==t.payload?[]:t.payload.markers||[];if(Object(f.isPlainObject)(n)){var a=[];for(var i in n){var r=n[i];for(var o in r)a.push({category:i,name:o,id:i+"-"+o,readonly:!0,features:r[o]})}n=a}if(null!=t.payload&&null!=t.payload.markers_read_only)if(Object(f.isPlainObject)(t.payload.markers_read_only)){var s=t.payload.markers_read_only;for(var l in s){var c=s[l];for(var u in c)n.push({category:l,name:u,id:l+"-"+u,readonly:!0,features:c[u]})}}else t.payload.markers_read_only.forEach((function(e){e.readonly=!0,n.push(e)}));return n.forEach((function(e){null==e.id&&(e.id=e.category+"-"+e.name)})),n;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Jn:return t.payload;default:return e}},pointSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Vn:return t.payload;case ra:return null!=t.payload.pointSize?t.payload.pointSize:e;default:return e}},primaryChartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case kn:return t.payload;default:return e}},savedDatasetState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Tn:return t.payload;default:return e}},searchTokens:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Bn:return t.payload;case Zn:return[];case ra:return t.payload.q||[];default:return e}},selectedDistributionData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rn:return e.slice();case sa:return t.payload;case Zn:return[];default:return e}},selection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ln:return t.payload;case Zn:return new Set;default:return e}},serverInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case En:return t.payload;default:return e}},tab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"embedding",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case da:return t.payload;default:return e}},unselectedMarkerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _n:return t.payload;case Zn:return Xi;case ra:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Xn:return t.payload;default:return e}}}),ar=Object(pi.a)((function(e){return{root:{minWidth:50,textTransform:"none",fontWeight:e.typography.fontWeightRegular,marginRight:e.spacing(0),"&:hover":{color:"#40a9ff",opacity:1},"&$selected":{color:"#1890ff",fontWeight:e.typography.fontWeightMedium},"&:focus":{color:"#40a9ff"}},selected:{}}}))((function(e){return Object(ge.jsx)(xi.a,Object(vi.a)({disableRipple:!0},e))})),ir=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleTabChange=function(e,t){a.props.handleTab(t)},a.handleEmbeddingsChange=function(e){var t=e.target.value,n=[];t.forEach((function(e){e.precomputed||(e=Object.assign(e,{bin:a.props.binValues,nbins:a.props.numberOfBins,_nbins:a.props.numberOfBinsUI,agg:a.props.binSummary})),n.push(e)})),a.props.handleEmbeddings(n)},a.handleUserMenuClose=function(){a.setState({userMenuOpen:!1})},a.handleMoreMenuClose=function(){a.setState({moreMenuOpen:!1})},a.handleHelp=function(){a.props.handleDialog(na)},a.handleUserMenuOpen=function(e){a.setState({userMenuOpen:!0,userMenuAnchorEl:e.currentTarget})},a.handleMoreMenuOpen=function(e){a.setState({moreMenuOpen:!0,moreMenuAnchorEl:e.currentTarget})},a.getLinkJson=function(){var e=a.props,t=e.chartOptions,n=e.combineDatasetFilters,i=e.activeFeature,r=e.dataset,o=e.embeddingLabels,s=e.distributionPlotOptions,l=e.distributionPlotInterpolator,c=e.embeddings,u=e.searchTokens,d=e.datasetFilter,h=e.interpolator,p=e.markerOpacity,f=e.pointSize,b=e.unselectedMarkerOpacity,m=e.distributionData,v={dataset:r.id,embeddings:c.map((function(e){return e.bin?(delete(e=Object.assign({},e))._bin,e):{name:e.name,dimensions:e.dimensions}}))},g=t.ref;v.embeddings.length>0&&null!=g&&g.scatterPlot&&(v.camera=g.scatterPlot.getCameraDef()),null!=i&&(v.activeFeature=i);var j={},x={showFog:false,darkMode:false,labelFontSize:14,labelStrokeWidth:4};for(var O in x){var y=t[O];y!==x[O]&&(j[O]=y)}1!==f&&(v.pointSize=f),v.chartOptions=j,u.length>0&&(v.q=u);var S={};for(var C in d){var w=d[C];Array.isArray(w)?function(){var e=[];w.forEach((function(t){var n=Object.assign({},t);n.indices=Array.from(t.indices),e.push(n)})),S[C]=e}():"in"===w.operation?S[C]={operation:w.operation,value:w.value}:""===w.operation||isNaN(w.value)||null==w.value||(S[C]={operation:w.operation,value:w.value})}Object.keys(S).length>0&&(v.datasetFilter=S),v.combineDatasetFilters=n,1!==p&&(v.markerOpacity=p),b!==Xi&&(v.unselectedMarkerOpacity=b),m&&m.length>0&&(v.distributionPlotOptions=s,v.distributionPlotInterpolator=Object.assign({},l,{value:null}));var k=Object.assign({},h,{value:null});return v.colorScheme=k,o.length>0&&(v.embeddingLabels=o),v},a.handleDataset=function(e){if(null!=a.props.dataset){var t=a.props.savedDatasetState,n=a.getLinkJson();n.dataset=null,t[a.props.dataset.id]=n,a.props.handleSavedDatasetState(t)}a.props.handleTab("embedding"),a.props.handleDataset(e)},a.copyLink=function(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname;t+="?q="+encodeURIComponent(JSON.stringify(a.getLinkJson()));var n=document.activeElement,i=document.createElement("textarea"),r="rtl"==document.documentElement.getAttribute("dir");i.style.fontSize="12pt",i.style.border="0",i.style.padding="0",i.style.margin="0",i.style.position="absolute",i.style[r?"right":"left"]="-9999px",i.setAttribute("readonly","");var o=window.pageYOffset||document.documentElement.scrollTop;i.style.top=o+"px",i.value=t,n.appendChild(i),i.select(),i.setSelectionRange(0,i.value.length),document.execCommand("copy");a.props.setMessage("Link copied"),n.addEventListener("click",(function e(t){document.activeElement.blur(),window.getSelection().removeAllRanges(),n.removeChild(i),n.removeEventListener("click",e)})),a.setState({moreMenuOpen:!1})},a.onDarkMode=function(){a.props.chartOptions.darkMode=!a.props.chartOptions.darkMode,a.props.handleChartOptions(a.props.chartOptions)},a.handleLogout=function(){a.setState({userMenuOpen:!1}),a.props.handleLogout()},a.handleImportDataset=function(e){a.props.handleDialog(Qn),a.setState({moreMenuOpen:!1})},a.handleSettings=function(e){a.props.handleDialog($n),a.setState({moreMenuOpen:!1})},a.handleDelete=function(e){a.props.handleDialog(aa),a.setState({moreMenuOpen:!1})},a.handleShowDatasetDetails=function(e){a.setState({datasetDetailsEl:e.currentTarget})},a.handleCloseDatasetDetails=function(e){a.setState({datasetDetailsEl:null})},a.state={userMenuOpen:!1,userMenuAnchorEl:null,moreMenuOpen:!1,moreMenuAnchorEl:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,a=t.loadingApp,i=t.jobResults,r=t.email,o=t.selection,s=t.classes,l=t.serverInfo,c=t.tab,u=t.user,d=Boolean(this.state.datasetDetailsEl),h=null!=n&&(n.title||n.description),p=null!=n&&null!=n.shape?n.shape:null,f=null!=n&&null!=p&&p[0]>0&&o.size>0,b=null!=u&&u.importer&&!a.loading,m=null!==n&&n.owner&&!a.loading,v=(b||null!=n)&&!a.loading,g=!a.loading&&null==r&&""!==l.clientId;return Object(ge.jsx)(gi.a,{position:"fixed",color:"default",className:s.appBar,children:Object(ge.jsxs)(yi.a,{variant:"dense",children:[null!=n&&Object(ge.jsx)(ji.a,{id:"dataset-details",open:d,anchorEl:this.state.datasetDetailsEl,onClose:this.handleCloseDatasetDetails,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(ge.jsxs)("div",{style:{width:500},children:[n.title&&Object(ge.jsx)(L.a,{className:s.typography,children:n.title}),n.description&&Object(ge.jsx)(Ai.a,{linkTarget:"_blank",children:n.description})]})}),null!=n&&Object(ge.jsxs)(L.a,{"aria-owns":this.state.datasetDetailsOpen?"dataset-details":void 0,"aria-haspopup":"true",component:"h3",children:[h&&Object(ge.jsx)(Yt.a,{onClick:this.handleShowDatasetDetails,children:Object(ge.jsx)("b",{children:n.name})}),!h&&Object(ge.jsx)("b",{children:n.name}),Object(ge.jsxs)("small",{children:["\xa0",f&&null!=p&&ke(o.size)+" / ",null!=p&&ke(p[0])+" cells"]})]}),null!=n&&Object(ge.jsxs)(Oi.a,{value:c,indicatorColor:"primary",textColor:"primary",onChange:this.handleTabChange,children:[Object(ge.jsx)(ar,{value:"embedding",label:"Embeddings"}),Object(ge.jsx)(ar,{value:"distribution",label:"Distributions"}),i.length>0&&Object(ge.jsx)(ar,{value:"results",label:"Results"})]}),Object(ge.jsx)("div",{className:"cirro-condensed"}),Object(ge.jsxs)("div",{style:{marginLeft:"auto"},children:[!a.loading&&!g&&Object(ge.jsx)(Gi,{onChange:this.handleDataset}),v&&Object(ge.jsx)(H.a,{title:"More",children:Object(ge.jsx)(J.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleMoreMenuOpen,children:Object(ge.jsx)(Ii.a,{})})}),v&&Object(ge.jsxs)(W.a,{id:"more-menu",anchorEl:this.state.moreMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.moreMenuOpen,onClose:this.handleMoreMenuClose,children:[b&&Object(ge.jsx)(V.a,{onClick:this.handleImportDataset,children:"New Dataset"}),m&&Object(ge.jsx)(V.a,{onClick:this.handleSettings,children:"Edit Dataset"}),m&&Object(ge.jsx)(V.a,{onClick:this.handleDelete,children:"Delete Dataset"}),(b||m)&&null!=n&&Object(ge.jsx)($t.a,{}),null!=n&&Object(ge.jsx)(V.a,{onClick:this.copyLink,children:"Copy Link "})]}),Object(ge.jsx)(H.a,{title:"Toggle Light/Dark Theme",children:Object(ge.jsx)(J.a,{edge:!1,className:this.props.chartOptions.darkMode?"cirro-active":"","aria-label":"Toggle Theme",onClick:function(){return e.onDarkMode()},children:Object(ge.jsx)(ki.a,{})})}),Object(ge.jsx)(H.a,{title:"Help",children:Object(ge.jsx)(J.a,{"aria-label":"Help",onClick:this.handleHelp,children:Object(ge.jsx)(Mi.a,{})})}),null!=r&&""!==r&&Object(ge.jsx)(H.a,{title:r,children:Object(ge.jsx)(J.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleUserMenuOpen,children:Object(ge.jsx)(Ci.a,{})})}),null!=r&&""!==r&&Object(ge.jsx)(W.a,{id:"menu-user",anchorEl:this.state.userMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.userMenuOpen,onClose:this.handleUserMenuClose,children:Object(ge.jsx)(V.a,{onClick:this.handleLogout,children:"Sign Out"})}),g&&Object(ge.jsx)(Yt.a,{style:{whiteSpace:"nowrap"},variant:"outlined",color:"primary",onClick:this.props.handleLogin,children:"Sign In"})]})]})})}}]),n}(i.a.PureComponent),rr=Object(pi.a)((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},appBar:{width:"calc(100% - ".concat(js,"px)"),marginLeft:js}}}))(Object(o.b)((function(e){return{activeFeature:e.activeFeature,binSummary:e.binSummary,binValues:e.binValues,chartOptions:e.chartOptions,combineDatasetFilters:e.combineDatasetFilters,dataset:e.dataset,datasetChoices:e.datasetChoices,datasetFilter:e.datasetFilter,dialog:e.dialog,distributionData:e.distributionData,distributionPlotInterpolator:e.distributionPlotInterpolator,email:e.email,embeddingLabels:e.embeddingLabels,embeddings:e.embeddings,interpolator:e.interpolator,jobResults:e.jobResults,loading:e.loading,loadingApp:e.loadingApp,markerOpacity:e.markerOpacity,message:e.message,pointSize:e.pointSize,savedDatasetState:e.savedDatasetState,searchTokens:e.searchTokens,selection:e.selection,serverInfo:e.serverInfo,tab:e.tab,unselectedMarkerOpacity:e.unselectedMarkerOpacity,user:e.user}}),(function(e,t){return{handleTab:function(t){e(Ga(t))},setMessage:function(t){e(Ba(t))},handleLogin:function(){e((function(e,t){window.gapi.auth2.getAuthInstance().signIn().then((function(t){e(Fa())}))}))},handleLogout:function(){e(ja())},handleSavedDatasetState:function(t){e({type:Tn,payload:t})},handleDataset:function(t){e(ti(t))},handleDialog:function(t){e(Ja(t))},handleChartOptions:function(t){e(Sa(t))}}}))(ir)),or=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleCancel()},a.handleDelete=function(){a.setState({loading:!0}),a.props.handleDelete({dataset:a.props.dataset})},a.state={open:!0},a}return Object(E.a)(n,[{key:"render",value:function(){return Object(ge.jsxs)(Vt.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"delete-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(ge.jsx)(Gt.a,{id:"delete-dataset-dialog-title",children:"Delete Dataset"}),Object(ge.jsx)(Xt.a,{children:this.props.dataset&&Object(ge.jsxs)("h3",{children:["Are you sure you want to delete ",this.props.dataset.name,"?"]})}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(ge.jsx)(Yt.a,{disabled:this.state.loading,onClick:this.handleDelete,color:"primary",children:"Delete"})]})]})}}]),n}(i.a.PureComponent),sr=Object(o.b)((function(e){return{dataset:e.dataset,email:e.email}}),(function(e){return{handleDelete:function(t){e(Ua(t))},handleCancel:function(t){e(Ja(null))}}}))(or),lr=n(440),cr=n(438),ur=n(436),dr=n(434),hr=n(501);function pr(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"black",o=t.domain(),s=(o[1]-o[0])/(n+1),l=[];l.push(o[0]);for(var c=o[0],u=0;u<n;u++)c+=s,l.push(c);l.push(o[1]);var d=20,h=Object(D.a)().range([i,a-i]).domain([0,l.length-1]).clamp(!0),p=[1,9];t.range()[0]>t.range()[1]&&(p=[9,1]);var f=Object(D.a)().range(p).domain(o).clamp(!0);e.textBaseline="top",e.fillStyle=r,e.strokeStyle=r,e.textAlign="center";for(var b=0;b<l.length;b++){var m=h(b),v=f(l[b]);e.beginPath(),e.arc(m,10,v,0,2*Math.PI),e.stroke();var g=ut(we(l[b]));e.fillText(g,m,d+2)}}var fr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).ref=i.a.createRef(),a.backingScale=1,a}return Object(E.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.font=Ie,t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(pr(t,r,this.props.nsteps||3,a,20,i),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,n=this.props.width,a={width:n,height:t};return this.props.style&&(a=Object.assign({},a,this.props.style)),Object(ge.jsx)("canvas",{width:n*e,height:t*e,ref:this.ref,style:a})}}]),n}(i.a.PureComponent),br=12;function mr(e,t){var n=[],a=0;if(e[0].length>0){a=e[0][0].name.length;for(var i=0;i<e[0][0].name.length;i++)n.push(0)}e.forEach((function(e){for(var i=e[0].name,r=0;r<a;r++)n[r]=Math.max(n[r],t.measureText(i[r]).width)}));for(var r=0;r<n.length;r++)n[r]+=6,n[r]+=br;return(n=Object(hr.a)(n))[n.length-1]+=4,{endCoordinates:n,sum:n[n.length-1]}}var vr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){var t,n;a.setState({saveImageEl:null}),"svg"===e?(t=new window.C2S(10,10)).font=De:(t=(n=document.createElement("canvas")).getContext("2d")).font=Ie;var i=a.getSize(t),r=i.height+i.y+35+40+10,o=Math.max(200,i.width+i.x),s=1;"svg"===e?(t=new window.C2S(o,r)).font=De:(n.width=o*window.devicePixelRatio,n.height=r*window.devicePixelRatio,t=n.getContext("2d"),s=window.devicePixelRatio,t.scale(s,s),t.font=Ie);var l=a.props.textColor;if(t.fillStyle="white"===l?"black":"white",t.fillRect(0,0,o,r),a.drawContext(t,i),t.translate(4,s*(i.height+i.y+4)),Me(t,a.props.colorScale,l),t.translate(-10,39),a.props.drawCircles&&pr(t,a.props.sizeScale,3,150,20,l),"svg"===e){var c=t.getSerializedSvg(),u=new Blob([c],{type:"text/plain;charset=utf-8"});window.saveAs(u,a.props.data[0][0].dimension+".svg")}else n.toBlob((function(e){window.saveAs(e,a.props.data[0][0].dimension+".png",!0)}))},a.divRef=i.a.createRef(),a.tooltipElementRef=i.a.createRef(),a.canvas=null,a.state={saveImageEl:null},a}return Object(E.a)(n,[{key:"redraw",value:function(){var e=this;if(null==this.props.data)return Object(ge.jsx)("div",{});var t=1;if("undefined"!==typeof window&&"devicePixelRatio"in window&&(t=window.devicePixelRatio),null==this.canvas){this.canvas=document.createElement("canvas"),this.canvas.addEventListener("mousemove",(function(t){var n=t.target,a=e.props.sizeScale.range()[1],i=n.getBoundingClientRect(),r=[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop],o=Math.floor((r[0]-e.size.x)/(2*a)),s=Math.floor(r[1]/(2*a));if(o>=0&&o<e.props.data[0].length&&s>=0&&s<e.props.data.length){e.tooltipElementRef.current.innerHTML="";var l=e.props.data[s],c=l[o].mean,u=ut(we(c)),d=ut(Ce(l[o].percentExpressed));e.tooltipElementRef.current.innerHTML="mean: "+u+", % expressed: "+d+", "+l[o].feature+", "+l[o].name.join(", ")}else e.tooltipElementRef.current.innerHTML=""})),this.canvas.addEventListener("mouseout",(function(t){e.tooltipElementRef.current.innerHTML=""})),this.divRef.current.append(this.canvas)}var n=this.size.height+this.size.y,a=this.size.width+this.size.x,i=this.canvas,r=i.getContext("2d");i.width=a*t,i.height=n*t,i.style.width=a+"px",i.style.height=n+"px",r.font=Ie,r.clearRect(0,0,a*t,n*t),r.scale(t,t),this.drawContext(r,this.size)}},{key:"drawContext",value:function(e,t){var n=this.props.data,a=this.props.colorScale,i=this.props.interpolator,r=this.props.categoryColorScales,o=this.props.sizeScale,s=this.props.drawCircles,l=this.props.textColor,c=o.range()[1],u=2*c,d=i.scale===ot||i.scale===st?Object(D.a)().range([0,1]):null,h=n.length>0?n[0].length:0,p=n.length,f=null;if(i.scale===ot){f=[];for(var b=0;b<h;b++){for(var m=Number.MAX_VALUE,v=-Number.MAX_VALUE,g=0;g<p;g++){var j=n[g][b].mean;m=Math.min(m,j),v=Math.max(v,j)}f.push([m,v])}}else if(i.scale===st){f=[];for(var x=0;x<p;x++){for(var O=Number.MAX_VALUE,y=-Number.MAX_VALUE,S=0;S<h;S++){var C=n[x][S].mean;O=Math.min(O,C),y=Math.max(y,C)}f.push([O,y])}}for(var w=0;w<h;w++){i.scale===ot&&d.domain(f[w]);for(var k=0;k<p;k++){i.scale===st&&d.domain(f[k]);var E=n[k][w],M=E.mean,z=k*u+(s?c:0);d&&(M=d(M));var I=a(M);if(e.fillStyle=I,e.beginPath(),s){var A=w*u+c+t.x,T=E.percentExpressed;e.arc(A,z,o(T),0,2*Math.PI)}else{var P=w*u+t.x;e.rect(P,z,u,u)}e.fill()}}e.textAlign="left",e.textBaseline="middle",n.forEach((function(n,a){for(var i=n[0].name,o=a*u+c,s=0;s<i.length;s++){var d=0===s?0:t.endCoordinates[s-1],h=r[s];e.fillStyle=h(n[0].categories[s]),e.beginPath(),e.rect(d,o-c/2-3,br,br),e.fill(),e.stroke(),e.fillStyle=l,e.fillText(i[s],d+2+br,o)}})),e.textAlign="right",e.textBaseline="top",n[0].forEach((function(n,a){var i=n.feature,r=a*u;e.save(),e.translate(t.x+r+4,t.height),e.rotate(-Math.PI/2),e.fillText(i,0,0),e.restore()})),e.setTransform(1,0,0,1,0,0)}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"getSize",value:function(e){var t=0,n=this.props.data;n[0].forEach((function(n){t=Math.max(t,e.measureText(n.feature).width)})),t+=4;var a=mr(n,e),i=2*this.props.sizeScale.range()[1],r=n.length*i+4,o=n[0].length*i+4;return{endCoordinates:a.endCoordinates,x:a.sum,y:t,width:o,height:r}}},{key:"update",value:function(){var e=(null==this.canvas?document.createElement("canvas"):this.canvas).getContext("2d");e.font=Ie,this.size=this.getSize(e)}},{key:"render",value:function(){var e=this;this.update();var t=this.state.saveImageEl,n=this.props.data[0][0].dimension;return Object(ge.jsxs)("div",{style:{position:"relative"},children:[Object(ge.jsxs)("div",{children:[Object(ge.jsxs)(L.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[n,this.props.subtitle&&Object(ge.jsxs)("small",{children:["(",this.props.subtitle,")"]})]}),Object(ge.jsx)(H.a,{title:"Save Image",children:Object(ge.jsx)(J.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(ge.jsx)(re.a,{})})}),Object(ge.jsxs)(W.a,{id:"save-image-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:this.handleSaveImageMenuClose,children:[Object(ge.jsx)(V.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(ge.jsx)(V.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),Object(ge.jsx)(L.a,{color:"textPrimary",className:"cirro-condensed",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top",whiteSpace:"nowrap",width:500,minWidth:500,maxWidth:500,textOverflow:"ellipsis"}})]}),Object(ge.jsx)("div",{ref:this.divRef})]})}}]),n}(i.a.PureComponent),gr=n(503),jr=n(502);function xr(e){return e.startsWith("interpolate")&&(e=e.substring("interpolate".length)),e}var Or=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onInterpolatorChange=function(e){var t=e.target.value;a.props.handleInterpolator(Object.assign({},a.props.interpolator,{name:t,value:gt(t)}))},a.state={forceUpdate:!1},a}return Object(E.a)(n,[{key:"getScale",value:function(e){return jt({name:e,value:T[e],reversed:this.props.interpolator.reversed}).domain([0,1])}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,a=t.interpolator;null==a.reversed&&(a.reversed=!1);var r=vt(a.name),o=this.props.width||176;return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Color Scheme"}),Object(ge.jsxs)(cr.a,{input:Object(ge.jsx)(dr.a,{}),className:n.select,onChange:this.onInterpolatorChange,value:r,multiple:!1,children:[Object(ge.jsx)(V.a,{value:"Diverging",divider:!0,disabled:!0,children:"Diverging"},"Diverging"),Ze.Diverging.map((function(t){return Object(ge.jsx)(V.a,{title:xr(t),value:t,children:Object(ge.jsx)(ze,{width:o,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(ge.jsx)(V.a,{value:"Sequential (Single Hue)",divider:!0,disabled:!0,children:"Sequential (Single Hue)"},"Sequential (Single Hue)"),Ze["Sequential (Single Hue)"].map((function(t){return Object(ge.jsx)(V.a,{title:xr(t),value:t,children:Object(ge.jsx)(ze,{width:o,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(ge.jsx)(V.a,{value:"Sequential (Multi-Hue)",divider:!0,disabled:!0,children:"Sequential (Multi-Hue)"},"Sequential (Multi-Hue)"),Ze["Sequential (Multi-Hue)"].map((function(t){return Object(ge.jsx)(V.a,{title:xr(t),value:t,children:Object(ge.jsx)(ze,{width:o,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(ge.jsx)(V.a,{value:"Cyclical",divider:!0,disabled:!0,children:"Cyclical"},"Cyclical"),Ze.Cyclical.map((function(t){return Object(ge.jsx)(V.a,{title:xr(t),value:t,children:Object(ge.jsx)(ze,{width:o,label:!1,height:14,scale:e.getScale(t)})},t)}))]})]})}}]),n}(i.a.PureComponent),yr=B()((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1)}}}))(Or),Sr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.props.onMinUIChange(e.target.value),a.updateMin(e.target.value)},a.updateMin=function(e){a.props.onMinChange(parseFloat(e))},a.onMaxChange=function(e){a.props.onMaxUIChange(e.target.value),a.updateMax(e.target.value)},a.updateMax=function(e){a.props.onMaxChange(parseFloat(e))},a.onReversedChange=function(e){a.props.onInterpolator(Object.assign({},a.props.interpolator,{reversed:e.target.checked}))},a.updateMin=Object(f.debounce)(a.updateMin,500),a.updateMax=Object(f.debounce)(a.updateMax,500),a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props,t=e.domain,n=e.textColor,a=e.interpolator,r=e.onInterpolator,o=e.min,s=e.max,l="",c="";t&&(isNaN(t[0])||(l=ut(Ce(t[0]))),isNaN(t[1])||(c=ut(Ce(t[1]))),""!==l&&l===c&&(l=ut(we(t[0])),c=ut(we(t[1]))));return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsx)(yr,{handleInterpolator:r,interpolator:a}),Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)("div",{style:{color:n,width:176},children:[Object(ge.jsx)(L.a,{variant:"caption",children:l}),Object(ge.jsx)(L.a,{variant:"caption",style:{float:"right"},children:c})]}),Object(ge.jsx)(lr.a,{disabled:null==t,shrink:!0,variant:"standard",children:"Custom Color Range"}),Object(ge.jsx)(_i.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",disabled:null==t,onChange:this.onMinChange,label:"Min",value:o}),Object(ge.jsx)(_i.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",disabled:null==t,onChange:this.onMaxChange,label:"Max",value:s})]}),Object(ge.jsx)(H.a,{title:"Select to invert the color order",children:Object(ge.jsx)("div",{children:Object(ge.jsx)(jr.a,{control:Object(ge.jsx)(gr.a,{checked:a.reversed,onChange:this.onReversedChange}),label:"Reverse Colors"})})})]})}}]),n}(i.a.PureComponent),Cr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onMinSizeChange=function(e){a.setState({minSize:e.target.value}),a.updateMinSize(e.target.value)},a.updateMinSize=function(e){e=parseFloat(e),a.props.onOptions({minSize:e})},a.onMaxSizeChange=function(e){a.setState({maxSize:e.target.value}),a.updateMaxSize(e.target.value)},a.updateMaxSize=function(e){e=parseFloat(e),a.props.onOptions({maxSize:e})},a.onReversedChange=function(e){a.props.onReversedChange(e.target.checked)},a.state={minSize:"",maxSize:""},a.updateMinSize=Object(f.debounce)(a.updateMinSize,500),a.updateMaxSize=Object(f.debounce)(a.updateMaxSize,500),a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props,t=e.sizeScale,n=e.reversed,a=e.showReversed,r=e.textColor;return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsx)(fr,{style:{display:"block"},width:174,textColor:r,label:!0,height:40,scale:t}),a&&Object(ge.jsx)("div",{children:Object(ge.jsx)(jr.a,{control:Object(ge.jsx)(gr.a,{checked:n,onChange:this.onReversedChange}),label:"Reverse Sizes"})}),Object(ge.jsx)(lr.a,{style:{marginTop:16},shrink:!0,variant:"standard",children:"Custom Size Range"}),Object(ge.jsx)(_i.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",onChange:this.onMinSizeChange,label:"Min",value:this.state.minSize}),Object(ge.jsx)(_i.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",onChange:this.onMaxSizeChange,label:"Max",value:this.state.maxSize})]})}}]),n}(i.a.PureComponent),wr=n(517);function kr(e,t){for(var n=0,a=e.length,i=0;i<a;i++){var r=e[i]-t;n+=r*=r}return a<=1?NaN:((a-=1)<1&&(a=1),n/a)}function Er(e){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*e*e)}function Mr(e,t,n){var a=n.length,i=1/(a*e);return function(r){for(var o=0,s=0;s<a;s++)o+=t((r-n[s])/e);return i*o}}function zr(e,t,n,a,i,r,o,s,l){for(var c,u=r.violinScale,d=r.violinHeight,h=r.violinWidth,p=r.violinShowBoxplot,f=a.map((function(e){return e[0].name})),b=a[0].map((function(e){return e.feature})).indexOf(n),m=Number.MAX_VALUE,v=-Number.MAX_VALUE,g=-Number.MAX_VALUE,j=0;j<f.length;j++){var x=a[j][b];m=Math.min(m,x.density.x[0]),v=Math.max(v,x.density.x[x.density.x.length-1]),g=Math.max(g,x.density.max)}"area"===u&&(c=Object(D.a)().domain([-g,g]).range([4,h-4]));var O=Object(D.a)().domain([m,v]).range([d-1,1]).nice();e.strokeStyle=l;for(var y=e.lineCap,S=e.lineJoin,C=0;C<f.length;C++){e.save();var w=a[C][b];"width"===u&&(c=Object(D.a)().domain([-w.density.max,w.density.max]).range([4,h-4])),e.lineCap="round",e.lineJoin="round";var k=w.density;e.translate(t.x+C*h,0),e.beginPath(),e.moveTo(c(k.y[0]),O(k.x[0]));for(var E=1,M=k.x.length;E<M;E++)e.lineTo(c(-k.y[E]),O(k.x[E]));for(var z=k.x.length-2;z>0;z--)e.lineTo(c(k.y[z]),O(k.x[z]));e.stroke(),e.lineCap=y,e.lineJoin=S,p&&(e.strokeRect(h/2-3,O(w.boxplotStats.q3),6,O(w.boxplotStats.q1)-O(w.boxplotStats.q3)),e.beginPath(),e.moveTo(h/2-3,O(w.boxplotStats.median)),e.lineTo(h/2-3+6,O(w.boxplotStats.median)),e.stroke(),e.beginPath(),e.moveTo(h/2,O(w.boxplotStats.upperAdjacentValue)),e.lineTo(h/2,O(w.boxplotStats.q3)),e.stroke(),e.beginPath(),e.moveTo(h/2,O(w.boxplotStats.q1)),e.lineTo(h/2,O(w.boxplotStats.lowerAdjacentValue)),e.stroke()),e.restore()}e.textAlign="right",e.textBaseline="middle",e.fillStyle=l,e.strokeStyle=l;var I=t.x-4;e.lineWidth=.5,e.beginPath(),e.moveTo(I+4,O(O.domain()[0])),e.lineTo(I+4,O(O.domain()[1])),e.stroke(),e.beginPath(),e.moveTo(I+4,O(O.domain()[0])),e.lineTo(t.width+t.x-4,O(O.domain()[0])),e.stroke(),e.lineWidth=1;var A=O.tickFormat(4);if(O.ticks(4).forEach((function(t){var n=O(t);e.fillText(A(t),I,n),e.beginPath(),e.moveTo(I,n),e.lineTo(I+4,n),e.stroke()})),o){e.textBaseline="middle",e.textAlign="left";for(var T=d+t.y-1,P=0;P<f.length;P++)for(var N=a[P][b],R=P*h+h/2,F=f[P],_=0;_<F.length;_++){var L=0===_?0:t.endCoordinates[_-1],U=s[_],B=N.categories[_];e.fillStyle=U(B),e.beginPath(),e.rect(t.x+R-br+4,T-br-L,br,br),e.fill(),e.stroke(),e.save(),e.fillStyle=l,e.translate(t.x+R,T-L-br-2),e.rotate(-Math.PI/2),e.fillText(F[_],0,0),e.restore()}}}var Ir=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).mousemove=function(e){var t=e.target,n=t.getBoundingClientRect(),i=a.props,r=i.data,o=i.feature,s=i.size,l=i.options,c=l.violinHeight,u=l.violinWidth,d=[e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop];if(d[0]<s.x||d[1]>=c)a.props.onTooltip(null);else{var h=Math.floor((d[0]-s.x)/u),p=r.map((function(e){return e[0].name}));if(h>=0&&h<p.length){var f=r[0].map((function(e){return e.feature})).indexOf(o);a.props.onTooltip(r[h][f])}else a.props.onTooltip(null)}},a.mouseout=function(e){a.props.onTooltip(null)},a.initialized=!1,a.canvasRef=i.a.createRef(),a.mousemove=Object(f.throttle)(a.mousemove,500),a}return Object(E.a)(n,[{key:"redraw",value:function(){var e=this.props,t=e.categoryColorScales,n=(e.colorScale,e.data),a=e.options,i=e.feature,r=e.size,o=e.textColor;if(null!=n){var s=a.violinHeight,l=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(l=window.devicePixelRatio);var c=this.canvasRef.current;this.initialized||(c.addEventListener("mousemove",this.mousemove),c.addEventListener("mouseout",this.mouseout),this.initialized=!0);var u=s+r.y,d=r.width+r.x,h=c.getContext("2d");c.width=d*l,c.height=u*l,c.style.width=d+"px",c.style.height=u+"px",h.font=Ie,h.clearRect(0,0,d*l,u*l),h.scale(l,l),zr(h,r,i,n,0,a,!0,t,o)}}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=this.props.feature;return Object(ge.jsxs)(Kt.a,{borderColor:"text.primary",border:1,style:{display:"inline-block",margin:2},children:[Object(ge.jsx)(L.a,{color:"textPrimary",component:"h4",style:{marginTop:"3.2px"},children:e}),Object(ge.jsx)("canvas",{ref:this.canvasRef})]})}}]),n}(i.a.PureComponent),Dr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){var t,n;a.setState({saveImageEl:null}),"svg"===e?(t=new window.C2S(10,10)).font=De:(t=(n=document.createElement("canvas")).getContext("2d")).font=Ie;var i=a.getSize(t),r=i.totalHeight+i.y+15+20,o=Math.max(200,i.width+i.x);"svg"===e?(t=new window.C2S(o,r)).font=De:(n.width=o*window.devicePixelRatio,n.height=r*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.font=Ie);if(t.fillStyle="white",t.fillRect(0,0,o,r),a.drawContext(t,i),"svg"===e){var s=t.getSerializedSvg(),l=new Blob([s],{type:"text/plain;charset=utf-8"});window.saveAs(l,a.props.data[0][0].dimension+".svg")}else n.toBlob((function(e){window.saveAs(e,a.props.data[0][0].dimension+".png",!0)}))},a.onTooltip=function(e){if(e){var t=e.mean,n=e.boxplotStats.median,i=ut(we(t)),r=ut(we(n)),o=ut(Ce(e.percentExpressed));a.tooltipElementRef.current.innerHTML="mean: "+i+", median: "+r+", % expressed: "+o+", "+e.name.join(", ")}else a.tooltipElementRef.current.innerHTML=""},a.tooltipElementRef=i.a.createRef(),a.canvas=null,a.state={saveImageEl:null},a}return Object(E.a)(n,[{key:"drawContext",value:function(e,t){for(var n=this.props,a=n.categoryColorScales,i=(n.colorScale,n.data),r=n.options,o=n.textColor,s=r.violinHeight,l=r.violinWidth,c=i[0].map((function(e){return e.feature})),u=i.map((function(e){return e[0].name})),d=0;d<c.length;d++)e.save(),e.translate(0,s*d),zr(e,t,c[d],i,0,r,d===c.length-1,a,o),e.textBaseline="top",e.textAlign="middle",e.fillStyle=o,e.fillText(c[d],l*u.length/2,0),e.restore();e.setTransform(1,0,0,1,0,0)}},{key:"getSize",value:function(e){var t=this.props,n=t.data,a=t.options,i=a.violinHeight,r=a.violinWidth,o=n.map((function(e){return e[0].name})),s=n[0].map((function(e){return e.feature})),l=mr(n,e),c=s.length*i+4,u=o.length*r+4;return{x:30,endCoordinates:l.endCoordinates,y:l.sum,width:u,totalHeight:c}}},{key:"render",value:function(){var e=this,t=this.state.saveImageEl,n=this.props,a=n.categoryColorScales,i=n.colorScale,r=n.data,o=n.options,s=n.textColor,l=r[0].map((function(e){return e.feature})),c=r[0][0].dimension,u=document.createElement("canvas").getContext("2d");u.font=Ie;var d=this.getSize(u);return Object(ge.jsxs)("div",{style:{position:"relative"},children:[Object(ge.jsxs)("div",{children:[Object(ge.jsxs)(L.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[c,this.props.subtitle&&Object(ge.jsxs)("small",{children:["(",this.props.subtitle,")"]})]}),Object(ge.jsx)(H.a,{title:"Save Image",children:Object(ge.jsx)(J.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(ge.jsx)(re.a,{})})}),Object(ge.jsxs)(W.a,{id:"save-image-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:this.handleSaveImageMenuClose,children:[Object(ge.jsx)(V.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(ge.jsx)(V.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),Object(ge.jsx)(L.a,{color:"textPrimary",className:"cirro-condensed",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top",whiteSpace:"nowrap",width:500,minWidth:500,maxWidth:500,textOverflow:"ellipsis"}})]}),l.map((function(t){return Object(ge.jsx)(Ir,{onTooltip:e.onTooltip,feature:t,data:r,categoryColorScales:a,options:o,size:d,textColor:s,colorScale:i},t)}))]})}}]),n}(i.a.PureComponent);function Ar(e,t){var n=[];e[0].dimensions.forEach((function(e){n.push(t[e]||{})})),e.forEach((function(e){var t=[];n.forEach((function(a,i){var r=n[i],o=e.categories[i],s=r[o];void 0!==s&&(o=s),t[i]=o,e.name=t}))}))}function Tr(e,t){var n={};e.forEach((function(e){var t=n[e.name];null==t&&(t=[],n[e.name]=t),t.push(e)}));var a=Object.keys(n),i=e[0].dimension;if(t.sortBy!==i){var r={},o={};e.forEach((function(e){e.feature===t.sortBy&&(r[e.name]=e.mean,o[e.name]=e.percentExpressed)})),a.sort((function(e,t){var n=r[e],a=r[t],i=n===a?0:n>a?-1:1;return 0===i&&(i=(n=o[e])===(a=o[t])?0:n>a?-1:1),i}))}else{var s=k()({insensitive:!0});a.sort((function(e,t){return s(e,t)}))}for(var l=[],c=0;c<a.length;c++){var u=a[c],d=n[u];l.push(d)}return l}function Pr(e){var t=[Number.MAX_VALUE,-Number.MAX_VALUE];return e.forEach((function(e){t[0]=Math.min(e.mean,t[0]),t[1]=Math.max(e.mean,t[1])})),{mean:t,percent:[0,100]}}var Nr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(j.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).onSortOrderChanged=function(t){e.props.onDistributionPlotOptions({sortBy:t.target.value})},e}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.textColor,a=t.categoryColorScales,i=t.distributionData,r=t.distributionPlotOptions,o=t.categoricalNames,s=t.selectedData,l=t.interpolator;if(null==i||0===i.length)return null;var c=Pr(i),u=l.scale!==lt?[0,1]:c.mean,d=c.percent;if(null!=s&&s.length>0){var h=Pr(s);u[0]=Math.min(u[0],h.mean[0]),u[1]=Math.max(u[1],h.mean[1]),d[0]=Math.min(d[0],h.percent[0]),d[1]=Math.max(d[1],h.percent[1])}if(null==r.min||isNaN(r.min)||(u[0]=r.min),null==r.max||isNaN(r.max)||(u[1]=r.max),null==r.minSize||isNaN(r.minSize)||(d[0]=r.minSize),null==r.maxSize||isNaN(r.maxSize)||(d[1]=r.maxSize),null==r.sortBy&&(r.sortBy=i[0].dimension),r.sortBy!==i[0].dimension){for(var p=!1,f=0;f<i.length;f++)if(i[f].feature===r.sortBy){p=!0;break}p||(r.sortBy=i[0].dimension)}var b=r.chartType,m=jt(l).domain(u),v=Object(D.a)().domain(d).range([1,9]).clamp(!0);Ar(i,o),s&&Ar(s,o);var g=Tr(i,r),j=g[0].map((function(e){return e.feature}));if("violin"===b){var x=s?i.concat(s):i;j.forEach((function(e){x.forEach((function(t){if(t.feature===e&&null==t.density){for(var n=t.vector,a=new Float32Array(n.size()),i=0,r=a.length;i<r;i++)a[i]=n.get(i);t.boxplotStats=function(e){e=e.slice().sort((function(e,t){return e-t}));for(var t=Object(wr.a)(e,.75),n=Object(wr.a)(e,.25),a=Object(wr.a)(e,.5),i=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=t+1.5*(t-n),s=n-1.5*(t-n),l=0,c=0,u=e.length;c<u;c++){var d=e[c];d<=o&&(i=Math.max(i,d)),d>=s&&(r=Math.min(r,d)),l+=d}var h=l/e.length;return r>n&&(r=n),i<t&&(i=t),{mean:h,upperAdjacentValue:i,lowerAdjacentValue:r,median:a,q3:t,q1:n,variance:kr(e,h),n:e.length,x0:e[0]}}(a);var o=function(e){var t,n=Math.sqrt(e.variance),a=e.q3-e.q1;return(t=Math.min(n,a/1.34))||(t=n)||(t=Math.abs(e.x0))||(t=1),.9*t*Math.pow(e.n,-.2)}(t.boxplotStats);t.bandwidth=o,t.density=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,a=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=0,o=e.length;r<o;r++){var s=e[r];a=Math.min(a,s),i=Math.max(i,s)}for(var l=(i-a)/(n-1),c=new Float32Array(n),u=new Float32Array(n),d=0,h=Mr(t,Er,e),p=0,f=a;p<n;p++,f+=l){var b=h(f);c[p]=f,u[p]=b,d=Math.max(d,b)}return{x:c,y:u,max:d}}(a,o)}}))}))}var O=[i[0].dimension].concat(j);return Object(ge.jsxs)(Kt.a,{color:"text.primary",children:["violin"!==b&&Object(ge.jsx)(vr,{categoryColorScales:a,colorScale:m,interpolator:l,sizeScale:v,textColor:n,drawCircles:"dotplot"===b,data:g}),"violin"===b&&Object(ge.jsx)(Dr,{categoryColorScales:a,colorScale:m,textColor:n,options:r,data:g}),"violin"!==b&&null!=s&&s.length>0?Object(ge.jsx)(vr,{categoryColorScales:a,colorScale:m,interpolator:l,sizeScale:v,subtitle:"selection",textColor:n,drawCircles:"dotplot"===b,data:Tr(s,r)}):null,"violin"===b&&null!=s&&s.length>0?Object(ge.jsx)(Dr,{categoryColorScales:a,colorScale:m,subtitle:"selection",options:r,textColor:n,data:Tr(s,r)}):null,"violin"!==b&&Object(ge.jsx)(Sr,{colorScale:m,textColor:n,domain:m.domain(),interpolator:l,onOptions:this.props.onDistributionPlotOptions,onInterpolator:this.props.handleInterpolator}),"violin"!==b&&Object(ge.jsxs)(ur.a,{className:this.props.classes.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Standardize"}),Object(ge.jsxs)(cr.a,{input:Object(ge.jsx)(dr.a,{size:"small"}),onChange:function(t){return e.props.onColorScalingChange(t.target.value)},value:l.scale,children:[Object(ge.jsx)(V.a,{value:"none",divider:!0,children:"(None)"}),Object(ge.jsx)(V.a,{title:"Standardize features between 0 and 1",value:ot,children:"Feature"}),Object(ge.jsx)(V.a,{title:"Standardize groups between 0 and 1",value:st,children:"Category"})]})]}),"dotplot"===b&&Object(ge.jsxs)("div",{style:{paddingTop:16},children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Size"}),Object(ge.jsx)(Cr,{sizeScale:v,textColor:n,onOptions:this.props.onDistributionPlotOptions,showReversed:!1})]}),Object(ge.jsxs)(ur.a,{className:this.props.classes.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Sort By"}),Object(ge.jsx)(cr.a,{input:Object(ge.jsx)(dr.a,{size:"small"}),onChange:this.onSortOrderChanged,value:r.sortBy,children:O.map((function(e){return Object(ge.jsx)(V.a,{value:e,children:e},e)}))})]})]})}}]),n}(i.a.PureComponent),Rr=B()((function(e){return{formControl:{display:"block",margin:e.spacing(1)}}}))(Nr),Fr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(j.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).onInterpolator=function(t){var n=e.props.distributionPlotInterpolator.scale;t.scale=n,e.props.onInterpolator(t)},e.onColorScalingChange=function(t){var n=e.props.distributionPlotInterpolator;n.scale=t,e.props.onInterpolator(Object.assign({},n))},e}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.cachedData,a=t.categoricalNames,r=t.chartOptions,o=t.distributionData,s=t.distributionPlotOptions,l=t.distributionPlotInterpolator,c=t.embeddingData,h=t.globalFeatureSummary,p=t.onDistributionPlotOptions,b=t.selectedDistributionData;if(0===o.length)return Object(ge.jsx)("h4",{children:"Please enter one or more categorical observations and one or more features."});var m=r.darkMode?"white":"black",v=Object(f.groupBy)(o,"dimension"),g=Object(f.groupBy)(b,"dimension");return Object(ge.jsx)(i.a.Fragment,{children:Object.keys(v).map((function(t){var i=v[t],r=[];return i[0].dimensions.forEach((function(e){for(var t=!1,n=0;n<c.length;n++)if(e===c[n].name){r.push(c[n].colorScale),t=!0;break}t||r.push(Object(u.a)(d.a))})),Object(ge.jsx)(Rr,{cachedData:n,categoryColorScales:r,distributionData:i,globalFeatureSummary:h,selectedData:g[t],interpolator:l,distributionPlotOptions:s,categoricalNames:a,textColor:m,handleInterpolator:e.onInterpolator,onColorScalingChange:e.onColorScalingChange,onDistributionPlotOptions:p},t)}))})}}]),n}(i.a.PureComponent),_r=Object(o.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,distributionData:e.distributionData,distributionPlotOptions:e.distributionPlotOptions,distributionPlotInterpolator:e.distributionPlotInterpolator,embeddingData:e.embeddingData,globalFeatureSummary:e.globalFeatureSummary,selectedDistributionData:e.selectedDistributionData}}),(function(e){return{onDistributionPlotOptions:function(t){e(ya(t))},onInterpolator:function(t){e({type:xn,payload:t})}}}))(Fr),Lr=n(178),Ur=n(437),Br=n(504),Hr=["Homo sapiens","Mus musculus"],Jr=["Gallus gallus","Macaca fascicularis","Macaca mulatta","Rattus norvegicus"];function Wr(e){var t=e.children,n=e.value,a=e.index,i=Object(Lr.a)(e,["children","value","index"]);return Object(ge.jsx)("div",Object(vi.a)(Object(vi.a)({role:"tabpanel",hidden:n!==a,id:"editor-tabpanel-".concat(a),"aria-labelledby":"editor-tab-".concat(a)},i),{},{children:n===a&&Object(ge.jsx)(Kt.a,{children:t})}))}var Vr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.url.trim();if(""!==e&&""!==t){var n=a.state.description.trim(),i=a.state.title.trim(),r=a.state.species;a.setState({loading:!0});var o=null;null!=a.state.readers&&(o=function(e){for(var t=e.split(","),n=new Set,a=0;a<t.length;a++){var i=t[a].trim().toLowerCase();""!==i&&n.add(i)}return Array.from(n)}(a.state.readers)),a.props.handleSave({dataset:a.props.dataset,name:e,title:i,description:n,url:t,species:r,readers:o})}},a.onTabChanged=function(e,t){a.setState({tabValue:t})},a.onEmailChanged=function(e){a.setState({readers:e.target.value})},a.onUrlChanged=function(e){a.setState({url:e.target.value})},a.onSpeciesChange=function(e){a.setState({species:e.target.value})},a.onNameChanged=function(e){a.setState({name:e.target.value})},a.onDescriptionChanged=function(e){a.setState({description:e.target.value})},a.onTitleChanged=function(e){a.setState({title:e.target.value})},a.state={url:"",tabValue:0,species:null!=a.props.dataset?a.props.dataset.species:"",name:null!=a.props.dataset?a.props.dataset.name:"",title:null!=a.props.title&&null!=a.props.dataset.title?a.props.dataset.title:"",description:null!=a.props.dataset&&null!=a.props.dataset.description?a.props.dataset.description:"",readers:"",loading:null!=a.props.dataset},a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){if(null!=this.props.dataset){var e=this.props.dataset.readers;if(e){var t=e.indexOf(this.props.email);-1!==t&&e.splice(t,1),e=e.join(", ")}this.setState({species:null!=this.props.dataset.species?this.props.dataset.species:"",name:this.props.dataset.name,description:null!=this.props.dataset.description?this.props.dataset.description:"",title:null!=this.props.dataset.title?this.props.dataset.title:"",loading:!1,url:this.props.dataset.url,readers:e})}}},{key:"render",value:function(){return Object(ge.jsxs)(Vt.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-dialog-title",fullWidth:!0,maxWidth:"lg",children:[Object(ge.jsxs)(Gt.a,{id:"edit-dataset-dialog-title",children:[null==this.props.dataset?"New":"Edit"," Dataset"]}),Object(ge.jsxs)(Xt.a,{children:[this.state.loading&&Object(ge.jsx)(ci.a,{}),Object(ge.jsx)(_i.a,{disabled:this.state.loading,autoComplete:"off",required:!0,value:this.state.name,onChange:this.onNameChanged,margin:"dense",label:"Name",fullWidth:!0}),!this.state.loading&&Object(ge.jsx)(_i.a,{required:!0,autoComplete:"off",value:this.state.url,onChange:this.onUrlChanged,margin:"dense",helperText:this.props.serverInfo.email?"Please ensure that "+this.props.serverInfo.email+' has "Storage Object Viewer" permissions':"",label:"URL ("+(this.props.serverInfo.email?"gs://my_bucket/my_dataset":"/Users/foo/my_dataset")+")",fullWidth:!0}),Object(ge.jsxs)(ur.a,{className:this.props.classes.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,id:"species-label",children:"Species"}),Object(ge.jsxs)(cr.a,{labelId:"species-label",value:this.state.species,onChange:this.onSpeciesChange,children:[Hr.map((function(e){return Object(ge.jsx)(V.a,{value:e,children:e},e)})),Object(ge.jsx)(V.a,{divider:!0}),Jr.map((function(e){return Object(ge.jsx)(V.a,{value:e,children:e},e)}))]})]}),Object(ge.jsx)(_i.a,{disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.title,onChange:this.onTitleChanged,margin:"dense",label:"Title",fullWidth:!0,inputProps:{maxLength:255}}),Object(ge.jsx)("div",{children:Object(ge.jsxs)(ur.a,{children:[Object(ge.jsx)(lr.a,{children:"Summary"}),Object(ge.jsx)("div",{style:{marginTop:36}}),Object(ge.jsx)(Ur.a,{children:Object(ge.jsx)(Br.a,{href:"https://www.markdownguide.org/cheat-sheet/",target:"_blank",children:"Markdown Cheat Sheet"})})]})}),Object(ge.jsxs)(Oi.a,{value:this.state.tabValue,onChange:this.onTabChanged,"aria-label":"description-editor",children:[Object(ge.jsx)(xi.a,{label:"Write"}),Object(ge.jsx)(xi.a,{label:"Preview"})]}),Object(ge.jsx)(Wr,{value:this.state.tabValue,index:0,children:Object(ge.jsx)(_i.a,{disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.description,onChange:this.onDescriptionChanged,margin:"dense",fullWidth:!0,variant:"outlined",rows:8,rowsMax:8,multiline:!0,inputProps:{maxLength:1e3}})}),Object(ge.jsx)(Wr,{value:this.state.tabValue,index:1,children:""!==this.state.description&&Object(ge.jsx)(Kt.a,{border:1,children:Object(ge.jsx)(Ai.a,{linkTarget:"_blank",children:this.state.description})})}),!this.state.loading&&""!==this.props.serverInfo.clientId&&Object(ge.jsx)(_i.a,{value:this.state.readers,onChange:this.onEmailChanged,margin:"dense",label:"Share",helperText:"Enter comma separated list of emails",fullWidth:!0,multiline:!0})]}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(ge.jsx)(Yt.a,{disabled:this.state.loading,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(i.a.PureComponent),Gr=B()((function(e){return{formControl:{minWidth:200,marginTop:e.spacing(1)},select:{minWidth:200}}}))(Object(o.b)((function(e){return{dataset:e.dialog===$n?e.dataset:null,email:e.email,serverInfo:e.serverInfo}}),(function(e){return{handleSave:function(t){e(La(t))},handleCancel:function(t){e(Ja(null))},handleError:function(t){e(Ba(t))}}}))(Vr)),Xr=n(176),Zr=n.n(Xr),qr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handlePopoverClose=function(e){a.setState({contextmenuEl:null,anchorEl:null})},a.handleColorChange=function(e){a.setState({color:e.target.value})},a.handleNameChange=function(e){a.setState({name:e.target.value})},a.handleColorChangeApply=function(e){a.props.handleColorChange({name:a.props.name,value:a.state.categoryValue,color:a.state.color}),a.setState({forceUpdate:!a.state.forceUpdate})},a.handleNameChangeApply=function(e){a.props.handleNameChange({name:a.props.name,oldValue:a.state.categoryValue,value:a.state.name}),a.setState({name:"",contextmenuEl:null,anchorEl:null})},a.handleEditColor=function(e){a.setState((function(e,t){return{anchorEl:e.contextmenuEl,contextmenuEl:null,menu:"color"}}),(function(){}))},a.handleEditName=function(e){a.setState((function(e,t){return{anchorEl:e.contextmenuEl,contextmenuEl:null,menu:"name",name:""}}),(function(){}))},a.handleContextmenuClose=function(e){a.setState({contextmenuEl:null})},a.handleClick=function(e,t,n){a.props.clickEnabled&&(n.preventDefault(),a.props.handleClick({name:a.props.name,value:e,shiftKey:n.shiftKey,metaKey:n.ctrlKey||n.metaKey}))},a.handleContextmenu=function(e,t,n){a.props.clickEnabled&&(n.preventDefault(),n.stopPropagation(),a.setState({contextmenuEl:n.target,categoryValue:e,color:a.props.scale(e)}))},a.state={contextmenuEl:null,anchorEl:null,color:null,name:"",categoryValue:null,forceUpdate:!1,menu:null},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.scale,a=t.datasetFilter,r=t.name,o=t.featureSummary,s=t.maxHeight,l=t.globalFeatureSummary,c=t.nObs,u=t.nObsSelected,d=t.categoricalNames,h=this.props.clickEnabled,p=a[r],f=o[r],b={};if(null!=f)for(var m=0;m<f.counts.length;m++)b[f.categories[m]]=f.counts[m];var v=l[r],g=v.categories,j=d[r]||{},x=k()({insensitive:!0});g.sort((function(e,t){var n=j[e];null!=n&&(e=n);var a=j[t];return null!=a&&(t=a),x(e,t)})),h=h&&g.length>1;var O={maxHeight:s,display:"inline-block"};this.props.style&&(O=Object.assign({},O,this.props.style));var y=j[this.state.categoryValue]||this.state.categoryValue;return Object(ge.jsxs)("div",{className:"cirro-chart-legend",style:O,children:[Object(ge.jsxs)(Vt.a,{open:Boolean(this.state.anchorEl),onClose:this.handlePopoverClose,"aria-labelledby":"edit-category-dialog-title",children:[Boolean(this.state.anchorEl)&&"color"==this.state.menu&&Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)(Gt.a,{id:"edit-category-dialog-title",children:["Edit ",y," Color"]}),Object(ge.jsx)(Xt.a,{children:Object(ge.jsx)("input",{type:"color",value:this.state.color,onChange:this.handleColorChange,style:{width:100}})}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{onClick:this.handlePopoverClose,color:"primary",children:"Close"}),Object(ge.jsx)(Yt.a,{onClick:this.handleColorChangeApply,color:"primary",children:"Apply"})]})]}),Boolean(this.state.anchorEl)&&"name"==this.state.menu&&Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)(Gt.a,{id:"edit-category-dialog-title",children:["Edit ",y," Name"]}),Object(ge.jsx)(Xt.a,{children:Object(ge.jsx)(_i.a,{type:"text",onChange:this.handleNameChange,value:this.state.name})}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{onClick:this.handlePopoverClose,color:"primary",children:"Cancel"}),Object(ge.jsx)(Yt.a,{onClick:this.handleNameChangeApply,color:"primary",children:"OK"})]})]})]}),Object(ge.jsxs)(W.a,{anchorEl:this.state.contextmenuEl,open:Boolean(this.state.contextmenuEl),onClose:this.handleContextmenuClose,children:[Object(ge.jsx)(V.a,{onClick:this.handleEditName,children:"Edit Name"}),Object(ge.jsx)(V.a,{onClick:this.handleEditColor,children:"Edit Color"})]}),Object(ge.jsxs)("table",{style:{textAlign:"left"},children:[Object(ge.jsx)("thead",{children:Object(ge.jsxs)("tr",{children:[h&&Object(ge.jsx)("td",{}),Object(ge.jsx)("td",{}),Object(ge.jsx)("td",{children:Object(ge.jsx)("small",{children:"all"})}),Object(ge.jsx)("td",{children:Object(ge.jsx)("small",{children:null!=f?"selection":null})})]})}),Object(ge.jsx)("tbody",{children:g.map((function(t,a){var i=null==p||-1!==p.value.indexOf(t)?1:.4,r=v.counts[a],o=b[t]||0,s=null==f?0:o/u,l=Ce(100*r/c)+"%",d=t,m=j[t];void 0!==m&&(d=m);var g=null==f?null:Ce(100*s)+"%";return Object(ge.jsxs)("tr",{style:{cursor:h?"pointer":null,opacity:i},onContextMenu:function(n){return e.handleContextmenu(t,a,n)},onClick:function(n){return e.handleClick(t,a,n)},children:[h&&Object(ge.jsx)("td",{children:Object(ge.jsx)("div",{style:{display:"inline-block",width:10,height:10,background:n(t)}})}),Object(ge.jsxs)("td",{children:[Object(ge.jsx)("div",{style:{maxWidth:140,textOverflow:"ellipsis",overflow:"hidden",display:"inline-block",userSelect:"none"},title:""+d,children:""+d}),Object(ge.jsx)(J.a,{style:{padding:0,fontSize:14},size:"small",onClick:function(n){return e.handleContextmenu(t,a,n)},"aria-label":"Menu","aria-haspopup":"true",children:Object(ge.jsx)(Zr.a,{fontSize:"inherit"})})]}),Object(ge.jsx)("td",{children:Object(ge.jsx)(H.a,{title:l,children:Object(ge.jsx)("span",{children:ke(r)})})}),f&&Object(ge.jsx)("td",{children:Object(ge.jsx)(H.a,{title:g,children:Object(ge.jsx)("div",{children:ke(o)})})})]},t)}))})]})]})}}]),n}(i.a.PureComponent),Kr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(j.a)(this,n),t.apply(this,arguments)}return Object(E.a)(n,[{key:"getTable",value:function(e,t,n){return Object(ge.jsxs)("table",{children:[Object(ge.jsx)("thead",{children:Object(ge.jsxs)("tr",{children:[Object(ge.jsx)("td",{}),e.map((function(e){return Object(ge.jsx)("td",{children:Object(ge.jsx)("small",{children:e})},e)}))]})}),Object(ge.jsxs)("tbody",{children:[Object(ge.jsxs)("tr",{children:[Object(ge.jsxs)("td",{style:{textAlign:"right"},children:["Mean",":"]}),Object(ge.jsx)("td",{children:ut(Ce(n.mean))}),t&&Object(ge.jsx)("td",{children:ut(Ce(t.mean))})]}),null!=n.numExpressed&&Object(ge.jsxs)("tr",{children:[Object(ge.jsxs)("td",{style:{textAlign:"right"},children:["% Expressed",":"]}),Object(ge.jsx)("td",{children:Ee(100*n.numExpressed/this.props.nObs)}),t&&Object(ge.jsx)("td",{children:Ee(100*t.numExpressed/this.props.nObsSelected)})]}),(null==n.numExpressed||0!==n.min)&&Object(ge.jsxs)("tr",{children:[Object(ge.jsxs)("td",{style:{textAlign:"right"},children:["Min",":"]}),Object(ge.jsx)("td",{children:ut(Ce(n.min))}),t&&Object(ge.jsx)("td",{children:ut(Ce(t.min))})]}),Object(ge.jsxs)("tr",{children:[Object(ge.jsxs)("td",{style:{textAlign:"right"},children:["Max",":"]}),Object(ge.jsx)("td",{children:ut(Ce(n.max))}),t&&Object(ge.jsx)("td",{children:ut(Ce(t.max))})]})]})]})}},{key:"render",value:function(){var e=this.props,t=e.name,n=e.featureSummary,a=e.globalFeatureSummary,r=n[t],o=a[t],s=["all"];return null!=r&&s.push("selection"),Object(ge.jsx)(i.a.Fragment,{children:null!=o&&"__count"!==t&&this.getTable(s,r,o)})}}]),n}(i.a.PureComponent),Yr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleValueUpdate=function(){var e=a.getFilter(),t=parseFloat(e.uiValue);a.props.handleUpdate({name:a.props.name,value:t,update:!0})},a.handleOperationChanged=function(e){var t=e.target.value;a.props.handleUpdate({name:a.props.name,operation:t,update:!0})},a.handleValueChange=function(e){var t=a.getFilter();t.uiValue=e.target.value,a.props.handleUpdate({name:a.props.name,operation:t.operation,value:t.value,update:!1}),a.handleValueUpdate()},a.handleValueUpdate=Object(f.debounce)(a.handleValueUpdate,500),a}return Object(E.a)(n,[{key:"getFilter",value:function(){var e=this.props.datasetFilter[this.props.name];return null==e&&(e={operation:">",value:NaN,uiValue:""},this.props.datasetFilter[this.props.name]=e),e}},{key:"render",value:function(){var e=this.props.name,t=this.getFilter(),n=e+"_filter";return Object(ge.jsxs)("div",{style:{display:"flex"},children:[Object(ge.jsx)(lr.a,{shrink:!0,id:n+"_label",children:"Filter"}),Object(ge.jsxs)(cr.a,{labelId:n+"_label",id:n,style:{marginRight:6},value:t.operation,onChange:this.handleOperationChanged,children:[Object(ge.jsx)(V.a,{value:""}),Object(ge.jsx)(V.a,{value:">",children:">"}),Object(ge.jsx)(V.a,{value:"<",children:"<"}),Object(ge.jsx)(V.a,{value:"=",children:"="}),Object(ge.jsx)(V.a,{value:">=",children:">="}),Object(ge.jsx)(V.a,{value:"<=",children:"<="}),Object(ge.jsx)(V.a,{value:"!=",children:"!="})]}),Object(ge.jsx)(_i.a,{onChange:this.handleValueChange,value:t.uiValue,style:{maxWidth:60}})]})}}]),n}(i.a.PureComponent),$r=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.setState({min:e.target.value}),a.onMinUpdate(parseFloat(e.target.value))},a.onMinUpdate=function(e){isNaN(e)?delete a.props.globalFeatureSummary[a.props.name].customMin:a.props.globalFeatureSummary[a.props.name].customMin=e,a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})},a.onMaxChange=function(e){a.setState({max:e.target.value}),a.onMaxUpdate(parseFloat(e.target.value))},a.onMaxUpdate=function(e){isNaN(e)?delete a.props.globalFeatureSummary[a.props.name].customMax:a.props.globalFeatureSummary[a.props.name].customMax=e,a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})},a.state={min:"",max:""},a.onMinUpdate=Object(f.debounce)(a.onMinUpdate,500),a.onMaxUpdate=Object(f.debounce)(a.onMaxUpdate,500),a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.name!==this.props.name&&this.setState({min:"",max:""})}},{key:"render",value:function(){var e=this.props,t=e.colorScale,n=e.datasetFilter,a=e.featureSummary,i=e.globalFeatureSummary,r=e.handleUpdate,o=e.maxHeight,s=e.name,l=e.nObs,c=e.nObsSelected,u=e.selected,d={display:"inline-block",verticalAlign:"top"};this.props.style&&(d=Object.assign({},d,this.props.style));var h="__count"===s;return Object(ge.jsxs)("div",{className:"cirro-condensed",style:d,children:[Object(ge.jsx)(Kr,{name:s,selected:u,summary:t.summary,featureSummary:a,nObs:l,nObsSelected:c,globalFeatureSummary:i,maxHeight:o}),!h&&Object(ge.jsx)(Yr,{datasetFilter:n,name:s,handleUpdate:r})]})}}]),n}(i.a.PureComponent),Qr=function(){function e(t,n){var a=this;Object(j.a)(this,e),this._viewer=t,this.backingScale=1,this._containerWidth=0,this._containerHeight=0,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.width="100%",this._canvas.style.height="100%",this._viewer.canvas.appendChild(this._canvas),this.onRedraw=n.onRedraw||function(){},this.clearBeforeRedraw="undefined"===typeof n.clearBeforeRedraw||n.clearBeforeRedraw,this._viewer.addHandler("update-viewport",(function(){a.resize(),a._updateCanvas()})),this._viewer.addHandler("open",(function(){a.resize(),a._updateCanvas()}))}return Object(E.a)(e,[{key:"canvas",value:function(){return this._canvas}},{key:"context2d",value:function(){return this._canvas.getContext("2d")}},{key:"clear",value:function(){this._canvas.getContext("2d").clearRect(0,0,this._containerWidth*this.backingScale,this._containerHeight*this.backingScale)}},{key:"resize",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio);var t=this.backingScale!==e;this.backingScale=e,(this._containerWidth!==this._viewer.container.clientWidth||t)&&(this._containerWidth=this._viewer.container.clientWidth,this._canvas.setAttribute("width",e*this._containerWidth),this._canvas.setAttribute("width",e*this._containerWidth)),(this._containerHeight!==this._viewer.container.clientHeight||t)&&(this._containerHeight=this._viewer.container.clientHeight,this._canvas.setAttribute("height",e*this._containerHeight),this._canvas.setAttribute("height",e*this._containerHeight))}},{key:"_updateCanvas",value:function(){var e=this._viewer.viewport.getZoom(!0);this.clearBeforeRedraw&&this.clear();for(var t=this._canvas.getContext("2d"),n=0,a=this._viewer.world.getItemCount();n<a;n++){var i=this._viewer.world.getItemAt(n);if(i){var r=i.viewportToImageZoom(e),o=i.imageToViewportCoordinates(0,0,!0),s=this._viewer.viewport.pixelFromPoint(o,!0);t.scale(this.backingScale,this.backingScale),t.translate(s.x,s.y),t.scale(r,r),this.onRedraw({index:n,context:t,x:s.x,y:s.y,zoom:r}),t.setTransform(1,0,0,1,0,0)}}}}],[{key:"getTileIndexFromPixel",value:function(e,t){for(var n=e.viewport.pointFromPixel(t),a=0,i=e.world.getItemCount();a<i;a++){var r=e.world.getItemAt(a),o=new window.OpenSeadragon.Rect(n.x,n.y,0,0),s=r._viewportToTiledImageRectangle(o).getTopLeft(),l=r.source;if(s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/l.aspectRatio)return a}return-1}}]),e}(),eo="http://www.w3.org/2000/svg",to=function(){function e(t){Object(j.a)(this,e);var n=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(eo,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(eo,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("update-viewport",(function(){n.resize()})),this._viewer.addHandler("open",(function(){n.resize()})),this._viewer.addHandler("rotate",(function(e){n.resize()})),this._viewer.addHandler("resize",(function(){n.resize()})),this.resize()}return Object(E.a)(e,[{key:"node",value:function(){return this._node}},{key:"resize",value:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));var e=this._viewer.viewport.pixelFromPoint(new m.a.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0);this._viewer.world.getItemCount()>0&&(t=this._viewer.world.getItemAt(0).viewportToImageZoom(t));var n=this._viewer.viewport.getRotation();this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+t+") rotate("+n+")")}}]),e}();function no(e,t){return t*(e.embedding.spatial.spot_diameter?e.embedding.spatial.spot_diameter/2:20)}function ao(e,t,n,a,i,r,o){if(r.length>0){e.textAlign="center",e.textBaseline="middle";var s=Math.ceil(a.labelFontSize/t);e.fillStyle="white",e.strokeStyle="rgba(0,0,0,0.9)",e.lineWidth=a.labelStrokeWidth,e.font=s+"px Roboto Condensed,Helvetica,Arial,sans-serif";for(var l=Ve(n.embedding,r,o),c=Xe(r,l.labels,i),u=0,d=0,h=c.length;u<h;u++,d+=3){var p=l.positions[d],f=l.positions[d+1];e.strokeText(""+c[u],p,f),e.fillText(""+c[u],p,f)}}}function io(e,t,n,a,i,r,o){e.lineWidth=2/t,e.setLineDash&&e.setLineDash([2,2]);var s=0===a.size,l=n.indices;if(s){e.globalAlpha=i;for(var c=0;c<n.x.length;c++){var u=l[c],d=n.x[u],h=n.y[u];e.fillStyle=n.colors[u],e.beginPath(),e.arc(d,h,o,0,2*Math.PI,!0),e.fill()}}else{e.globalAlpha=r;for(var p=0;p<n.x.length;p++){var f=l[p],b=n.x[f],m=n.y[f];a.has(f)||(e.fillStyle=n.colors[f],e.beginPath(),e.arc(b,m,o,0,2*Math.PI,!0),e.fill())}e.globalAlpha=i;for(var v=0;v<n.x.length;v++){var g=l[v],j=n.x[g],x=n.y[g];a.has(g)&&(e.fillStyle=n.colors[g],e.beginPath(),e.arc(j,x,o,0,2*Math.PI,!0),e.fill())}}e.globalAlpha=1,e.setLineDash&&e.setLineDash([])}var ro=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t=a.props.traceInfo,n=a.viewer.source.levels[a.viewer.source.levels.length-1].context2D.canvas;Ae(t,{width:n.width,height:n.height},Object(f.bind)(a.drawContext,Object(_.a)(a)),e)},a.onZoomIn=function(){a.viewer.viewport.zoomBy(a.viewer.zoomPerClick/1),a.viewer.viewport.applyConstraints()},a.onZoomOut=function(){a.viewer.viewport.zoomBy(1/a.viewer.zoomPerClick),a.viewer.viewport.applyConstraints()},a.onHome=function(){a.viewer.viewport.goHome(),a.viewer.viewport.applyConstraints()},a.onDragMode=function(e){a.props.chartOptions.dragmode=e,a.props.setChartOptions(a.props.chartOptions)},a.id=Object(f.uniqueId)("cirro-image"),a.editSelection=!1,a.tooltipElementRef=i.a.createRef(),a.state={loading:!1},a}return Object(E.a)(n,[{key:"findPointsInPolygon",value:function(e){for(var t=this.props.traceInfo,n=[],a=0;a<t.x.length;a++)bt({x:t.x[a],y:t.y[a]},e)&&n.push(a);return n}},{key:"findPointsInRectangle",value:function(e){for(var t=this.props.traceInfo,n=no(t,this.props.pointSize),a=[],i=parseFloat(e.getAttribute("x")),r=parseFloat(e.getAttribute("y")),o=i+parseFloat(e.getAttribute("width")),s=r+parseFloat(e.getAttribute("height")),l=0;l<t.x.length;l++){var c=t.x[l],u=t.y[l];c<=o&&i<=c+n&&u<=s&&r<=u+n&&a.push(l)}return a}},{key:"findPointIndex",value:function(e,t){for(var n=this.props.traceInfo,a=no(n,this.props.pointSize),i=0;i<n.x.length;i++)if(Math.abs(n.x[i]-e)<=a&&Math.abs(n.y[i]-t)<=a)return i;return-1}},{key:"setTooltip",value:function(e,t){var n=this.props.traceInfo,a=this.findPointIndex(e,t);if(-1!=a){var i=n.values[a],r=this.props.categoricalNames[n.name];if(r){var o=r[i];null!=o&&(i=o)}"number"===typeof i&&(i=we(i)).endsWith(".00")&&(i=i.substring(0,i.lastIndexOf("."))),this.tooltipElementRef.current.innerHTML=""+i}else this.tooltipElementRef.current.innerHTML=" "}},{key:"drawContext",value:function(e,t){var n=this.viewer.source.levels[this.viewer.source.levels.length-1].context2D.canvas;null==t&&(t={width:n.width,height:n.height});var a=Math.min(t.width/n.width,t.height/n.height);e.drawImage(n,0,0,n.width*a,n.height*a),this._drawOverlay({context:e,zoom:a})}},{key:"_drawOverlay",value:function(e){var t=e.context,n=this.props.traceInfo,a=this.props.selection,i=this.props.markerOpacity,r=this.props.unselectedMarkerOpacity,o=no(n,this.props.pointSize);io(t,e.zoom,n,a,i,r,o),ao(t,e.zoom,n,this.props.chartOptions,this.props.categoricalNames,this.props.obsCat,this.props.cachedData)}},{key:"createViewer",value:function(){var e=this;this.viewer&&this.viewer.destroy(),this.props.traceInfo.tileSource.ready?this.setState({loading:!1}):(this.setState({loading:!0}),this.props.traceInfo.tileSource.addOnceHandler("ready",(function(t){e.setState({loading:!1})}))),this.viewer=new m.a({id:this.id,gestureSettingsMouse:{dblClickToZoom:!0,clickToZoom:!1},autoResize:!0,showFullPageControl:!1,collectionMode:!1,showNavigationControl:!1,tileSources:this.props.traceInfo.tileSource});var t=this.viewer,n=this;this.canvasOverlay=new Qr(this.viewer,{onRedraw:function(e){n._drawOverlay(e)}});var a=[],i=[0,0],r={x:0,y:0,width:0,height:0};this.viewer.innerTracker.moveHandler=function(e){if(null==n.tooltipElementRef.current)n.tooltipElementRef.current.innerHTML=" ";else if("pan"===n.props.chartOptions.dragmode&&t.world.getItemCount()>0){var a=e.position,i=t.viewport.pointFromPixel(a),r=t.world.getItemAt(0).viewportToImageCoordinates(i,!0);n.setTooltip(r.x,r.y)}else n.tooltipElementRef.current.innerHTML=" "},this.viewer.addHandler("canvas-drag",(function(e){if(("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode)&&t.world.getItemCount()>0){e.preventDefaultAction=!0;var o=e.position,c=t.viewport.pointFromPixel(o),u=t.world.getItemAt(0).viewportToImageCoordinates(c,!0);a.push({x:u.x,y:u.y}),"lasso"===n.props.chartOptions.dragmode?(a=N()(a),s.setAttribute("d",mt(a))):(r.x=Math.min(u.x,i[0]),r.y=Math.max(u.y,i[1]),r.width=Math.max(u.x,i[0])-r.x,r.height=r.y-Math.min(u.y,i[1]),l.setAttribute("x",""+r.x),l.setAttribute("y",""+(r.y-r.height)),l.setAttribute("width",""+r.width),l.setAttribute("height",""+r.height))}})),this.viewer.addHandler("canvas-press",(function(e){if("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0,n.editSelection=e.metaKey||e.ctrlKey;var o=e.position,l=t.viewport.pointFromPixel(o),c=t.world.getItemAt(0).viewportToImageCoordinates(l,!0);"lasso"===n.props.chartOptions.dragmode?((a=[]).push({x:c.x,y:c.y}),a=N()(a),s.setAttribute("d",mt(a))):(i=[c.x,c.y],r={x:i[0],y:i[1],width:1,height:1})}})),this.viewer.addHandler("canvas-release",(function(e){if("lasso"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var t=new Set(n.findPointsInPolygon(a));a=[],s.setAttribute("d",""),n.props.onSelected({name:ma(n.props.traceInfo.embedding),clear:!n.editSelection,value:{basis:n.props.traceInfo.embedding,indices:t}})}else if("select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var i=new Set(n.findPointsInRectangle(l));l.removeAttribute("x"),l.removeAttribute("y"),l.removeAttribute("width"),l.removeAttribute("height"),n.props.onSelected({name:ma(n.props.traceInfo.embedding),clear:!n.editSelection,value:{basis:n.props.traceInfo.embedding,indices:i}})}})),t.addHandler("canvas-exit",(function(e){n.tooltipElementRef.current&&(n.tooltipElementRef.current.innerHTML=" ")}));var o=new to(t),s=document.createElementNS("http://www.w3.org/2000/svg","path"),l=document.createElementNS("http://www.w3.org/2000/svg","rect");[s,l].forEach((function(e){e.setAttribute("stroke","black"),e.setAttribute("stroke-width","3px"),e.setAttribute("fill","#0bb"),e.setAttribute("fill-opacity","0.3"),e.setAttribute("stroke-dasharray","2 2"),o.node().appendChild(e)}))}},{key:"componentDidUpdate",value:function(e,t,n){this.canvasOverlay&&this.canvasOverlay._updateCanvas()}},{key:"componentWillUnmount",value:function(){this.viewer&&this.viewer.destroy(),this.viewer=null}},{key:"componentDidMount",value:function(){null==this.viewer&&this.createViewer(this.props.traceInfo.url)}},{key:"render",value:function(){return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)("div",{className:this.props.classes.root,children:[Object(ge.jsx)(xe,{dragmode:this.props.chartOptions.dragmode,onGallery:this.props.onGallery,animating:!1,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,is3d:!1,onHome:this.onHome,onSaveImage:this.onSaveImage,onDragMode:this.onDragMode}),Object(ge.jsx)(L.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(ge.jsx)("div",{style:{display:"inline-block",width:this.props.chartSize.width,height:this.props.chartSize.height},id:this.id}),this.state.loading&&Object(ge.jsx)(ci.a,{style:{position:"absolute",left:this.props.chartSize.width/2,top:this.props.chartSize.height/2},size:20})]})}}]),n}(i.a.PureComponent),oo=B()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},position:"absolute",zIndex:1,top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(ro),so=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleToggleLegend=function(e){e.preventDefault(),a.setState({showDetails:!a.state.showDetails})},a.state={showDetails:!0},a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.traceInfo.name!==this.props.traceInfo.name&&this.setState({showDetails:!0})}},{key:"render",value:function(){var e=this.props,t=e.cachedData,n=e.categoricalNames,a=e.chartOptions,i=e.dataset,r=e.datasetFilter,o=e.embeddingLabels,s=e.featureSummary,l=e.globalFeatureSummary,c=e.markerOpacity,u=e.onChartOptions,d=e.onColorChange,h=e.onDimensionFilterUpdated,p=e.onDomain,f=e.onGallery,b=e.onMeasureFilterUpdated,m=e.onNameChange,v=e.onSelect,g=e.pointSize,j=e.primaryChartSize,x=e.searchTokens,O=e.selection,y=e.shape,S=e.traceInfo,C=e.unselectedMarkerOpacity,w=O.size,k=yt(x).obsCat.filter((function(e){return-1!==o.indexOf(e)})),E="__count"===S.name?"":S.name;return Object(ge.jsxs)("div",{style:{position:"relative"},children:[Object(ge.jsxs)(Kt.a,{color:"text.primary",style:{marginTop:3.2,position:"absolute",textAlign:"right",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:300,right:8,zIndex:1e3},children:[""!==E&&Object(ge.jsx)(H.a,{title:"Embedding: "+S.embedding.name,children:Object(ge.jsx)(Br.a,{onClick:this.handleToggleLegend,children:Object(ge.jsx)(L.a,{color:"textPrimary",style:{marginRight:14},component:"h4",children:E})})}),S.continuous?Object(ge.jsx)($r,{handleDomain:p,width:140,showColorScheme:!1,height:30,style:{display:this.state.showDetails?"block":"none"},handleUpdate:b,datasetFilter:r,colorScale:S.colorScale,featureSummary:s,globalFeatureSummary:l,nObs:y[0],nObsSelected:w,maxHeight:null,name:S.name},S.name):Object(ge.jsx)(qr,{style:{display:this.state.showDetails?"block":"none"},datasetFilter:r,handleClick:h,handleColorChange:d,handleNameChange:m,categoricalNames:n,name:S.name,scale:S.colorScale,maxHeight:300,clickEnabled:!0,nObs:y[0],nObsSelected:w,globalFeatureSummary:l,featureSummary:s},S.name)]}),"scatter"===S.type&&Object(ge.jsx)(_e,{traceInfo:S,cachedData:t,obsCat:k,chartSize:j,setChartOptions:u,chartOptions:a,categoricalNames:n,selection:O,onSelected:v,pointSize:g,markerOpacity:c,unselectedMarkerOpacity:C,color:S.colors,onGallery:f}),S.type===rt&&Object(ge.jsx)(pn,{traceInfo:S,cachedData:t,chartSize:j,setChartOptions:u,chartOptions:a,dataset:i,selection:O,categoricalNames:n,markerOpacity:c,onGallery:f,onSelected:v}),"image"===S.type&&Object(ge.jsx)(oo,{cachedData:t,obsCat:k,setChartOptions:u,chartOptions:a,style:{display:"inline-block"},traceInfo:S,pointSize:g,chartSize:j,categoricalNames:n,selection:O,onInitialized:this.onInitialized,markerOpacity:c,unselectedMarkerOpacity:C,onSelected:v,onGallery:f})]})}}]),n}(i.a.PureComponent),lo=Object(o.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,dataset:e.dataset,datasetFilter:e.datasetFilter,embeddingChartSize:e.embeddingChartSize,embeddingLabels:e.embeddingLabels,featureSummary:e.featureSummary,globalFeatureSummary:e.globalFeatureSummary,markerOpacity:e.markerOpacity,selection:e.selection,pointSize:e.pointSize,primaryChartSize:e.primaryChartSize,shape:e.dataset.shape,searchTokens:e.searchTokens,unselectedMarkerOpacity:e.unselectedMarkerOpacity}}),(function(e){return{onChartOptions:function(t){e(Sa(t))},onDomain:function(t){e(Ia(t))},onDimensionFilterUpdated:function(t){var n;e((n=t,function(e,t){for(var a,i=n.name,r=n.value,o=n.shiftKey,s=n.metaKey,l=t().datasetFilter,c=t().embeddingData,u=0;u<c.length;u++)if(c[u].name===i){a=c[u].colorScale.domain();break}var d=l[i];if(null==d&&(d={operation:"in",value:[]},l[i]=d),o&&d.value.length>0){var h=a.indexOf(d.value[d.value.length-1]),p=a.indexOf(r);if(p>h)for(var f=h;f<=p;f++){var b=d.value.indexOf(r);-1!==b&&d.value.splice(b,1),d.value.push(a[f])}else for(var m=h;m>=p;m--){var v=d.value.indexOf(r);-1!==v&&d.value.splice(v,1),d.value.push(a[m])}}else{var g=d.value.indexOf(r);s||(d.value=[]),-1!==g?(d.value.splice(g,1),0===d.value.length&&delete l[i]):d.value.push(r)}e(ka(l)),e(za())}))},onColorChange:function(t){e({type:Nn,payload:t})},onNameChange:function(t){var n;e((n=t,function(e,t){var a=t().dataset.id;(t().serverInfo.dynamic?t().serverInfo.api.setCategoryNamePromise({c:n.name,o:n.oldValue,n:n.value,id:a}):Promise.resolve()).then((function(){return e(Da(n))}))}))},onMeasureFilterUpdated:function(t){var n;e((n=t,function(e,t){var a=n.name,i=n.operation,r=n.value,o=n.update,s=t().datasetFilter,l=s[a];null==l&&(l={operation:">",value:NaN},s[a]=l),o&&(null!=r&&(o=isNaN(r)?isNaN(r)!==isNaN(l.value):r!==l.value),null!=i&&(o=o||i!==l.operation&&!isNaN(l.value))),null!=i&&(l.operation=i),null!=r&&(l.value=r),e(ka(Object.assign({},s))),o&&e(za())}))},onSelect:function(t){var n;e((n=t,function(e,t){var a=n.name,i=n.value,r=n.clear,o=null!=n.value?n.value.indices:null,s=t().datasetFilter;function l(){if(r)for(var e in s){var t=s[e];Array.isArray(t)&&delete s[e]}}var c=!0;if(null==i||0===o.size)c=null!=s[a],delete s[a],l();else{var u=s[a],d=!1;if(null!=u){var h=null!=i.id?Object(f.findIndex)(u,(function(e){return e.id===i.id})):-1;-1!==h&&(d=!0,u.splice(h,1))}d||(l(),null==(u=s[a])&&(u=[],s[a]=u),u.push({basis:i.basis,indices:o,id:i.id}))}c&&(e(ka(Object.assign({},s))),e(za()))}))}}}))(so),co=(new Set,function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).resizeListener=function(){var e=window.innerWidth-280,t=Math.max(300,window.innerHeight-410);a.props.handlePrimaryChartSize({width:e,height:t})},window.addEventListener("resize",a.resizeListener),a}return Object(E.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeListener)}},{key:"render",value:function(){var e=this.props,t=e.activeFeature,n=e.embeddingData,a=e.onGallery,i=e.primaryChartSize;if(null==t)return Object(ge.jsx)("div",{style:{height:i.height}});var r=Object(f.find)(n,(function(e){return va(e)===t.embeddingKey}));return null==r?Object(ge.jsx)("div",{style:{height:i.height}}):Object(ge.jsx)(lo,{onGallery:a,traceInfo:r})}}]),n}(i.a.PureComponent)),uo=Object(o.b)((function(e){return{activeFeature:e.activeFeature,embeddingData:e.embeddingData,primaryChartSize:e.primaryChartSize}}),(function(e){return{handlePrimaryChartSize:function(t){e({type:kn,payload:t})}}}))(co),ho=n(276),po=n.n(ho),fo=n(201),bo=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onSelect=function(e){e.preventDefault(),a.props.onSelect(a.props.traceInfo)},a.state={url:null,overlayUrl:null,loading:!1,forceUpdate:!1},a.elementRef=i.a.createRef(),a}return Object(E.a)(n,[{key:"draw",value:function(){var e=this,t=this.props,n=t.cachedData,a=t.categoricalNames,i=t.chartOptions,r=t.chartSize,o=t.containerElement,s=t.markerOpacity,l=t.obsCat,c=t.pointSize,u=t.scatterPlot,d=t.selection,h=t.traceInfo,p=t.unselectedMarkerOpacity;if("scatter"===h.type){Re(u,Le).zoomFactor=this.zoomFactor,Ge(u,h,d,s,p,c,a,i,l,n);var f=o.querySelector("canvas"),b=null;if(l.length>0&&i.showGalleryLabels){var m=Ve(h.embedding,l,n),v=document.createElement("canvas");v.width=r*window.devicePixelRatio,v.height=r*window.devicePixelRatio;var g=v.getContext("2d");g.scale(window.devicePixelRatio,window.devicePixelRatio),g.font="bold "+i.labelFontSize+"px Roboto Condensed",Ne(g,Xe(l,m.labels,a),m.positions,i,{width:r,height:r},u.camera),b=v.toDataURL()}this.setState({url:f.toDataURL(),overlayUrl:b,loading:!1,element:null})}else if("image"===h.type)if(h.tileSource.ready){var j=document.createElement("canvas");j.width=r*window.devicePixelRatio,j.height=r*window.devicePixelRatio;var x=j.getContext("2d");x.scale(window.devicePixelRatio,window.devicePixelRatio),function(e,t,n,a,i,r,o,s,l,c,u){if(n.tileSource.ready){var d=n.tileSource.levels[n.tileSource.levels.length-1].context2D.canvas;null==t&&(t={width:d.width,height:d.height});var h=Math.min(t.width/d.width,t.height/d.height);e.drawImage(d,0,0,d.width*h,d.height*h),e.scale(h,h),io(e,h,n,a,i,r,u),ao(e,h,n,o,s,l,c),e.setTransform(1,0,0,1,0,0)}}(x,{width:r,height:r},h,d,s,p,i,a,l,n,no(h,c)),this.setState({url:j.toDataURL(),overlayUrl:null,loading:!1,element:null}),j=null}else this.setState({url:null,overlayUrl:null,loading:!0,element:null}),h.tileSource.addOnceHandler("ready",(function(){e.setState({loading:!1})}));else{var O=this.elementRef.current;O.innerHTML="";var y=h.gallerySource;y.setAttribute("width",r),y.setAttribute("height",r),O.append(y),this.setState({url:null,overlayUrl:null,loading:!1})}}},{key:"componentDidMount",value:function(){this.zoomFactor=He(this.props.primaryChartSize),this.draw()}},{key:"componentDidUpdate",value:function(e,t){e.primaryChartSize!==this.props.primaryChartSize&&(this.zoomFactor=He(this.props.primaryChartSize)),this.draw()}},{key:"render",value:function(){var e=this.props.traceInfo.name;return"__count"===e&&(e=""),Object(ge.jsx)(Kt.a,{borderColor:"text.primary",border:1,style:{display:"inline-block",margin:2},children:Object(ge.jsxs)("div",{style:{position:"relative",width:this.props.chartSize,height:this.props.chartSize,cursor:"pointer"},children:[Object(ge.jsx)(H.a,{title:"Embedding: "+this.props.traceInfo.embedding.name,children:Object(ge.jsx)(L.a,{color:"textPrimary",component:"h4",onClick:this.onSelect,style:{marginTop:3.2,position:"absolute",right:4,zIndex:1e3},children:e})}),this.state.loading&&Object(ge.jsx)(ci.a,{style:{position:"absolute",left:this.props.chartSize/2,top:this.props.chartSize/2},size:20}),Object(ge.jsx)("div",{onClick:this.onSelect,ref:this.elementRef,style:{position:"absolute",left:0,top:0}}),this.state.url&&Object(ge.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(ge.jsx)("img",{alt:"",src:this.state.url,width:this.props.chartSize*window.devicePixelRatio,height:this.props.chartSize*window.devicePixelRatio,onClick:this.onSelect,style:{width:this.props.chartSize,height:this.props.chartSize}})}),this.state.overlayUrl&&Object(ge.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(ge.jsx)("img",{alt:"",src:this.state.overlayUrl,onClick:this.onSelect,style:{width:this.props.chartSize,height:this.props.chartSize}})})]})})}}]),n}(i.a.PureComponent);function mo(e){var t=document.createElement("div");return t.style.position="absolute",t.style.left="-9999px",t.style.width=e+"px",t.style.height=e+"px",t}var vo=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onChartSelected=function(e){a.props.handleActiveFeature({name:e.name,type:e.featureType,embeddingKey:va(e)}),window.scrollTo(0,0)},a.onSortEnd=function(e,t){e[t.oldIndex].sortIndex=t.newIndex,e[t.newIndex].sortIndex=t.oldIndex,a.props.handleEmbeddingData(a.props.embeddingData.slice())},a.containerElement=mo(a.props.chartSize),document.body.appendChild(a.containerElement),a.scatterPlot=Je(a.containerElement,null!=window.ApplePaySession,!1,!1),a.emptySet=new Set,a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.cachedData,a=t.categoricalNames,r=t.chartSize,o=t.chartOptions,s=t.embeddingData,l=t.embeddingLabels,c=t.markerOpacity,u=t.pointSize,d=t.primaryChartSize,h=t.searchTokens,p=t.selection,f=t.unselectedMarkerOpacity;this.containerElement.style.width!==this.props.chartSize+"px"&&(document.body.removeChild(this.containerElement),this.containerElement=mo(this.props.chartSize),document.body.appendChild(this.containerElement),this.scatterPlot=Je(this.containerElement,window.ApplePaySession,!1,!1));var b=s.filter((function(e){return e.active})),m=yt(h).obsCat.filter((function(e){return-1!==l.indexOf(e)})),v=Object(fo.b)((function(t){var i=t.traceInfo;return Object(ge.jsx)(bo,{traceInfo:i,obsCat:m,cachedData:n,scatterPlot:e.scatterPlot,markerOpacity:c,chartOptions:o,pointSize:u,chartSize:r,categoricalNames:a,primaryChartSize:d,unselectedMarkerOpacity:f,selection:p,containerElement:e.containerElement,onSelect:e.onChartSelected},va(i))})),g=Object(fo.a)((function(e){var t=e.items;return Object(ge.jsx)("ul",{style:{padding:0},children:t.map((function(e,t){return Object(ge.jsx)(v,{index:t,traceInfo:e},va(e))}))})}));return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)(L.a,{color:"textSecondary",variant:"subtitle1",children:["Gallery",Object(ge.jsx)(H.a,{title:"Drag gallery charts to reorder. Click chart to set primary view.",children:Object(ge.jsx)(po.a,{style:{verticalAlign:"text-bottom"}})})]}),Object(ge.jsx)(g,{distance:2,axis:"xy",items:b,onSortEnd:function(t){return e.onSortEnd(b,t)}})]})}}]),n}(i.a.PureComponent),go=Object(o.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,chartSize:e.chartSize,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,markerOpacity:e.markerOpacity,pointSize:e.pointSize,primaryChartSize:e.primaryChartSize,searchTokens:e.searchTokens,selection:e.selection,unselectedMarkerOpacity:e.unselectedMarkerOpacity}}),(function(e){return{handleActiveFeature:function(t){e(wa(t))},handleEmbeddingData:function(t){e(Ha(t))}}}))(vo),jo=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleClose()},a.state={open:!0},a}return Object(E.a)(n,[{key:"render",value:function(){return Object(ge.jsx)(Vt.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"help-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:Object(ge.jsxs)(Xt.a,{children:[Object(ge.jsx)(L.a,{variant:"h4",children:"Links"}),Object(ge.jsxs)("div",{style:{marginLeft:6,marginBottom:12},children:[Object(ge.jsx)(L.a,{variant:"h6",children:Object(ge.jsx)(Br.a,{target:"_blank",rel:"noopener noreferrer",href:"http://cirrocumulus.readthedocs.io/",children:"Documentation"})}),Object(ge.jsx)(L.a,{variant:"h6",children:"Contact: cirrocumulus@broadinstitute.org"}),Object(ge.jsx)(L.a,{variant:"h6",children:Object(ge.jsx)(Br.a,{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/klarman-cell-observatory/cirrocumulus",children:"Source Code"})})]}),Object(ge.jsx)(L.a,{variant:"h4",children:"Primary Embedding Controls"}),Object(ge.jsxs)("div",{style:{marginLeft:6,marginBottom:12},children:[Object(ge.jsx)(L.a,{variant:"h5",children:"3-d Embedding"}),"Rotate: Mouse left click",Object(ge.jsx)("br",{}),"Pan: Mouse right click",Object(ge.jsx)("br",{}),"Zoom: Mouse wheel",Object(ge.jsx)("br",{}),Object(ge.jsx)(L.a,{variant:"h5",children:"2-d Embedding"}),"Pan: Mouse left click",Object(ge.jsx)("br",{}),"Zoom: Mouse wheel",Object(ge.jsx)("br",{})]})]})})}}]),n}(i.a.PureComponent),xo=Object(o.b)((function(e){return{}}),(function(e){return{handleClose:function(t){e(Ja(null))}}}))(jo),Oo=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleClose()},a.onLabelFontSizeUpdate=function(e){!isNaN(e)&&e>0&&(a.props.chartOptions.labelFontSize=e,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelFontSize:e}))},a.onLabelFontSize=function(e){a.setState({labelFontSize:e.target.value}),a.onLabelFontSizeUpdate(e.target.value)},a.onLabelStrokeWidth=function(e){a.setState({labelStrokeWidth:e.target.value})},a.onLabelStrokeWidthUpdate=function(e){!isNaN(e)&&e>=0&&(a.props.chartOptions.labelStrokeWidth=e,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelStrokeWidth:e}))},a.state={labelFontSize:"",labelStrokeWidth:""},a.onLabelFontSizeUpdate=Object(f.debounce)(a.onLabelFontSizeUpdate,500),a.onLabelStrokeWidthUpdate=Object(f.debounce)(a.onLabelStrokeWidthUpdate,500),a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){this.setState({labelFontSize:this.props.chartOptions.labelFontSize,labelStrokeWidth:this.props.chartOptions.labelStrokeWidth})}},{key:"render",value:function(){return Object(ge.jsxs)(Vt.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"more-options-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(ge.jsx)(Gt.a,{id:"more-options-dialog-title",children:"More Options"}),Object(ge.jsxs)(Xt.a,{children:[Object(ge.jsx)(_i.a,{value:this.state.labelFontSize,onChange:this.onLabelFontSize,margin:"dense",label:"Label Font Size",fullWidth:!0}),Object(ge.jsx)(_i.a,{value:this.state.labelStrokeWidth,onChange:this.onLabelStrokeWidth,margin:"dense",label:"Label Shadow Size",fullWidth:!0})]})]})}}]),n}(i.a.PureComponent),yo=Object(o.b)((function(e){return{chartOptions:e.chartOptions}}),(function(e){return{handleChartOptions:function(t){e(Sa(t))},handleClose:function(){e(Ja(null))}}}))(Oo),So=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onNotesChanged=function(e){a.setState({notes:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.notes;null!=t&&(t=t.trim()),a.setState({loading:!0}),a.props.handleSave({name:e,notes:t})},a.state={open:!0,name:"",notes:""},a}return Object(E.a)(n,[{key:"componentDidMount",value:function(){null==this.props.savedFilter?this.setState({name:"",notes:"",create:!0}):this.setState({name:this.props.savedFilter.name,notes:this.props.savedFilter.notes})}},{key:"render",value:function(){var e=this.state,t=e.name,n=e.notes,a=e.create;return Object(ge.jsxs)(Vt.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-filter-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(ge.jsxs)(Gt.a,{id:"edit-dataset-filter-dialog-title",children:[a?"Create":"Edit"," Filter"]}),Object(ge.jsxs)(Xt.a,{children:[Object(ge.jsx)(_i.a,{required:!0,value:t,autoComplete:"off",onChange:this.onNameChanged,margin:"dense",label:"Name",fullWidth:!0}),Object(ge.jsx)(_i.a,{required:!1,autoComplete:"off",value:n,onChange:this.onNotesChanged,margin:"dense",label:"Notes",fullWidth:!0})]}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(ge.jsx)(Yt.a,{disabled:0===t.trim().length,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(i.a.PureComponent),Co=Object(o.b)((function(e){return{savedFilter:e.savedDatasetFilter}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t(),i=xa(a),r={ds_id:a.dataset.id};null!=n.filterId&&(r.id=n.filterId);var o={},s=!1;if(n.name!==o.name&&(r.name=n.name,s=!0),n.notes!==o.notes&&(r.notes=n.notes,s=!0),Object(f.isEqual)(i,o.value)||(r.value=i,s=!0),s){for(var l in r)o[l]=r[l];e(Va(!0)),t().serverInfo.api.upsertDatasetFilterPromise(r,null!=n.filterId).then((function(a){r.id=a.id;var i=t().datasetFilters;if(null!=n.filterId){for(var o=0;o<i.length;o++)if(i[o].id===a.id){i[o]=r;break}}else i.push(r);e(ei(i.slice())),e(Ba("Filter saved"))})).finally((function(){e(Va(!1)),e(Ja(null))})).catch((function(t){oi(e,t,"Unable to save filter. Please try again.")}))}else e(Ja(null))}))},handleCancel:function(t){e(Ja(null))},handleError:function(t){e(Ba(t))}}}))(So),wo=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onCategoryChanged=function(e){a.setState({category:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.category;null!=t&&(t=t.trim()),a.setState({loading:!0}),a.props.handleSave({name:e,category:t})},a.state={open:!0,name:"",category:""},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.state,t=e.name,n=e.category;return Object(ge.jsxs)(Vt.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-set-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(ge.jsx)(Gt.a,{id:"edit-set-dialog-title",children:"Create Set"}),Object(ge.jsxs)(Xt.a,{children:[Object(ge.jsx)(_i.a,{required:!0,autoComplete:"off",value:t,onChange:this.onNameChanged,margin:"dense",label:"Set Name",fullWidth:!0}),Object(ge.jsx)(_i.a,{required:!0,autoComplete:"off",value:n,onChange:this.onCategoryChanged,margin:"dense",label:"Set Category",fullWidth:!0})]}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(ge.jsx)(Yt.a,{disabled:0===t.trim().length||0===n.trim().length,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(i.a.PureComponent),ko=Object(o.b)((function(e){return{savedFilter:e.savedDatasetFilter}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t(),i=yt(a.searchTokens).X,r={ds_id:a.dataset.id,name:n.name,features:i,category:n.category};e(Va(!0)),t().serverInfo.api.upsertFeatureSet(r,!1).then((function(a){var r=t().markers;r.push({category:n.category,name:n.name,features:i,id:a.id}),e(Wa(r.slice())),e(Ba("Set saved"))})).finally((function(){e(Va(!1)),e(Ja(null))})).catch((function(t){oi(e,t,"Unable to save set. Please try again.")}))}))},handleCancel:function(t){e(Ja(null))},handleError:function(t){e(Ba(t))}}}))(wo),Eo=n(510),Mo=n(523),zo=n(524),Io=n(200),Do=n.n(Io),Ao=n(280),To=n.n(Ao),Po=n(278),No=n.n(Po),Ro=n(279),Fo=n.n(Ro),_o=n(199),Lo=n.n(_o),Uo=n(57),Bo=n(519),Ho=n(506),Jo=n(505),Wo=B()({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0}},expanded:{}})(Bo.a),Vo=B()({root:{backgroundColor:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:43,"&$expanded":{minHeight:43}},content:{"&$expanded":{margin:0}},expanded:{}})(Jo.a),Go=B()((function(e){return{root:{flexDirection:"column",padding:0}}}))(Ho.a),Xo=n(509),Zo=n(30),qo=n(508),Ko=n(507),Yo=n(518),$o=n(277);function Qo(e){var t=e.data,n=e.index,a=e.style;return i.a.cloneElement(t[n],{style:Object(vi.a)(Object(vi.a)({},a),{},{top:a.top+0})})}var es=i.a.createContext({}),ts=i.a.forwardRef((function(e,t){var n=i.a.useContext(es);return Object(ge.jsx)("div",Object(vi.a)(Object(vi.a)({ref:t},e),n))})),ns=i.a.forwardRef((function(e,t){var n=e.children,a=Object(Lr.a)(e,["children"]),r=i.a.Children.toArray(n),o=Object(Zo.a)(),s=Object(Ko.a)(o.breakpoints.up("sm"),{noSsr:!0}),l=r.length,c=s?24:36,u=function(e){return c};return Object(ge.jsx)("div",{ref:t,children:Object(ge.jsx)(es.Provider,{value:a,children:Object(ge.jsx)($o.a,{itemData:r,height:(l>8?8*c:r.map(u).reduce((function(e,t){return e+t}),0))+0,width:"100%",outerElementType:ts,innerElementType:"ul",itemSize:function(e){return u(r[e])},overscanCount:5,itemCount:l,children:Qo},l)})})})),as=Object(qo.a)({paper:{width:230},listbox:{"& ul":{padding:0,margin:0}}}),is=function(e){return[Object(ge.jsx)(Xo.a,{disableGutters:!0,component:"div",children:Object(ge.jsx)(L.a,{noWrap:!0,children:e.group})}),e.children]};function rs(e){var t=as(),n=i.a.createRef();function a(t,n){var a=[];n.forEach((function(t){if(""!==(t=t.toLowerCase().trim().replace(/"/g,"")))for(var n=0;n<e.options.length;n++){var i=e.options[n];if((null!=i.text?i.text:i).toLowerCase()===t){a.push(i);break}}})),e.onChange(t,a)}function r(e){n.current.style.background=e?"#1976d2":""}function o(e){e.preventDefault(),e.stopPropagation(),r(!1)}var s=e.onChipClick?function(t,n){e.onChipClick(t,n)}:null,l=e.getOptionSelected;null==l&&(l=e.groupBy?function(e,t){return e.id===t.id&&e.group===t.group}:function(e,t){return e===t});var c=e.getChipText;null==c&&(c=function(e){return e});var u=e.getChipIcon;null==u&&(u=function(e){return null});var d=e.getChipTitle;null==d&&(d=function(e){return null});var h=e.getOptionLabel;null==h&&(h=e.groupBy?function(e){return e.text}:function(e){return e});return Object(ge.jsx)(Yo.a,{multiple:!0,ref:n,filterOptions:function(e,t){var n=t.inputValue;if(""===(n=n.trim().toLowerCase()))return e;for(var a=n.length,i=[],r=[],o=[],s=0,l=e.length;s<l;s++){var c=e[s],u=h(c).toLowerCase(),d=u.indexOf(n);0===d?u.length===a?i.push(c):r.push(c):-1!==d&&o.push(c)}return i.concat(r).concat(o)},disableListWrap:!0,classes:t,getOptionSelected:l,value:e.value,openOnFocus:!0,filterSelectedOptions:!0,getOptionLabel:h,groupBy:e.groupBy?function(e){return e.group}:null,blurOnSelect:!0,ChipProps:{size:"small"},ListboxComponent:ns,renderGroup:is,options:e.options,autoHighlight:!0,onChange:e.onChange,renderTags:function(e,t){return e.map((function(e,n){return Object(ge.jsx)(Mo.a,Object(vi.a)({variant:"default",onClick:s?function(t){return s(t,e)}:null,label:c(e),title:d(e),size:"small",icon:u(e)},t({index:n})))}))},renderInput:function(t){return Object(ge.jsx)(_i.a,Object(vi.a)(Object(vi.a)({margin:"dense"},t),{},{label:e.label,helperText:e.helperText}))},renderOption:function(e,t){var n=t.inputValue;n=n.toLowerCase();var a=h(e);if(""!==n){var i=a.toLowerCase().indexOf(n);if(-1!==i){var r=n.length,o=a.substring(0,i),s=a.substring(i,i+r),l=a.substring(i+r);return Object(ge.jsxs)(L.a,{title:a,noWrap:!0,children:[o,Object(ge.jsx)("b",{children:s}),l]})}}return Object(ge.jsx)(L.a,{title:a,noWrap:!0,children:a})},onPaste:function(e){var t=e.clipboardData.getData("text/plain");null!=t&&t.length>0&&(e.preventDefault(),e.stopPropagation(),a(e,t.split(/[\n,\t]/)))},onDrop:function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files,n=new FileReader;n.onload=function(e){a(e,e.target.result.split(/[\n,\t]/))},n.onerror=function(e){alert("Unable to read file.")},n.readAsText(t[0]),r(!1)},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),r(!0)},onDragEnd:o,onDragLeave:o})}var os=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).getJobResult=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.jobResults,i=t.jobResultId;return null==e&&(e=i),Object(f.find)(n,(function(t){return t.id===e}))},a.updateTopNJobResultDebounced=function(){on(a.getJobResult()),a.props.handleJobResults(a.props.jobResults.slice())},a.sortAndFilterDebounced=function(){rn(a.getJobResult()),a.props.handleJobResults(a.props.jobResults.slice())},a.handleJobResultDebounced=function(e){an(a.getJobResult(e)),a.props.handleJobResults(a.props.jobResults.slice())},a.onSizeReversedChange=function(e){var t=a.getJobResult();t.sizeScaleReversed=e,t.sizeScale=void 0,an(a.getJobResult()),a.props.handleJobResults(a.props.jobResults.slice())},a.onSortChange=function(e){var t=a.getJobResult();t.sortByGroup=e.target.value,on(t),a.props.handleJobResults(a.props.jobResults.slice())},a.onMinUIChange=function(e){a.setState({min:e})},a.onMaxUIChange=function(e){a.setState({max:e})},a.onMinChange=function(e){var t=a.getJobResult();t.options.min=e,t.colorScale=void 0,an(t),a.props.handleJobResults(a.props.jobResults.slice())},a.onMaxChange=function(e){var t=a.getJobResult();t.options.max=e,t.colorScale=void 0,an(t),a.props.handleJobResults(a.props.jobResults.slice())},a.onOptions=function(e){var t=a.getJobResult();t.options=Object.assign(t.options,e),t.colorScale=void 0,t.sizeScale=void 0,a.handleJobResultDebounced(a.props.jobResultId)},a.onInterpolator=function(e){var t=a.getJobResult(),n=t.interpolator.scale;t.interpolator=e,t.interpolator.scale=n,t.colorScale=jt(t.interpolator).domain(t.colorScale.domain()).clamp(!0),a.props.handleJobResults(a.props.jobResults.slice())},a.onColorScalingChange=function(e){var t=a.getJobResult();t.colorScale=void 0,t.interpolator.scale=e,an(t),a.props.handleJobResults(a.props.jobResults.slice())},a.onColorChanged=function(e){var t=a.getJobResult();t.colorScale=void 0,t.color=e.target.value,an(a.getJobResult()),a.props.handleJobResults(a.props.jobResults.slice())},a.onSizeChanged=function(e){var t=a.getJobResult();t.sizeScale=void 0,t.size=e.target.value,an(a.getJobResult()),a.props.handleJobResults(a.props.jobResults.slice())},a.onNtopChange=function(e,t){var n=a.getJobResult();n.ntopUI=t,n.ntop=t,a.setState((function(e,t){return{forceUpdate:!e.forceUpdate}})),a.updateTopNJobResultDebounced()},a.onByChanged=function(e){var t=a.getJobResult();t.by=e.target.value,rn(t),a.props.handleJobResults(a.props.jobResults.slice())},a.onOperationChanged=function(e,t){e[1]=t,rn(a.getJobResult()),a.props.handleJobResults(a.props.jobResults.slice())},a.onValueChange=function(e,t){e[2]=parseFloat(t),e[3]=t,a.setState((function(e,t){return{forceUpdate:!e.forceUpdate}})),a.sortAndFilterDebounced()},a.handleJobResultDebounced=Object(f.debounce)(a.handleJobResultDebounced,500),a.sortAndFilterDebounced=Object(f.debounce)(a.sortAndFilterDebounced,500),a.updateTopNJobResultDebounced=Object(f.debounce)(a.updateTopNJobResultDebounced,500),a.state={forceUpdate:!1,min:"",max:""},a}return Object(E.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.jobResultId,a=t.classes,r=t.textColor;if(null==n)return null;var o=this.getJobResult();if(null==o)return null;var s=o.rowFilters,l=o.color,c=o.size,u=o.by,d=o.colorScale,h=o.ntopUI,p=o.interpolator,f=o.sizeScale,b=o.fields.slice();b.sort(k()({insensitive:!0}));["(None)"].concat(b);return Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)("div",{style:{marginTop:16},children:[Object(ge.jsx)(L.a,{component:"h2",children:"Rank Features"}),Object(ge.jsxs)(ur.a,{style:{display:"block"},className:a.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"By"}),Object(ge.jsx)(cr.a,{input:Object(ge.jsx)(dr.a,{size:"small"}),onChange:this.onByChanged,value:u,children:b.map((function(e){return Object(ge.jsx)(V.a,{value:e,children:e},e)}))})]}),Object(ge.jsx)(lr.a,{style:{marginLeft:8,marginTop:8},shrink:!0,children:"Number of Features"}),Object(ge.jsx)(zo.a,{min:5,max:50,step:5,style:{marginLeft:10,width:"86%"},valueLabelDisplay:"auto",value:h,onChange:this.onNtopChange}),o.groups.length>1&&Object(ge.jsxs)(ur.a,{style:{display:"block"},className:a.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Sort Features"}),Object(ge.jsx)(cr.a,{input:Object(ge.jsx)(dr.a,{size:"small"}),onChange:this.onSortChange,value:o.sortByGroup,children:o.columns.map((function(e){return Object(ge.jsx)(V.a,{value:o.groups[e],children:o.groups[e]},o.groups[e])}))})]})]}),Object(ge.jsx)("div",{style:{marginTop:8}}),Object(ge.jsx)(H.a,{title:"Filters are applied separately per cluster",children:Object(ge.jsx)(L.a,{component:"h2",children:"Filters"})}),s.map((function(t){var n="job_result"+t[0];return Object(ge.jsxs)("div",{style:{paddingTop:8},children:[Object(ge.jsxs)(ur.a,{className:a.formControlInline,children:[Object(ge.jsx)(lr.a,{children:t[0]}),Object(ge.jsxs)(cr.a,{labelId:n+"_label",id:n,style:{marginRight:6},value:t[1],onChange:function(n){return e.onOperationChanged(t,n.target.value)},children:[Object(ge.jsx)(V.a,{value:""}),Object(ge.jsx)(V.a,{value:">",children:">"}),Object(ge.jsx)(V.a,{value:"<",children:"<"}),Object(ge.jsx)(V.a,{value:"=",children:"="}),Object(ge.jsx)(V.a,{value:">=",children:">="}),Object(ge.jsx)(V.a,{value:"<=",children:"<="}),Object(ge.jsx)(V.a,{value:"!=",children:"!="})]})]}),Object(ge.jsx)(_i.a,{onChange:function(n){return e.onValueChange(t,n.target.value)},value:t[3],style:{maxWidth:60,verticalAlign:"bottom"}})]},t[0])})),Object(ge.jsx)(L.a,{style:{marginTop:16},component:"h2",children:"View Options"}),Object(ge.jsxs)(ur.a,{className:a.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Color"}),Object(ge.jsx)(cr.a,{input:Object(ge.jsx)(dr.a,{size:"small"}),onChange:this.onColorChanged,value:l,children:b.map((function(e){return Object(ge.jsx)(V.a,{value:e,children:e},e)}))})]}),Object(ge.jsx)(Sr,{domain:d.domain(),textColor:r,interpolator:p,min:this.state.min,max:this.state.max,onMinChange:this.onMinChange,onMaxChange:this.onMaxChange,onMinUIChange:this.onMinUIChange,onMaxUIChange:this.onMaxUIChange,onInterpolator:this.onInterpolator}),o.groups.length>1&&Object(ge.jsxs)(ur.a,{className:this.props.classes.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Standardize"}),Object(ge.jsxs)(cr.a,{input:Object(ge.jsx)(dr.a,{size:"small"}),onChange:function(t){return e.onColorScalingChange(t.target.value)},value:p.scale,children:[Object(ge.jsx)(V.a,{value:"none",divider:!0,children:"(None)"}),Object(ge.jsx)(V.a,{title:"Standardize features between 0 and 1",value:ot,children:"Feature"}),Object(ge.jsx)(V.a,{title:"Standardize groups between 0 and 1",value:st,children:"Category"})]})]}),Object(ge.jsxs)(ur.a,{style:{marginTop:16},className:a.formControl,children:[Object(ge.jsx)(lr.a,{shrink:!0,children:"Size"}),Object(ge.jsxs)(cr.a,{input:Object(ge.jsx)(dr.a,{size:"small"}),onChange:this.onSizeChanged,value:c,children:[Object(ge.jsx)(V.a,{divider:!0,value:"none",children:"(None)"}),b.map((function(e){return Object(ge.jsx)(V.a,{value:e,children:e},e)}))]})]}),Object(ge.jsx)("div",{style:{display:"(None)"===c?"none":"",marginTop:6},children:Object(ge.jsx)(Cr,{sizeScale:f,textColor:r,onOptions:this.onOptions,showReversed:!0,reversed:o.sizeScaleReversed,onReversedChange:this.onSizeReversedChange})})]})}}]),n}(i.a.PureComponent),ss=B()((function(e){return{formControl:{display:"block",margin:e.spacing(0,1)},formControlInline:{margin:e.spacing(0,1)}}}))(Object(o.b)((function(e){return{textColor:e.chartOptions.darkMode?"white":"black",jobResults:e.jobResults,jobResultId:e.jobResult}}),(function(e,t){return{handleJobResults:function(t){e(qa(t))}}}))(os)),ls=k()({insensitive:!0}),cs=[{value:.1,label:"10%"},{value:.25,label:"25%"},{value:.5,label:"50%"},{value:.75,label:"75%"},{value:1,label:"100%"},{value:1.5,label:"150%"},{value:2,label:"200%"},{value:3,label:"300%"},{value:4,label:"400%"}],us=[{value:300,label:"Small"},{value:500,label:"Medium"},{value:800,label:"Large"}],ds=Object(Uo.a)((function(e,t){var n=[];return e.forEach((function(e){n.push({group:"Continuous",text:e,id:e})})),t.forEach((function(e){n.push({group:"Categorical",text:e,id:e})})),n.sort((function(e,t){var n=ls(e.group,t.group);return 0!==n?n:ls(e.text,t.text)})),n})),hs=Object(Uo.a)((function(e){var t=[];return e.forEach((function(e){t.push({text:e.name+(3===e.dimensions?" 3d":""),id:ma(e)})})),t.sort((function(e,t){return ls(e.text.toLowerCase(),t.text.toLowerCase())})),t})),ps=Object(Uo.a)((function(e){if(e){var t=e.slice();return t.sort(ls),t}})),fs=Object(Uo.a)((function(e,t){var n=e.map((function(e){return{group:e.category,text:e.name,id:e.id}}));return n.forEach((function(e){var n=e.group,a=n.lastIndexOf(" (");-1!==a&&(n=n.substring(0,a));var i=(t[n]||{})[e.text];null!=i&&(e.text=i)})),n.sort((function(e,t){var n=ls(e.group,t.group);return 0!==n?n:ls(e.text,t.text)})),n})),bs=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onMinUIChange=function(e){a.setState({minColor:e})},a.onMaxUIChange=function(e){a.setState({maxColor:e})},a.onMinChange=function(e){var t=a.props,n=t.activeFeature,i=t.embeddingData,r=t.globalFeatureSummary[n.name];Object(f.find)(i,(function(e){return va(e)===n.embeddingKey})).type!==rt?r.customMin=isNaN(e)?void 0:e:r.customZMin=isNaN(e)?void 0:e,a.props.onDomain({name:n.name,summary:r})},a.onMaxChange=function(e){var t=a.props,n=t.activeFeature,i=t.embeddingData,r=t.globalFeatureSummary[n.name];Object(f.find)(i,(function(e){return va(e)===n.embeddingKey})).type!==rt?r.customMax=isNaN(e)?void 0:e:r.customZMax=isNaN(e)?void 0:e,a.props.onDomain({name:a.props.activeFeature.name,summary:r})},a.onMarkerOpacityChange=function(e,t){a.setState({opacity:t}),a.updateMarkerOpacity(t)},a.updateMarkerOpacity=function(e){var t=parseFloat(e);t>=0&&t<=1&&a.props.handleMarkerOpacity(t)},a.onUnselectedMarkerOpacityChange=function(e,t){a.setState({unselectedOpacity:t}),a.updateUnselectedMarkerOpacity(t)},a.updateUnselectedMarkerOpacity=function(e){var t=parseFloat(e);t>=0&&t<=1&&a.props.handleUnselectedMarkerOpacity(t)},a.onReversedChange=function(e){a.props.handleInterpolator(Object.assign({},a.props.interpolator,{reversed:e.target.checked}))},a.openDatasetFilter=function(e){a.props.handleOpenDatasetFilter(e)},a.deleteDatasetFilter=function(e){a.props.handleDeleteDatasetFilter(e)},a.onPointSizeChange=function(e){a.props.handlePointSize(e.target.value)},a.onFeaturesChange=function(e,t){a.props.handleSearchTokens(t,Qe)},a.onMetafeaturesChange=function(e,t){a.props.handleSearchTokens(t,tt)},a.onObservationsIconClick=function(e,t){a.props.handleEmbeddingLabel(t),e.stopPropagation()},a.onObservationsChange=function(e,t){var n=[];t.forEach((function(e){void 0!==e.text?n.push(e.text):n.push(e)})),a.props.handleSearchTokens(n,Ye)},a.onSaveFeatureList=function(){a.props.handleDialog(ta)},a.onEmbeddingsChange=function(e,t){var n=[],i=a.props.dataset.embeddings.map((function(e){return ma(e)}));t.forEach((function(e){var t=void 0!==e.id?e.id:e,r=i.indexOf(t),o=a.props.dataset.embeddings[r];o.precomputed||(o=Object.assign(o,{bin:a.props.binValues,nbins:a.props.numberOfBins,agg:a.props.binSummary})),n.push(o)})),a.props.handleEmbeddings(n)},a.onFeatureSetsChange=function(e,t){var n=[];t.forEach((function(e){void 0!==e.id?n.push(e.id):n.push(e)})),a.props.handleSearchTokens(n,et)},a.onFeatureSetClick=function(e,t){for(var n=t.id,i=e.target,r=a.props.markers,o=null,s=0;s<r.length;s++)if(r[s].id===n){o=r[s];break}null==o&&console.log(n+" not found"),e.stopPropagation(),a.setState({featureSetAnchorEl:i,featureSet:o})},a.onFeatureSetMenuClose=function(e){a.setState({featureSetAnchorEl:null,featureSet:null})},a.onViewFeatureSet=function(e){e.stopPropagation(),a.setState({featureSetAnchorEl:null,featureSetView:!0})},a.onCloseViewFeatureSetDialog=function(e){e.stopPropagation(),a.setState({featureSet:null,featureSetView:!1})},a.onDeleteFeatureSet=function(e){e.stopPropagation();var t=a.props.searchTokens,n=a.state.featureSet.id,i=t.filter((function(e){return e.type===et&&e.value.id!==n}));a.props.handleSearchTokens(i,et),a.props.handleDeleteFeatureSet(n),a.setState({featureSetAnchorEl:null,featureSet:null})},a.onFilterChipClicked=function(e){a.onFeatureClick(e,e.target.innerText)},a.onFeatureClick=function(e,t){e.stopPropagation();for(var n=void 0!==t.text?t.text:t,i=a.props.embeddingData.filter((function(e){return e.active})),r=0;r<i.length;r++)if(i[r].name==n){"embedding"!==a.props.tab&&a.props.handleTab("embedding"),a.props.handleActiveFeature({name:i[r].name,type:i[r].featureType,embeddingKey:va(i[r])});break}},a.onChartSizeChange=function(e){var t=e.target.value;a.props.handleChartSize(t)},a.onShowGalleryLabelsChange=function(e){var t=a.props.chartOptions;t.showGalleryLabels=e.target.checked,a.props.handleChartOptions(Object.assign({},t))},a.handleSelectedCellsClick=function(e){e.preventDefault(),a.props.downloadSelectedIds()},a.onJobNameChange=function(e){a.setState({jobName:e.target.value})},a.onSubmitJobCancel=function(){a.setState({jobName:"",jobParams:null,group1:null,group2:null,group1Count:null,group2Count:null})},a.onSubmitJobOK=function(){a.state.jobParams.name=a.state.jobName,a.props.handleSubmitJob(a.state.jobParams),a.setState({jobName:"",jobParams:null,group1:null,group2:null,group1Count:null,group2Count:null})},a.onSetGroup=function(e){var t={};t["group"+e]=Oa(a.props.dataset,a.props.datasetFilter,a.props.combineDatasetFilters),t["group"+e+"Count"]=a.props.selection.size,a.setState(t)},a.onSubmitJob=function(e){if("corr"===e){var t=a.props.activeFeature;a.setState({jobName:"",jobParams:{type:"corr",params:{ref:t.name}}})}else a.setState({jobName:"",jobParams:{type:"de",params:{filter:a.state.group1,filter2:a.state.group2}}})},a.onDatasetFilterChipDeleted=function(e){a.props.removeDatasetFilter(e)},a.onDatasetFilterCleared=function(){a.props.removeDatasetFilter(null)},a.onDatasetFilterSaved=function(){a.props.handleDialog(ea)},a.handleCombineDatasetFilters=function(e){a.props.handleCombineDatasetFilters(e.target.checked?"or":"and")},a.onChartTypeChange=function(e){a.props.onDistributionPlotOptions({chartType:e.target.value})},a.onViolinScaleChange=function(e){a.props.onDistributionPlotOptions({violinScale:e.target.value})},a.onViolinShowBoxplot=function(e){a.props.onDistributionPlotOptions({violinShowBoxplot:e.target.checked})},a.state={featureSetAnchorEl:null,featureSet:null,featureSetView:!1,opacity:e.markerOpacity,unselectedOpacity:e.unselectedMarkerOpacity,minColor:"",maxColor:""},a.updateMarkerOpacity=Object(f.debounce)(a.updateMarkerOpacity,500),a.updateUnselectedMarkerOpacity=Object(f.debounce)(a.updateUnselectedMarkerOpacity,500),a}return Object(E.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){var a=this;if(e.markerOpacity!==this.props.markerOpacity&&this.setState({opacity:this.props.markerOpacity}),e.unselectedMarkerOpacity!==this.props.unselectedMarkerOpacity&&this.setState({unselectedOpacity:this.props.unselectedMarkerOpacity}),e.dataset!==this.props.dataset&&this.setState({group1:null,group2:null,group1Count:null,group2Count:null}),e.activeFeature!==this.props.activeFeature){var i=null==this.props.activeFeature?null:this.props.globalFeatureSummary[this.props.activeFeature.name];if(null==this.props.activeFeature)this.setState({minColor:"",maxColor:""});else Object(f.find)(this.props.embeddingData,(function(e){return va(e)===a.props.activeFeature.embeddingKey})).type!==rt?this.setState({minColor:null==i.customMin?"":i.customMin,maxColor:null==i.customMax?"":i.customMax}):this.setState({minColor:null==i.customZMin?"":i.customZMin,maxColor:null==i.customZMax?"":i.customZMax})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.activeFeature,a=t.categoricalNames,r=t.chartOptions,o=t.chartSize,s=t.classes,l=t.combineDatasetFilters,c=t.dataset,u=t.datasetFilter,d=t.datasetFilters,h=t.distributionPlotOptions,p=t.embeddingLabels,b=t.embeddings,m=t.embeddingData,v=t.interpolator,g=t.markers,j=t.pointSize,x=t.searchTokens,O=t.selection,y=t.serverInfo,S=t.tab,C=t.textColor,w=null==n?null:Object(f.find)(m,(function(e){return va(e)===n.embeddingKey})),k=h.chartType,E=function(e){var t=[],n=!1;for(var a in e){var i=e[a];Array.isArray(i)?n=!0:"in"===i.operation?t.push(a):null==i.operation||""===i.operation||isNaN(i.value)||null==i.value||t.push(a)}return n&&t.push("selection"),t}(u);E.sort(ls);var M=this.props.savedDatasetFilter;null==M&&(M={});var z=yt(x),I=Ot(g,z.featureSets),D=c.features,A=ps(c.metafeatures),T=c.obsCat,P=c.obs,N=ds(P,T),R=fs(g,a),F=hs(c.embeddings),_=hs(b),U=y.dynamic,B=this.state,G=B.featureSet,X=B.featureSetAnchorEl,Z=B.featureSetView,q=B.unselectedOpacity,K=B.opacity,Y=B.jobParams,$=B.jobName,Q=B.minColor,ee=B.maxColor,te=y.jobs;return Object(ge.jsxs)("div",{className:s.root,children:[Object(ge.jsxs)(Vt.a,{open:null!=Y,onClose:this.onSubmitJobCancel,"aria-labelledby":"submit-job-dialog-title","aria-describedby":"submit-job-dialog-description",children:[Object(ge.jsx)(Gt.a,{id:"submit-job-dialog-title",children:"Submit Job"}),Object(ge.jsxs)(Xt.a,{children:[Object(ge.jsx)(Zt.a,{id:"submit-job-dialog-description",children:"Job Details"}),Object(ge.jsx)(_i.a,{onChange:this.onJobNameChange,value:$,autoFocus:!0,margin:"dense",label:"Job Name",type:"text",fullWidth:!0})]}),Object(ge.jsxs)(qt.a,{children:[Object(ge.jsx)(Yt.a,{onClick:this.onSubmitJobCancel,children:"Cancel"}),Object(ge.jsx)(Yt.a,{disabled:""===$,variant:"contained",onClick:function(t){return e.onSubmitJobOK($)},color:"primary",children:"Submit"})]})]}),Object(ge.jsxs)(Vt.a,{open:Z,onClose:this.onCloseViewFeatureSetDialog,"aria-labelledby":"view-set-dialog-title",fullWidth:!0,maxWidth:"lg",children:[Object(ge.jsx)(Gt.a,{id:"view-set-dialog-title",children:G?G.name:""}),Object(ge.jsx)(Xt.a,{children:Object(ge.jsx)(_i.a,{value:G?G.features.join("\n"):"",margin:"dense",fullWidth:!0,readOnly:!0,variant:"outlined",multiline:!0})})]}),Object(ge.jsxs)(W.a,{id:"feature-set-menu",anchorEl:X,open:Boolean(X),onClose:this.onFeatureSetMenuClose,children:[Object(ge.jsx)(V.a,{onClick:this.onViewFeatureSet,children:"View"}),Object(ge.jsx)(V.a,{divider:!0}),Object(ge.jsx)(V.a,{disabled:G&&G.readonly,onClick:this.onDeleteFeatureSet,children:"Delete"})]}),Object(ge.jsxs)(Wo,{style:"embedding"===S||"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(ge.jsx)(Vo,{children:Object(ge.jsx)(L.a,{children:"View"})}),Object(ge.jsx)(Go,{children:Object(ge.jsxs)("div",{children:["embedding"===S&&F.length>0&&Object(ge.jsx)(ur.a,{className:s.formControl,children:Object(ge.jsx)(rs,{label:"Embeddings",options:F,getChipTitle:function(e){return e.text},value:_,getChipText:function(e){return e.text},getOptionLabel:function(e){return e.text},getOptionSelected:function(e,t){return-1!==Object(f.findIndex)(_,(function(t){return t.id===e.id}))},onChange:this.onEmbeddingsChange})}),D.length>0&&Object(ge.jsx)(ur.a,{className:s.formControl,children:Object(ge.jsx)(rs,{onChipClick:this.onFeatureClick,label:"Genes/Features",options:D,value:z.X,onChange:this.onFeaturesChange,helperText:"Enter or paste list"})}),N.length>0&&Object(ge.jsx)(ur.a,{className:s.formControl,children:Object(ge.jsx)(rs,{label:"Cell Metadata",options:N,value:z.obsCat.concat(z.obs),onChipClick:this.onFeatureClick,groupBy:!0,getChipIcon:function(t){return-1!==z.obsCat.indexOf(t)?Object(ge.jsx)(No.a,{onClick:function(n){e.onObservationsIconClick(n,t)},title:"Toggle Show/Hide Labels",style:{marginLeft:4,marginTop:0,marginRight:0,marginBottom:0},className:"MuiChip-deleteIcon MuiChip-deleteIconSmall"+(-1!==p.indexOf(t)?" cirro-active":"")}):null},getOptionSelected:function(e,t){return e.id===t},onChange:this.onObservationsChange})}),A&&A.length>0&&Object(ge.jsx)(ur.a,{className:s.formControl,children:Object(ge.jsx)(rs,{onChipClick:this.onMetaFeatureClick,label:"Metagenes/Features",options:A,value:z.metafeatures,onChange:this.onMetafeaturesChange})}),R.length>0&&Object(ge.jsxs)(ur.a,{className:s.formControl,children:[Object(ge.jsx)(rs,{label:"Sets",options:R,value:I,onChipClick:this.onFeatureSetClick,getChipTitle:function(e){return e.category+", "+e.name},getChipIcon:function(t){return Object(ge.jsx)(Zr.a,{onClick:function(n){e.onFeatureSetClick(n,t)}})},groupBy:!0,onChange:this.onFeatureSetsChange,getOptionSelected:function(e,t){return e.id===t.id},getChipText:function(e){return e.name}}),U&&z.X.length>0&&Object(ge.jsx)(H.a,{title:"Save Current Feature List",children:Object(ge.jsx)(J.a,{size:"small",onClick:this.onSaveFeatureList,children:Object(ge.jsx)(Lo.a,{})})})]})]})})]}),Object(ge.jsxs)(Wo,{style:"embedding"===S||"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(ge.jsx)(Vo,{children:Object(ge.jsx)(L.a,{children:"Filters"})}),Object(ge.jsx)(Go,{children:Object(ge.jsxs)("div",{style:{marginLeft:10,maxHeight:500},children:[Object(ge.jsxs)(Qt.a,{component:"label",alignContent:"flex-start",container:!0,alignItems:"center",spacing:0,children:[Object(ge.jsx)(Qt.a,{item:!0,children:Object(ge.jsx)(lr.a,{shrink:!0,variant:"standard",children:"Combine Filters"})}),Object(ge.jsx)(Qt.a,{item:!0,children:"AND"}),Object(ge.jsx)(Qt.a,{item:!0,children:Object(ge.jsx)(gr.a,{size:"small",checked:"or"===l,onChange:this.handleCombineDatasetFilters})}),Object(ge.jsx)(Qt.a,{item:!0,children:"OR"})]}),E.length>0&&O.size>0&&Object(ge.jsx)(i.a.Fragment,{children:Object(ge.jsxs)("div",{style:{marginBottom:2},children:[ke(O.size)+" / "+ke(c.shape[0])+": ",E.map((function(t){return Object(ge.jsx)(Mo.a,{onDelete:function(){e.onDatasetFilterChipDeleted(t)},onClick:e.onFilterChipClicked,size:"small",variant:"default",style:{marginRight:2,verticalAlign:"bottom"},label:t},t)})),Object(ge.jsx)($t.a,{}),Object(ge.jsxs)(Qt.a,{container:!0,alignItems:"center",className:s.toolbar,children:[Object(ge.jsx)(H.a,{title:"Clear All",children:Object(ge.jsx)(J.a,{size:"small",disabled:0===E.length,onClick:this.onDatasetFilterCleared,children:Object(ge.jsx)(Fo.a,{})})}),U&&Object(ge.jsx)(H.a,{title:"Save Filter",children:Object(ge.jsx)(J.a,{size:"small",disabled:0===E.length,onClick:this.onDatasetFilterSaved,children:Object(ge.jsx)(Lo.a,{})})}),Object(ge.jsx)(H.a,{title:"Download Selected IDs",children:Object(ge.jsx)(J.a,{size:"small",disabled:0===E.length,onClick:this.handleSelectedCellsClick,children:Object(ge.jsx)(Do.a,{})})})]})]})})]})})]}),te&&Object(ge.jsxs)(Wo,{style:"embedding"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(ge.jsx)(Vo,{children:Object(ge.jsx)(L.a,{children:"Analysis"})}),Object(ge.jsx)(Go,{children:Object(ge.jsxs)("div",{className:this.props.classes.margin,children:[Object(ge.jsx)(H.a,{title:"Find differentially expressed features between two groups of cells",children:Object(ge.jsx)(L.a,{children:"Differential Expression"})}),Object(ge.jsxs)(Eo.a,{variant:"outlined",children:[Object(ge.jsx)(H.a,{title:"Group one"+(this.state.group1Count?" ("+ke(this.state.group1Count)+" cells)":""),children:Object(ge.jsx)(Yt.a,{size:"small",disabled:0===O.size,onClick:function(t){return e.onSetGroup(1)},children:"1"})}),Object(ge.jsx)(H.a,{title:"Group two"+(this.state.group2Count?" ("+ke(this.state.group2Count)+" cells)":""),children:Object(ge.jsx)(Yt.a,{size:"small",disabled:0===O.size,onClick:function(t){return e.onSetGroup(2)},children:"2"})}),Object(ge.jsx)(Yt.a,{size:"small",variant:"outlined",disabled:0===O.size||null==this.state.group1||null==this.state.group2,onClick:function(t){return e.onSubmitJob("de")},children:"Go"})]})]})})]}),Object(ge.jsxs)(Wo,{style:"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(ge.jsx)(Vo,{children:Object(ge.jsx)(L.a,{children:"Distribution Options"})}),Object(ge.jsx)(Go,{children:Object(ge.jsxs)("div",{style:{marginTop:8},children:["violin"===k&&Object(ge.jsxs)(ur.a,{className:s.formControl,children:[Object(ge.jsx)(lr.a,{id:"violin-scale-label",children:"Scale"}),Object(ge.jsxs)(cr.a,{className:s.select,labelId:"violin-scale-label",value:h.violinScale,onChange:this.onViolinScaleChange,children:[Object(ge.jsx)(V.a,{value:"area",children:"Area"}),Object(ge.jsx)(V.a,{value:"width",children:"Width"})]}),Object(ge.jsx)(Ur.a,{children:'If "area", violins have the same area. If "width", violins have the same maximum width.'})]}),"violin"===k&&Object(ge.jsx)("div",{children:Object(ge.jsx)(jr.a,{control:Object(ge.jsx)(gr.a,{value:"violinShowBoxplot",checked:h.violinShowBoxplot,onChange:this.onViolinShowBoxplot}),label:"Show Box Plot"})}),Object(ge.jsxs)(ur.a,{className:s.formControl,children:[Object(ge.jsx)(lr.a,{id:"dist-chart-type-label",children:"Chart Type"}),Object(ge.jsxs)(cr.a,{className:s.select,labelId:"dist-chart-type-label",value:k,onChange:this.onChartTypeChange,children:[Object(ge.jsx)(V.a,{value:"dotplot",children:"Dot Plot"}),Object(ge.jsx)(V.a,{value:"heatmap",children:"Heatmap"}),Object(ge.jsx)(V.a,{value:"violin",children:"Violin"})]})]})]})})]}),Object(ge.jsxs)(Wo,{style:"embedding"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(ge.jsx)(Vo,{children:Object(ge.jsx)(L.a,{children:"Embedding Options"})}),Object(ge.jsx)(Go,{children:Object(ge.jsxs)("div",{children:[Object(ge.jsx)(lr.a,{style:{marginLeft:8,marginTop:8},shrink:!0,children:"Marker Opacity"}),Object(ge.jsx)(zo.a,{min:0,max:1,step:.01,style:{marginLeft:10,width:"86%"},valueLabelDisplay:"auto",value:K,onChange:this.onMarkerOpacityChange,"aria-labelledby":"continuous-slider"}),Object(ge.jsx)(lr.a,{style:{marginLeft:8,marginTop:8},shrink:!0,children:"Filtered Marker Opacity"}),Object(ge.jsx)(zo.a,{min:0,max:1,step:.01,style:{marginLeft:10,width:"86%"},valueLabelDisplay:"auto",value:q,onChange:this.onUnselectedMarkerOpacityChange,"aria-labelledby":"continuous-slider"}),Object(ge.jsxs)(ur.a,{className:s.formControl,children:[Object(ge.jsx)(lr.a,{htmlFor:"point_size",children:"Marker Size"}),Object(ge.jsx)(cr.a,{className:s.select,input:Object(ge.jsx)(dr.a,{id:"point_size"}),onChange:this.onPointSizeChange,value:j,multiple:!1,children:cs.map((function(e){return Object(ge.jsx)(V.a,{value:e.value,children:Object(ge.jsx)(Fi.a,{primary:e.label})},e.label)}))})]}),Object(ge.jsxs)(ur.a,{className:s.formControl,children:[Object(ge.jsx)(lr.a,{htmlFor:"chart_size",children:"Gallery Chart Size"}),Object(ge.jsx)(cr.a,{className:s.select,input:Object(ge.jsx)(dr.a,{id:"chart_size"}),onChange:this.onChartSizeChange,value:o,multiple:!1,children:us.map((function(e){return Object(ge.jsx)(V.a,{value:e.value,children:Object(ge.jsx)(Fi.a,{primary:e.label})},e.label)}))})]}),Object(ge.jsx)("div",{children:Object(ge.jsx)(jr.a,{control:Object(ge.jsx)(gr.a,{checked:r.showGalleryLabels,onChange:this.onShowGalleryLabelsChange}),label:"Gallery Labels"})}),Object(ge.jsx)("div",{className:this.props.classes.margin,children:Object(ge.jsx)(Sr,{textColor:C,interpolator:v,domain:w&&w.continuous&&"__count"!==w.name?w.colorScale.domain():null,min:Q,max:ee,onMinChange:this.onMinChange,onMaxChange:this.onMaxChange,onMinUIChange:this.onMinUIChange,onMaxUIChange:this.onMaxUIChange,onInterpolator:this.props.handleInterpolator})}),Object(ge.jsx)(Yt.a,{size:"small","aria-label":"More Options",onClick:this.props.onMoreOptions,children:"More Options..."})]})})]}),U&&Object(ge.jsxs)(Wo,{style:"embedding"===S||"distribution"===S?null:{display:"none"},defaultExpanded:!0,children:[Object(ge.jsx)(Vo,{expandIcon:Object(ge.jsx)(To.a,{}),children:Object(ge.jsx)(L.a,{children:"Saved Filters"})}),Object(ge.jsx)(Go,{children:Object(ge.jsxs)("div",{style:{width:"100%"},children:[0===d.length&&Object(ge.jsx)(Kt.a,{color:"text.secondary",style:{paddingLeft:10},children:"No saved filters"}),d.length>0&&Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsx)(Pi.a,{dense:!0,children:d.map((function(t){return Object(ge.jsxs)(Ni.a,{"data-key":t.id,button:!0,selected:t.id===M.id,onClick:function(n){return e.openDatasetFilter(t.id)},children:[Object(ge.jsx)(Fi.a,{primary:t.name}),Object(ge.jsx)(Ri.a,{onClick:function(n){return e.deleteDatasetFilter(t.id)},children:Object(ge.jsx)(J.a,{edge:"end","aria-label":"delete",children:Object(ge.jsx)(tn.a,{})})})]},t.id)}))}),Object(ge.jsxs)("div",{className:this.props.classes.margin,children:[Object(ge.jsx)($t.a,{}),Object(ge.jsx)(H.a,{title:"Export Filters",children:Object(ge.jsx)(J.a,{size:"small",onClick:this.props.handleExportDatasetFilters,children:Object(ge.jsx)(Do.a,{})})})]})]})]})})]}),Object(ge.jsx)(Wo,{style:"results"===S?null:{display:"none"},defaultExpanded:!0,children:Object(ge.jsx)(Go,{children:Object(ge.jsx)("div",{className:this.props.classes.margin,children:Object(ge.jsx)(ss,{})})})})]})}}]),n}(i.a.PureComponent),ms=B()((function(e){return{root:{display:"flex",width:"100%",flexDirection:"column"},formControl:{display:"block",minWidth:200,margin:e.spacing(0,1)},margin:{margin:e.spacing(1,1)},select:{minWidth:200},toolbar:{"& hr":{margin:e.spacing(0,.5)}}}}))(Object(o.b)((function(e){return{activeFeature:e.activeFeature,categoricalNames:e.categoricalNames,chartSize:e.chartSize,chartOptions:e.chartOptions,combineDatasetFilters:e.combineDatasetFilters,dataset:e.dataset,datasetFilter:e.datasetFilter,datasetFilters:e.datasetFilters,distributionPlotOptions:e.distributionPlotOptions,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,embeddings:e.embeddings,globalFeatureSummary:e.globalFeatureSummary,interpolator:e.interpolator,markerOpacity:e.markerOpacity,markers:e.markers,numberOfBins:e.numberOfBins,pointSize:e.pointSize,savedDatasetFilter:e.savedDatasetFilter,searchTokens:e.searchTokens,selection:e.selection,serverInfo:e.serverInfo,tab:e.tab,textColor:e.textColor,unselectedMarkerOpacity:e.unselectedMarkerOpacity}}),(function(e,t){return{handleDialog:function(t){e(Ja(t))},handleTab:function(t){e(Ga(t))},handleActiveFeature:function(t){e(wa(t))},handleInterpolator:function(t){e({type:Wn,payload:t})},handleChartSize:function(t){e({type:wn,payload:t})},handleChartOptions:function(t){e(Sa(t))},onDomain:function(t){e(Ia(t))},handleCombineDatasetFilters:function(t){e(Ca(t))},downloadSelectedIds:function(){e((function(e,t){e(Va(!0));var n=t(),a=xa(n);n.dataset.api.getSelectedIdsPromise({filter:a},n.cachedData).then((function(e){var t=new Blob([e.ids.join("\n")],{type:"text/plain;charset=utf-8"});Object(p.saveAs)(t,"selection.txt")})).finally((function(){e(Va(!1))})).catch((function(t){oi(e,t)}))}))},removeDatasetFilter:function(t){var n;e((n=t,function(e,t){if(null==n)e(ka({}));else{var a=t().datasetFilter;if("selection"===n)for(var i in a)Array.isArray(a[i])&&delete a[i];else delete a[n];e(ka(Object.assign({},a)))}e(za())}))},handleEmbeddings:function(t){e(Qa(t))},handlePointSize:function(t){e({type:Vn,payload:t})},handleMarkerOpacity:function(t){e({type:Fn,payload:t})},handleEmbeddingLabel:function(t){var n;e((n=t,function(e,t){var a=t().embeddingLabels,i=a.indexOf(n);return-1===i?a.push(n):a.splice(i,1),e({type:jn,payload:a.slice()})}))},handleUnselectedMarkerOpacity:function(t){e({type:_n,payload:t})},onMoreOptions:function(){e(Ja(Yn))},handleSearchTokens:function(t,n){e(function(e,t){return function(n,a){var i=a(),r=i.searchTokens,o=[t];if(t===Ye&&o.push($e),r=r.filter((function(e){return-1===o.indexOf(e.type)})),t===Ye){var s=i.dataset.obsCat;e.forEach((function(e){var t=-1!==s.indexOf(e)?$e:Ye;r.push({value:e,type:t})}))}else r=r.concat(e.map((function(e){return{value:e,type:t}})));n({type:Bn,payload:r.slice()}),n(ii())}}(null==t?[]:t,n))},handleOpenDatasetFilter:function(t){var n;e((n=t,function(e,t){e(Va(!0)),t().serverInfo.api.getDatasetFilterPromise(n,t().dataset.id).then((function(t){t.id=n;var a=JSON.parse(t.value),i={};a.filters.forEach((function(e){e[1];var t=e[0],n=t.indexOf("/");-1!==n&&(t=t.substring(n+1)),i[t]={operation:e[1],value:e[2]}})),e(ka(i)),e(za())})).finally((function(){e(Va(!1))})).catch((function(t){oi(e,t,"Unable to retrieve filter. Please try again.")}))}))},handleDeleteDatasetFilter:function(t){var n;e((n=t,function(e,t){e(Va(!0)),t().serverInfo.api.deleteDatasetFilterPromise(n,t().dataset.id).then((function(){for(var a=t().datasetFilters,i=0;i<a.length;i++)if(a[i].id===n){a.splice(i,1);break}e(ei(a.slice())),e(Ba("Filter deleted"))})).finally((function(){e(Va(!1)),e(Ja(null))})).catch((function(t){oi(e,t,"Unable to delete filter. Please try again.")}))}))},handleExportDatasetFilters:function(){e((function(e,t){e(Va(!0)),t().serverInfo.api.exportDatasetFiltersPromise(t().dataset.id).then((function(t){if(null!=t){var n=new Blob([t],{type:"text/plain;charset=utf-8"});Object(p.saveAs)(n,"filters.csv")}else oi(e,"Unable to export filters")})).finally((function(){e(Va(!1))})).catch((function(t){oi(e,t)}))}))},handleDeleteFeatureSet:function(t){var n;e((n=t,function(e,t){e(Va(!0)),t().serverInfo.api.deleteFeatureSet(n,t().dataset.id).then((function(a){for(var i=t().markers,r=0;r<i.length;r++)if(i[r].id===n){i.splice(r,1);break}e(Wa(i.slice())),e(Ba("Set deleted"))})).finally((function(){e(Va(!1))})).catch((function(t){oi(e,t,"Unable to delete set. Please try again.")}))}))},handleSubmitJob:function(t){var n;e((n=t,function(e,t){var a;function i(){t().dataset.api.getJob(a,!1).then((function(n){var r=Object(f.find)(t().jobResults,(function(e){return e.id===a})),o=r.status!==n.status;r.status=n.status;var s=!0;"complete"===n.status?(e(Ba("Job complete")),e(qa(t().jobResults.slice())),s=!1):"error"===n.status?(oi(e,new S("Unable to complete job. Please try again.")),s=!1):o&&e(qa(t().jobResults.slice())),s&&window.setTimeout(i,5e3)})).catch((function(t){oi(e,t,"Unable to get job. Please try again.")}))}n.id=t().dataset.id,null==n.params.filter&&(n.params.filter=xa(t())),t().serverInfo.api.submitJob(n).then((function(r){e(Ba("Job submitted")),a=r.id,n.email=t().email,n.id=a,t().jobResults.push(n),e(qa(t().jobResults.slice())),window.setTimeout(i,5e3)})).finally((function(){})).catch((function(t){oi(e,t,"Unable to submit job. Please try again.")}))}))},onDistributionPlotOptions:function(t){e(ya(t))}}}))(bs)),vs=Object(hi.a)({palette:{type:"light"}}),gs=Object(hi.a)({palette:{type:"dark"}}),js=240,xs=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleMessageClose=function(){a.props.setMessage(null)},a.onGallery=function(){window.scrollTo(0,a.galleryRef.current.offsetTop)},a.state={tab:"embedding"},a.galleryRef=i.a.createRef(),a}return Object(E.a)(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.chartOptions,a=e.dataset,r=e.dialog,o=e.loading,s=e.loadingApp,l=e.message,c=e.tab,u=n.darkMode?gs:vs,d=u.palette.primary.main,h=n.darkMode?"black":"white";return Object(ge.jsx)(mi.a,{theme:u,children:Object(ge.jsxs)("div",{className:t.root,children:[(r===$n||r===Qn)&&Object(ge.jsx)(Gr,{}),r===aa&&Object(ge.jsx)(sr,{}),r===ea&&Object(ge.jsx)(Co,{}),r===na&&Object(ge.jsx)(xo,{}),r===Yn&&Object(ge.jsx)(yo,{}),r===ta&&Object(ge.jsx)(ko,{}),Object(ge.jsx)(rr,{}),Object(ge.jsx)(ui.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper},anchor:"left",children:null!=a&&Object(ge.jsx)(ms,{},a.id)}),Object(ge.jsxs)("main",{style:{backgroundColor:h,color:d},className:t.content,children:[s.loading&&Object(ge.jsx)("div",{children:Object(ge.jsxs)("h2",{children:["Loading",Object(ge.jsx)(di.a,{style:{width:"90%"},variant:"determinate",value:s.progress})]})}),null!=a&&Object(ge.jsxs)(i.a.Fragment,{children:[Object(ge.jsxs)("div",{role:"tabpanel",hidden:"embedding"!==c,children:[Object(ge.jsx)(uo,{onGallery:this.onGallery}),Object(ge.jsx)("div",{ref:this.galleryRef,children:Object(ge.jsx)(go,{})})]}),Object(ge.jsx)("div",{role:"tabpanel",hidden:"distribution"!==c,children:Object(ge.jsx)(_r,{})}),Object(ge.jsx)("div",{role:"tabpanel",hidden:"results"!==c,children:Object(ge.jsx)(ln,{})})]})]}),o&&Object(ge.jsx)(Vt.a,{"aria-labelledby":"loading-dialog-title",open:!0,children:Object(ge.jsxs)(Gt.a,{id:"loading-dialog-title",children:[Object(ge.jsx)(ci.a,{size:20})," Loading..."]})}),null!=l&&Object(ge.jsx)(li.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},ContentProps:{"aria-describedby":"message-id"},onClose:this.handleMessageClose,open:!0,autoHideDuration:6e3,action:[Object(ge.jsx)(J.a,{"aria-label":"Close",color:"inherit",onClick:this.handleMessageClose,children:Object(ge.jsx)(bi.a,{})},"close")],message:Object(ge.jsx)("span",{id:"message-id",children:l instanceof Error?l.message:l})})]})})}}]),n}(a.PureComponent),Os=Object(pi.a)((function(e){return{root:{display:"flex"},appBar:{width:"calc(100% - ".concat(js,"px)"),marginLeft:js},drawer:{width:js,flexShrink:0},drawerPaper:{width:js},toolbar:e.mixins.toolbar,content:{flexGrow:1,paddingTop:e.spacing(6.5),paddingLeft:e.spacing(1)}}}))(Object(o.b)((function(e){return{dataset:e.dataset,dialog:e.dialog,loading:e.loading,loadingApp:e.loadingApp,message:e.message,tab:e.tab,chartOptions:e.chartOptions}}),(function(e){return{handleDialog:function(t){e(Ja(t))},setMessage:function(t){e(Ba(t))}}}))(xs)),ys=Object(s.d)(nr,Object(s.a)(l.a));ys.dispatch((function(e,t){e(Xa({loading:!0,progress:0}));var n=(new Date).getTime();return window.setTimeout((function a(){if(t().loadingApp.loading){var i=((new Date).getTime()-n)/1e3,r=Math.min(100,i/32*100);e(Xa({loading:!0,progress:r})),r<100&&window.setTimeout(a,300)}}),500),fetch(vn+"/server").then((function(e){return e.json()})).then((function(t){if(t.api=new mn,null==t.clientId&&(t.clientId=""),null==t.dynamic&&(t.dynamic=!0),e({type:En,payload:t}),""===t.clientId)e(Xa({loading:!1})),e($a("server"===t.mode?"":null)),"server"===t.mode&&e(Aa({importer:!0})),e(si()).then((function(){e(Ra())}));else{console.log(((new Date).getTime()-n)/1e3+" startup time");var a=document.createElement("script");a.type="text/javascript",a.src="https://apis.google.com/js/api.js",a.onload=function(n){window.gapi.load("client:auth2",(function(){window.gapi.client.init({clientId:t.clientId,scope:gn.join(" ")}).then((function(){e(Xa({loading:!1,progress:0})),e(Fa(!0))}))}))},document.getElementsByTagName("head")[0].appendChild(a)}})).catch((function(t){console.log(t),e(Xa({loading:!1,progress:0})),oi(e,"Unable to load app. Please try again.")}))})),Object(r.render)(Object(ge.jsx)(o.a,{store:ys,children:Object(ge.jsx)(Os,{})}),document.getElementById("root"))}},[[426,1,2]]]);
//# sourceMappingURL=main.967652b4.chunk.js.map