(this.webpackJsonpcirrocumulus=this.webpackJsonpcirrocumulus||[]).push([[0],{394:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n(0),r=n.n(i),o=n(20),s=n(23),l=n(82),c=n(229),d=n(472),u=n(446),h=n(207),p=n(208),f=n(176),m=n(36),g=n(94),v=n.n(g),b=n(230),j=n.n(b),y=n(11),O=n(13),x=n(14),S=n(259),w=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return n}(Object(S.a)(Error)),C=n(12),k=n(160),E=n(83),P=n.n(E),M=function(){function e(t,n){Object(y.a)(this,e),this.vector=t,this.indices=n}return Object(C.a)(e,[{key:"getName",value:function(){return this.vector.getName()}},{key:"size",value:function(){return this.indices.length}},{key:"get",value:function(e){return this.vector.get(this.indices[e])}}]),e}();function I(e,t){for(var n=new Set,a=0,i=e.size();a<i;a++)t(e.get(a))&&n.add(a);return n}function D(e,t){var n=[];return e.forEach((function(e){for(var a={},i=0,r=e.size();i<r;i++){var o=e.get(i),s=a[o];void 0===s&&(s=[],a[o]=s),s.push(i)}var l=Object.keys(a);l.sort(P()());var c={categories:l,name:e.getName(),values:[]};t.forEach((function(e){c.values.push({fractionExpressed:[],mean:[],name:e.getName()})})),l.forEach((function(e){var n=a[e];t.forEach((function(e,t){var a=new M(e,n),i=z(a);c.values[t].mean.push(i.mean),c.values[t].fractionExpressed.push(i.numExpressed/a.size())}))})),n.push(c)})),n}function z(e){for(var t=Number.MAX_VALUE,n=-Number.MAX_VALUE,a=0,i=0,r=0,o=e.size();r<o;r++){var s=e.get(r);t=s<t?s:t,n=s>n?s:n,a+=s,0!==s&&i++}return{min:t,max:n,sum:a,mean:a/e.size(),numExpressed:i}}function A(e,t,n){return"or"===n?new Set([].concat(Object(k.a)(e),Object(k.a)(t))):new Set(Object(k.a)(e).filter((function(e){return t.has(e)})))}function _(e,t){var n=null;if(t)for(var a=t.filters||[],i=t.combine||"and",r=function(t){var r=a[t],o=r[0],s=r[1],l=r[2],c=null;if(Object(m.isObject)(o)){var d=N(o.basis,o.nbins,o.agg,o.ndim||2,o.precomputed),u=d.coordinate_columns;if(l.points){if("index"!=(d.nbins?d.full_name:"index"))throw"Not implemented";c=l.points}else{for(var h,p=l.path,f=function(t){var n=p[t],a=I(e[u[0]],(function(e){return e>=n.x&&e<=n.x+n.width})),i=I(e[u[1]],(function(e){return e>=n.y&&e<=n.y+n.height}));if(h=A(a,i,"and"),n.z){var r=I(e[u[2]],(function(e){return e>=n.z&&e<=n.z+n.depth}));h=A(h,r,"and")}},g=0;g<p.length;g++)f(g);c=c?A(h,c,i):h}}else{var v,b=e[o];if("in"===s)l=new Set(l),v=function(e){return l.has(e)};else if(">"===s)v=function(e){return e>l};else if("="===s)v=function(e){return e===l};else if("<"===s)v=function(e){return e<l};else if("!="===s)v=function(e){return e!==l};else if(">="===s)v=function(e){return e>=l};else{if("<="!==s)throw"Unknown filter";v=function(e){return e<=l}}c=I(b,v)}n=n?A(n,c,i):c},o=0;o<a.length;o++)r(o);return null!=n?Array.from(n):null}var T=function(){function e(t,n){Object(y.a)(this,e),this.name=t,this.values=n}return Object(C.a)(e,[{key:"getName",value:function(){return this.name}},{key:"size",value:function(){return this.values.length}},{key:"get",value:function(e){return this.values[e]}},{key:"asArray",value:function(){return this.values}}]),e}();function F(e){var t=e.indexOf("/");if(-1===t)return{name:e,type:"X"};var n=e.substring(0,t);return{name:e.substring(t+1),type:n}}function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];a=parseInt(a);for(var r=[],o=0;o<a;o++)r.push(e+"_"+o+1);var s=e+"_"+a;return null!=t&&(s=s+"_"+t+"_"+n),{name:e,dimensions:a,coordinate_columns:r,nbins:t,agg:n,full_name:s,precomputed:i}}function R(e){var t=new Set,n=new Set,a=[];if(e)for(var i=e.filters||[],r=0;r<i.length;r++){var o=i[r],s=o[0];if(Object(m.isObject)(s)){var l=N(s.basis,s.nbins,s.agg,s.ndim||2,s.precomputed);a.push(l)}else{var c=F(s),d=c.name,u=c.type;o[0]=d,"X"===u?t.add(d):n.add(d)}}return{basis:a,X:Array.from(t),obs:Array.from(n)}}function L(e){for(var t=[],n=[],a=0;a<e.length;a++){var i=F(e[a]),r=i.name,o=i.type;if("X"===o)n.push(r);else{if("obs"!==o)throw"Unknown key type "+o;t.push(r)}}return{obsMeasures:t,varMeasures:n}}function B(e,t,n){var a={};return e.forEach((function(e){a[e.getName()]=function(e){for(var t={},n=0,a=e.size();n<a;n++){var i=e.get(n),r=t[i]||0;t[i]=r+1}var o=Object.keys(t);o.sort(P()());var s=o.map((function(e){return t[e]}));return{categories:o,counts:s}}(e)})),t.forEach((function(e){a[e.getName()]=z(e)})),n.forEach((function(e){a[e.getName()]=z(e)})),a}var U=function(){function e(){Object(y.a)(this,e)}return Object(C.a)(e,[{key:"init",value:function(e,t){var n=this;return this.id=e,this.key2vector={},this.schema=null,t.endsWith(".json")||(t+="schema.json"),this.url=t,this.baseUrl=this.url.substring(0,this.url.lastIndexOf("/")+1),new Promise((function(e,a){fetch(t).then((function(e){return e.json()})).then((function(t){n.schema=t,e()}))}))}},{key:"_fetch",value:function(e){return fetch(this.baseUrl+e+".json").then((function(e){return e.json()}))}},{key:"fetchData",value:function(e){var t=this,n=[];return e.forEach((function(e){if(null==t.key2vector[e]&&"__count"!==e){var a=t._fetch(e).then((function(n){if(Object(m.isArray)(n))t.key2vector[e]=new T(e,n);else if(n.index){for(var a=new Float32Array(t.schema.shape[0]),i=0,r=n.index.length;i<r;i++)a[n.index[i]]=n.value[i];t.key2vector[e]=new T(e,a)}else t.key2vector[e]=new T(e,n)}));n.push(a)}})),new Promise((function(e){Promise.all(n).then((function(){return e()}))}))}},{key:"getSelectedIdsPromise",value:function(e){var t=this,n=e.filter,a=R(n),i=a.basis,r=a.X,o=a.obs,s=[];return i.forEach((function(e){s.push(e.name)})),s.push("index"),s=s.concat(r).concat(o),new Promise((function(e){t.fetchData(s).then((function(){for(var a=_(t.key2vector,n),i=t.getVector("index",a),r=[],o=0,s=i.size();o<s;o++)r.push(i.get(o));e({ids:r})}))}))}},{key:"getDataPromise",value:function(e){var t=this,n=[],a=[],i={};["stats","groupedStats","embedding","selection"].forEach((function(t){if(t in e){var i=e[t];Object(m.isArray)(i)||(i=[i]),i.forEach((function(e){e.dimensions&&(n=n.concat(e.dimensions)),e.measures&&(a=a.concat(e.measures))}))}}));var r=L(a),o=r.obsMeasures,s=r.varMeasures,l=new Set;if(e.selection){var c=R(e.selection.filter),d=c.basis,u=c.X,h=c.obs;n=n.concat(h),a=a.concat(u);var p=e.selection.embeddings||[],f=[];p.forEach((function(e){var t=N(e.basis,e.nbins,e.agg,e.ndim||2,e.precomputed);l.add(t.name),f.push(t)})),e.selection.embeddings=f,d.forEach((function(e){l.add(e.name)}))}return e.embedding&&e.embedding.forEach((function(e){var t=N(e.basis,e.nbins,e.agg,e.ndim||2,e.precomputed);l.add(t.name),e.basis=t})),new Promise((function(a){t.fetchData(n.concat(o).concat(s).concat(Array.from(l))).then((function(){if(e.embedding&&(i.embedding=[],e.embedding.forEach((function(e){var n=e.dimensions||[],a=L(e.measures||[]),r=a.obsMeasures,o=a.varMeasures,s={},l=t.getVector(e.basis.name).asArray();n.concat(r).concat(o).forEach((function(e){"__count"===e?(s[e]=new Int8Array(l[Object.keys(l)[0]].length),s[e].fill(1)):s[e]=t.getVector(e).asArray()})),i.embedding.push({coordinates:l,values:s})}))),e.stats){var n=e.stats.dimensions||[],r=L(e.stats.measures||[]),o=r.obsMeasures,s=r.varMeasures;i.summary=B(t.getVectors(n),t.getVectors(o),t.getVectors(s))}if(e.groupedStats){var l=e.groupedStats.dimensions||[],c=e.groupedStats.measures||[];l.length>0&&c.length>0&&(i.dotplot=D(t.getVectors(l),t.getVectors(c)))}if(e.selection){var d=e.selection.dimensions||[],u=e.selection.measures||[],h=e.selection.embeddings||[],p=L(u),f=p.obsMeasures,m=p.varMeasures;i.selection={};var g=_(t.key2vector,e.selection.filter);h.length>0&&(i.selection.coordinates={},h.forEach((function(e){i.selection.coordinates[e.full_name]={indices_or_bins:g}}))),d.length>0&&m.length>0&&(i.selection.dotplot=D(t.getVectors(d,g),t.getVectors(u,g))),i.selection.count=g.length,i.selection.summary=B(t.getVectors(d,g),t.getVectors(f,g),t.getVectors(m,g))}a(i)}))}))}},{key:"getSchemaPromise",value:function(){return Promise.resolve(this.schema)}},{key:"getVector",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.key2vector[e];return null==t?n:new M(n,t)}},{key:"getFileUrl",value:function(e){return this.baseUrl+e}},{key:"getVectors",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=[];return e.forEach((function(e){var i=t.key2vector[e];null!=n&&(i=new M(i,n)),a.push(i)})),a}}]),e}(),H=function(){function e(){Object(y.a)(this,e)}return Object(C.a)(e,[{key:"init",value:function(e){return this.id=e,Promise.resolve()}},{key:"getSelectedIdsPromise",value:function(e){return e.id=this.id,fetch(vt+"/selected_ids",{body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+Vn()}}).result((function(e){return e.json()}))}},{key:"getFileUrl",value:function(e){return vt+"/file?id="+this.id+"&file="+e+"&access_token="+Vn()}},{key:"getDataPromise",value:function(e){return e.id=this.id,fetch(vt+"/data",{body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"getSchemaPromise",value:function(){return fetch(vt+"/schema?id="+this.id,{headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}}]),e}(),V=function(){function e(){Object(y.a)(this,e)}return Object(C.a)(e,[{key:"getUserPromise",value:function(){return fetch(vt+"/user",{headers:{Authorization:"Bearer "+Vn(),"Content-Type":"application/json"}}).then((function(e){return e.json()}))}},{key:"getDatasetsPromise",value:function(){return fetch(vt+"/datasets",{headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"deleteDatasetPromise",value:function(e){return fetch(vt+"/dataset",{body:JSON.stringify({id:e}),method:"DELETE",headers:{Authorization:"Bearer "+Vn()}})}},{key:"upsertDatasetPromise",value:function(e,t){var n=null!=e;return null!=e&&(t.id=e),fetch(vt+"/dataset",{body:JSON.stringify(t),method:n?"PUT":"POST",headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"getDatasetPromise",value:function(e){return fetch(vt+"/dataset?id="+e,{method:"GET",headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"setCategoryNamePromise",value:function(e){return fetch(vt+"/category_name",{body:JSON.stringify(e),method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+Vn()}})}},{key:"upsertDatasetFilterPromise",value:function(e,t){return fetch(vt+"/filter",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"upsertFeatureSet",value:function(e,t){return fetch(vt+"/feature_set",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"deleteFeatureSet",value:function(e,t){return fetch(vt+"/feature_set",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+Vn()}})}},{key:"exportDatasetFiltersPromise",value:function(e){return fetch(vt+"/export_filters?id="+e,{headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.ok?e.text():null}))}},{key:"deleteDatasetFilterPromise",value:function(e,t){return fetch(vt+"/filter",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+Vn()}})}},{key:"getDatasetFilterPromise",value:function(e,t){return fetch(vt+"/filter?id="+e+"&ds_id="+t,{headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"getCategoryNamesPromise",value:function(e){return fetch(vt+"/category_name?id="+e,{headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}},{key:"getFiltersPromise",value:function(e){return fetch(vt+"/filters?id="+e,{headers:{Authorization:"Bearer "+Vn()}}).then((function(e){return e.json()}))}}]),e}(),W=n(66),K=n(116),G=n(15),X=n(69),q=n(74),Z=n(52),Y=n.n(Z),J=n(101),$=n(436),Q=n(263),ee=n(260),te=n(440),ne=n(240),ae=n.n(ne),ie=n(241),re=n.n(ie),oe=n(236),se=n.n(oe),le=n(239),ce=n.n(le),de=n(234),ue=n.n(de),he=n(238),pe=n.n(he),fe=n(154),me=n.n(fe),ge=n(243),ve=n.n(ge),be=n(235),je=n.n(be),ye=n(237),Oe=n.n(ye),xe=n(242),Se=n.n(xe),we=n(232),Ce=n.n(we),ke=n(233),Ee=n.n(ke),Pe="cirro-active",Me=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).setDragMode=function(e){a.props.onDragMode(e)},a.onShowLabels=function(){a.props.onShowLabels()},a.onShowAxis=function(){a.props.onShowAxis()},a.onShowFog=function(){a.props.onShowFog()},a.onGallery=function(){a.props.onGallery()},a.handleMoreOptions=function(){a.props.onMoreOptions()},a.setEditSelection=function(){a.props.onEditSelection()},a.handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){a.setState({saveImageEl:null}),a.props.onSaveImage(e)},a.state={saveImageEl:null},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dragmode,i=t.editSelection,o=t.showLabels,s=t.showAxis,l=this.state.saveImageEl;return Object(a.jsxs)(r.a.Fragment,{children:[this.props.onZoomIn&&Object(a.jsx)($.a,{title:"Zoom In",children:Object(a.jsx)(Q.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:this.props.onZoomIn,children:Object(a.jsx)(Ce.a,{})})}),this.props.onZoomOut&&Object(a.jsx)($.a,{title:"Zoom Out",children:Object(a.jsx)(Q.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:this.props.onZoomOut,children:Object(a.jsx)(Ee.a,{})})}),this.props.onHome&&Object(a.jsx)($.a,{title:"Home",children:Object(a.jsx)(Q.a,{edge:!1,size:"small","aria-label":"Home",onClick:this.props.onHome,children:Object(a.jsx)(ue.a,{})})}),Object(a.jsx)($.a,{title:"Lasso Select",children:Object(a.jsx)(Q.a,{edge:!1,size:"small",className:"lasso"===n?Pe:"","aria-label":"Lasso Select",onClick:function(){return e.setDragMode("lasso")},children:Object(a.jsx)("svg",{className:"MuiSvgIcon-root",width:"24",height:"21",viewBox:"0 0 1031 1000",children:Object(a.jsx)("path",{d:"m1018 538c-36 207-290 336-568 286-277-48-473-256-436-463 10-57 36-108 76-151-13-66 11-137 68-183 34-28 75-41 114-42l-55-70 0 0c-2-1-3-2-4-3-10-14-8-34 5-45 14-11 34-8 45 4 1 1 2 3 2 5l0 0 113 140c16 11 31 24 45 40 4 3 6 7 8 11 48-3 100 0 151 9 278 48 473 255 436 462z m-624-379c-80 14-149 48-197 96 42 42 109 47 156 9 33-26 47-66 41-105z m-187-74c-19 16-33 37-39 60 50-32 109-55 174-68-42-25-95-24-135 8z m360 75c-34-7-69-9-102-8 8 62-16 128-68 170-73 59-175 54-244-5-9 20-16 40-20 61-28 159 121 317 333 354s407-60 434-217c28-159-121-318-333-355z",transform:"matrix(1 0 0 -1 0 850)"})})})}),Object(a.jsx)($.a,{title:"Box Select",children:Object(a.jsx)(Q.a,{edge:!1,size:"small","aria-label":"Box Select",onClick:function(){return e.setDragMode("select")},children:Object(a.jsx)(je.a,{className:"select"===n?Pe:""})})}),Object(a.jsx)($.a,{title:"Append to selection",children:Object(a.jsx)(Q.a,{edge:!1,size:"small","aria-label":"Append to selection",onClick:this.setEditSelection,children:Object(a.jsx)(se.a,{className:i?Pe:""})})}),this.props.is3d&&Object(a.jsx)($.a,{title:this.props.animating?"Pause":"Animate",children:Object(a.jsxs)(Q.a,{edge:!1,size:"small","aria-label":this.props.animating?"Pause":"Animate",onClick:this.props.toggleAnimation,children:[!this.props.animating&&Object(a.jsx)(Oe.a,{}),this.props.animating&&Object(a.jsx)(pe.a,{})]})}),Object(a.jsx)($.a,{title:"Pan",children:Object(a.jsx)(Q.a,{edge:!1,size:"small",className:"pan"===n?Pe:"","aria-label":"Pan",onClick:function(){return e.setDragMode("pan")},children:Object(a.jsx)("svg",{className:"MuiSvgIcon-root",viewBox:"0 0 1000 1000",height:"16",width:"16",children:Object(a.jsx)("path",{d:"m1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z",transform:"matrix(1 0 0 -1 0 850)"})})})}),this.props.onShowLabels&&Object(a.jsx)($.a,{title:"Show Categorical Labels",children:Object(a.jsx)(Q.a,{edge:!1,size:"small",className:o?Pe:"","aria-label":"Show Labels",onClick:function(){return e.onShowLabels()},children:Object(a.jsx)(ce.a,{})})}),this.props.is3d&&this.props.onShowAxis&&Object(a.jsx)($.a,{title:"Show Axis",children:Object(a.jsx)(Q.a,{edge:!1,size:"small",className:s?Pe:"","aria-label":"Show Axis",onClick:function(){return e.onShowAxis()},children:Object(a.jsx)(ae.a,{})})}),this.props.is3d&&this.props.onShowFog&&Object(a.jsx)($.a,{title:"Show Fog",children:Object(a.jsx)(Q.a,{edge:!1,size:"small",className:this.props.showFog?Pe:"","aria-label":"Show Fog",onClick:function(){return e.onShowFog()},children:Object(a.jsx)(re.a,{})})}),Object(a.jsx)($.a,{title:"Save Image",children:Object(a.jsx)(Q.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(a.jsx)(me.a,{})})}),Object(a.jsxs)(ee.a,{id:"save-image-menu",anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:this.handleSaveImageMenuClose,children:[Object(a.jsx)(te.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(a.jsx)(te.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),Object(a.jsx)($.a,{title:"More Options",children:Object(a.jsx)(Q.a,{edge:!1,size:"small","aria-label":"More Options",onClick:this.handleMoreOptions,children:Object(a.jsx)(Se.a,{})})}),Object(a.jsx)($.a,{title:"View Gallery",children:Object(a.jsx)(Q.a,{edge:!1,size:"small","aria-label":"View Gallery",onClick:this.onGallery,children:Object(a.jsx)(ve.a,{})})})]})}}]),n}(r.a.PureComponent),Ie=n(244),De=n.n(Ie),ze=n(473),Ae=Object(ze.a)(".1f"),_e=Object(ze.a)(","),Te=Object(ze.a)(".0f");function Fe(e,t,n,a,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"black",s=a.domain();if(s[0]!==s[1]){for(var l=s[0],c=(s[1]-s[0])/r,d=18,u=e.createLinearGradient(0,0,t,d),h=Object(J.a)().range([0,1]).domain(s).clamp(!0),p=0;p<r;p++){p===r-1&&(l=s[1]);var f=h(l);if(!isNaN(f)){var m=a(l);u.addColorStop(f,m)}l+=c}e.fillStyle=u,e.fillRect(0,0,t,d),e.strokeStyle="LightGrey",e.strokeRect(0,0,t,d),i>0&&(e.textBaseline="top",e.fillStyle=o,e.textAlign="left",e.fillText(Ae(s[0]),0,d+2),e.textAlign="right",e.fillText(Ae(s[1]),t,d+2))}}var Ne=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).ref=r.a.createRef(),a.backingScale=1,a}return Object(C.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(t.font="12px Roboto Condensed,Helvetica,Arial,sans-serif",Fe(t,a,n,r,this.props.label,10,i),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"render",value:function(){"undefined"!==typeof window&&"devicePixelRatio"in window&&(this.backingScale=window.devicePixelRatio);var e=this.props.height,t=this.props.width,n={width:t,height:e};return this.props.style&&(n=Object.assign({},n,this.props.style)),Object(a.jsx)("canvas",{width:t*this.backingScale,height:e*this.backingScale,ref:this.ref,style:n})}}]),n}(r.a.PureComponent);function Re(e,t,n,a){var i,r=null,o={width:t.width,height:t.height},s=e.name;if("__count"===s&&(s="count"),"svg"!==a?((r=document.createElement("canvas")).width=100,r.height=100,i=r.getContext("2d")):i=new De.a(100,100),e.continuous)o.height+=150;else{var l=function(e,t,n){e.font="14px Helvetica";var a=e.measureText(t).width;return n.forEach((function(t){return a=Math.max(a,e.measureText(t).width)})),{width:a+14,height:12*n.length+4}}(i,s,e.colorScale.domain());o.width+=l.width,o.height=Math.max(l.height,t.height)}if("svg"===a?i=new window.C2S(o.width,o.height):(r.width=o.width*window.devicePixelRatio,r.height=o.height*window.devicePixelRatio,(i=r.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),i.fillStyle="white",i.fillRect(0,0,o.width,o.height)),n(i,t,a),e.continuous?(i.translate(t.width/2-75,t.height+2),Fe(i,150,20,e.colorScale,!0)):(i.translate(t.width,2),function(e,t,n,a){e.font="14px Helvetica",e.textAlign="left",e.textBaseline="bottom";for(var i=0;i<a.length;i++){var r=a[i];e.fillStyle=t(r),e.fillRect(0,12*i,10,10),e.fillStyle="black",e.fillText(""+r,12,12*i+12)}}(i,e.colorScale,0,e.colorScale.domain())),"svg"===a){var c=i.getSerializedSvg(),d=new Blob([c],{type:"text/plain;charset=utf-8"});window.saveAs(d,s+".svg")}else r.toBlob((function(e){window.saveAs(e,s+".png",!0)}))}var Le=n(443),Be=n(110),Ue=n(97),He=n.n(Ue),Ve={Diverging:["interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral"],"Sequential (Single Hue)":["interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds"],"Sequential (Multi-Hue)":["interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateWarm","interpolateCool","interpolateCubehelixDefault","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateYlOrBr","interpolateYlOrRd"],Cyclical:["interpolateRainbow","interpolateSinebow"]},We=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],Ke=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];function Ge(e){if(e.isImage){for(var t=[],n=e.colorScale,a=function(e){return e.formatHex()},i=0,r=e.npoints;i<r;i++){var o=Object(W.e)(n(e.values[i]));t.push(a(o))}e.colors=t}else e.colors=function(e){for(var t=4,n=Object(J.a)().domain([0,255]).range([0,1]),a=0,i=e.colorScale,r=e.x.length,o=new Float32Array(r*t),s=0;s<r;++s){var l=Object(W.e)(i(e.values[s]));o[a++]=n(l.r),o[a++]=n(l.g),o[a++]=n(l.b),o[a++]=1}return o}(e)}function Xe(e){for(var t=e.length,n=new Uint32Array(t),a=0;a<t;a++)n[e[a]]=a+1;return n}function qe(e,t){for(var n=[],a=0,i=e.length;a<i;a++)n.push({value:e[a],index:a});return function(e,t){t?e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.index<t.index?-1:1})):e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.index<t.index?1:-1}));for(var n=new Uint32Array(e.length),a=0,i=e.length;a<i;a++)n[a]=e[a].index;return n}(n,t)}function Ze(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new Uint32Array(e),a=0;a<e;a++,t++)n[a]=t;return Object(Le.a)(n),n}function Ye(e,t){for(var n=e.x,a=e.y,i=!1,r=0,o=t.length-1;r<t.length;o=r++){var s=t[r].x,l=t[r].y,c=t[o].x,d=t[o].y;l>a!=d>a&&n<(c-s)*(a-l)/(d-l)+s&&(i=!i)}return i}function Je(e){e.length>1&&(e=He()(e));for(var t="M "+e[0].x+" "+e[0].y,n=1;n<e.length;n++)t+=" L "+e[n].x+" "+e[n].y;return t+=" Z"}function $e(e){return e.startsWith("interpolate")||(e="interpolate"+e),e}function Qe(e){return Be[$e(e)]}function et(e,t){var n=[];t=new Set(t);for(var a=0,i=e.length;a<i;a++)t.has(e[a])&&n.push(a);return n}function tt(e,t){var n=new Set(t);e.forEach((function(e){var a=e.features;a&&a.forEach((function(e){n.has(e)||(t.push(e),n.add(e))}))}))}function nt(e,t){var n=[];return t.forEach((function(t){for(var a=0;a<e.length;a++)if(e[a].id===t){n.push(e[a]);break}})),n}function at(e){var t=[],n=[],a=[],i=[];return e.forEach((function(e){"X"===e.type?t.push(e.value):"obs"===e.type?n.push(e.value):"obsCat"===e.type?a.push(e.value):"featureSet"===e.type?i.push(e.value):console.log("Unknown type: "+e)})),{X:t,obs:n,obsCat:a,featureSets:i}}function it(e,t,n){var a=function(e,t,n){return Math.min(Math.max(e,t),n)}((n-e)/(t-e),0,1);return a*a*(3-2*a)}function rt(e,t,n){return e*(1-n)+t*n}function ot(e,t,n,a,i){var r=new G.Vector3;e.fillStyle=n.darkMode?"white":"black",e.strokeStyle=n.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",e.lineWidth=n.labelStrokeWidth,e.textAlign="center",e.textBaseline="middle";for(var o=a.width/2,s=a.height/2,l=0,c=0;l<t.labels.length;l++,c+=3)r.x=t.positions[c],r.y=t.positions[c+1],r.z=t.positions[c+2],r.project(i),r.x=r.x*o+o,r.y=-r.y*s+s,e.strokeText(t.labels[l],r.x,r.y),e.fillText(t.labels[l],r.x,r.y)}function st(e,t){for(var n=0;n<e.visualizers.length;n++)if(e.visualizers[n].id===t)return e.visualizers[n]}var lt=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t=a.props;Re(t.traceInfo,t.chartSize,Object(m.bind)(a.drawContext,Object(X.a)(a)),e)},a.onEditSelection=function(){a.props.chartOptions.editSelection=!a.props.chartOptions.editSelection,a.props.setChartOptions(a.props.chartOptions)},a.onShowLabels=function(){a.props.chartOptions.showLabels=!a.props.chartOptions.showLabels,a.props.setChartOptions(a.props.chartOptions)},a.onShowAxis=function(){var e=a.scatterPlot.scene.getObjectByName("axes");a.props.chartOptions.showAxis=!a.props.chartOptions.showAxis,e&&(e.visible=a.props.chartOptions.showAxis),a.props.setChartOptions(a.props.chartOptions)},a.onShowFog=function(){var e=st(a.scatterPlot,dt);a.props.chartOptions.showFog=!a.props.chartOptions.showFog,e.styles.fog.enabled=a.props.chartOptions.showFog,a.props.setChartOptions(a.props.chartOptions)},a.onDragMode=function(e){"pan"===e?a.scatterPlot.setInteractionMode("PAN"):"select"===e?(a.scatterPlot.setInteractionMode("SELECT"),a.scatterPlot.rectangleSelector.setSelectionMode("BOX")):"lasso"===e&&(a.scatterPlot.rectangleSelector.setSelectionMode("LASSO"),a.scatterPlot.setInteractionMode("SELECT")),a.props.chartOptions.dragmode=e,a.props.setChartOptions(a.props.chartOptions)},a.onToggleAnimation=function(){a.scatterPlot.orbitIsAnimating()?(a.scatterPlot.stopOrbitAnimation(),a.props.chartOptions.animating=!1):(a.scatterPlot.startOrbitAnimation(),a.props.chartOptions.animating=!0),a.props.setChartOptions(a.props.chartOptions)},a.containerElementRef=r.a.createRef(),a.tooltipElementRef=r.a.createRef(),a.scatterPlot=null,a.lastHoverIndex=-1,a.state={forceUpdate:!1},a}return Object(C.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.chartSize!==this.props.chartSize&&this.scatterPlot.resize(),this.init(),this.draw()}},{key:"componentDidMount",value:function(){this.init(),this.draw(),this.draw(),this.props.chartOptions.camera&&(this.scatterPlot.updateFromCameraDef(this.props.chartOptions.camera),this.props.chartOptions.camera=null,this.draw())}},{key:"componentWillUnmount",value:function(){}},{key:"calculatePointSize",value:function(e){var t=e.npoints,n=200/Math.log(t)/Math.log(8);return 3===e.dimensions?n:n/1.5}},{key:"drawContext",value:function(e,t,n){var a=this.props,i=a.traceInfo,r=a.markerOpacity,o=a.unselectedMarkerOpacity,s=a.selection,l=a.categoricalNames,c=a.chartOptions,d=this.props.chartOptions.showLabels&&i.isCategorical,u=this.calculatePointSize(i),h=this.props.pointSize,p=2*Math.PI,f=i.colors,m=i.positions,g=this.scatterPlot.camera,v=t.width,b=t.height;c.darkMode&&(e.fillStyle="black",e.fillRect(0,0,v,b));var j=v/2,y=b/2,O=Object(J.a)().domain([0,1]).range([0,255]),x=i.npoints,S=3===i.dimensions,w=0,C=this.scatterPlot.scene.fog,k=st(this.scatterPlot,dt);if(!S){var E=.9/Math.atan(2),P=g.projectionMatrix.elements[0]+.3;w=u*(P<1?1+E*Math.atan(2*(P-1)):1+8.91267681314614*Math.atan(.02*(P-1)))}var M=new G.Vector3,I=new G.Vector4,D=k.points,z=D.modelViewMatrix.clone();z.multiplyMatrices(g.matrixWorldInverse,D.matrixWorld);for(var A=w*h/4,_=c.showFog,T=0===s.size,F=0,N=0,R=0;F<x;F++,N+=4,R+=3){var L=T||s.has(F);M.x=m[R],M.y=m[R+1],M.z=m[R+2],M.project(g);var B=f[N],U=f[N+1],H=f[N+2],V=L?r:o;if(S&&(I.x=m[R],I.y=m[R+1],I.z=m[R+2],I.w=1,I.applyMatrix4(z),A=(w=-u/I.z)*h/4,_)){var W=u/w*1.2,K=it(C.near,C.far,W);B=rt(B,C.color.r,K),U=rt(U,C.color.g,K),H=rt(H,C.color.b,K)}M.x=M.x*j+j,M.y=-M.y*y+y,B=Math.round(O(B)),U=Math.round(O(U)),H=Math.round(O(H)),e.fillStyle="rgba("+B+","+U+","+H+","+V+")",e.beginPath(),e.arc(M.x,M.y,A,0,p),e.closePath(),e.fill()}if(d){var X=mt(i,l),q="svg"===n?"serif":"Roboto Condensed";e.font="bold "+c.labelFontSize+"px "+q,ot(e,X,c,t,g)}}},{key:"init",value:function(){var e=this;if(null==this.scatterPlot){var t=this.containerElementRef.current;this.scatterPlot=ft(t,window.ApplePaySession,!0),"pan"===this.props.chartOptions.dragmode?this.scatterPlot.setInteractionMode("PAN"):"select"===this.props.chartOptions.dragmode?(this.scatterPlot.setInteractionMode("SELECT"),this.scatterPlot.rectangleSelector.setSelectionMode("BOX")):"lasso"===this.props.chartOptions.dragmode&&(this.scatterPlot.setInteractionMode("SELECT"),this.scatterPlot.rectangleSelector.setSelectionMode("LASSO"));var n=this.scatterPlot.scene.getObjectByName("axes");n&&(n.visible=this.props.chartOptions.showAxis),st(this.scatterPlot,dt).styles.fog.enabled=this.props.chartOptions.showFog,this.scatterPlot.hoverCallback=function(t){if(null==t)e.tooltipElementRef.current.innerHTML=" ";else{var n=e.props.traceInfo,a=n.positions,i=e.scatterPlot.camera,r=e.props.chartSize.width/2,o=e.props.chartSize.height/2,s=new G.Vector3,l=-1;if(-1!==e.lastHoverIndex&&(s.x=a[3*e.lastHoverIndex],s.y=a[3*e.lastHoverIndex+1],s.z=a[3*e.lastHoverIndex+2],s.project(i),s.x=s.x*r+r,s.y=-s.y*o+o,Math.abs(s.x-t.x)<=2&&Math.abs(s.y-t.y)<=2&&(l=e.lastHoverIndex)),-1===l)for(var c=0,d=0;c<n.npoints;c++,4,d+=3)if(s.x=a[d],s.y=a[d+1],s.z=a[d+2],s.project(i),s.x=s.x*r+r,s.y=-s.y*o+o,Math.abs(s.x-t.x)<=2&&Math.abs(s.y-t.y)<=2){l=c;break}if(e.lastHoverIndex=l,-1!==l){var u=n.values[l],h=e.props.categoricalNames[n.name];if(h){var p=h[u];null!=p&&(u=p)}"number"===typeof u&&(u=Ae(u)),e.tooltipElementRef.current.innerHTML=""+u}else e.tooltipElementRef.current.innerHTML=" "}},this.scatterPlot.lassoCallback=function(t){for(var n=e.props.traceInfo,a=n.positions,i=e.scatterPlot.camera,r=e.props.chartSize.width/2,o=e.props.chartSize.height/2,s=new G.Vector3,l=[],c=0,d=0;c<n.npoints;c++,4,d+=3)s.x=a[d],s.y=a[d+1],s.z=a[d+2],s.project(i),s.x=s.x*r+r,s.y=-s.y*o+o,Ye(s,t)&&l.push(c);0===l.length?e.props.onDeselect({name:yn(n.embedding)}):e.props.onSelected({name:yn(n.embedding),clear:!e.props.chartOptions.editSelection,value:{basis:n.embedding,points:l}})},this.scatterPlot.boxCallback=function(t){if("PAN"!==e.scatterPlot.interactionMode){for(var n=e.props.traceInfo,a=n.positions,i=e.scatterPlot.camera,r=e.props.chartSize.width/2,o=e.props.chartSize.height/2,s=new G.Vector3,l=[],c=0,d=0;c<n.npoints;c++,4,d+=3)s.x=a[d],s.y=a[d+1],s.z=a[d+2],s.project(i),s.x=s.x*r+r,s.y=-s.y*o+o,s.x>=t.x&&s.x<=t.x+t.width&&s.y>=t.y&&s.y<=t.y+t.height&&l.push(c);0===l.length?e.props.onDeselect({name:yn(n.embedding)}):e.props.onSelected({name:yn(n.embedding),clear:!e.props.chartOptions.editSelection,value:{basis:n.embedding,points:l}})}};var a=this.containerElementRef.current.querySelector("canvas");a.style.outline="0px";a.addEventListener("webglcontextlost",(function(t){t.preventDefault(),e.scatterPlot=null})),a.addEventListener("webglcontextrestored",(function(t){e.setState({forceUpdate:!e.state.forceUpdate})}))}}},{key:"draw",value:function(){var e=this.props,t=e.traceInfo,n=e.markerOpacity,a=e.unselectedMarkerOpacity,i=e.selection,r=e.pointSize,o=e.chartOptions,s=e.categoricalNames;gt(this.scatterPlot,t,i,n,a,r,s,o)}},{key:"render",value:function(){return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{className:this.props.classes.root,children:[Object(a.jsx)(Me,{dragmode:this.props.chartOptions.dragmode,editSelection:this.props.chartOptions.editSelection,showLabels:this.props.chartOptions.showLabels,onMoreOptions:this.props.onMoreOptions,onGallery:this.props.onGallery,animating:this.props.chartOptions.animating,showFog:this.props.chartOptions.showFog,onShowFog:this.onShowFog,is3d:this.props.traceInfo&&null!=this.props.traceInfo.z,toggleAnimation:this.onToggleAnimation,onSaveImage:this.onSaveImage,onShowLabels:this.onShowLabels,onDragMode:this.onDragMode,onCopyImage:this.onCopyImage,onEditSelection:this.onEditSelection,onShowAxis:this.onShowAxis,showAxis:this.props.chartOptions.showAxis}),Object(a.jsx)(q.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(a.jsx)("div",{style:{display:"inline-block",width:this.props.chartSize.width,height:this.props.chartSize.height},ref:this.containerElementRef})]})}}]),n}(r.a.PureComponent),ct=Y()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},"& > .cirro-active":{fill:"rgb(220, 0, 78)",color:"rgb(220, 0, 78)"},"& > .cirro-inactive":{fill:"rgba(0, 0, 0, 0.26)",color:"rgba(0, 0, 0, 0.26)"},position:"absolute",top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(lt),dt="SPRITES",ut="SVG_LABELS";function ht(e,t,n){var a=t[1]-t[0],i=n[1]-n[0];return(e-t[0])/a*i+n[0]}function pt(e){var t=1.2,n=e.width/e.height,a=-1.2,i=t,r=-1.2,o=t;n>1?(a*=n,i*=n):(o/=n,r/=n);var s=new G.OrthographicCamera(a,i,o,r,-1e3,1e3);return s.up=new G.Vector3(0,0,1),s.updateProjectionMatrix(),s.projectionMatrix.elements[0]}function ft(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Object(K.makeStyles)();i.label3D.fontSize=40;var r=new K.ScatterPlot(e,{camera:{},selectEnabled:!1,styles:i,interactive:a},t),o=[new K.ScatterPlotVisualizerSprites(i)];return n&&o.push(new K.ScatterPlotVisualizerSvgLabels(e,i)),r.setActiveVisualizers(o),r}function mt(e,t){for(var n={},a=0,i=e.isImage,r=0,o=0;r<e.npoints;r++,o+=3){var s=e.values[r],l=n[s];void 0===l&&(l={x:[],y:[],z:[]},n[s]=l,a++),l.count++,i?(l.x.push(e.x[r]),l.y.push(e.y[r])):(l.x.push(e.positions[o]),l.y.push(e.positions[o+1]),l.z.push(e.positions[o+2]))}var c=[],d=new Float32Array(3*a),u=0,h=t[e.name];for(var p in void 0===h&&(h={}),n){var f=h[p];void 0!==f?c.push(f):c.push(p);var m=n[p];m.x.sort((function(e,t){return e-t})),m.y.sort((function(e,t){return e-t})),m.z.sort((function(e,t){return e-t}));var g=m.x.length/2;d[u]=g%1?m.x[g-.5]:(m.x[g-1]+m.x[g])/2,d[u+1]=g%1?m.y[g-.5]:(m.y[g-1]+m.y[g])/2,d[u+2]=g%1?m.z[g-.5]:(m.z[g-1]+m.z[g])/2,u+=3}return{labels:c,positions:d}}function gt(e,t,n,a,i,r){for(var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,l=t.colors,c=t.positions,d=t.npoints,u=0===n.size,h=0,p=3,f=2;h<d;h++,p+=4,f+=3){var m=u||n.has(h);l[p]=m?a:i}e.scene.background=s.darkMode?new G.Color("rgb(0, 0, 0)"):null,e.setDimensions(t.dimensions);var g=st(e,dt);g.styles.fog.enabled=s.showFog;var v=e.scene.getObjectByName("axes");v&&(v.visible=s.showAxis),e.setPointColors(l),e.setPointPositions(c);var b=new Float32Array(t.npoints);b.fill(r),e.setPointScaleFactors(b);var j=s.showLabels&&t.isCategorical,y=st(e,ut);if(y&&(y.labelsActive=j,j)){var O=mt(t,o);y.fillStyle=s.darkMode?"white":"black",y.shadowColor=s.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",y.shadowStroke=s.labelStrokeWidth,y.setLabels(O.labels,O.positions),y.font="bold "+s.labelFontSize+"px Roboto Condensed"}e.render()}var vt="api",bt=["email"],jt="SET_DOT_PLOT_INTERPOLATOR",yt="SET_CHART_OPTIONS",Ot="SET_COMBINE_DATASET_FILTERS",xt="SET_DATASET_FILTERS",St="SET_PRIMARY_TRACE_KEY",wt="SET_CHART_SIZE",Ct="SET_PRIMARY_CHART_SIZE",kt="SET_SERVER_INFO",Et="SET_DATASET_FILTER",Pt="ADD_DATASET",Mt="DELETE_DATASET",It="UPDATE_DATASET",Dt="SET_GLOBAL_FEATURE_SUMMARY",zt="SET_SAVED_DATASET_STATE",At="SET_DOMAIN",_t="SET_CATEGORICAL_COLOR",Tt="SET_CATEGORICAL_NAME",Ft="SET_MARKER_OPACITY",Nt="SET_UNSELECTED_MARKER_OPACITY",Rt="SET_SELECTION",Lt="SET_FEATURE_SUMMARY",Bt="SET_SEARCH_TOKENS",Ut="SET_SELECTED_EMBEDDING",Ht="SET_NUMBER_OF_BINS",Vt="SET_BIN_VALUES",Wt="SET_BIN_SUMMARY",Kt="SET_MESSAGE",Gt="SET_INTERPOLATOR",Xt="SET_POINT_SIZE",qt="SET_EMAIL",Zt="SET_USER",Yt="SET_DATASET",Jt="SET_MARKERS",$t="SET_DIALOG",Qt="MORE_OPTIONS_DIALOG",en="EDIT_DATASET_DIALOG",tn="IMPORT_DATASET_DIALOG",nn="SAVE_DATASET_FILTER_DIALOG",an="SAVE_FEATURE_SET_DIALOG",rn="HELP_DIALOG",on="DELETE_DATASET_DIALOG",sn="SET_DATASET_CHOICES",ln="RESTORE_VIEW",cn="SET_DOT_PLOT_DATA",dn="SET_SELECTED_DOT_PLOT_DATA",un="SET_DOT_PLOT_SORT_ORDER",hn="SET_EMBEDDING_DATA",pn="SET_LOADING",fn="SET_TAB",mn="LOADING_APP",gn="SET_NUMBER_OF_BINS_UI",vn="SET_MARKER_OPACITY_UI",bn="SET_UNSELECTED_MARKER_OPACITY_UI";function jn(e){return e.bin||e.precomputed}function yn(e){var t=e.name+"_"+e.dimensions;return(e.bin||e.precomputed)&&(t=t+"_"+e.nbins+"_"+e.agg),t}function On(e){return e.name+"_"+yn(e.embedding)}function xn(e){var t={basis:e.name,ndim:e.dimensions};return e.precomputed&&(t.precomputed=!0),e.bin&&(t.nbins=e.nbins,t.agg=e.agg),t}function Sn(){return function(e,t){window.gapi.auth2.getAuthInstance().signOut().then((function(){e({type:qt,payload:null}),e($n(null))}))}}function wn(e){var t=[];for(var n in e){var a=e[n],i=null;if(window.Array.isArray(a))i=[n,"in",a];else if(null!=a.basis){var r=a.points;r.length>1?function(){var e=new Set;r.forEach((function(t){return t.forEach((function(t){return e.add(t)}))})),r=Array.from(e)}():r=r[0],i=[xn(a.basis),"in",{points:r}]}else""===a.operation||isNaN(a.value)||null==a.value||(i=[n,a.operation,a.value]);null!=i&&t.push(i)}return t}function Cn(e){var t=wn(e.datasetFilter);if(t.length>0){for(var n=e.dataset.obs,a=e.dataset.obsCat,i=0;i<t.length;i++)-1===a.indexOf(t[i][0])&&-1===n.indexOf(t[i][0])||(t[i][0]="obs/"+t[i][0]);return{filters:t,combine:e.combineDatasetFilters}}}function kn(e){return{type:un,payload:e}}function En(e){return{type:yt,payload:e}}function Pn(e){return function(t,n){t(function(e){return{type:Ot,payload:e}}(e)),t(_n())}}function Mn(e){return{type:Ct,payload:e}}function In(e){return{type:St,payload:e}}function Dn(e){return{type:Et,payload:e}}function zn(e){return{type:Rt,payload:e}}function An(e){return{type:Lt,payload:e}}function _n(){return function(e,t){e(Yn(!0));var n=t(),a=at(n.searchTokens),i=Cn(n);tt(nt(n.markers,a.featureSets),a.X);var r={selection:{measures:a.X.concat(a.obs.map((function(e){return"obs/"+e}))),dimensions:a.obsCat}};i&&(r.selection.filter=i);var o=null==n.selection.chart||0===Object.keys(n.selection.chart).length;if(null==i)return n.dotPlotData.forEach((function(e){e.selection=null})),e(Qn(n.dotPlotData.slice())),o||e(zn({chart:{}})),e(ea([])),e(An({})),void e(Yn(!1));var s=n.embeddings;r.selection.embeddings=s.map((function(e){return xn(e)})),t().dataset.api.getDataPromise(r).then((function(t){e(ra(t.selection,!0))})).catch((function(t){la(e,t)})).finally((function(){return e(Yn(!1))}))}}function Tn(e){return function(t,n){var a=e.name,i=e.value,r=e.clear,o=n().datasetFilter;if(i&&jn(i.basis)){var s=n().cachedData[yn(i.basis)].bins;i.points=function(e,t){for(var n=[],a=0,i=e.length;a<i;a++)n.push(t[e[a]]);return n}(i.points,s)}var l=!0;null==i?(l=null!=o[a],delete o[a]):r?o[a]={basis:i.basis,points:[i.points]}:null!=o[a]?o[a].points.push(i.points):o[a]={basis:i.basis,points:[i.points]};l&&(t(Dn(Object.assign({},o))),t(_n()))}}function Fn(e){return{type:Tt,payload:e}}function Nn(e){return{type:Zt,payload:e}}function Rn(){return function(e,t){var n=t().dataset,a=n.embeddings.map((function(e){return e.name})),i={tissue_hires:1,X_fle:2,X_umap:3,X_tsne:4,X_fitsne:5};a.sort((function(e,t){return(e=i[e]||Number.MAX_VALUE)-(t=i[t]||Number.MAX_VALUE)})),a.length>0&&e(na([n.embeddings[n.embeddings.map((function(e){return e.name})).indexOf(a[0])]]))}}function Ln(){return function(e,t){null==t().dataset&&1===t().datasetChoices.length&&e(ia(t().datasetChoices[0].id))}}function Bn(e){return function(t,n){if(null!=e.colorScheme){var a=Qe(e.colorScheme);null!=a&&(e.colorScheme={name:e.colorScheme,value:a})}if(null!=e.datasetFilter)for(var i in e.datasetFilter){var r=e.datasetFilter[i];window.Array.isArray(r)||(r.uiValue=r.value)}else e.datasetFilter={};t(Yn(!0)),(null!=e.dataset?t(ia(e.dataset,!1,!1)):Promise.resolve()).then((function(){var t=n().dataset;if(e.embeddings){var a=t.embeddings.map((function(e){return yn(e)})),i=[];e.embeddings.forEach((function(e){var n=a.indexOf(yn(e));-1!==n&&i.push(t.embeddings[n])})),e.embeddings=i,null!=e.camera&&(e.chartOptions.camera=e.camera)}})).then((function(){return t(Dn(e.datasetFilter))})).then((function(){return t({type:ln,payload:e})})).then((function(){return t(sa())})).then((function(){return t(_n())})).then((function(){if(null!=e.sort)for(var n in e.sort)t(kn({name:n,value:e.sort[n]}))})).finally((function(){return t(Yn(!1))})).catch((function(e){console.log(e),t(Gn("Unable to restore saved view.")),t(Ln())}))}}function Un(){return function(e,t){var n={dataset:null},a=window.location.search.substring(3);if(a.length>0)try{n=JSON.parse(window.decodeURIComponent(a))}catch(i){return e(Gn("Unable to restore saved view."))}null!=n.dataset?e(Bn(n)):e(Ln())}}function Hn(e){return function(t,n){if(window.gapi.auth2.getAuthInstance().isSignedIn.get()){var a=window.gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail();t(ta(a)),t((function(e,t){t().serverInfo.api.getUserPromise().then((function(t){return e(Nn(t))}))})),t(ca()).then((function(){e&&t(Un())}))}}}function Vn(){return"undefined"!==typeof window.gapi?window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token:""}function Wn(e){return function(t,n){var a=e.name,i=e.url;if(""!==a&&""!==i){var r=e.readers,o=e.description,s=e.title;t(Yn(!0));var l=null!=e.dataset,c=n().serverInfo,d=!l||i!==e.dataset.url;Promise.resolve({ok:!0}).then((function(e){})).then((function(){return n().serverInfo.api.upsertDatasetPromise(e.dataset?e.dataset.id:null,{name:a,readers:r,description:o,title:s,url:i})})).then((function(e){var n={name:a,id:e.id,title:s,url:i,readers:r,description:o,owner:!0};l?(t(function(e){return{type:It,payload:e}}(n)),t(Gn("Dataset updated"))):(t(function(e){return{type:Pt,payload:e}}(n)),c.email&&t(Gn(d?"Please ensure that "+c.email+' is a "Storage Object Viewer"':"Dataset created")))})).finally((function(){t(Yn(!1)),t(qn(null))})).catch((function(e){la(t,e)}))}}}function Kn(e){return function(t,n){t(Yn(!0)),n().serverInfo.api.deleteDatasetPromise(e.dataset.id).then((function(){t($n(null)),t(function(e){return{type:Mt,payload:e}}({id:e.dataset.id})),t(qn(null)),t(Gn("Dataset deleted"))})).finally((function(){t(Yn(!1)),t(qn(null))})).catch((function(e){la(t,e,"Unable to delete dataset. Please try again.")}))}}function Gn(e){return{type:Kt,payload:e}}function Xn(e){return{type:hn,payload:e}}function qn(e){return{type:$t,payload:e}}function Zn(e){return{type:Jt,payload:e}}function Yn(e){return{type:pn,payload:e}}function Jn(e){return{type:mn,payload:e}}function $n(e){return{type:Yt,payload:e}}function Qn(e){return{type:cn,payload:e}}function ea(e){return{type:dn,payload:e}}function ta(e){return{type:qt,payload:e}}function na(e){return function(t,n){var a=n().embeddings;t({type:Ut,payload:e}),t(sa((function(e){t({type:Ut,payload:a})})))}}function aa(e){return{type:xt,payload:e}}function ia(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a,i){n&&a(Yn(!0));for(var r=i().savedDatasetState[e],o=i().datasetChoices,s=null,l=0;l<o.length;l++)if(o[l].id===e){s=o[l];break}if(null==s)return a(Yn(!1)),a(Gn("Unable to find dataset")),Promise.reject("Unable to find dataset");var c,d=Object.assign({},s);d.id=e,d.embeddings=[],d.features=[],d.obs=[],d.obsCat=[],a($n(d));var u,h=[];var p=d.url||"",f=p.startsWith("http")||p.startsWith("//");return d.api=f?new U:new H,d.api.init(e,d.url).then((function(){var e=[];if(!f){var t=i().serverInfo.api.getCategoryNamesPromise(d.id).then((function(e){c=e})),n=i().serverInfo.api.getFiltersPromise(d.id).then((function(e){h=e}));e.push(t),e.push(n)}var a=d.api.getSchemaPromise().then((function(e){u=e}));return e.push(a),e})).then((function(e){return Promise.all(e)})).then((function(){return function(){if((u=Object.assign(d,u)).embeddings)for(var n=0;n<u.embeddings.length;n++)null!=u.embeddings[n].nbins?(u.embeddings[n].bin=!0,u.embeddings[n].precomputed=!0):(u.embeddings[n].nbins=500,u.embeddings[n]._nbins=500,u.embeddings[n].bin=!1,u.embeddings[n].agg="max");u.api=d.api,u.features=u.var,u.features.sort((function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e[0]>="0"&&e[0]<="9"&&(e="zzzzzz"+e),t[0]>="0"&&t[0]<="9"&&(t="zzzzzz"+t),e<t?-1:e===t?0:1})),u.id=e,a($n(u)),null!=c&&c.forEach((function(e){a(Fn({name:e.category,oldValue:e.original,value:e.new}))})),a(aa(h)),r?a(Bn(r)):t&&a(Rn())}()})).finally((function(){n&&a(Yn(!1))})).catch((function(e){la(a,e,"Unable to retrieve dataset. Please try again.")}))}}function ra(e,t){return function(n,a){var i=a();if(e){var r=e.coordinates;if(null!=r){var o={};for(var s in r){var l=r[s].indices_or_bins,c=i.embeddings[i.embeddings.map((function(e){return yn(e)})).indexOf(s)];if(null!=c){var d=l;if(jn(c))d=et(i.cachedData[yn(c)].bins,l);o[s]={userPoints:new Set(d),points:l}}else console.log(s+" missing")}n(zn({count:e.count,chart:o}))}else{var u=null==i.selection.chart||0===Object.keys(i.selection.chart).length;t&&!u&&n(zn({count:e.count,chart:{}}))}if(e.summary){var h=t?e.summary:Object.assign(a().featureSummary,e.summary);n(An(Object.assign({},h)))}if(e.dotplot){var p=i.selectedDotPlotData;t&&(p=[]),n(ea(p=oa(e.dotplot,p,at(i.searchTokens))))}}}}function oa(e,t,n){var a=[n.obsCat.join("-")],i={};a.forEach((function(e){n.X.forEach((function(t){"__count"!==t&&(i[e+"-"+t]=!0)}))})),e&&e.forEach((function(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].name===e.name){n=a;break}-1===n?t.push(e):(t[n].values=e.values.concat(t[n].values),t[n].values=Object(m.uniqBy)(t[n].values,(function(e){return e.name})),t[n]=Object.assign({},t[n]))})),(t=t.filter((function(e){return-1!==a.indexOf(e.name)}))).forEach((function(e,n){var a=e.values.length;e.values=e.values.filter((function(t){return i[e.name+"-"+t.name]})),a!==e.values.length&&(t[n]=Object.assign({},e))})),t=t.filter((function(e){return e.values.length>0}));var r={};return n.X.forEach((function(e,t){r[e]=t})),t.forEach((function(e){e.values.sort((function(e,t){return(e=r[e.name])-(t=r[t.name])}))})),t}function sa(e){return function(t,n){var a=n();if(null!=a.dataset){t(Yn(!0));var i=at(a.searchTokens);i.featureSets.length>0&&tt(nt(a.markers,i.featureSets),i.X);var r=(i.X.length>0||i.featureSets.length>0)&&i.obsCat.length>0,o=a.featureSummary,s=a.embeddings,l=a.dotPlotData,c=a.selectedDotPlotData,f=a.embeddingData,m=a.globalFeatureSummary,g=a.cachedData,b=[],y=new Set,O=[],x=new Set,S=new Set;i.X.concat(i.obs).concat(i.obsCat).forEach((function(e){S.add(e)})),s.forEach((function(e){var t=yn(e);if(x.add(t),null==g[t]&&b.push(e),jn(e)){var n={values:[],embedding:e};S.forEach((function(e){null==g[e+"_"+t]&&n.values.push(e)})),n.values.length>0&&O.push(n)}else S.forEach((function(e){null==g[e]&&y.add(e)}))})),f.forEach((function(e){var t=yn(e.embedding),n=x.has(t)&&(S.has(e.name)||0===S.size&&"__count"===e.name);n&&(e.date=new Date),e.active=n}));var w=new Set,C=i.obsCat.slice(),k=[C.join("-")],E={},P=[];if(r){var M={};l.forEach((function(e){e.values.forEach((function(t){M[e.name+"-"+t.name]=!0}))}));var I={};c.forEach((function(e){e.values.forEach((function(e){I[e.name]=!0}))})),i.X.forEach((function(e){null==I[e]&&P.push(e)})),i.obs.forEach((function(e){null==o[e]&&P.push("obs/"+e)})),k.forEach((function(e){i.X.forEach((function(t){var n=e+"-"+t;E[n]=!0,null==M[n]&&(w.add(t),!0)}))}))}var D={};if(b.length>0||O.length>0){D.embedding=[];var z=b.map((function(e){return yn(e)}));O.forEach((function(e){var t=xn(e.embedding);t.dimensions=[],t.measures=[],t.coords=-1!==z.indexOf(yn(e.embedding)),D.embedding.push(t),e.values.forEach((function(e){-1!==i.obsCat.indexOf(e)?t.dimensions.push(e):-1!==i.obs.indexOf(e)?t.measures.push("obs/"+e):t.measures.push(e)}))}));var A=O.map((function(e){return yn(e.embedding)}));b.forEach((function(e){if(-1===A.indexOf(yn(e))){var t=xn(e);t.coords=!0,D.embedding.push(t)}}))}y.size>0&&(D.values={measures:[],dimensions:[]},y.forEach((function(e){-1!==i.obsCat.indexOf(e)?D.values.dimensions.push(e):-1!==i.obs.indexOf(e)?D.values.measures.push("obs/"+e):D.values.measures.push(e)})));var _=[],T=[],F=[];i.X.forEach((function(e){null==m[e]&&_.push(e)})),i.obs.forEach((function(e){null==m[e]&&T.push("obs/"+e)})),i.obsCat.forEach((function(e){null==m[e]&&F.push(e)})),(_.length>0||T.length>0||F.length>0)&&(D.stats={measures:_.concat(T),dimensions:F}),C.length>0&&w.size>0&&(D.groupedStats={measures:Array.from(w),dimensions:[C]});var N=Cn(a);return null!=N&&(_.length>0||F.length>0||P.length>0)&&(D.selection={filter:N,measures:F.length>0?i.X:P,dimensions:i.obsCat}),(Object.keys(D).length>0?a.dataset.api.getDataPromise(D):Promise.resolve({})).then((function(e){if(null!=e.embeddings&&e.embeddings.forEach((function(e){if(e.coordinates&&Object.keys(e.coordinates).length>0&&(g[e.name]=e.coordinates),e.values)for(var t in e.values)g[t+"_"+e.name]=e.values[t]})),e.values)for(var n in e.values)g[n]=e.values[n];t(Qn(oa(e.dotplot,l,i)));var r=e.summary||{};for(var o in r)m[o]=r[o];if(t({type:Dt,payload:m}),function(e,t){var n=e.embeddings,a=e.embeddingData,i=e.dataset.obsCat,r=e.globalFeatureSummary,o=e.interpolator,s=e.dataset,l=e.cachedData,c=new Set;a.forEach((function(e){var t=yn(e.embedding),n=e.name+"_"+t;c.add(n)})),0===t.size&&t.add("__count");n.forEach((function(e){var n=yn(e),f=jn(e),m=l[n],g=m[e.name+"_1"],b=m[e.name+"_2"],y=m[e.name+"_3"],O=f?m.bins:null;t.forEach((function(t){var m=t+"_"+n,x=t;if(!c.has(m)){var S=null!=e.spatial;f&&(x=m);var w=r[t],C=l[x];if(null==C&&"__count"===t&&!f)for(var k=0,E=(C=new Float32Array(g.length)).length;k<E;k++)C[k]=1;void 0!==C.value&&(C.purity,C=C.value);var P="__count"!==t&&-1!==i.indexOf(t),M=null;if(P){var I,D=w.categories;I=D.length<=10?h.a:D.length<=12?p.a:D.length<=20?We:We.concat(Ke),(M=Object(u.a)(I).domain(D)).summary=w}else{if(j()(C)){for(var z=new Float32Array(s.shape[0]),A=0,_=C.index.length;A<_;A++)z[C.index[A]]=C.values[A];C=z}if(null==w||"__count"===t){for(var T=Number.MAX_VALUE,F=-Number.MAX_VALUE,N=0,R=C.length;N<R;N++){var L=C[N];T=L<T?L:T,F=L>F?L:F}w={min:T,max:F},r[t]=w}var B=[w.min,w.max];null==w.customMin||isNaN(w.customMin)||(B[0]=w.customMin),null==w.customMax||isNaN(w.customMax)||(B[1]=w.customMax),M=Object(d.a)(o.value).domain(B)}var U={embedding:Object.assign({},e),name:t,x:g,y:b,z:null!=y?y:void 0,bins:O,dimensions:null!=y?3:2,npoints:C.length,date:new Date,active:!0,colorScale:M,continuous:!P,isCategorical:P,values:C,isImage:S};if(S||(U.positions=function(e){var t,n=[1/0,-1/0],a=[1/0,-1/0],i=[1/0,-1/0],r=e.x.length,o=null!=e.z;o||(t=e.isCategorical?Ze(e.values.length,1):Xe(qe(e.values,!0)),i[0]=0,i[1]=1);for(var s=0;s<r;s++){var l=e.x[s];l<n[0]&&(n[0]=l),l>n[1]&&(n[1]=l);var c=e.y[s];if(c<a[0]&&(a[0]=c),c>a[1]&&(a[1]=c),o){var d=e.z[s];d<i[0]&&(i[0]=d),d>i[1]&&(i[1]=d)}}for(var u=function(e){return Math.abs(e[1]-e[0])},h=u(n),p=u(a),f=u(i),m=Math.max(h,p,f),g=function(e,t){return[e/m*-t,t*(e/m)]},v=g(h,1),b=g(p,1),j=g(f,1),y=new Float32Array(3*r),O=0,x=0;x<r;x++)y[O++]=ht(e.x[x],n,v),y[O++]=ht(e.y[x],a,b),y[O++]=ht(o?e.z[x]:t[x]/(t.length+1),i,j);return y}(U)),Ge(U),S){U.indices=P?Ze(U.values.length):qe(U.values,!0),U.isImage=!0;var H=s.api.getFileUrl(e.spatial.image),V=new v.a.ImageTileSource({url:H,buildPyramid:!0,crossOriginPolicy:"Anonymous"});U.tileSource=V}a.push(U)}}))}))}(a,S),null!=a.chartOptions.activeEmbedding){for(var s=-1,b=0;b<f.length;b++)if(a.chartOptions.activeEmbedding===On(f[b])){s=b;break}if(-1!==s){var y=f[s];f.splice(s,1),f.push(y)}a.chartOptions.activeEmbedding=null}t(Xn(f.slice())),e.selection?t(ra(e.selection)):t(ea(oa(null,c,i)))})).finally((function(){t(Yn(!1))})).catch((function(n){la(t,n,"Unable to retrieve data. Please try again."),e&&e(n)}))}}}function la(e,t,n){if(console.log(t),401===t.status)return e(Gn("Your session has expired. Please login again.")),e(Sn());null==n&&(n=t instanceof w?t.message:"An unexpected error occurred. Please try again."),e(Gn(new Error(n)))}function ca(){return function(e,t){return e(Yn(!0)),t().serverInfo.api.getDatasetsPromise().then((function(t){e({type:sn,payload:t})})).finally((function(){e(Yn(!1))})).catch((function(t){la(e,t,"Unable to retrieve datasets. Please try again.")}))}}var da=n(478),ua=n(461),ha=n(455),pa=n(456),fa=n(480),ma=n(471),ga=n(258),va=n(6),ba=n(257),ja=n.n(ba),ya=n(445),Oa=n(44),xa=n(454),Sa=n(452),wa=n(447),Ca=n(438),ka=n(451),Ea=n(474),Pa=n(453),Ma=n(250),Ia=n.n(Ma),Da=n(248),za=n.n(Da),Aa=n(249),_a=n.n(Aa),Ta=n(247),Fa=n.n(Ta),Na=n(156),Ra=n.n(Na),La=n(449),Ba=n(439),Ua=n(399),Ha=n(450),Va=n(448),Wa=n(246),Ka=n.n(Wa),Ga=n(245),Xa=n.n(Ga),qa=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handleClick=function(e){a.setState({anchorEl:e.currentTarget,searchText:""})},a.handleClose=function(){a.setState({anchorEl:null,searchText:""})},a.handleListItemClick=function(e){e!==(null!=a.props.dataset?a.props.dataset.id:null)&&a.props.onChange(e),a.setState({anchorEl:null,searchText:""})},a.handleClearSearchText=function(){a.setState({searchText:""})},a.onSearchChange=function(e){a.setState({searchText:e.target.value})},a.state={anchorEl:null,searchText:""},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,i=t.datasetChoices,o=this.state,s=o.anchorEl,l=o.searchText,c=null!=n?n.id:null,d=Boolean(this.state.anchorEl),u=i,h=this.state.searchText.toLowerCase().trim();return""!=h&&(u=u.filter((function(e){return-1!==e.name.toLowerCase().indexOf(h)||null!=e.description&&-1!==e.description.toLowerCase().indexOf(h)}))),Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)(wa.a,{variant:"contained",onClick:this.handleClick,color:null==c?"primary":"default",startIcon:Object(a.jsx)(Xa.a,{}),children:"Open"}),Object(a.jsxs)(Ca.a,{open:d,anchorEl:s,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[Object(a.jsx)(Va.a,{style:{padding:6},type:"text",placeholder:"Search",value:l,onChange:this.onSearchChange,fullWidth:!0,InputProps:""!==l.trim()?{endAdornment:Object(a.jsx)(La.a,{position:"end",children:Object(a.jsx)(Q.a,{"aria-label":"clear",onClick:this.handleClearSearchText,children:Object(a.jsx)(Ka.a,{})})})}:null}),Object(a.jsx)(Ba.a,{style:{width:500},dense:!0,disablePadding:!0,component:"nav","aria-label":"datasets",children:u.map((function(t){var n=t.name;return t.title&&(n+=" - "+t.title),Object(a.jsx)(Ua.a,{alignItems:"flex-start",selected:t.id===c,button:!0,onClick:function(n){return e.handleListItemClick(t.id)},children:Object(a.jsx)(Ha.a,{primary:n,style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}})},t.id)}))})]})]})}}]),n}(r.a.PureComponent),Za=Object(s.b)((function(e){return{dataset:e.dataset,datasetChoices:e.datasetChoices}}),(function(e){return{handleClose:function(t){e(qn(null))}}}))(qa),Ya="max",Ja=500,$a=.1,Qa="Viridis",ei="Reds",ti={name:Qa,value:Qe(Qa)},ni={name:ei,value:Qe(ei)},ai={width:window.innerWidth-280,height:Math.max(300,window.innerHeight-410)},ii={animating:!1,dragmode:"pan",editSelection:!1,showLabels:false,showAxis:true,showFog:false,darkMode:false,labelFontSize:14,labelStrokeWidth:4};function ri(e){e.forEach((function(e){var t=[Number.MAX_VALUE,-Number.MAX_VALUE],n=[Number.MAX_VALUE,-Number.MAX_VALUE];e.values.forEach((function(e){for(var a=0,i=e.mean.length;a<i;a++)t[0]=Math.min(e.fractionExpressed[a],t[0]),t[1]=Math.max(e.fractionExpressed[a],t[1]),n[0]=Math.min(e.mean[a],n[0]),n[1]=Math.max(e.mean[a],n[1])})),e.meanRange=n,e.fractionRange=t}))}var oi=Object(l.c)({binSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ya,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Wt:return t.payload;case Yt:return Ya;case ln:return null!=t.payload.binSummary?t.payload.binSummary:e;default:return e}},binValues:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Vt:return t.payload;case Yt:return!1;case ln:return null!=t.payload.binValues?t.payload.binValues:e;default:return e}},cachedData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yt:return{}}return e},categoricalNames:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Tt:var n=e[t.payload.name];return void 0===n&&(n={},e[t.payload.name]=n),null==t.payload.value||""===t.payload.value?delete n[t.payload.oldValue]:n[t.payload.oldValue]=t.payload.value,Object.assign({},e);case Yt:return{};default:return e}},chartOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ii,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case yt:return Object.assign({},t.payload);case ln:return t.payload.chartOptions?Object.assign(ii,t.payload.chartOptions):e;default:return e}},chartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case wt:return t.payload;default:return e}},combineDatasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"and",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ot:return t.payload;case Yt:return"and";case ln:return null!=t.payload.combineDatasetFilters?t.payload.combineDatasetFilters:e;default:return e}},dataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yt:return document.title=null==t.payload?"Cirro":t.payload.name+" - Cirro",t.payload;case It:if(t.payload.id===e.id)return document.title=t.payload.name+" - Cirro",Object.assign(e,t.payload);default:return e}},datasetChoices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case sn:return t.payload.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),t.payload;case qt:return null==t.payload?[]:e;case Pt:return e.push(t.payload),e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1})),e.slice();case It:case Mt:for(var n=-1,a=0;a<e.length;a++)if(e[a].id===t.payload.id){n=a;break}return-1!==n?(t.type===It?(e[n]=t.payload,e.sort((function(e,t){return(e=e.name.toLowerCase())===(t=t.name.toLowerCase())?0:e<t?-1:1}))):e.splice(n,1),e.slice()):e;default:return e}},datasetFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yt:return{};case Et:return t.payload;case ln:return null!=t.payload.datasetFilter?t.payload.datasetFilter:e;default:return e}},datasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yt:return[];case xt:return t.payload;default:return e}},dialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $t:return t.payload;default:return e}},dotPlotData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Tt:for(var n=0;n<e.length;n++){var a=e[n];e[n]=Object.assign({},a)}return e.slice();case un:for(var i=t.payload.name,r=t.payload.value,o=0;o<e.length;o++){var s=e[o];if(s.name===i){s.sortBy=r,e[o]=Object.assign({},s);break}}return e.slice();case cn:return ri(t.payload),t.payload;case Yt:return[];default:return e}},dotPlotInterpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ni,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case jt:return t.payload;case ln:return null!=t.payload.dotPlotInterpolator?t.payload.dotPlotInterpolator:e;default:return e}},email:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case qt:return t.payload;default:return e}},embeddingData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case hn:return t.payload;case Rt:return e.slice();case At:return e.forEach((function(e,n){if(e.continuous&&e.name===t.payload.name){var a=t.payload.summary,i=[a.min,a.max];null==a.customMin||isNaN(a.customMin)||(i[0]=a.customMin),null==a.customMax||isNaN(a.customMax)||(i[1]=a.customMax),e.colorScale.domain(i),Ge(e)}})),e.slice();case _t:return e.forEach((function(e,n){if(!e.continuous&&e.name===t.payload.name){var a=e.colorScale.domain().indexOf(t.payload.value),i=e.colorScale.range();i[a]=t.payload.color,e.colorScale.range(i),Ge(e)}})),e.slice();case Gt:return e.forEach((function(e,n){if(e.continuous){var a=e.colorScale.domain();e.colorScale=Object(d.a)(t.payload.value).domain(a),Ge(e)}})),e.slice();case Yt:return[];default:return e}},embeddings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ut:return t.payload;case Yt:return[];case ln:return null!=t.payload.embeddings?t.payload.embeddings:e;default:return e}},featureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Lt:return t.payload;case Yt:return{};default:return e}},globalFeatureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Dt:return t.payload;case Yt:return{};default:return e}},interpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ti,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Gt:return t.payload;case ln:return null!=t.payload.colorScheme?t.payload.colorScheme:e;default:return e}},loading:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case pn:return t.payload;default:return e}},loadingApp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!1,progress:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case mn:return t.payload;default:return e}},markerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ft:return t.payload;case Yt:return 1;case ln:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markerOpacityUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ft:case vn:return t.payload;case Yt:return 1;case ln:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Jt:return t.payload;case Yt:var n=null==t.payload?[]:t.payload.markers||[];if(Object(m.isPlainObject)(n)){var a=[];for(var i in n){var r=n[i];for(var o in r)a.push({category:i,name:o,id:i+"-"+o,readonly:!0,features:r[o]})}n=a}if(null!=t.payload&&null!=t.payload.markers_read_only)if(Object(m.isPlainObject)(t.payload.markers_read_only)){var s=t.payload.markers_read_only;for(var l in s){var c=s[l];for(var d in c)n.push({category:l,name:d,id:l+"-"+d,readonly:!0,features:c[d]})}}else t.payload.markers_read_only.forEach((function(e){e.readonly=!0,n.push(e)}));return n.forEach((function(e){null==e.id&&(e.id=e.category+"-"+e.name)})),n;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Kt:return t.payload;default:return e}},numberOfBins:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ja,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ht:return t.payload;case Yt:return Ja;case ln:return null!=t.payload.numberOfBins?t.payload.numberOfBins:e;default:return e}},numberOfBinsUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ja,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ht:case gn:return t.payload;case Yt:return Ja;case ln:return null!=t.payload.numberOfBins?t.payload.numberOfBins:e;default:return e}},pointSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Xt:return t.payload;default:return e}},primaryChartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ai,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ct:return t.payload;default:return e}},primaryTraceKey:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Yt:return null;case St:return t.payload;case hn:var n=t.payload.filter((function(e){return e.active}));if(0===n.length)return null;var a=n[n.length-1];return On(a);default:return e}},savedDatasetState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case zt:return t.payload;default:return e}},searchTokens:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Bt:return t.payload;case Yt:return[];case ln:return t.payload.q||[];default:return e}},selectedDotPlotData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Tt:for(var n=0;n<e.length;n++){var a=e[n];e[n]=Object.assign({},a)}return e.slice();case un:for(var i=t.payload.name,r=t.payload.value,o=0;o<e.length;o++){var s=e[o];if(s.name===i){s.sortBy=r,e[o]=Object.assign({},s);break}}return e.slice();case dn:return ri(t.payload),t.payload;case Yt:return[];default:return e}},selection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{chart:{}},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Rt:return t.payload;case Yt:return{};default:return e}},serverInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case kt:return t.payload;default:return e}},tab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"embedding",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case fn:return t.payload;default:return e}},unselectedMarkerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$a,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Nt:return t.payload;case Yt:return $a;case ln:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},unselectedMarkerOpacityUI:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$a,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Nt:case bn:return t.payload;case Yt:return $a;case ln:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zt:return t.payload;default:return e}}}),si=Object(va.a)((function(e){return{root:{minWidth:50,textTransform:"none",fontWeight:e.typography.fontWeightRegular,marginRight:e.spacing(0),"&:hover":{color:"#40a9ff",opacity:1},"&$selected":{color:"#1890ff",fontWeight:e.typography.fontWeightMedium},"&:focus":{color:"#40a9ff"}},selected:{}}}))((function(e){return Object(a.jsx)(ka.a,Object(Oa.a)({disableRipple:!0},e))})),li=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handleTabChange=function(e,t){a.props.handleTab(t)},a.handleEmbeddingsChange=function(e){var t=e.target.value,n=[];t.forEach((function(e){e.precomputed||(e=Object.assign(e,{bin:a.props.binValues,nbins:a.props.numberOfBins,_nbins:a.props.numberOfBinsUI,agg:a.props.binSummary})),n.push(e)})),a.props.handleEmbeddings(n)},a.handleUserMenuClose=function(){a.setState({userMenuOpen:!1})},a.handleMoreMenuClose=function(){a.setState({moreMenuOpen:!1})},a.handleHelp=function(){a.props.handleDialog(rn)},a.handleUserMenuOpen=function(e){a.setState({userMenuOpen:!0,userMenuAnchorEl:e.currentTarget})},a.handleMoreMenuOpen=function(e){a.setState({moreMenuOpen:!0,moreMenuAnchorEl:e.currentTarget})},a.getLinkJson=function(){var e=a.props,t=e.chartOptions,n=e.combineDatasetFilters,i=e.primaryTraceKey,r=e.dataset,o=e.embeddings,s=e.searchTokens,l=e.datasetFilter,c=e.interpolator,d=e.markerOpacity,u=e.unselectedMarkerOpacity,h=e.dotPlotData,p={dataset:r.id,embeddings:o.map((function(e){return e.bin?(delete(e=Object.assign({},e))._bin,e):{name:e.name,dimensions:e.dimensions}}))},f=t.ref;p.embeddings.length>0&&null!=f&&f.scatterPlot&&(p.camera=f.scatterPlot.getCameraDef());var m={};p.embeddings.length>0&&(m.activeEmbedding=i);var g={showLabels:false,showAxis:true,showFog:false,darkMode:false,labelFontSize:14,labelStrokeWidth:4};for(var v in g){var b=t[v];b!==g[v]&&(m[v]=b)}Object.keys(m).length>0&&(p.chartOptions=m),s.length>0&&(p.q=s);var j={};for(var y in l){var O=l[y];window.Array.isArray(O)?j[y]=O:""===O.operation||isNaN(O.value)||null==O.value||(j[y]={operation:O.operation,value:O.value})}if(Object.keys(j).length>0&&(p.datasetFilter=j),p.combineDatasetFilters=n,1!==d&&(p.markerOpacity=d),u!==$a&&(p.unselectedMarkerOpacity=u),h&&h.length>0){var x={};h.forEach((function(e){x[e.name]=e.sortBy})),p.sort=x}return c.name!==Qa&&(p.colorScheme=c.name),p},a.handleDataset=function(e){if(null!=a.props.dataset){var t=a.props.savedDatasetState,n=a.getLinkJson();n.dataset=null,t[a.props.dataset.id]=n,a.props.handleSavedDatasetState(t)}a.props.handleDataset(e)},a.copyLink=function(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname;t+="?q="+encodeURIComponent(JSON.stringify(a.getLinkJson()));var n=document.activeElement,i=document.createElement("textarea"),r="rtl"==document.documentElement.getAttribute("dir");i.style.fontSize="12pt",i.style.border="0",i.style.padding="0",i.style.margin="0",i.style.position="absolute",i.style[r?"right":"left"]="-9999px",i.setAttribute("readonly","");var o=window.pageYOffset||document.documentElement.scrollTop;i.style.top=o+"px",i.value=t,n.appendChild(i),i.select(),i.setSelectionRange(0,i.value.length),document.execCommand("copy");a.props.setMessage("Link copied"),n.addEventListener("click",(function e(t){document.activeElement.blur(),window.getSelection().removeAllRanges(),n.removeChild(i),n.removeEventListener("click",e)})),a.setState({moreMenuOpen:!1})},a.onDarkMode=function(){a.props.chartOptions.darkMode=!a.props.chartOptions.darkMode,a.props.handleChartOptions(a.props.chartOptions)},a.handleLogout=function(){a.setState({userMenuOpen:!1}),a.props.handleLogout()},a.handleImportDataset=function(e){a.props.handleDialog(tn),a.setState({moreMenuOpen:!1})},a.handleSettings=function(e){a.props.handleDialog(en),a.setState({moreMenuOpen:!1})},a.handleDelete=function(e){a.props.handleDialog(on),a.setState({moreMenuOpen:!1})},a.handleShowDatasetDetails=function(e){a.setState({datasetDetailsEl:e.currentTarget})},a.handleCloseDatasetDetails=function(e){a.setState({datasetDetailsEl:null})},a.state={userMenuOpen:!1,userMenuAnchorEl:null,moreMenuOpen:!1,moreMenuAnchorEl:null},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,i=t.loadingApp,r=t.email,o=t.selection,s=t.classes,l=t.serverInfo,c=t.tab,d=t.user,u=Boolean(this.state.datasetDetailsEl),h=null!=n&&(n.title||n.description),p=null!=n&&null!=n.shape?n.shape:null,f=null!=n&&null!=p&&p[0]>0&&!isNaN(o.count),m=null!=d&&d.importer&&!i.loading,g=null!==n&&n.owner&&!i.loading,v=(m||null!=n)&&!i.loading,b=!i.loading&&null==r&&""!==l.clientId;return Object(a.jsx)(Sa.a,{position:"fixed",color:"default",className:s.appBar,children:Object(a.jsxs)(Pa.a,{variant:"dense",children:[null!=n&&Object(a.jsx)(Ca.a,{id:"dataset-details",open:u,anchorEl:this.state.datasetDetailsEl,onClose:this.handleCloseDatasetDetails,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(a.jsxs)("div",{style:{width:500},children:[n.title&&Object(a.jsx)(q.a,{className:s.typography,children:n.title}),n.description&&Object(a.jsx)(Ra.a,{linkTarget:"_blank",children:n.description})]})}),null!=n&&Object(a.jsxs)(q.a,{"aria-owns":this.state.datasetDetailsOpen?"dataset-details":void 0,"aria-haspopup":"true",component:"h3",children:[h&&Object(a.jsx)(wa.a,{onClick:this.handleShowDatasetDetails,children:Object(a.jsx)("b",{children:n.name})}),!h&&Object(a.jsx)("b",{children:n.name}),Object(a.jsxs)("small",{children:["\xa0",f&&null!=p&&_e(o.count)+" / ",null!=p&&_e(p[0])+" cells"]})]}),null!=n&&Object(a.jsxs)(Ea.a,{value:c,indicatorColor:"primary",textColor:"primary",onChange:this.handleTabChange,"aria-label":"view",children:[Object(a.jsx)(si,{value:"embedding",label:"Embeddings"}),Object(a.jsx)(si,{value:"dot_plot",label:"Dot Plot"})]}),Object(a.jsx)("div",{className:"cirro-condensed"}),Object(a.jsxs)("div",{style:{marginLeft:"auto"},children:[!i.loading&&!b&&Object(a.jsx)(Za,{onChange:this.handleDataset}),v&&Object(a.jsx)($.a,{title:"More",children:Object(a.jsx)(Q.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleMoreMenuOpen,children:Object(a.jsx)(Fa.a,{})})}),v&&Object(a.jsxs)(ee.a,{id:"more-menu",anchorEl:this.state.moreMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.moreMenuOpen,onClose:this.handleMoreMenuClose,children:[m&&Object(a.jsx)(te.a,{onClick:this.handleImportDataset,children:"New Dataset"}),g&&Object(a.jsx)(te.a,{onClick:this.handleSettings,children:"Edit Dataset"}),g&&Object(a.jsx)(te.a,{onClick:this.handleDelete,children:"Delete Dataset"}),(m||g)&&null!=n&&Object(a.jsx)(xa.a,{}),null!=n&&Object(a.jsx)(te.a,{onClick:this.copyLink,children:"Copy Link "})]}),Object(a.jsx)($.a,{title:"Toggle Light/Dark Theme",children:Object(a.jsx)(Q.a,{edge:!1,className:this.props.chartOptions.darkMode?"cirro-active":"","aria-label":"Toggle Theme",onClick:function(){return e.onDarkMode()},children:Object(a.jsx)(za.a,{})})}),Object(a.jsx)($.a,{title:"Help",children:Object(a.jsx)(Q.a,{"aria-label":"Help",onClick:this.handleHelp,children:Object(a.jsx)(_a.a,{})})}),null!=r&&""!==r&&Object(a.jsx)($.a,{title:r,children:Object(a.jsx)(Q.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleUserMenuOpen,children:Object(a.jsx)(Ia.a,{})})}),null!=r&&""!==r&&Object(a.jsx)(ee.a,{id:"menu-user",anchorEl:this.state.userMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.userMenuOpen,onClose:this.handleUserMenuClose,children:Object(a.jsx)(te.a,{onClick:this.handleLogout,children:"Sign Out"})}),b&&Object(a.jsx)(wa.a,{style:{whiteSpace:"nowrap"},variant:"outlined",color:"primary",onClick:this.props.handleLogin,children:"Sign In"})]})]})})}}]),n}(r.a.PureComponent),ci=Object(va.a)((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},appBar:{width:"calc(100% - ".concat(lo,"px)"),marginLeft:lo}}}))(Object(s.b)((function(e){return{dataset:e.dataset,chartOptions:e.chartOptions,embeddings:e.embeddings,searchTokens:e.searchTokens,primaryTraceKey:e.primaryTraceKey,binSummary:e.binSummary,binValues:e.binValues,combineDatasetFilters:e.combineDatasetFilters,datasetFilter:e.datasetFilter,markerOpacity:e.markerOpacity,unselectedMarkerOpacity:e.unselectedMarkerOpacity,savedDatasetState:e.savedDatasetState,datasetChoices:e.datasetChoices,dialog:e.dialog,dotPlotData:e.dotPlotData,email:e.email,interpolator:e.interpolator,loading:e.loading,loadingApp:e.loadingApp,message:e.message,selection:e.selection,serverInfo:e.serverInfo,user:e.user,tab:e.tab}}),(function(e,t){return{handleTab:function(t){e({type:fn,payload:t})},setMessage:function(t){e(Gn(t))},handleLogin:function(){e((function(e,t){window.gapi.auth2.getAuthInstance().signIn().then((function(t){e(Hn())}))}))},handleLogout:function(){e(Sn())},handleSavedDatasetState:function(t){e({type:zt,payload:t})},handleDataset:function(t){e(ia(t))},handleDialog:function(t){e(qn(t))},handleChartOptions:function(t){e(En(t))}}}))(li)),di=n(458),ui=n(457),hi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleCancel()},a.handleDelete=function(){a.setState({loading:!0}),a.props.handleDelete({dataset:a.props.dataset})},a.state={open:!0},a}return Object(C.a)(n,[{key:"render",value:function(){return Object(a.jsxs)(ha.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"delete-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(pa.a,{id:"delete-dataset-dialog-title",children:"Delete Dataset"}),Object(a.jsx)(ui.a,{children:this.props.dataset&&Object(a.jsxs)("h3",{children:["Are you sure you want to delete ",this.props.dataset.name,"?"]})}),Object(a.jsxs)(di.a,{children:[Object(a.jsx)(wa.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(wa.a,{disabled:this.state.loading,onClick:this.handleDelete,color:"primary",children:"Delete"})]})]})}}]),n}(r.a.PureComponent),pi=Object(s.b)((function(e){return{dataset:e.dataset,email:e.email}}),(function(e){return{handleDelete:function(t){e(Kn(t))},handleCancel:function(t){e(qn(null))}}}))(hi),fi=n(407),mi=n(459),gi=n(460),vi=n(400),bi=n(405);function ji(e){return e.startsWith("interpolate")&&(e=e.substring("interpolate".length)),e}var yi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(y.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).handleInterpolatorChange=function(t){var n=t.target.value;e.props.handleInterpolator({name:n,value:Qe(n)})},e}return Object(C.a)(n,[{key:"getScale",value:function(e){return Object(d.a)(Be[e]).domain([0,1])}},{key:"render",value:function(){var e=this,t=this.props.classes,n=$e(this.props.interpolator.name),i=174;return Object(a.jsxs)(bi.a,{input:Object(a.jsx)(vi.a,{id:"color-scheme"}),className:t.select,onChange:this.handleInterpolatorChange,value:n,multiple:!1,children:[Object(a.jsx)(te.a,{value:"Diverging",divider:!0,disabled:!0,children:"Diverging"},"Diverging"),Ve.Diverging.map((function(t){return Object(a.jsx)(te.a,{title:ji(t),value:t,children:Object(a.jsx)(Ne,{width:i,label:!1,height:20,scale:e.getScale(t)})},t)})),Object(a.jsx)(te.a,{value:"Sequential (Single Hue)",divider:!0,disabled:!0,children:"Sequential (Single Hue)"},"Sequential (Single Hue)"),Ve["Sequential (Single Hue)"].map((function(t){return Object(a.jsx)(te.a,{title:ji(t),value:t,children:Object(a.jsx)(Ne,{width:i,label:!1,height:20,scale:e.getScale(t)})},t)})),Object(a.jsx)(te.a,{value:"Sequential (Multi-Hue)",divider:!0,disabled:!0,children:"Sequential (Multi-Hue)"},"Sequential (Multi-Hue)"),Ve["Sequential (Multi-Hue)"].map((function(t){return Object(a.jsx)(te.a,{title:ji(t),value:t,children:Object(a.jsx)(Ne,{width:i,label:!1,height:20,scale:e.getScale(t)})},t)})),Object(a.jsx)(te.a,{value:"Cyclical",divider:!0,disabled:!0,children:"Cyclical"},"Cyclical"),Ve.Cyclical.map((function(t){return Object(a.jsx)(te.a,{title:ji(t),value:t,children:Object(a.jsx)(Ne,{width:i,label:!1,height:20,scale:e.getScale(t)})},t)}))]})}}]),n}(r.a.PureComponent),Oi=Y()((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1)}}}))(yi),xi=n(402);function Si(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"black",o=t.domain(),s=(o[1]-o[0])/(n+1),l=[];l.push(o[0]);for(var c=o[0],d=0;d<n;d++)c+=s,l.push(c);l.push(o[1]);var u=20,h=Object(J.a)().range([i,a-i]).domain([0,l.length-1]).clamp(!0),p=Object(J.a)().range([1,9]).domain(o).clamp(!0);e.textBaseline="top",e.fillStyle=r,e.strokeStyle=r,e.textAlign="center";for(var f=0;f<l.length;f++){var m=h(f),g=p(l[f]);e.beginPath(),e.arc(m,10,g,0,2*Math.PI),e.stroke(),e.fillText(Te(100*l[f]),m,u+2)}}var wi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).ref=r.a.createRef(),a.backingScale=1,a}return Object(C.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.font="12px Roboto Condensed,Helvetica,Arial,sans-serif",t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(Si(t,r,this.props.nsteps||3,a,20,i),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,n=this.props.width,i={width:n,height:t};return this.props.style&&(i=Object.assign({},i,this.props.style)),Object(a.jsx)("canvas",{width:n*e,height:t*e,ref:this.ref,style:i})}}]),n}(r.a.PureComponent),Ci="12px Helvetica,Arial,sans-serif",ki="12px Roboto Condensed,Helvetica,Arial,sans-serif",Ei=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onSortOrderChanged=function(e){a.props.onSortOrderChanged({name:a.props.data.name,value:e.target.value})},a.handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){var t,n;a.setState({saveImageEl:null}),"svg"===e?(t=new window.C2S(10,10)).font=Ci:(t=(n=document.createElement("canvas")).getContext("2d")).font=ki;var i=a.getSize(t),r=i.height+i.y+40+40+10,o=Math.max(200,i.width+i.x),s=1;"svg"===e?(t=new window.C2S(o,r)).font=Ci:(n.width=o*window.devicePixelRatio,n.height=r*window.devicePixelRatio,t=n.getContext("2d"),s=window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio),t.font=ki);var l=a.props.textColor;if("white"===l&&(t.fillStyle="black",t.fillRect(0,0,o,r)),a.drawContext(t),t.translate(10*s,s*(i.height+i.y+4)),Fe(t,150,40,a.props.colorScale,!0,10,l),t.translate(-10,44),Si(t,a.props.sizeScale,3,150,20,l),"svg"===e){var c=t.getSerializedSvg(),d=new Blob([c],{type:"text/plain;charset=utf-8"});window.saveAs(d,a.dotplot.name+".svg")}else n.toBlob((function(e){window.saveAs(e,a.dotplot.name+".png",!0)}))},a.divRef=r.a.createRef(),a.tooltipElementRef=r.a.createRef(),a.canvas=null,a.state={saveImageEl:null},a}return Object(C.a)(n,[{key:"redraw",value:function(){var e=this;if(null==this.props.data)return Object(a.jsx)("div",{});var t=1;if("undefined"!==typeof window&&"devicePixelRatio"in window&&(t=window.devicePixelRatio),null==this.canvas){this.canvas=document.createElement("canvas"),this.canvas.addEventListener("mousemove",(function(t){var n=t.target,a=e.props.sizeScale.range()[1],i=n.getBoundingClientRect(),r=[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop],o=Math.floor((r[0]-e.size.x)/(2*a)),s=Math.floor(r[1]/(2*a));if(o>=0&&o<e.dotplot.values.length&&s>=0&&s<e.categories.length){e.tooltipElementRef.current.innerHTML="";var l=e.dotplot.values[o],c=l.mean[e.categoryOrder[s]],d=l.fractionExpressed[e.categoryOrder[s]];e.tooltipElementRef.current.innerHTML="mean: "+Ae(c)+", % expressed: "+Ae(100*d)}else e.tooltipElementRef.current.innerHTML=""})),this.canvas.addEventListener("mouseout",(function(t){e.tooltipElementRef.current.innerHTML=""})),this.divRef.current.append(this.canvas)}var n=this.size.height+this.size.y,i=this.size.width+this.size.x,r=this.canvas,o=r.getContext("2d");r.width=i*t,r.height=n*t,r.style.width=i+"px",r.style.height=n+"px",o.font=ki,o.clearRect(0,0,i*t,n*t),o.scale(t,t),this.drawContext(o)}},{key:"drawContext",value:function(e){var t=this,n=this.props.renamedCategories||{},a=this.dotplot,i=this.props.colorScale,r=this.features,o=this.props.sizeScale,s=this.categories,l=this.props.drawCircles,c=this.categoryOrder,d=this.props.textColor,u=o.range()[1],h=2*u;a.values.forEach((function(n,a){for(var r=0;r<n.mean.length;r++){var s=n.mean[c[r]],d=i(s);if(e.fillStyle=d,e.beginPath(),l){var p=a*h+u+t.size.x,f=r*h+u,m=n.fractionExpressed[c[r]];e.arc(p,f,o(m),0,2*Math.PI)}else{var g=a*h+t.size.x,v=r*h;e.rect(g,v,h,h)}e.fill()}})),e.textAlign="right",e.fillStyle=d,e.textBaseline="middle";for(var p=0;p<s.length;p++){var f=s[c[p]],m=n[f];null!=m&&(f=m);var g=p*h+u;e.fillText(f,this.size.x-4,g)}e.textAlign="right",e.textBaseline="top";for(var v=0;v<r.length;v++){var b=r[v],j=v*h;e.save(),e.translate(this.size.x+j+4,this.size.height),e.rotate(-Math.PI/2),e.fillText(b,0,0),e.restore()}e.setTransform(1,0,0,1,0,0)}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"getSize",value:function(e){var t=0,n=this.props.renamedCategories||{};this.dotplot.values.forEach((function(n){t=Math.max(t,e.measureText(n.name).width)})),t+=4;var a=0;this.categories.forEach((function(t){var i=n[t];null!=i&&(t=i),a=Math.max(a,e.measureText(t).width)})),a+=4;var i=2*this.props.sizeScale.range()[1],r=this.categories.length*i+4,o=this.features.length*i+4;return{x:a,y:t,width:o,height:r}}},{key:"update",value:function(){var e=Object.assign({},this.props.data),t=this.props.renamedCategories||{};null!=e&&e.selection&&(e=e.selection),this.dotplot=e;var n=e.categories||[""];this.categories=n;var a=e.values.map((function(e){return e.name}));null==e.sortBy&&(e.sortBy=e.name);for(var i=[],r=0;r<n.length;r++)i.push(r);if(e.sortBy!==e.name){for(var o,s=0;s<e.values.length;s++)if(e.values[s].name===e.sortBy){o=e.values[s];break}o&&i.sort((function(e,t){var n=o.mean[e],a=o.mean[t],i=n===a?0:n>a?-1:1;return 0===i&&(i=(n=o.fractionExpressed[e])===(a=o.fractionExpressed[t])?0:n>a?-1:1),i}))}else if(Object.keys(t).length>0){var l=P()();i.sort((function(e,a){var i=n[e],r=t[i];null!=r&&(i=r);var o=n[a],s=t[o];return null!=s&&(o=s),l(i,o)}))}var c=document.createElement("canvas").getContext("2d");c.font=ki,this.features=a,this.size=this.getSize(c),this.categoryOrder=i}},{key:"render",value:function(){var e=this;this.update();var t=this.state.saveImageEl,n=this.dotplot,i=this.features,r=[n.name].concat(i);return Object(a.jsxs)("div",{style:{position:"relative"},children:[Object(a.jsxs)("div",{children:[Object(a.jsxs)(q.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[n.name,this.props.subtitle&&Object(a.jsxs)("small",{children:["(",this.props.subtitle,")"]})]}),Object(a.jsx)($.a,{title:"Save Image",children:Object(a.jsx)(Q.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(a.jsx)(me.a,{})})}),Object(a.jsxs)(ee.a,{id:"save-image-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:this.handleSaveImageMenuClose,children:[Object(a.jsx)(te.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(a.jsx)(te.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),Object(a.jsx)(q.a,{color:"textPrimary",className:"cirro-condensed",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top",whiteSpace:"nowrap",width:500,minWidth:500,maxWidth:500,textOverflow:"ellipsis"}}),this.props.onSortOrderChanged?Object(a.jsxs)(xi.a,{className:this.props.classes.formControl,children:[Object(a.jsx)(fi.a,{shrink:!0,children:"Sort By"}),Object(a.jsx)(bi.a,{input:Object(a.jsx)(vi.a,{size:"small"}),onChange:this.onSortOrderChanged,value:n.sortBy,children:r.map((function(e){return Object(a.jsx)(te.a,{value:e,children:e},e)}))})]}):null]}),Object(a.jsx)("div",{ref:this.divRef})]})}}]),n}(r.a.PureComponent),Pi=Object(va.a)((function(e){return{root:{},formControl:{display:"block",margin:e.spacing(1)}}}))(Ei),Mi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.setState({min:e.target.value})},a.onMinKeyPress=function(e){"Enter"===e.key&&(a.props.categoryItem.minCustom=parseFloat(e.target.value),a.setState({forceUpdate:!a.state.forceUpdate}))},a.onMinSizeChange=function(e){a.setState({minSize:e.target.value})},a.onHeatmapChange=function(e){a.setState({drawCircles:!e.target.checked})},a.onMinSizeKeyPress=function(e){"Enter"===e.key&&(a.props.categoryItem.minSizeCustom=parseFloat(e.target.value),a.props.categoryItem.minSizeCustom>1&&(a.props.categoryItem.minSizeCustom/=100),a.setState({forceUpdate:!a.state.forceUpdate}))},a.onMaxSizeChange=function(e){a.setState({sizeMax:e.target.value})},a.onMaxSizeKeyPress=function(e){"Enter"===e.key&&(a.props.categoryItem.maxSizeCustom=parseFloat(e.target.value),a.props.categoryItem.maxSizeCustom>1&&(a.props.categoryItem.maxSizeCustom/=100),a.setState({forceUpdate:!a.state.forceUpdate}))},a.onMaxChange=function(e){a.setState({max:e.target.value})},a.onMaxKeyPress=function(e){"Enter"===e.key&&(a.props.categoryItem.maxCustom=parseFloat(e.target.value),a.setState({forceUpdate:!a.state.forceUpdate}))},a.state={min:"",max:"",minSize:"",sizeMax:"",forceUpdate:!1,drawCircles:!0},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.props,t=e.textColor,n=e.categoryItem,i=e.renamedCategories,o=e.selectedData,s=e.interpolator,l=n.meanRange,c=n.fractionRange;l=l.slice(),c=c.slice(),null!=o&&(l[0]=Math.min(l[0],o.meanRange[0]),l[1]=Math.max(l[1],o.meanRange[1]),c[0]=Math.min(c[0],o.fractionRange[0]),c[1]=Math.max(c[1],o.fractionRange[1])),l[0]===l[1]&&l[1]++,c[0]===c[1]&&(c[0]=0,c[1]=1),l[0]>0&&(l[0]=0),c[0]>0&&(c[0]=0),c[1]<1&&(c[1]=1),null==n.minCustom||isNaN(n.minCustom)||(l[0]=n.minCustom),null==n.maxCustom||isNaN(n.maxCustom)||(l[1]=n.maxCustom),null==n.minSizeCustom||isNaN(n.minSizeCustom)||(c[0]=n.minSizeCustom),null==n.maxSizeCustom||isNaN(n.maxSizeCustom)||(c[1]=n.maxSizeCustom);var u=Object(d.a)(s.value).domain(l).clamp(!0),h=Object(J.a)().domain(c).range([1,9]).clamp(!0);return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsx)(Pi,{renamedCategories:i,colorScale:u,sizeScale:h,legend:null==o,meanRange:l,fractionRange:c,textColor:t,drawCircles:this.state.drawCircles,onSortOrderChanged:this.props.onSortOrderChanged,data:n}),null!=o?Object(a.jsx)(Pi,{renamedCategories:i,colorScale:u,sizeScale:h,subtitle:"selection",legend:!0,textColor:t,drawCircles:this.state.drawCircles,meanRange:l,fractionRange:c,data:o}):null,Object(a.jsx)(Oi,{handleInterpolator:this.props.handleInterpolator,interpolator:s}),Object(a.jsxs)("div",{style:{color:t,width:174},children:[Object(a.jsx)(q.a,{variant:"caption",children:Ae(u.domain()[0])}),Object(a.jsx)(q.a,{variant:"caption",style:{float:"right"},children:Ae(u.domain()[1])})]}),Object(a.jsx)(fi.a,{shrink:!0,variant:"standard",children:"Custom Mean"}),Object(a.jsx)(Va.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",onKeyPress:this.onMinKeyPress,onChange:this.onMinChange,label:"Min",value:this.state.min}),Object(a.jsx)(Va.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",onKeyPress:this.onMaxKeyPress,onChange:this.onMaxChange,label:"Max",value:this.state.max}),this.state.drawCircles&&Object(a.jsxs)("div",{style:{paddingTop:16},children:[Object(a.jsx)(wi,{style:{display:"block"},width:150,textColor:t,label:!0,height:40,scale:h}),Object(a.jsx)(fi.a,{style:{marginTop:16},shrink:!0,variant:"standard",children:"Custom Percent Expressed"}),Object(a.jsx)(Va.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",onKeyPress:this.onMinSizeKeyPress,onChange:this.onMinSizeChange,label:"Min",value:this.state.minSize}),Object(a.jsx)(Va.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",onKeyPress:this.onMaxSizeKeyPress,onChange:this.onMaxSizeChange,label:"Max",value:this.state.maxSize})]}),Object(a.jsx)("div",{style:{paddingTop:16},children:Object(a.jsxs)(mi.a,{component:"label",alignContent:"flex-start",container:!0,alignItems:"center",spacing:0,children:[Object(a.jsx)(mi.a,{item:!0,children:Object(a.jsx)(gi.a,{style:{display:"inline"},size:"small",checked:!this.state.drawCircles,onChange:this.onHeatmapChange,name:"heatmap"})}),Object(a.jsx)(mi.a,{item:!0,children:Object(a.jsx)(fi.a,{shrink:!1,variant:"standard",children:"Heat Map"})})]})})]},n.name)}}]),n}(r.a.PureComponent),Ii=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"render",value:function(){var e=this.props,t=e.chartOptions,n=e.dotPlotData,i=e.dotPlotInterpolator,r=e.categoricalNames,o=e.handleInterpolator,s=e.onSortOrderChanged,l=e.selectedDotPlotData;if(0===n.length)return Object(a.jsx)("h4",{children:"Please enter one or more categorical observations and one or more features."});var c=t.darkMode?"white":"black",d={};return l.forEach((function(e){d[e.name]=e})),Object(a.jsx)("div",{children:n.map((function(e){var t=d[e.name],n=r[e.name];return Object(a.jsx)(Mi,{categoryItem:e,selectedData:t,interpolator:i,handleInterpolator:o,onSortOrderChanged:s,renamedCategories:n,textColor:c},e.name)}))})}}]),n}(r.a.PureComponent),Di=Object(s.b)((function(e){return{chartOptions:e.chartOptions,dotPlotInterpolator:e.dotPlotInterpolator,dotPlotData:e.dotPlotData,selectedDotPlotData:e.selectedDotPlotData,categoricalNames:e.categoricalNames}}),(function(e){return{onSortOrderChanged:function(t){e(kn(t))},handleInterpolator:function(t){e({type:jt,payload:t})}}}))(Ii),zi=n(159),Ai=n(481),_i=n(403),Ti=n(462);function Fi(e){var t=e.children,n=e.value,i=e.index,r=Object(zi.a)(e,["children","value","index"]);return Object(a.jsx)("div",Object(Oa.a)(Object(Oa.a)({role:"tabpanel",hidden:n!==i,id:"editor-tabpanel-".concat(i),"aria-labelledby":"editor-tab-".concat(i)},r),{},{children:n===i&&Object(a.jsx)(Ai.a,{children:t})}))}var Ni=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.url.trim();if(""!==e&&""!==t){var n=a.state.description.trim(),i=a.state.title.trim();a.setState({loading:!0});var r=function(e){for(var t=e.split(","),n=new Set,a=0;a<t.length;a++){var i=t[a].trim().toLowerCase();""!==i&&n.add(i)}return Array.from(n)}(a.state.readers);a.props.handleSave({dataset:a.props.dataset,name:e,title:i,description:n,url:t,readers:r})}},a.onTabChanged=function(e,t){a.setState({tabValue:t})},a.onEmailChanged=function(e){a.setState({readers:e.target.value})},a.onUrlChanged=function(e){a.setState({url:e.target.value})},a.onNameChanged=function(e){a.setState({name:e.target.value})},a.onDescriptionChanged=function(e){a.setState({description:e.target.value})},a.onTitleChanged=function(e){a.setState({title:e.target.value})},a.state={url:"",tabValue:0,name:null!=a.props.dataset?a.props.dataset.name:"",title:null!=a.props.title&&null!=a.props.dataset.title?a.props.dataset.title:"",description:null!=a.props.dataset&&null!=a.props.dataset.description?a.props.dataset.description:"",readers:"",loading:null!=a.props.dataset},a}return Object(C.a)(n,[{key:"componentDidMount",value:function(){if(null!=this.props.dataset){var e=this.props.dataset.readers.slice(),t=e.indexOf(this.props.email);-1!==t&&e.splice(t,1),this.setState({name:this.props.dataset.name,description:null!=this.props.dataset.description?this.props.dataset.description:"",title:null!=this.props.dataset.title?this.props.dataset.title:"",loading:!1,url:this.props.dataset.url,readers:e.join(", ")})}}},{key:"render",value:function(){return Object(a.jsxs)(ha.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-dialog-title",fullWidth:!0,maxWidth:"lg",children:[Object(a.jsxs)(pa.a,{id:"edit-dataset-dialog-title",children:[null==this.props.dataset?"New":"Edit"," Dataset"]}),Object(a.jsxs)(ui.a,{children:[this.state.loading&&Object(a.jsx)(ua.a,{}),Object(a.jsx)(Va.a,{disabled:this.state.loading,autoComplete:"off",required:!0,value:this.state.name,helperText:"asfd",onChange:this.onNameChanged,margin:"dense",label:"Name",fullWidth:!0}),!this.state.loading&&Object(a.jsx)(Va.a,{required:!0,autoComplete:"off",value:this.state.url,onChange:this.onUrlChanged,margin:"dense",helperText:this.props.serverInfo.email?"Please ensure that "+this.props.serverInfo.email+' has "Storage Object Viewer" permissions':"",label:"URL ("+(this.props.serverInfo.email?"gs://my_bucket/my_dataset":"/Users/foo/my_dataset")+")",fullWidth:!0}),Object(a.jsx)(Va.a,{disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.title,onChange:this.onTitleChanged,margin:"dense",label:"Title",fullWidth:!0,inputProps:{maxLength:255}}),Object(a.jsx)("div",{children:Object(a.jsxs)(xi.a,{children:[Object(a.jsx)(fi.a,{children:"Summary"}),Object(a.jsx)("div",{style:{marginTop:36}}),Object(a.jsx)(_i.a,{children:Object(a.jsx)(Ti.a,{href:"https://www.markdownguide.org/cheat-sheet/",target:"_blank",children:"Markdown Cheat Sheet"})})]})}),Object(a.jsxs)(Ea.a,{value:this.state.tabValue,onChange:this.onTabChanged,"aria-label":"description-editor",children:[Object(a.jsx)(ka.a,{label:"Write"}),Object(a.jsx)(ka.a,{label:"Preview"})]}),Object(a.jsx)(Fi,{value:this.state.tabValue,index:0,children:Object(a.jsx)(Va.a,{disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.description,onChange:this.onDescriptionChanged,margin:"dense",fullWidth:!0,variant:"outlined",rows:8,rowsMax:8,multiline:!0,inputProps:{maxLength:1e3}})}),Object(a.jsx)(Fi,{value:this.state.tabValue,index:1,children:""!==this.state.description&&Object(a.jsx)(Ai.a,{border:1,children:Object(a.jsx)(Ra.a,{linkTarget:"_blank",children:this.state.description})})}),!this.state.loading&&""!==this.props.serverInfo.clientId&&Object(a.jsx)(Va.a,{value:this.state.readers,onChange:this.onEmailChanged,margin:"dense",label:"Share",helperText:"Enter comma separated list of emails",fullWidth:!0,multiline:!0})]}),Object(a.jsxs)(di.a,{children:[Object(a.jsx)(wa.a,{disabled:this.state.loading,onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(wa.a,{disabled:this.state.loading,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(r.a.PureComponent),Ri=Object(s.b)((function(e){return{dataset:e.dialog===en?e.dataset:null,serverInfo:e.serverInfo,email:e.email}}),(function(e){return{handleSave:function(t){e(Wn(t))},handleCancel:function(t){e(qn(null))},handleError:function(t){e(Gn(t))}}}))(Ni),Li=n(251),Bi=n.n(Li),Ui=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handlePopoverClose=function(e){a.setState({contextmenuEl:null,anchorEl:null})},a.handleColorChange=function(e){a.setState({color:e.target.value})},a.handleNameChange=function(e){a.setState({name:e.target.value})},a.handleColorChangeApply=function(e){a.props.handleColorChange({name:a.props.name,value:a.state.categoryValue,color:a.state.color}),a.setState({forceUpdate:!a.state.forceUpdate})},a.handleNameChangeApply=function(e){a.props.handleNameChange({name:a.props.name,oldValue:a.state.categoryValue,value:a.state.name}),a.setState({name:"",contextmenuEl:null,anchorEl:null})},a.handleEditColor=function(e){a.setState((function(e,t){return{anchorEl:e.contextmenuEl,contextmenuEl:null,menu:"color"}}),(function(){}))},a.handleEditName=function(e){a.setState((function(e,t){return{anchorEl:e.contextmenuEl,contextmenuEl:null,menu:"name",name:""}}),(function(){}))},a.handleContextmenuClose=function(e){a.setState({contextmenuEl:null})},a.handleClick=function(e,t,n){a.props.clickEnabled&&(n.preventDefault(),a.props.handleClick({name:a.props.name,value:e,shiftKey:n.shiftKey,metaKey:n.metaKey}))},a.handleContextmenu=function(e,t,n){a.props.clickEnabled&&(n.preventDefault(),n.stopPropagation(),a.setState({contextmenuEl:n.target,categoryValue:e,color:a.props.scale(e)}))},a.state={contextmenuEl:null,anchorEl:null,color:null,name:"",categoryValue:null,forceUpdate:!1,menu:null},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.scale,i=t.datasetFilter,o=t.name,s=t.featureSummary,l=t.maxHeight,c=t.globalFeatureSummary,d=t.nObs,u=t.nObsSelected,h=t.categoricalNames,p=this.props.clickEnabled,f=i[o],m=s[o],g={};if(null!=m)for(var v=0;v<m.counts.length;v++)g[m.categories[v]]=m.counts[v];var b=c[o],j=b.categories,y=h[o]||{};p=p&&j.length>1;var O={maxHeight:l,display:"inline-block"};this.props.style&&(O=Object.assign({},O,this.props.style));var x=y[this.state.categoryValue]||this.state.categoryValue;return Object(a.jsxs)("div",{className:"cirro-chart-legend",style:O,children:[Object(a.jsxs)(ha.a,{open:Boolean(this.state.anchorEl),onClose:this.handlePopoverClose,"aria-labelledby":"edit-category-dialog-title",children:[Boolean(this.state.anchorEl)&&"color"==this.state.menu&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)(pa.a,{id:"edit-category-dialog-title",children:["Edit ",x," Color"]}),Object(a.jsx)(ui.a,{children:Object(a.jsx)("input",{type:"color",value:this.state.color,onChange:this.handleColorChange,style:{width:100}})}),Object(a.jsxs)(di.a,{children:[Object(a.jsx)(wa.a,{onClick:this.handlePopoverClose,color:"primary",children:"Close"}),Object(a.jsx)(wa.a,{onClick:this.handleColorChangeApply,color:"primary",children:"Apply"})]})]}),Boolean(this.state.anchorEl)&&"name"==this.state.menu&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)(pa.a,{id:"edit-category-dialog-title",children:["Edit ",x," Name"]}),Object(a.jsx)(ui.a,{children:Object(a.jsx)(Va.a,{type:"text",onChange:this.handleNameChange,value:this.state.name})}),Object(a.jsxs)(di.a,{children:[Object(a.jsx)(wa.a,{onClick:this.handlePopoverClose,color:"primary",children:"Cancel"}),Object(a.jsx)(wa.a,{onClick:this.handleNameChangeApply,color:"primary",children:"OK"})]})]})]}),Object(a.jsxs)(ee.a,{anchorEl:this.state.contextmenuEl,open:Boolean(this.state.contextmenuEl),onClose:this.handleContextmenuClose,children:[Object(a.jsx)(te.a,{onClick:this.handleEditName,children:"Edit Name"}),Object(a.jsx)(te.a,{onClick:this.handleEditColor,children:"Edit Color"})]}),Object(a.jsxs)("table",{style:{textAlign:"left"},children:[Object(a.jsx)("thead",{children:Object(a.jsxs)("tr",{children:[p&&Object(a.jsx)("td",{}),Object(a.jsx)("td",{}),Object(a.jsx)("td",{children:Object(a.jsx)("small",{children:"all"})}),Object(a.jsx)("td",{children:Object(a.jsx)("small",{children:null!=m?"selection":null})})]})}),Object(a.jsx)("tbody",{children:j.map((function(t,i){var r=null==f||-1!==f.indexOf(t)?1:.4,o=b.counts[i],s=g[t]||0,l=null==m?0:s/u,c=Ae(100*o/d)+"%",h=t,v=y[t];void 0!==v&&(h=v);var j=null==m?null:Ae(100*l)+"%";return Object(a.jsxs)("tr",{style:{cursor:p?"pointer":null,opacity:r},onContextMenu:function(n){return e.handleContextmenu(t,i,n)},onClick:function(n){return e.handleClick(t,i,n)},children:[p&&Object(a.jsx)("td",{children:Object(a.jsx)("div",{style:{display:"inline-block",width:10,height:10,background:n(t)}})}),Object(a.jsxs)("td",{children:[Object(a.jsx)("div",{style:{maxWidth:140,textOverflow:"ellipsis",overflow:"hidden",display:"inline-block",userSelect:"none"},title:""+h,children:""+h}),Object(a.jsx)(Q.a,{style:{padding:0,fontSize:14},size:"small",onClick:function(n){return e.handleContextmenu(t,i,n)},"aria-label":"Menu","aria-haspopup":"true",children:Object(a.jsx)(Bi.a,{fontSize:"inherit"})})]}),Object(a.jsx)("td",{children:Object(a.jsx)($.a,{title:c,children:Object(a.jsx)("span",{children:_e(o)})})}),m&&Object(a.jsx)("td",{children:Object(a.jsx)($.a,{title:j,children:Object(a.jsx)("div",{children:_e(s)})})})]},t)}))})]})]})}}]),n}(r.a.PureComponent),Hi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(y.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"getTable",value:function(e,t,n){return Object(a.jsxs)("table",{children:[Object(a.jsx)("thead",{children:Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{}),e.map((function(e){return Object(a.jsx)("td",{children:Object(a.jsx)("small",{children:e})},e)}))]})}),Object(a.jsxs)("tbody",{children:[Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["Mean",":"]}),Object(a.jsx)("td",{children:Ae(n.mean)}),t&&Object(a.jsx)("td",{children:Ae(t.mean)})]}),null!=n.numExpressed&&Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["% Expressed",":"]}),Object(a.jsx)("td",{children:Te(100*n.numExpressed/this.props.nObs)}),t&&Object(a.jsx)("td",{children:Te(100*t.numExpressed/this.props.nObsSelected)})]}),(null==n.numExpressed||0!==n.min)&&Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["Min",":"]}),Object(a.jsx)("td",{children:Ae(n.min)}),t&&Object(a.jsx)("td",{children:Ae(t.min)})]}),Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{style:{textAlign:"right"},children:["Max",":"]}),Object(a.jsx)("td",{children:Ae(n.max)}),t&&Object(a.jsx)("td",{children:Ae(t.max)})]})]})]})}},{key:"render",value:function(){var e=this.props,t=e.name,n=e.featureSummary,i=e.globalFeatureSummary,o=n[t],s=i[t],l=["all"];return null!=o&&l.push("selection"),Object(a.jsx)(r.a.Fragment,{children:null!=s&&"__count"!==t&&this.getTable(l,o,s)})}}]),n}(r.a.PureComponent),Vi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){var e;Object(y.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).handleOperationChanged=function(t){var n=t.target.value;e.props.handleUpdate({name:e.props.name,operation:n,update:!0})},e.handleValueKeyPress=function(t){if("Enter"===t.key){var n=e.getFilter(),a=parseFloat(n.uiValue);e.props.handleUpdate({name:e.props.name,value:a,update:!0})}},e.handleValueChange=function(t){var n=e.getFilter();n.uiValue=t.target.value,e.props.handleUpdate({name:e.props.name,operation:n.operation,value:n.value,update:!1})},e}return Object(C.a)(n,[{key:"getFilter",value:function(){var e=this.props.datasetFilter[this.props.name];return null==e&&(e={operation:">",value:NaN,uiValue:""},this.props.datasetFilter[this.props.name]=e),e}},{key:"render",value:function(){var e=this.props.name,t=this.getFilter(),n=e+"_filter";return Object(a.jsxs)("div",{style:{display:"flex"},children:[Object(a.jsx)(fi.a,{shrink:!0,id:n+"_label",children:"Filter"}),Object(a.jsxs)(bi.a,{labelId:n+"_label",id:n,style:{marginRight:6},value:t.operation,onChange:this.handleOperationChanged,children:[Object(a.jsx)(te.a,{value:""}),Object(a.jsx)(te.a,{value:">",children:">"}),Object(a.jsx)(te.a,{value:"<",children:"<"}),Object(a.jsx)(te.a,{value:"=",children:"="}),Object(a.jsx)(te.a,{value:">=",children:">="}),Object(a.jsx)(te.a,{value:"<=",children:"<="}),Object(a.jsx)(te.a,{value:"!=",children:"!="})]}),Object(a.jsx)(Va.a,{onKeyPress:this.handleValueKeyPress,onChange:this.handleValueChange,value:t.uiValue,style:{maxWidth:60}})]})}}]),n}(r.a.PureComponent),Wi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.setState({min:e.target.value})},a.onMinKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);isNaN(t)?delete a.props.globalFeatureSummary[a.props.name].customMin:a.props.globalFeatureSummary[a.props.name].customMin=t,a.setState({min:e.target.value}),a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})}},a.onMaxChange=function(e){a.setState({max:e.target.value})},a.onMaxKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);isNaN(t)?delete a.props.globalFeatureSummary[a.props.name].customMax:a.props.globalFeatureSummary[a.props.name].customMax=t,a.setState({max:e.target.value}),a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})}},a.state={min:"",max:""},a}return Object(C.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.name!==this.props.name&&this.setState({min:"",max:""})}},{key:"render",value:function(){var e=this.props,t=e.scale,n=e.name,i=e.nObs,r=e.nObsSelected,o=e.featureSummary,s=e.globalFeatureSummary,l=e.maxHeight,c=e.datasetFilter,d=e.handleUpdate,u=e.selected,h={display:"inline-block",verticalAlign:"top"};return this.props.style&&(h=Object.assign({},h,this.props.style)),Object(a.jsxs)("div",{className:"cirro-condensed",style:h,children:[Object(a.jsx)(Hi,{name:n,selected:u,summary:t.summary,featureSummary:o,nObs:i,nObsSelected:r,globalFeatureSummary:s,maxHeight:l}),"__count"!==n&&this.props.handleDomain&&Object(a.jsx)(fi.a,{shrink:!0,variant:"standard",children:"Custom Color Scale"}),"__count"!==n&&this.props.handleDomain&&Object(a.jsx)(Va.a,{InputLabelProps:{shrink:!0},margin:"none",style:{maxWidth:60,marginRight:4,marginTop:0},size:"small",type:"text",onKeyPress:this.onMinKeyPress,onChange:this.onMinChange,label:"Min",value:this.state.min}),"__count"!==n&&this.props.handleDomain&&Object(a.jsx)(Va.a,{InputLabelProps:{shrink:!0},margin:"none",style:{maxWidth:60,marginTop:0},size:"small",type:"text",onKeyPress:this.onMaxKeyPress,onChange:this.onMaxChange,label:"Max",value:this.state.max}),"__count"!==n&&Object(a.jsx)(Vi,{datasetFilter:c,name:n,handleUpdate:d})]})}}]),n}(r.a.PureComponent),Ki=function(){function e(t,n){var a=this;Object(y.a)(this,e),this._viewer=t,this.backingScale=1,this._containerWidth=0,this._containerHeight=0,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.width="100%",this._canvas.style.height="100%",this._viewer.canvas.appendChild(this._canvas),this.onRedraw=n.onRedraw||function(){},this.clearBeforeRedraw="undefined"===typeof n.clearBeforeRedraw||n.clearBeforeRedraw,this._viewer.addHandler("update-viewport",(function(){a.resize(),a._updateCanvas()})),this._viewer.addHandler("open",(function(){a.resize(),a._updateCanvas()}))}return Object(C.a)(e,[{key:"canvas",value:function(){return this._canvas}},{key:"context2d",value:function(){return this._canvas.getContext("2d")}},{key:"clear",value:function(){this._canvas.getContext("2d").clearRect(0,0,this._containerWidth*this.backingScale,this._containerHeight*this.backingScale)}},{key:"resize",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio);var t=this.backingScale!==e;this.backingScale=e,(this._containerWidth!==this._viewer.container.clientWidth||t)&&(this._containerWidth=this._viewer.container.clientWidth,this._canvas.setAttribute("width",e*this._containerWidth),this._canvas.setAttribute("width",e*this._containerWidth)),(this._containerHeight!==this._viewer.container.clientHeight||t)&&(this._containerHeight=this._viewer.container.clientHeight,this._canvas.setAttribute("height",e*this._containerHeight),this._canvas.setAttribute("height",e*this._containerHeight))}},{key:"_updateCanvas",value:function(){var e=this._viewer.viewport.getZoom(!0);this.clearBeforeRedraw&&this.clear();for(var t=this._canvas.getContext("2d"),n=0,a=this._viewer.world.getItemCount();n<a;n++){var i=this._viewer.world.getItemAt(n);if(i){var r=i.viewportToImageZoom(e),o=i.imageToViewportCoordinates(0,0,!0),s=this._viewer.viewport.pixelFromPoint(o,!0);t.scale(this.backingScale,this.backingScale),t.translate(s.x,s.y),t.scale(r,r),this.onRedraw({index:n,context:t,x:s.x,y:s.y,zoom:r}),t.setTransform(1,0,0,1,0,0)}}}}],[{key:"getTileIndexFromPixel",value:function(e,t){for(var n=e.viewport.pointFromPixel(t),a=0,i=e.world.getItemCount();a<i;a++){var r=e.world.getItemAt(a),o=new window.OpenSeadragon.Rect(n.x,n.y,0,0),s=r._viewportToTiledImageRectangle(o).getTopLeft(),l=r.source;if(s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/l.aspectRatio)return a}return-1}}]),e}(),Gi="http://www.w3.org/2000/svg",Xi=function(){function e(t){Object(y.a)(this,e);var n=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(Gi,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(Gi,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("update-viewport",(function(){n.resize()})),this._viewer.addHandler("open",(function(){n.resize()})),this._viewer.addHandler("rotate",(function(e){n.resize()})),this._viewer.addHandler("resize",(function(){n.resize()})),this.resize()}return Object(C.a)(e,[{key:"node",value:function(){return this._node}},{key:"resize",value:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));var e=this._viewer.viewport.pixelFromPoint(new v.a.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0);this._viewer.world.getItemCount()>0&&(t=this._viewer.world.getItemAt(0).viewportToImageZoom(t));var n=this._viewer.viewport.getRotation();this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+t+") rotate("+n+")")}}]),e}();function qi(e,t){return t*(e.embedding.spatial.spot_diameter?e.embedding.spatial.spot_diameter/2:20)}function Zi(e,t,n,a,i){if(a.showLabels&&n.isCategorical){e.textAlign="center",e.textBaseline="middle";var r=Math.ceil(a.labelFontSize/t);e.fillStyle="white",e.strokeStyle="rgba(0,0,0,0.9)",e.lineWidth=a.labelStrokeWidth,e.font=r+"px Roboto Condensed,Helvetica,Arial,sans-serif";for(var o=mt(n,i),s=0,l=0,c=o.labels.length;s<c;s++,l+=3){var d=o.positions[l],u=o.positions[l+1];e.strokeText(""+o.labels[s],d,u),e.fillText(""+o.labels[s],d,u)}}}function Yi(e,t,n,a,i,r,o){e.lineWidth=2/t,e.setLineDash&&e.setLineDash([2,2]);var s=0===a.size,l=n.indices;if(s){e.globalAlpha=i;for(var c=0;c<n.x.length;c++){var d=l[c],u=n.x[d],h=n.y[d];e.fillStyle=n.colors[d],e.beginPath(),e.arc(u,h,o,0,2*Math.PI,!0),e.fill()}}else{e.globalAlpha=r;for(var p=0;p<n.x.length;p++){var f=l[p],m=n.x[f],g=n.y[f];a.has(f)||(e.fillStyle=n.colors[f],e.beginPath(),e.arc(m,g,o,0,2*Math.PI,!0),e.fill())}e.globalAlpha=i;for(var v=0;v<n.x.length;v++){var b=l[v],j=n.x[b],y=n.y[b];a.has(b)&&(e.fillStyle=n.colors[b],e.beginPath(),e.arc(j,y,o,0,2*Math.PI,!0),e.fill())}}e.globalAlpha=1,e.setLineDash&&e.setLineDash([])}var Ji=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t=a.props.traceInfo,n=a.viewer.source.levels[a.viewer.source.levels.length-1].context2D.canvas;Re(t,{width:n.width,height:n.height},Object(m.bind)(a.drawContext,Object(X.a)(a)),e)},a.onEditSelection=function(){a.props.chartOptions.editSelection=!a.props.chartOptions.editSelection,a.props.setChartOptions(a.props.chartOptions)},a.onShowLabels=function(){a.props.chartOptions.showLabels=!a.props.chartOptions.showLabels,a.props.setChartOptions(a.props.chartOptions)},a.onZoomIn=function(){a.viewer.viewport.zoomBy(a.viewer.zoomPerClick/1),a.viewer.viewport.applyConstraints()},a.onZoomOut=function(){a.viewer.viewport.zoomBy(1/a.viewer.zoomPerClick),a.viewer.viewport.applyConstraints()},a.onHome=function(){a.viewer.viewport.goHome(),a.viewer.viewport.applyConstraints()},a.onDragMode=function(e){a.props.chartOptions.dragmode=e,a.props.setChartOptions(a.props.chartOptions)},a.id=Object(m.uniqueId)("cirro-image"),a.tooltipElementRef=r.a.createRef(),a.state={loading:!1},a}return Object(C.a)(n,[{key:"findPointsInPolygon",value:function(e){for(var t=this.props.traceInfo,n=[],a=0;a<t.x.length;a++)Ye({x:t.x[a],y:t.y[a]},e)&&n.push(a);return n}},{key:"findPointsInRectangle",value:function(e){for(var t=this.props.traceInfo,n=qi(t,this.props.pointSize),a=[],i=parseFloat(e.getAttribute("x")),r=parseFloat(e.getAttribute("y")),o=i+parseFloat(e.getAttribute("width")),s=r+parseFloat(e.getAttribute("height")),l=0;l<t.x.length;l++){var c=t.x[l],d=t.y[l];c<=o&&i<=c+n&&d<=s&&r<=d+n&&a.push(l)}return a}},{key:"findPointIndex",value:function(e,t){for(var n=this.props.traceInfo,a=qi(n,this.props.pointSize),i=0;i<n.x.length;i++)if(Math.abs(n.x[i]-e)<=a&&Math.abs(n.y[i]-t)<=a)return i;return-1}},{key:"setTooltip",value:function(e,t){var n=this.props.traceInfo,a=this.findPointIndex(e,t);if(-1!=a){var i=n.values[a],r=this.props.categoricalNames[n.name];if(r){var o=r[i];null!=o&&(i=o)}"number"===typeof i&&(i=Ae(i)),this.tooltipElementRef.current.innerHTML=""+i}else this.tooltipElementRef.current.innerHTML=" "}},{key:"drawContext",value:function(e,t){var n=this.viewer.source.levels[this.viewer.source.levels.length-1].context2D.canvas;null==t&&(t={width:n.width,height:n.height});var a=Math.min(t.width/n.width,t.height/n.height);e.drawImage(n,0,0,n.width*a,n.height*a),this._drawOverlay({context:e,zoom:a})}},{key:"_drawOverlay",value:function(e){var t=e.context,n=this.props.traceInfo,a=this.props.selection,i=this.props.markerOpacity,r=this.props.unselectedMarkerOpacity,o=qi(n,this.props.pointSize);Yi(t,e.zoom,n,a,i,r,o),Zi(t,e.zoom,n,this.props.chartOptions,this.props.categoricalNames)}},{key:"createViewer",value:function(){var e=this;this.viewer&&this.viewer.destroy(),this.props.traceInfo.tileSource.ready?this.setState({loading:!1}):(this.setState({loading:!0}),this.props.traceInfo.tileSource.addOnceHandler("ready",(function(t){e.setState({loading:!1})}))),this.viewer=new v.a({id:this.id,gestureSettingsMouse:{dblClickToZoom:!0,clickToZoom:!1},autoResize:!0,showFullPageControl:!1,collectionMode:!1,showNavigationControl:!1,tileSources:this.props.traceInfo.tileSource});var t=this.viewer,n=this;this.canvasOverlay=new Ki(this.viewer,{onRedraw:function(e){n._drawOverlay(e)}});var a=[],i=[0,0],r={x:0,y:0,width:0,height:0};this.viewer.innerTracker.moveHandler=function(e){if(null==n.tooltipElementRef.current)n.tooltipElementRef.current.innerHTML=" ";else if("pan"===n.props.chartOptions.dragmode&&t.world.getItemCount()>0){var a=e.position,i=t.viewport.pointFromPixel(a),r=t.world.getItemAt(0).viewportToImageCoordinates(i,!0);n.setTooltip(r.x,r.y)}else n.tooltipElementRef.current.innerHTML=" "},this.viewer.addHandler("canvas-drag",(function(e){if(("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode)&&t.world.getItemCount()>0){e.preventDefaultAction=!0;var o=e.position,c=t.viewport.pointFromPixel(o),d=t.world.getItemAt(0).viewportToImageCoordinates(c,!0);a.push({x:d.x,y:d.y}),"lasso"===n.props.chartOptions.dragmode?(a=He()(a),s.setAttribute("d",Je(a))):(r.x=Math.min(d.x,i[0]),r.y=Math.max(d.y,i[1]),r.width=Math.max(d.x,i[0])-r.x,r.height=r.y-Math.min(d.y,i[1]),l.setAttribute("x",""+r.x),l.setAttribute("y",""+(r.y-r.height)),l.setAttribute("width",""+r.width),l.setAttribute("height",""+r.height))}})),this.viewer.addHandler("canvas-press",(function(e){if("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var o=e.position,l=t.viewport.pointFromPixel(o),c=t.world.getItemAt(0).viewportToImageCoordinates(l,!0);"lasso"===n.props.chartOptions.dragmode?((a=[]).push({x:c.x,y:c.y}),a=He()(a),s.setAttribute("d",Je(a))):(i=[c.x,c.y],r={x:i[0],y:i[1],width:1,height:1})}})),this.viewer.addHandler("canvas-release",(function(e){if("lasso"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var t=n.findPointsInPolygon(a);a=[],s.setAttribute("d",""),n.props.onSelected({name:yn(n.props.traceInfo.embedding),clear:!n.props.chartOptions.editSelection,value:{basis:n.props.traceInfo.embedding,points:t}})}else if("select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var i=n.findPointsInRectangle(l);l.removeAttribute("x"),l.removeAttribute("y"),l.removeAttribute("width"),l.removeAttribute("height"),n.props.onSelected({name:yn(n.props.traceInfo.embedding),clear:!n.props.chartOptions.editSelection,value:{basis:n.props.traceInfo.embedding,points:i}})}})),t.addHandler("canvas-exit",(function(e){n.tooltipElementRef.current&&(n.tooltipElementRef.current.innerHTML=" ")}));var o=new Xi(t),s=document.createElementNS("http://www.w3.org/2000/svg","path"),l=document.createElementNS("http://www.w3.org/2000/svg","rect");[s,l].forEach((function(e){e.setAttribute("stroke","black"),e.setAttribute("stroke-width","3px"),e.setAttribute("fill","#0bb"),e.setAttribute("fill-opacity","0.3"),e.setAttribute("stroke-dasharray","2 2"),o.node().appendChild(e)}))}},{key:"componentDidUpdate",value:function(e,t,n){this.canvasOverlay&&this.canvasOverlay._updateCanvas()}},{key:"componentWillUnmount",value:function(){this.viewer&&this.viewer.destroy(),this.viewer=null}},{key:"componentDidMount",value:function(){null==this.viewer&&this.createViewer(this.props.traceInfo.url)}},{key:"render",value:function(){return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{className:this.props.classes.root,children:[Object(a.jsx)(Me,{dragmode:this.props.chartOptions.dragmode,editSelection:this.props.chartOptions.editSelection,showLabels:this.props.chartOptions.showLabels,onMoreOptions:this.props.onMoreOptions,onGallery:this.props.onGallery,animating:!1,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,is3d:!1,onHome:this.onHome,onSaveImage:this.onSaveImage,onShowLabels:this.onShowLabels,onDragMode:this.onDragMode,onEditSelection:this.onEditSelection}),Object(a.jsx)(q.a,{color:"textPrimary",ref:this.tooltipElementRef,style:{display:"inline-block",paddingLeft:5,verticalAlign:"top"},children:"\xa0"})]}),Object(a.jsx)("div",{style:{display:"inline-block",width:this.props.chartSize.width,height:this.props.chartSize.height},id:this.id}),this.state.loading&&Object(a.jsx)(ua.a,{style:{position:"absolute",left:this.props.chartSize.width/2,top:this.props.chartSize.height/2},size:20})]})}}]),n}(r.a.PureComponent),$i=Y()((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},position:"absolute",zIndex:1,top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(Ji),Qi=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).setChartRef=function(e){a.props.chartOptions.ref=e},a.handleExpandClick=function(e){e.preventDefault(),a.setState({showDetails:!a.state.showDetails})},a.state={showDetails:!0},a}return Object(C.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.traceInfo.name!==this.props.traceInfo.name&&this.setState({showDetails:!0})}},{key:"render",value:function(){var e=this.props,t=e.onChartOptions,n=e.onMoreOptions,i=e.onDomain,r=e.onDimensionFilterUpdated,o=e.onColorChange,s=e.onNameChange,l=e.onMeasureFilterUpdated,c=e.onSelect,d=e.onDeselect,u=e.onGallery,h=e.traceInfo,p=e.selection,f=e.datasetFilter,m=e.chartOptions,g=e.featureSummary,v=e.markerOpacity,b=e.unselectedMarkerOpacity,j=e.pointSize,y=e.globalFeatureSummary,O=e.shape,x=e.nObsSelected,S=e.categoricalNames,w=e.primaryChartSize,C="__count"===h.name?"":h.name;return Object(a.jsxs)("div",{style:{position:"relative"},children:[Object(a.jsxs)(Ai.a,{color:"text.primary",style:{marginTop:"3.2px",position:"absolute",textAlign:"right",right:8,zIndex:1e3},children:[""!==C?Object(a.jsx)($.a,{title:"Embedding: "+h.embedding.name,children:Object(a.jsx)(Ti.a,{onClick:this.handleExpandClick,children:Object(a.jsxs)(q.a,{color:"textPrimary",style:{marginRight:14},component:"h4",children:[C," ",h.continuous?null:Object(a.jsxs)("small",{children:["(",y[h.name].categories.length,")"]})]})})}):null,h.continuous?Object(a.jsx)(Wi,{handleDomain:i,width:140,showColorScheme:!1,height:30,style:{display:this.state.showDetails?"block":"none"},handleUpdate:l,datasetFilter:f,scale:h.colorScale,featureSummary:g,globalFeatureSummary:y,nObs:O[0],nObsSelected:x,maxHeight:null,name:h.name},h.name):Object(a.jsx)(Ui,{style:{display:this.state.showDetails?"block":"none"},datasetFilter:f,handleClick:r,handleColorChange:o,handleNameChange:s,categoricalNames:S,name:h.name,scale:h.colorScale,maxHeight:300,clickEnabled:!0,nObs:O[0],nObsSelected:x,globalFeatureSummary:y,featureSummary:g},h.name)]}),!h.isImage&&Object(a.jsx)(ct,{traceInfo:h,chartSize:w,setChartOptions:t,chartOptions:m,categoricalNames:S,selection:p,onDeselect:d,onSelected:c,pointSize:j,markerOpacity:v,unselectedMarkerOpacity:b,color:h.colors,onGallery:u,onMoreOptions:n,ref:this.setChartRef}),h.isImage&&Object(a.jsx)($i,{setChartOptions:t,chartOptions:m,style:{display:"inline-block"},traceInfo:h,pointSize:j,chartSize:w,categoricalNames:S,selection:p,onInitialized:this.onInitialized,markerOpacity:v,unselectedMarkerOpacity:b,onDeselect:d,onSelected:c,onGallery:u,onMoreOptions:n,ref:this.setChartRef})]})}}]),n}(r.a.PureComponent),er=Object(s.b)((function(e){return{chartOptions:e.chartOptions,embeddingChartSize:e.embeddingChartSize,pointSize:e.pointSize,embeddingData:e.embeddingData,primaryChartSize:e.primaryChartSize,markerOpacity:e.markerOpacity,unselectedMarkerOpacity:e.unselectedMarkerOpacity,primaryTraceKey:e.primaryTraceKey,categoricalNames:e.categoricalNames,globalFeatureSummary:e.globalFeatureSummary,featureSummary:e.featureSummary,shape:e.dataset.shape,nObsSelected:e.selection.count,dataset:e.dataset,datasetFilter:e.datasetFilter}}),(function(e){return{onChartOptions:function(t){e(En(t))},onMoreOptions:function(){e(qn(Qt))},onPrimaryChartSize:function(t){e(Mn(t))},onDomain:function(t){e({type:At,payload:t})},onDimensionFilterUpdated:function(t){var n;e((n=t,function(e,t){for(var a,i=n.name,r=n.value,o=n.shiftKey,s=n.metaKey,l=t().datasetFilter,c=t().embeddingData,d=0;d<c.length;d++)if(c[d].name===i){a=c[d].colorScale.domain();break}var u=l[i];if(null==u&&(u=[],l[i]=u),o&&u.length>0){var h=a.indexOf(u[u.length-1]),p=a.indexOf(r);if(p>h)for(var f=h;f<=p;f++){var m=u.indexOf(r);-1!==m&&u.splice(m,1),u.push(a[f])}else for(var g=h;g>=p;g--){var v=u.indexOf(r);-1!==v&&u.splice(v,1),u.push(a[g])}}else{var b=u.indexOf(r);s||(u=[],l[i]=u),-1!==b?(u.splice(b,1),0===u.length&&delete l[i]):u.push(r)}e(Dn(l)),e(_n())}))},onColorChange:function(t){e({type:_t,payload:t})},onNameChange:function(t){var n;e((n=t,function(e,t){var a=t().dataset.id;(t().serverInfo.fancy?t().serverInfo.api.setCategoryNamePromise({c:n.name,o:n.oldValue,n:n.value,id:a}):Promise.resolve()).then((function(){return e(Fn(n))}))}))},onMeasureFilterUpdated:function(t){var n;e((n=t,function(e,t){var a=n.name,i=n.operation,r=n.value,o=n.update,s=t().datasetFilter,l=s[a];null==l&&(l={operation:">",value:NaN},s[a]=l),o&&(null!=r&&(o=isNaN(r)?isNaN(r)!==isNaN(l.value):r!==l.value),null!=i&&(o=o||i!==l.operation&&!isNaN(l.value))),null!=i&&(l.operation=i),null!=r&&(l.value=r),e(Dn(Object.assign({},s))),o&&e(_n())}))},onSelect:function(t){e(Tn(t))},onDeselect:function(t){e(Tn(t))}}}))(Qi),tr=new Set,nr=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).resizeListener=function(){var e=window.innerWidth-280,t=Math.max(300,window.innerHeight-410);a.props.handlePrimaryChartSize({width:e,height:t})},window.addEventListener("resize",a.resizeListener),a}return Object(C.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeListener)}},{key:"render",value:function(){var e=this.props,t=e.primaryTraceKey,n=e.embeddingData,i=e.selection,r=e.onGallery,o=e.primaryChartSize,s=n.filter((function(e){return On(e)===t})),l=1===s.length?s[0]:null,c=tr;if(l){var d=yn(l.embedding),u=null!=i&&null!=i.chart?i.chart[d]:null;c=u?u.userPoints:tr}return null==l?Object(a.jsx)("div",{style:{height:o.height}}):Object(a.jsx)(er,{onGallery:r,traceInfo:l,selection:c})}}]),n}(r.a.PureComponent),ar=Object(s.b)((function(e){return{embeddingData:e.embeddingData,primaryTraceKey:e.primaryTraceKey,primaryChartSize:e.primaryChartSize,selection:e.selection}}),(function(e){return{handlePrimaryChartSize:function(t){e(Mn(t))}}}))(nr),ir=n(252),rr=n.n(ir),or=n(181),sr=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onSelect=function(e){e.preventDefault(),a.props.onSelect(a.props.traceInfo)},a.state={url:null,overlayUrl:null,loading:!1},a.canvasRef=r.a.createRef(),a}return Object(C.a)(n,[{key:"draw",value:function(){var e=this,t=this.props,n=t.scatterPlot,a=t.chartSize,i=t.categoricalNames,r=t.containerElement,o=t.traceInfo,s=t.markerOpacity,l=t.unselectedMarkerOpacity,c=t.selection,d=t.chartOptions,u=t.pointSize,h=yn(o.embedding),p=null!=c&&null!=c.chart?c.chart[h]:null,f=p?p.userPoints:new Set;if(o.isImage)if(o.tileSource.ready){var m=document.createElement("canvas");m.width=a*window.devicePixelRatio,m.height=a*window.devicePixelRatio;var g=m.getContext("2d");g.scale(window.devicePixelRatio,window.devicePixelRatio),function(e,t,n,a,i,r,o,s,l){if(n.tileSource.ready){var c=n.tileSource.levels[n.tileSource.levels.length-1].context2D.canvas;null==t&&(t={width:c.width,height:c.height});var d=Math.min(t.width/c.width,t.height/c.height);e.drawImage(c,0,0,c.width*d,c.height*d),e.scale(d,d),Yi(e,d,n,a,i,r,l),Zi(e,d,n,o,s),e.setTransform(1,0,0,1,0,0)}}(g,{width:a,height:a},o,f,s,l,d,i,qi(o,u)),this.setState({url:m.toDataURL(),overlayUrl:null,loading:!1}),m=null}else this.setState({url:null,overlayUrl:null,loading:!0}),o.tileSource.addOnceHandler("ready",(function(){e.setState({loading:!1})}));else{st(n,dt).zoomFactor=this.zoomFactor,gt(n,o,f,s,l,u,i,d);var v=r.querySelector("canvas"),b=null;if(d.showLabels&&o.isCategorical){var j=mt(o,i),y=document.createElement("canvas");y.width=a*window.devicePixelRatio,y.height=a*window.devicePixelRatio;var O=y.getContext("2d");O.scale(window.devicePixelRatio,window.devicePixelRatio),O.font="bold "+d.labelFontSize+"px Roboto Condensed",ot(O,j,d,{width:a,height:a},n.camera),b=y.toDataURL()}this.setState({url:v.toDataURL(),overlayUrl:b,loading:!1})}}},{key:"componentDidMount",value:function(){this.zoomFactor=pt(this.props.primaryChartSize),this.draw()}},{key:"componentDidUpdate",value:function(e,t){e.primaryChartSize!==this.props.primaryChartSize&&(this.zoomFactor=pt(this.props.primaryChartSize)),this.draw()}},{key:"render",value:function(){var e=this.props.traceInfo.name;return"__count"===e&&(e="count"),Object(a.jsx)(Ai.a,{borderColor:"text.primary",border:1,style:{display:"inline-block",margin:2},children:Object(a.jsxs)("div",{style:{position:"relative",width:this.props.chartSize,height:this.props.chartSize,cursor:"pointer"},children:[Object(a.jsx)($.a,{title:"Embedding: "+this.props.traceInfo.embedding.name,children:Object(a.jsx)(q.a,{color:"textPrimary",component:"h4",onClick:this.onSelect,style:{marginTop:"3.2px",position:"absolute",right:4,zIndex:1e3},children:e})}),this.state.url&&Object(a.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(a.jsx)("img",{alt:"",src:this.state.url,width:this.props.chartSize*window.devicePixelRatio,height:this.props.chartSize*window.devicePixelRatio,onClick:this.onSelect,style:{width:this.props.chartSize,height:this.props.chartSize}})}),this.state.loading&&Object(a.jsx)(ua.a,{style:{position:"absolute",left:this.props.chartSize/2,top:this.props.chartSize/2},size:20}),this.state.url&&Object(a.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(a.jsx)("img",{alt:"",src:this.state.url,width:this.props.chartSize*window.devicePixelRatio,height:this.props.chartSize*window.devicePixelRatio,onClick:this.onSelect,style:{width:this.props.chartSize,height:this.props.chartSize}})}),this.state.overlayUrl&&Object(a.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(a.jsx)("img",{alt:"",src:this.state.overlayUrl,onClick:this.onSelect,style:{width:this.props.chartSize,height:this.props.chartSize}})})]})})}}]),n}(r.a.PureComponent);function lr(e){var t=document.createElement("div");return t.style.position="absolute",t.style.left="-9999px",t.style.width=e+"px",t.style.height=e+"px",t}var cr=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onChartSelected=function(e){a.props.handlePrimaryTraceKey(On(e)),window.scrollTo(0,0)},a.onSortEnd=function(e,t){e[t.oldIndex].sortIndex=t.newIndex,e[t.newIndex].sortIndex=t.oldIndex,a.props.handleEmbeddingData(a.props.embeddingData.slice())},a.containerElement=lr(a.props.chartSize),document.body.appendChild(a.containerElement),a.scatterPlot=ft(a.containerElement,window.ApplePaySession,!1,!1),a.emptySet=new Set,a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.categoricalNames,i=t.chartSize,o=t.embeddingData,s=t.primaryChartSize,l=t.markerOpacity,c=t.unselectedMarkerOpacity,d=t.pointSize,u=t.chartOptions,h=t.selection;this.containerElement.style.width!==this.props.chartSize+"px"&&(document.body.removeChild(this.containerElement),this.containerElement=lr(this.props.chartSize),document.body.appendChild(this.containerElement),this.scatterPlot=ft(this.containerElement,window.ApplePaySession,!1,!1));for(var p=o.filter((function(e){return e.active})),f=0;f<p.length;f++)null==p[f].sortIndex&&(p[f].sortIndex=f);p.sort((function(e,t){return e.sortIndex-t.sortIndex}));var m=Object(or.b)((function(t){var r=t.traceInfo;return Object(a.jsx)(sr,{traceInfo:r,color:r.colors,scatterPlot:e.scatterPlot,markerOpacity:l,chartOptions:u,pointSize:d,chartSize:i,categoricalNames:n,primaryChartSize:s,unselectedMarkerOpacity:c,selection:h,containerElement:e.containerElement,onSelect:e.onChartSelected},On(r))})),g=Object(or.a)((function(e){var t=e.items;return Object(a.jsx)("ul",{style:{padding:0},children:t.map((function(e,t){return Object(a.jsx)(m,{index:t,traceInfo:e},On(e))}))})}));return Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)(q.a,{variant:"subtitle1",children:["Gallery",Object(a.jsx)($.a,{title:"Drag gallery charts to reorder. Click chart to set primary view.",children:Object(a.jsx)(rr.a,{style:{verticalAlign:"text-bottom"}})})]}),Object(a.jsx)(g,{distance:2,axis:"xy",items:p,onSortEnd:function(t){return e.onSortEnd(p,t)}})]})}}]),n}(r.a.PureComponent),dr=Object(s.b)((function(e){return{categoricalNames:e.categoricalNames,embeddingData:e.embeddingData,markerOpacity:e.markerOpacity,unselectedMarkerOpacity:e.unselectedMarkerOpacity,selection:e.selection,primaryTraceKey:e.primaryTraceKey,pointSize:e.pointSize,chartSize:e.chartSize,primaryChartSize:e.primaryChartSize,chartOptions:e.chartOptions}}),(function(e){return{handlePrimaryTraceKey:function(t){e(In(t))},handleEmbeddingData:function(t){e(Xn(t))}}}))(cr),ur=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleClose()},a.state={open:!0},a}return Object(C.a)(n,[{key:"render",value:function(){return Object(a.jsxs)(ha.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"help-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(pa.a,{id:"help-dataset-dialog-title",children:"Help"}),Object(a.jsxs)(ui.a,{children:[Object(a.jsx)(q.a,{variant:"h6",children:"Primary Embedding Controls"}),Object(a.jsx)(q.a,{variant:"subtitle1",children:"3-d Plot"}),"Rotate: Mouse left click.",Object(a.jsx)("br",{}),"Pan: Mouse right click.",Object(a.jsx)("br",{}),"Zoom: Mouse wheel.",Object(a.jsx)("br",{}),Object(a.jsx)(q.a,{variant:"subtitle1",children:"2-d Plot"}),"Pan: Mouse left click.",Object(a.jsx)("br",{}),"Zoom: Mouse wheel.",Object(a.jsx)("br",{}),Object(a.jsx)(xa.a,{}),Object(a.jsx)(q.a,{variant:"h6",children:"Gallery"}),"Drag chart to reorder. Click plot to set primary view.",Object(a.jsx)(xa.a,{}),Object(a.jsx)(q.a,{variant:"h6",children:"Dot Plot"}),"Enter one or more categorical observations and one or more features.",Object(a.jsx)(xa.a,{}),Object(a.jsxs)(q.a,{variant:"h6",children:["Additional documentation is available ",Object(a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"http://cirrocumulus.readthedocs.io/",children:"here"}),"."]})]})]})}}]),n}(r.a.PureComponent),hr=Object(s.b)((function(e){return{}}),(function(e){return{handleClose:function(t){e(qn(null))}}}))(ur),pr=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleClose()},a.onLabelFontSizeKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);!isNaN(t)&&t>0&&(a.props.chartOptions.labelFontSize=t,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelFontSize:t}))}},a.onLabelFontSize=function(e){a.setState({labelFontSize:e.target.value})},a.onLabelStrokeWidth=function(e){a.setState({labelStrokeWidth:e.target.value})},a.onLabelStrokeWidthKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);!isNaN(t)&&t>=0&&(a.props.chartOptions.labelStrokeWidth=t,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelStrokeWidth:t}))}},a.state={labelFontSize:"",labelStrokeWidth:""},a}return Object(C.a)(n,[{key:"componentDidMount",value:function(){this.setState({labelFontSize:this.props.chartOptions.labelFontSize,labelStrokeWidth:this.props.chartOptions.labelStrokeWidth})}},{key:"render",value:function(){return Object(a.jsxs)(ha.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"more-options-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(pa.a,{id:"more-options-dialog-title",children:"More Options"}),Object(a.jsxs)(ui.a,{children:[Object(a.jsx)(Va.a,{value:this.state.labelFontSize,onChange:this.onLabelFontSize,onKeyPress:this.onLabelFontSizeKeyPress,margin:"dense",label:"Label Font Size",fullWidth:!0}),Object(a.jsx)(Va.a,{value:this.state.labelStrokeWidth,onChange:this.onLabelStrokeWidth,onKeyPress:this.onLabelStrokeWidthKeyPress,margin:"dense",label:"Label Shadow Size",fullWidth:!0})]})]})}}]),n}(r.a.PureComponent),fr=Object(s.b)((function(e){return{chartOptions:e.chartOptions}}),(function(e){return{handleChartOptions:function(t){e(En(t))},handleClose:function(){e(qn(null))}}}))(pr),mr=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onNotesChanged=function(e){a.setState({notes:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.notes;null!=t&&(t=t.trim()),a.setState({loading:!0}),a.props.handleSave({name:e,notes:t})},a.state={open:!0,name:"",notes:""},a}return Object(C.a)(n,[{key:"componentDidMount",value:function(){null==this.props.savedFilter?this.setState({name:"",notes:"",create:!0}):this.setState({name:this.props.savedFilter.name,notes:this.props.savedFilter.notes})}},{key:"render",value:function(){var e=this.state,t=e.name,n=e.notes,i=e.create;return Object(a.jsxs)(ha.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-filter-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsxs)(pa.a,{id:"edit-dataset-filter-dialog-title",children:[i?"Create":"Edit"," Filter"]}),Object(a.jsxs)(ui.a,{children:[Object(a.jsx)(Va.a,{required:!0,value:t,autoComplete:"off",onChange:this.onNameChanged,margin:"dense",label:"Name",fullWidth:!0}),Object(a.jsx)(Va.a,{required:!1,autoComplete:"off",value:n,onChange:this.onNotesChanged,margin:"dense",label:"Notes",fullWidth:!0})]}),Object(a.jsxs)(di.a,{children:[Object(a.jsx)(wa.a,{onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(wa.a,{disabled:0===t.trim().length,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(r.a.PureComponent),gr=Object(s.b)((function(e){return{savedFilter:e.savedDatasetFilter}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t(),i=Cn(a),r={ds_id:a.dataset.id};null!=n.filterId&&(r.id=n.filterId);var o={},s=!1;if(n.name!==o.name&&(r.name=n.name,s=!0),n.notes!==o.notes&&(r.notes=n.notes,s=!0),Object(m.isEqual)(i,o.value)||(r.value=i,s=!0),s){for(var l in r)o[l]=r[l];e(Yn(!0)),t().serverInfo.api.upsertDatasetFilterPromise(r,null!=n.filterId).then((function(a){r.id=a.id;var i=t().datasetFilters;if(null!=n.filterId){for(var o=0;o<i.length;o++)if(i[o].id===a.id){i[o]=r;break}}else i.push(r);e(aa(i.slice())),e(Gn("Filter saved"))})).finally((function(){e(Yn(!1)),e(qn(null))})).catch((function(t){la(e,t,"Unable to save filter. Please try again.")}))}else e(qn(null))}))},handleCancel:function(t){e(qn(null))},handleError:function(t){e(Gn(t))}}}))(mr),vr=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onCategoryChanged=function(e){a.setState({category:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.category;null!=t&&(t=t.trim()),a.setState({loading:!0}),a.props.handleSave({name:e,category:t})},a.state={open:!0,name:"",category:""},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.state,t=e.name,n=e.category;return Object(a.jsxs)(ha.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-set-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(a.jsx)(pa.a,{id:"edit-set-dialog-title",children:"Create Set"}),Object(a.jsxs)(ui.a,{children:[Object(a.jsx)(Va.a,{required:!0,autoComplete:"off",value:t,onChange:this.onNameChanged,margin:"dense",label:"Set Name",fullWidth:!0}),Object(a.jsx)(Va.a,{required:!0,autoComplete:"off",value:n,onChange:this.onCategoryChanged,margin:"dense",label:"Set Category",fullWidth:!0})]}),Object(a.jsxs)(di.a,{children:[Object(a.jsx)(wa.a,{onClick:this.handleClose,color:"primary",children:"Cancel"}),Object(a.jsx)(wa.a,{disabled:0===t.trim().length||0===n.trim().length,onClick:this.handleSave,color:"primary",children:"Save"})]})]})}}]),n}(r.a.PureComponent),br=Object(s.b)((function(e){return{savedFilter:e.savedDatasetFilter}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t(),i=at(a.searchTokens).X,r={ds_id:a.dataset.id,name:n.name,features:i,category:n.category};e(Yn(!0)),t().serverInfo.api.upsertFeatureSet(r,!1).then((function(a){var r=t().markers;r.push({category:n.category,name:n.name,features:i,id:a.id}),e(Zn(r.slice())),e(Gn("Set saved"))})).finally((function(){e(Yn(!1)),e(qn(null))})).catch((function(t){la(e,t,"Unable to save set. Please try again.")}))}))},handleCancel:function(t){e(qn(null))},handleError:function(t){e(Gn(t))}}}))(vr),jr=n(477),yr=n(468),Or=n(467),xr=n(476),Sr=n(482),wr=(n(469),n(470)),Cr=n(255),kr=n.n(Cr),Er=n(256),Pr=n.n(Er),Mr=n(254),Ir=n.n(Mr),Dr=n(180),zr=n.n(Dr),Ar=n(53),_r=n(465),Tr=n(28),Fr=n(464),Nr=n(463),Rr=n(466),Lr=n(479),Br=n(253);function Ur(e){var t=e.data,n=e.index,a=e.style;return r.a.cloneElement(t[n],{style:Object(Oa.a)(Object(Oa.a)({},a),{},{top:a.top+0})})}var Hr=r.a.createContext({}),Vr=r.a.forwardRef((function(e,t){var n=r.a.useContext(Hr);return Object(a.jsx)("div",Object(Oa.a)(Object(Oa.a)({ref:t},e),n))})),Wr=r.a.forwardRef((function(e,t){var n=e.children,i=Object(zi.a)(e,["children"]),o=r.a.Children.toArray(n),s=Object(Tr.a)(),l=Object(Nr.a)(s.breakpoints.up("sm"),{noSsr:!0}),c=o.length,d=l?24:36,u=function(e){return d};return Object(a.jsx)("div",{ref:t,children:Object(a.jsx)(Hr.Provider,{value:i,children:Object(a.jsx)(Br.a,{itemData:o,height:(c>8?8*d:o.map(u).reduce((function(e,t){return e+t}),0))+0,width:"100%",outerElementType:Vr,innerElementType:"ul",itemSize:function(e){return u(o[e])},overscanCount:5,itemCount:c,children:Ur},c)})})})),Kr=Object(Fr.a)({paper:{width:230},listbox:{"& ul":{padding:0,margin:0}}}),Gr=function(e){return[Object(a.jsx)(_r.a,{disableGutters:!0,component:"div",children:Object(a.jsx)(q.a,{noWrap:!0,children:e.group})}),e.children]};function Xr(e){var t=Kr(),n=r.a.createRef();function i(t,n){var a=[];n.forEach((function(t){if(""!==(t=t.toLowerCase().trim().replace(/"/g,"")))for(var n=0;n<e.options.length;n++)if(e.options[n].toLowerCase()===t){a.push(e.options[n]);break}})),e.onChange(t,a)}function o(e){n.current.style.background=e?"#1976d2":""}function s(e){e.preventDefault(),e.stopPropagation(),o(!1)}var l=Object(Rr.a)({matchFrom:"start"}),c=e.getOptionSelected;null==c&&(c=e.groupBy?function(e,t){return e.id===t.id&&e.group===t.group}:function(e,t){return e===t});var d=e.getChipText;return null==d&&(d=function(e){return e}),Object(a.jsx)(Lr.a,{multiple:!0,ref:n,filterOptions:l,disableListWrap:!0,classes:t,getOptionSelected:c,value:e.value,openOnFocus:!0,filterSelectedOptions:!0,getOptionLabel:e.groupBy?function(e){return e.text}:function(e){return e},groupBy:e.groupBy?function(e){return e.group}:null,blurOnSelect:!0,ChipProps:{size:"small"},ListboxComponent:Wr,renderGroup:Gr,options:e.options,autoHighlight:!0,onChange:e.onChange,renderTags:null==e.onChipClick?null:function(t,n){return t.map((function(t,i){return Object(a.jsx)(Sr.a,Object(Oa.a)({variant:"default",onClick:function(n){return function(t,n){e.onChipClick(t,n)}(n,t)},label:d(t),size:"small"},n({index:i})))}))},renderInput:function(t){return Object(a.jsx)(Va.a,Object(Oa.a)(Object(Oa.a)({margin:"dense"},t),{},{label:e.label,helperText:e.helperText}))},renderOption:e.groupBy?function(e){return Object(a.jsx)(q.a,{title:e.text,noWrap:!0,children:e.text})}:function(e){return Object(a.jsx)(q.a,{noWrap:!0,children:e})},onPaste:function(e){var t=e.clipboardData.getData("text/plain");null!=t&&t.length>0&&(e.preventDefault(),e.stopPropagation(),i(e,t.split(/[\n,\t]/)))},onDrop:function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files,n=new FileReader;n.onload=function(e){i(e,e.target.result.split(/[\n,\t]/))},n.onerror=function(e){alert("Unable to read file.")},n.readAsText(t[0]),o(!1)},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),o(!0)},onDragEnd:s,onDragLeave:s})}var qr=P()(),Zr=[{value:.1,label:"10%"},{value:.25,label:"25%"},{value:.5,label:"50%"},{value:.75,label:"75%"},{value:1,label:"100%"},{value:1.5,label:"150%"},{value:2,label:"200%"},{value:3,label:"300%"},{value:4,label:"400%"}],Yr=[{value:300,label:"Small"},{value:500,label:"Medium"},{value:800,label:"Large"}],Jr=[{value:"max",label:"Maximum"},{value:"mean",label:"Mean"},{value:"sum",label:"Sum"}],$r=Object(Ar.a)((function(e){var t=e.map((function(e){return yn(e)}));return t.sort(qr),t})),Qr=Object(Ar.a)((function(e,t){var n=[];return e.forEach((function(e){n.push({group:"Continuous",text:e,id:e})})),t.forEach((function(e){n.push({group:"Categorical",text:e,id:e})})),n.sort((function(e,t){var n=qr(e.group,t.group);return 0!==n?n:qr(e.text,t.text)})),n})),eo=Object(Ar.a)((function(e){var t=e.map((function(e){return{group:e.category,text:e.name,id:e.id}}));return t.sort((function(e,t){var n=qr(e.group,t.group);return 0!==n?n:qr(e.text,t.text)})),t})),to=Y()({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0}},expanded:{}})(jr.a),no=Y()({root:{backgroundColor:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:43,"&$expanded":{minHeight:43}},content:{"&$expanded":{margin:0}},expanded:{}})(Or.a),ao=Y()((function(e){return{root:{padding:0}}}))(yr.a),io=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).openDatasetFilter=function(e){a.props.handleOpenDatasetFilter(e)},a.deleteDatasetFilter=function(e){a.props.handleDeleteDatasetFilter(e)},a.onMarkerOpacityChange=function(e){a.props.handleMarkerOpacityUI(e.target.value)},a.onPointSizeChange=function(e){a.props.handlePointSize(e.target.value)},a.onFeaturesChange=function(e,t){a.props.handleSearchTokens(t,"X")},a.onObservationsChange=function(e,t){var n=[];t.forEach((function(e){void 0!==e.text?n.push(e.text):n.push(e)})),a.props.handleSearchTokens(n,"obs")},a.onSaveFeatureList=function(){a.props.handleDialog(an)},a.onFeatureSetsChange=function(e,t){var n=[];t.forEach((function(e){void 0!==e.id?n.push(e.id):n.push(e)})),a.props.handleSearchTokens(n,"featureSet")},a.onFeatureClick=function(e,t){for(var n=void 0!==t.text?t.text:t,i=a.props.embeddingData.filter((function(e){return e.active})),r=0;r<i.length;r++)if(i[r].name==n){a.props.handlePrimaryTraceKey(On(i[r]));break}},a.onFeatureSetClick=function(e,t){for(var n=t.id,i=e.target,r=a.props.markers,o=!1,s=!1,l=0;l<r.length;l++)if(r[l].id===n){o=r[l].readonly,s=!0;break}s||console.log(n+" not found"),a.setState({featureSetAnchorEl:i,featureSetId:n,readonly:o||!s})},a.onFeatureSetMenuClose=function(e){a.setState({featureSetAnchorEl:null,readonly:!1})},a.onDeleteFeatureSet=function(e){e.stopPropagation();var t=a.props.searchTokens.filter((function(e){return"featureSet"===e.type&&e.value.id!==a.state.featureSetId}));a.props.handleSearchTokens(t,"featureSet"),a.props.handleDeleteFeatureSet(a.state.featureSetId),a.setState({featureSetAnchorEl:null,featureSetId:null,readonly:!1})},a.onFilterChipClicked=function(e){a.onFeatureClick(e.target.innerText)},a.onMarkerOpacityKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>=0&&t<=1&&a.props.handleMarkerOpacity(t)}},a.onUnselectedMarkerOpacityChange=function(e){a.props.handleUnselectedMarkerOpacityUI(e.target.value)},a.onUnselectedMarkerOpacityKeyPress=function(e){if("Enter"===e.key){var t=parseFloat(e.target.value);t>=0&&t<=1&&a.props.handleUnselectedMarkerOpacity(t)}},a.onNumberOfBinsChange=function(e){a.props.handleNumberOfBinsUI(e.target.value)},a.onNumberOfBinsKeyPress=function(e){if("Enter"===e.key){var t=parseInt(e.target.value);if(t>=0){a.props.handleNumberOfBins(e.target.value);for(var n=a.props.embeddings,i=0;i<n.length;i++)n[i].precomputed||(n[i]=Object.assign(n[i],{nbins:t,_nbins:t}));a.props.handleEmbeddings(n.slice(0))}}},a.onChartSizeChange=function(e){var t=e.target.value;a.props.handleChartSize(t)},a.onBinSummaryChange=function(e){var t=e.target.value;a.props.handleBinSummary(t);for(var n=a.props.embeddings,i=0;i<n.length;i++)n[i].precomputed||(n[i]=Object.assign(n[i],{agg:t}));a.props.handleEmbeddings(n.slice(0))},a.handleBinValuesChange=function(e){var t=e.target.checked;a.props.handleBinValues(t);for(var n=a.props.embeddings,i=0;i<n.length;i++)n[i].precomputed||(n[i]=Object.assign(n[i],{bin:t}));a.props.handleEmbeddings(n.slice(0))},a.handleEmbeddingsChange=function(e){var t=e.target.value,n=[];t.forEach((function(e){e.precomputed||(e=Object.assign(e,{bin:a.props.binValues,nbins:a.props.numberOfBins,_nbins:a.props.numberOfBinsUI,agg:a.props.binSummary})),n.push(e)})),a.props.handleEmbeddings(n)},a.handleSelectedCellsClick=function(e){e.preventDefault(),a.props.downloadSelectedIds()},a.onDatasetFilterChipDeleted=function(e){a.props.removeDatasetFilter(e)},a.onDatasetFilterCleared=function(){a.props.removeDatasetFilter(null)},a.onDatasetFilterSaved=function(){a.props.handleDialog(nn)},a.handleCombineDatasetFilters=function(e){a.props.handleCombineDatasetFilters(e.target.checked?"or":"and")},a.state={featureSetAnchorEl:null,readonly:!1},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.chartSize,i=t.numberOfBinsUI,o=t.binValues,s=t.binSummary,l=t.embeddings,c=t.classes,d=t.searchTokens,u=t.markerOpacity,h=t.datasetFilter,p=t.datasetFilters,f=t.interpolator,m=t.markers,g=t.unselectedMarkerOpacity,v=t.dataset,b=t.pointSize,j=t.combineDatasetFilters,y=t.selection,O=t.serverInfo,x=wn(h),S=[],w=!1;x.forEach((function(e){"object"===typeof e[0]?w=!0:S.push(e[0])})),S.sort((function(e,t){return(e=e.toLowerCase())<(t=t.toLowerCase())?-1:e===t?0:1})),w&&S.push("selection");var C=this.props.savedDatasetFilter;null==C&&(C={});var k=at(d),E=nt(m,k.featureSets),P=v.features,M=v.embeddings,I=null!=v.precomputed,D=v.obsCat,z=v.obs,A=$r(l),_=Qr(z,D),T=eo(m),F=O.fancy,N=this.state.featureSetAnchorEl;return Object(a.jsxs)("div",{className:c.root,children:[Object(a.jsx)(ee.a,{id:"delete-set-menu",anchorEl:N,open:Boolean(N),onClose:this.onFeatureSetMenuClose,children:Object(a.jsx)(te.a,{disabled:this.state.readonly,onClick:this.onDeleteFeatureSet,children:"Delete"})}),Object(a.jsxs)(xi.a,{className:c.formControl,children:[Object(a.jsx)(fi.a,{id:"embedding-label",children:"Embeddings"}),Object(a.jsx)(bi.a,{className:c.select,labelId:"embedding-label",multiple:!0,value:l,onChange:this.handleEmbeddingsChange,input:Object(a.jsx)(vi.a,{}),renderValue:function(e){return e.map((function(e){return e.name+(3===e.dimensions?" 3d":"")})).join(", ")},children:M.map((function(e){return Object(a.jsxs)(te.a,{value:e,children:[Object(a.jsx)(xr.a,{checked:-1!==A.indexOf(yn(e))}),Object(a.jsx)(Ha.a,{primary:e.name+(3===e.dimensions?" 3d":"")})]},yn(e))}))})]}),Object(a.jsx)(xi.a,{className:c.formControl,children:Object(a.jsx)(Xr,{onChipClick:this.onFeatureClick,label:"Features/Genes",options:P,value:k.X,onChange:this.onFeaturesChange,helperText:"Enter or paste list"})}),Object(a.jsx)(xi.a,{className:c.formControl,children:Object(a.jsx)(Xr,{label:"Cell Metadata",options:_,value:k.obs.concat(k.obsCat),onChipClick:this.onFeatureClick,groupBy:!0,getOptionSelected:function(e,t){return e.id===t},onChange:this.onObservationsChange})}),(F||T.length>0)&&Object(a.jsxs)(xi.a,{className:c.formControl,children:[Object(a.jsx)(Xr,{label:"Sets",options:T,value:E,onChipClick:this.onFeatureSetClick,groupBy:!0,onChange:this.onFeatureSetsChange,getOptionSelected:function(e,t){return e.id===t.id},getChipText:function(e){return e.name}}),F&&k.X.length>0&&Object(a.jsx)($.a,{title:"Save Current Feature List",children:Object(a.jsx)(Q.a,{size:"small",onClick:this.onSaveFeatureList,children:Object(a.jsx)(zr.a,{})})})]}),Object(a.jsxs)(to,{defaultExpanded:!0,children:[Object(a.jsx)(no,{"aria-controls":"filter-content",id:"filter-header",children:Object(a.jsx)("div",{children:"Filters"})}),Object(a.jsx)(ao,{children:Object(a.jsxs)("div",{style:{marginLeft:10,maxHeight:500},children:[Object(a.jsxs)(mi.a,{component:"label",alignContent:"flex-start",container:!0,alignItems:"center",spacing:0,children:[Object(a.jsx)(mi.a,{item:!0,children:Object(a.jsx)(fi.a,{shrink:!0,variant:"standard",children:"Combine Filters"})}),Object(a.jsx)(mi.a,{item:!0,children:"AND"}),Object(a.jsx)(mi.a,{item:!0,children:Object(a.jsx)(gi.a,{size:"small",checked:"or"===j,onChange:this.handleCombineDatasetFilters})}),Object(a.jsx)(mi.a,{item:!0,children:"OR"})]}),S.length>0&&!isNaN(y.count)&&Object(a.jsx)(r.a.Fragment,{children:Object(a.jsxs)("div",{style:{marginBottom:2},children:[_e(y.count)+" / "+_e(v.shape[0])+": ",S.map((function(t){return Object(a.jsx)(Sr.a,{onDelete:function(){e.onDatasetFilterChipDeleted(t)},onClick:e.onFilterChipClicked,size:"small",variant:"default",style:{marginRight:2,verticalAlign:"bottom"},label:t},t)})),Object(a.jsx)(xa.a,{}),Object(a.jsx)($.a,{title:"Clear All",children:Object(a.jsx)(Q.a,{size:"small",disabled:0===S.length,onClick:this.onDatasetFilterCleared,children:Object(a.jsx)(Ir.a,{})})}),F&&Object(a.jsx)($.a,{title:"Save Filter",children:Object(a.jsx)(Q.a,{size:"small",disabled:0===S.length,onClick:this.onDatasetFilterSaved,children:Object(a.jsx)(zr.a,{})})}),Object(a.jsx)($.a,{title:"Download Selected IDs",children:Object(a.jsx)(Q.a,{size:"small",disabled:0===S.length,onClick:this.handleSelectedCellsClick,children:Object(a.jsx)(kr.a,{})})}),Object(a.jsx)(xa.a,{})]})})]})})]}),Object(a.jsxs)(to,{defaultExpanded:!0,children:[Object(a.jsx)(no,{"aria-controls":"view-options-content",id:"view-options-header",children:Object(a.jsx)("div",{children:"View Options"})}),Object(a.jsx)(ao,{children:Object(a.jsxs)("div",{children:[Object(a.jsx)(Va.a,{type:"text",onKeyPress:this.onMarkerOpacityKeyPress,onChange:this.onMarkerOpacityChange,label:"Marker Opacity",className:c.formControl,value:u}),Object(a.jsx)(Va.a,{type:"text",onKeyPress:this.onUnselectedMarkerOpacityKeyPress,onChange:this.onUnselectedMarkerOpacityChange,label:"Filtered Marker Opacity",className:c.formControl,value:g}),Object(a.jsxs)(xi.a,{className:c.formControl,children:[Object(a.jsx)(fi.a,{htmlFor:"point_size",children:"Marker Size"}),Object(a.jsx)(bi.a,{className:c.select,input:Object(a.jsx)(vi.a,{id:"point_size"}),onChange:this.onPointSizeChange,value:b,multiple:!1,children:Zr.map((function(e){return Object(a.jsx)(te.a,{value:e.value,children:Object(a.jsx)(Ha.a,{primary:e.label})},e.label)}))})]}),Object(a.jsxs)(xi.a,{className:c.formControl,children:[Object(a.jsx)(fi.a,{htmlFor:"chart_size",children:"Gallery Chart Size"}),Object(a.jsx)(bi.a,{className:c.select,input:Object(a.jsx)(vi.a,{id:"chart_size"}),onChange:this.onChartSizeChange,value:n,multiple:!1,children:Yr.map((function(e){return Object(a.jsx)(te.a,{value:e.value,children:Object(a.jsx)(Ha.a,{primary:e.label})},e.label)}))})]}),Object(a.jsxs)(xi.a,{className:c.formControl,children:[Object(a.jsx)(fi.a,{htmlFor:"color-scheme",children:"Color Scale"}),Object(a.jsx)(Oi,{handleInterpolator:this.props.handleInterpolator,interpolator:f})]}),!I&&!1,!I&&o&&Object(a.jsx)(Va.a,{max:"1000",min:"20",step:"100",onKeyPress:this.onNumberOfBinsKeyPress,value:i,onChange:this.onNumberOfBinsChange,label:"# Bins Per Axis",className:c.formControl}),!I&&o&&Object(a.jsxs)(xi.a,{className:c.formControl,children:[Object(a.jsx)(fi.a,{htmlFor:"summary",children:"Bin Summary"}),Object(a.jsx)(bi.a,{className:c.select,input:Object(a.jsx)(vi.a,{id:"summary"}),onChange:this.onBinSummaryChange,value:s,children:Jr.map((function(e){return Object(a.jsx)(te.a,{value:e.value,children:Object(a.jsx)(Ha.a,{primary:e.label})},e.value)}))})]}),Object(a.jsx)(xa.a,{})]})})]}),F&&Object(a.jsxs)(to,{defaultExpanded:!0,children:[Object(a.jsx)(no,{"aria-controls":"filter-options-content",id:"filter-options-header",children:Object(a.jsx)("div",{children:"Saved Filters"})}),Object(a.jsx)(ao,{children:Object(a.jsxs)("div",{children:[0===p.length&&Object(a.jsx)(Ai.a,{color:"text.secondary",style:{paddingLeft:10},children:"No saved filters"}),p.length>0&&Object(a.jsxs)("div",{children:[Object(a.jsx)(Ba.a,{dense:!0,children:p.map((function(t){return Object(a.jsxs)(Ua.a,{"data-key":t.id,button:!0,selected:t.id===C.id,onClick:function(n){return e.openDatasetFilter(t.id)},children:[Object(a.jsx)(Ha.a,{primary:t.name}),Object(a.jsx)(wr.a,{onClick:function(n){return e.deleteDatasetFilter(t.id)},children:Object(a.jsx)(Q.a,{edge:"end","aria-label":"delete",children:Object(a.jsx)(Pr.a,{})})})]},t.id)}))}),Object(a.jsx)(wa.a,{onClick:this.props.handleExportDatasetFilters,children:"Export Filters"})]})]})})]})]})}}]),n}(r.a.PureComponent),ro=Y()((function(e){return{root:{display:"flex",flexWrap:"nowrap",width:"100%",flexDirection:"column"},formControl:{display:"block",minWidth:200,margin:e.spacing(1)},select:{minWidth:200}}}))(Object(s.b)((function(e){return{dataset:e.dataset,markers:e.markers,binValues:e.binValues,binSummary:e.binSummary,numberOfBins:e.numberOfBins,numberOfBinsUI:e.numberOfBinsUI,embeddingData:e.embeddingData,embeddingChartSize:e.embeddingChartSize,interpolator:e.interpolator,markerOpacity:e.markerOpacityUI,pointSize:e.pointSize,primaryTraceKey:e.primaryTraceKey,savedDatasetFilter:e.savedDatasetFilter,serverInfo:e.serverInfo,embeddings:e.embeddings,searchTokens:e.searchTokens,unselectedMarkerOpacity:e.unselectedMarkerOpacityUI,combineDatasetFilters:e.combineDatasetFilters,datasetFilter:e.datasetFilter,datasetFilters:e.datasetFilters,selection:e.selection,chartSize:e.chartSize}}),(function(e,t){return{handleDialog:function(t){e(qn(t))},handlePrimaryTraceKey:function(t){e(In(t))},handleInterpolator:function(t){e({type:Gt,payload:t})},handleChartSize:function(t){e({type:wt,payload:t})},handleCombineDatasetFilters:function(t){e(Pn(t))},downloadSelectedIds:function(){e((function(e,t){e(Yn(!0));var n=Cn(t());t().dataset.api.getSelectedIdsPromise({filter:n}).then((function(e){var t=new Blob([e.ids.join("\n")],{type:"text/plain;charset=utf-8"});Object(f.saveAs)(t,"selection.txt")})).finally((function(){e(Yn(!1))})).catch((function(t){la(e,t)}))}))},removeDatasetFilter:function(t){var n;e((n=t,function(e,t){if(null==n)e(Dn({}));else{var a=t().datasetFilter;if("selection"===n)for(var i in a)null!=a[i].basis&&delete a[i];else delete a[n];e(Dn(Object.assign({},a)))}e(_n())}))},handleEmbeddings:function(t){e(na(t))},handleNumberOfBins:function(t){var n;e((n=t,function(e,t){t().numberOfBins!==n&&e({type:Ht,payload:n})}))},handlePointSize:function(t){e({type:Xt,payload:t})},handleNumberOfBinsUI:function(t){e({type:gn,payload:t})},handleMarkerOpacity:function(t){e({type:Ft,payload:t})},handleMarkerOpacityUI:function(t){e({type:vn,payload:t})},handleUnselectedMarkerOpacity:function(t){e({type:Nt,payload:t})},handleUnselectedMarkerOpacityUI:function(t){e({type:bn,payload:t})},handleBinSummary:function(t){var n;e((n=t,function(e,t){e({type:Wt,payload:n})}))},handleBinValues:function(t){e({type:Vt,payload:t})},handleSearchTokens:function(t,n){e(function(e,t){return function(n,a){var i=a(),r=i.searchTokens,o=[t];if("obs"===t&&o.push("obsCat"),r=r.filter((function(e){return-1===o.indexOf(e.type)})),"X"===t||"featureSet"===t)r=r.concat(e.map((function(e){return{value:e,type:t}})));else if("obs"===t){var s=i.dataset.obsCat;e.forEach((function(e){var t=-1!==s.indexOf(e)?"obsCat":"obs";r.push({value:e,type:t})}))}n({type:Bt,payload:r.slice()}),n(sa())}}(null==t?[]:t,n))},handleOpenDatasetFilter:function(t){var n;e((n=t,function(e,t){e(Yn(!0)),t().serverInfo.api.getDatasetFilterPromise(n,t().dataset.id).then((function(t){t.id=n;var a=JSON.parse(t.value),i={};a.filters.forEach((function(e){var t=e[1],n=e[0],a=n.indexOf("/");-1!==a&&(n=n.substring(a+1)),i[n]="in"===t?e[2]:{operation:e[1],value:e[2]}})),e(Dn(i)),e(_n())})).finally((function(){e(Yn(!1))})).catch((function(t){la(e,t,"Unable to retrieve filter. Please try again.")}))}))},handleDeleteDatasetFilter:function(t){var n;e((n=t,function(e,t){e(Yn(!0)),t().serverInfo.api.deleteDatasetFilterPromise(n,t().dataset.id).then((function(){for(var a=t().datasetFilters,i=0;i<a.length;i++)if(a[i].id===n){a.splice(i,1);break}e(aa(a.slice())),e(Gn("Filter deleted"))})).finally((function(){e(Yn(!1)),e(qn(null))})).catch((function(t){la(e,t,"Unable to delete filter. Please try again.")}))}))},handleExportDatasetFilters:function(){e((function(e,t){e(Yn(!0)),t().serverInfo.api.exportDatasetFiltersPromise(t().dataset.id).then((function(t){if(null!=t){var n=new Blob([t],{type:"text/plain;charset=utf-8"});Object(f.saveAs)(n,"filters.csv")}else la(e,"Unable to export filters")})).finally((function(){e(Yn(!1))})).catch((function(t){la(e,t)}))}))},handleDeleteFeatureSet:function(t){var n;e((n=t,function(e,t){e(Yn(!0)),t().serverInfo.api.deleteFeatureSet(n,t().dataset.id).then((function(a){for(var i=t().markers,r=0;r<i.length;r++)if(i[r].id===n){i.splice(r,1);break}e(Zn(i.slice())),e(Gn("Set deleted"))})).finally((function(){e(Yn(!1))})).catch((function(t){la(e,t,"Unable to delete set. Please try again.")}))}))}}}))(io)),oo=Object(ga.a)({palette:{type:"light"}}),so=Object(ga.a)({palette:{type:"dark"}}),lo=240,co=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(y.a)(this,n),(a=t.call(this,e)).handleMessageClose=function(){a.props.setMessage(null)},a.onGallery=function(){window.scrollTo(0,a.galleryRef.current.offsetTop)},a.state={tab:"embedding"},a.galleryRef=r.a.createRef(),a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.chartOptions,i=e.dataset,o=e.dialog,s=e.loading,l=e.loadingApp,c=e.message,d=e.tab,u=n.darkMode?so:oo,h=u.palette.primary.main,p=n.darkMode?"black":"white";return Object(a.jsx)(ya.a,{theme:u,children:Object(a.jsxs)("div",{className:t.root,children:[(o===en||o===tn)&&Object(a.jsx)(Ri,{}),o===on&&Object(a.jsx)(pi,{}),o===nn&&Object(a.jsx)(gr,{}),o===rn&&Object(a.jsx)(hr,{}),o===Qt&&Object(a.jsx)(fr,{}),o===an&&Object(a.jsx)(br,{}),Object(a.jsx)(ci,{}),Object(a.jsx)(fa.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper},anchor:"left",children:null!=i&&Object(a.jsx)(ro,{},i.id)}),Object(a.jsxs)("main",{style:{backgroundColor:p,color:h},className:t.content,children:[l.loading&&Object(a.jsx)("div",{children:Object(a.jsxs)("h2",{children:["Loading",Object(a.jsx)(ma.a,{style:{width:"90%"},variant:"determinate",value:l.progress})]})}),null!=i&&Object(a.jsxs)(r.a.Fragment,{children:[Object(a.jsxs)("div",{role:"tabpanel",hidden:"embedding"!==d,children:[Object(a.jsx)(ar,{onGallery:this.onGallery}),Object(a.jsx)("div",{ref:this.galleryRef,children:Object(a.jsx)(dr,{})})]}),Object(a.jsx)("div",{role:"tabpanel",hidden:"dot_plot"!==d,children:Object(a.jsx)(Di,{})})]})]}),s&&Object(a.jsx)(ha.a,{"aria-labelledby":"loading-dialog-title",open:!0,children:Object(a.jsxs)(pa.a,{id:"loading-dialog-title",children:[Object(a.jsx)(ua.a,{size:20})," Loading..."]})}),null!=c&&Object(a.jsx)(da.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},ContentProps:{"aria-describedby":"message-id"},onClose:this.handleMessageClose,open:!0,autoHideDuration:6e3,action:[Object(a.jsx)(Q.a,{"aria-label":"Close",color:"inherit",onClick:this.handleMessageClose,children:Object(a.jsx)(ja.a,{})},"close")],message:Object(a.jsx)("span",{id:"message-id",children:c instanceof Error?c.message:c})})]})})}}]),n}(i.PureComponent),uo=Object(va.a)((function(e){return{root:{display:"flex"},appBar:{width:"calc(100% - ".concat(lo,"px)"),marginLeft:lo},drawer:{width:lo,flexShrink:0},drawerPaper:{width:lo},toolbar:e.mixins.toolbar,content:{flexGrow:1,paddingTop:e.spacing(6.5),paddingLeft:e.spacing(1)}}}))(Object(s.b)((function(e){return{dataset:e.dataset,dialog:e.dialog,loading:e.loading,loadingApp:e.loadingApp,message:e.message,tab:e.tab,chartOptions:e.chartOptions}}),(function(e){return{handleDialog:function(t){e(qn(t))},setMessage:function(t){e(Gn(t))}}}))(co)),ho=Object(l.d)(oi,Object(l.a)(c.a));ho.dispatch((function(e,t){e(Jn({loading:!0,progress:0}));var n=(new Date).getTime();return window.setTimeout((function a(){if(t().loadingApp.loading){var i=((new Date).getTime()-n)/1e3,r=Math.min(100,i/32*100);e(Jn({loading:!0,progress:r})),r<100&&window.setTimeout(a,300)}}),500),fetch(vt+"/server").then((function(e){return e.json()})).then((function(t){if(t.api=new V,null==t.clientId&&(t.clientId=""),null==t.fancy&&(t.fancy=!0),e({type:kt,payload:t}),""===t.clientId)e(Jn({loading:!1})),e(ta("server"===t.mode?"":null)),"server"===t.mode&&e(Nn({importer:!0})),e(ca()).then((function(){e(Un())}));else{console.log(((new Date).getTime()-n)/1e3+" startup time");var a=document.createElement("script");a.type="text/javascript",a.src="https://apis.google.com/js/api.js",a.onload=function(n){window.gapi.load("client:auth2",(function(){window.gapi.client.init({clientId:t.clientId,scope:bt.join(" ")}).then((function(){e(Jn({loading:!1,progress:0})),e(Hn(!0))}))}))},document.getElementsByTagName("head")[0].appendChild(a)}})).catch((function(t){console.log(t),e(Jn({loading:!1,progress:0})),la(e,"Unable to load app. Please try again.")}))})),Object(o.render)(Object(a.jsx)(s.a,{store:ho,children:Object(a.jsx)(uo,{})}),document.getElementById("root"))}},[[394,1,2]]]);
//# sourceMappingURL=main.85d54d37.chunk.js.map