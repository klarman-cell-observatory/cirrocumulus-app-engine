{"version":3,"sources":["CustomError.js","SlicedVector.js","VectorUtil.js","dataset_filter.js","Vector.js","JsonDataset.js","RestDataset.js","RestServerApi.js","ChartToolbar.js","formatters.js","ColorSchemeLegend.js","ChartUtil.js","LegendDrawer.js","util.js","ThreeUtil.js","ScatterChartThree.js","actions/index.js","DatasetSelector.js","reducers/index.js","AppHeader.js","DeleteDatasetDialog.js","ColorSchemeSelector.js","SizeLegend.js","DotPlotCanvas.js","DotPlotGroup.js","DotPlots.js","EditDatasetDialog.js","CategoricalLegend.js","ContinuousLegend.js","MeasureFilter.js","ColorSchemeLegendWrapper.js","CanvasOverlayHd.js","OpenseadragonSvgOverlay.js","ImageChart.js","EmbeddingChart.js","EmbeddingCharts.js","GalleryImage.js","GalleryCharts.js","HelpDialog.js","MoreOptionsDialog.js","SaveDatasetFilterDialog.js","SaveSetDialog.js","AutocompleteVirtualized.js","SideBar.js","App.js","index.js"],"names":["CustomError","Error","SlicedVector","vector","indices","this","getName","length","i","get","getIndices","v","f","result","Set","size","add","groupedStats","dimensions","varMeasures","allResults","forEach","valueToIndices","value","undefined","push","categories","Object","keys","sort","natsort","results","values","fractionExpressed","mean","name","category","index","slicedVector","xStats","stats","numExpressed","min","Number","MAX_VALUE","max","sum","combine","a","b","op","filter","x","has","getPassingFilterIndices","df","data_filter","passingIndices","user_filters","filters","combine_filters","filter_obj","field","keep","isObject","selected_points_basis","getBasis","nbins","agg","ndim","precomputed","coordinate_columns","points","selection_keep","path","j","p","xKeep","val","width","yKeep","y","height","z","zKeep","depth","applyFunction","series","d","Array","from","Vector","getVarNameType","key","indexOf","type","key_type","substring","basis","parseInt","full_name","splitDataFilter","var_keys","obs_keys","basis_list","user_filter","X","obs","splitMeasures","measures","obsMeasures","getStats","valueToCount","count","counts","map","valueCounts","JsonDataset","id","url","key2vector","schema","endsWith","baseUrl","lastIndexOf","Promise","resolve","reject","fetch","then","r","json","promises","_fetch","data","isArray","Float32Array","shape","n","all","q","dataFilter","embedding","concat","fetchData","idVector","getVector","ids","obj","basisKeys","selection","embeddings","mappedEmbeddings","coordinates","asArray","Int8Array","fill","summary","getVectors","dotplot","file","RestDataset","API","body","JSON","stringify","method","headers","getIdToken","response","RestServerApi","datasetId","dataset","isEdit","importDatasetResponse","isUpdate","setId","ds_id","ok","text","filterId","active","ChartToolbar","props","setDragMode","mode","onDragMode","onShowLabels","onShowAxis","onShowFog","onGallery","handleMoreOptions","onMoreOptions","setEditSelection","onEditSelection","handleSaveImageMenu","event","setState","saveImageEl","currentTarget","handleSaveImageMenuClose","handleSaveImage","format","onSaveImage","state","dragmode","editSelection","showLabels","showAxis","Fragment","onZoomIn","Tooltip","title","IconButton","edge","aria-label","onClick","onZoomOut","onHome","className","viewBox","transform","is3d","animating","toggleAnimation","showFog","aria-controls","aria-haspopup","Menu","anchorEl","keepMounted","open","Boolean","onClose","MenuItem","e","React","PureComponent","numberFormat","intFormat","numberFormat0","drawColorScheme","context","colorScale","label","nsteps","textColor","domain","stepSize","legendHeight","gradient","createLinearGradient","valueToFraction","scaleLinear","range","clamp","isNaN","color","addColorStop","fillStyle","fillRect","strokeStyle","strokeRect","textBaseline","textAlign","fillText","ColorSchemeLegend","ref","createRef","backingScale","current","getContext","clearRect","scale","font","setTransform","redraw","prevProps","prevState","snapshot","window","devicePixelRatio","style","assign","saveImage","traceInfo","chartSize","draw","canvas","totalSize","document","createElement","C2S","continuous","legendSize","maxWidth","measureText","Math","getCategoricalLegendSize","translate","drawCategoricalLegend","svg","getSerializedSvg","blob","Blob","saveAs","toBlob","interpolators","CATEGORY_20B","CATEGORY_20C","updateTraceColors","isImage","colors","colorMapper","rgb","formatHex","npoints","trace","RGBA_NUM_ELEMENTS","rgbScale","dst","c","g","getColors","rankIndexArray","rank","Uint32Array","indexSort","array","ascending","pairs","indexSortPairs","randomSeq","start","shuffle","isPointInside","point","vs","inside","xi","yi","xj","yj","arrayToSvgPath","lassoPathArray","simplify","svgPath","fixInterpolatorName","startsWith","getInterpolator","scaleChromatic","convertBinsToIndices","bins","selectedBins","addFeatureSetsToX","featureSets","uniqueX","featureSet","features","feature","getFeatureSets","markers","featureSetIds","featureSetId","splitSearchTokens","tokens","obsCat","token","console","log","smoothstep","edge0","edge1","t","min_v","max_v","mix","drawLabels","labelsPositions","chartOptions","camera","pos","Vector3","darkMode","lineWidth","labelStrokeWidth","widthHalf","heightHalf","k","labels","positions","project","strokeText","getVisualizer","scatterPlot","visualizers","ScatterChartThree","bind","drawContext","setChartOptions","resetCamera","resetZoom","axes","scene","getObjectByName","visible","spriteVisualizer","POINT_VISUALIZER_ID","styles","fog","enabled","setInteractionMode","rectangleSelector","setSelectionMode","onToggleAnimation","orbitIsAnimating","stopOrbitAnimation","startOrbitAnimation","containerElementRef","tooltipElementRef","lastHoverIndex","forceUpdate","resize","init","updateFromCameraDef","pointSize","markerOpacity","unselectedMarkerOpacity","categoricalNames","isCategorical","calculatePointSize","scaleFactor","PI2","PI","outputPointSize","outNorm","atan","zoom","projectionMatrix","elements","gl_PointSize","cameraSpacePos","Vector4","object","modelViewMatrix","clone","multiplyMatrices","matrixWorldInverse","matrixWorld","pointOrder","isSelectionEmpty","positionIndex","colorIndex","isSelected","w","applyMatrix4","fogDepth","fogFactor","near","far","round","beginPath","arc","closePath","getCategoryLabelsPositions","labelFontSize","containerElement","createScatterPlot","ApplePaySession","hoverCallback","innerHTML","selectedIndex","abs","categoryObject","renamedValue","lassoCallback","selectedIndices","onDeselect","getEmbeddingKey","onSelected","clear","boxCallback","rect","interactionMode","selectedPoints","querySelector","outline","addEventListener","preventDefault","updateScatterChart","classes","root","onCopyImage","Typography","display","paddingLeft","verticalAlign","withStyles","theme","margin","spacing","padding","position","top","left","whiteSpace","overflow","LABELS_VISUALIZER_ID","domainDifference","rangeDifference","getScaleFactor","ORTHO_CAMERA_FRUSTUM_HALF_EXTENT","aspectRatio","right","bottom","OrthographicCamera","up","updateProjectionMatrix","premultipliedAlpha","interactive","makeStyles","label3D","fontSize","ScatterPlot","selectEnabled","ScatterPlotVisualizerSprites","ScatterPlotVisualizerSvgLabels","setActiveVisualizers","categoryToPosition","ncategories","labelStrings","labelPositions","renamedCategory","mid","background","Color","setDimensions","setPointColors","setPointPositions","setPointScaleFactors","labelsVisualizer","labelsActive","shadowColor","shadowStroke","setLabels","render","authScopes","SET_DOT_PLOT_INTERPOLATOR","SET_CHART_OPTIONS","SET_COMBINE_DATASET_FILTERS","SET_DATASET_FILTERS","SET_PRIMARY_TRACE_KEY","SET_CHART_SIZE","SET_PRIMARY_CHART_SIZE","SET_SERVER_INFO","SET_DATASET_FILTER","ADD_DATASET","DELETE_DATASET","UPDATE_DATASET","SET_GLOBAL_FEATURE_SUMMARY","SET_SAVED_DATASET_STATE","SET_DOMAIN","SET_CATEGORICAL_COLOR","SET_CATEGORICAL_NAME","SET_MARKER_OPACITY","SET_UNSELECTED_MARKER_OPACITY","SET_SELECTION","SET_FEATURE_SUMMARY","SET_SEARCH_TOKENS","SET_SELECTED_EMBEDDING","SET_NUMBER_OF_BINS","SET_BIN_VALUES","SET_BIN_SUMMARY","SET_MESSAGE","SET_INTERPOLATOR","SET_POINT_SIZE","SET_EMAIL","SET_USER","SET_DATASET","SET_MARKERS","SET_DIALOG","MORE_OPTIONS_DIALOG","EDIT_DATASET_DIALOG","IMPORT_DATASET_DIALOG","SAVE_DATASET_FILTER_DIALOG","SAVE_FEATURE_SET_DIALOG","HELP_DIALOG","DELETE_DATASET_DIALOG","SET_DATASET_CHOICES","RESTORE_VIEW","SET_DOT_PLOT_DATA","SET_SELECTED_DOT_PLOT_DATA","SET_DOT_PLOT_SORT_ORDER","SET_EMBEDDING_DATA","SET_LOADING","SET_TAB","SET_LOADING_APP","isEmbeddingBinned","bin","fullName","getTraceKey","getEmbeddingJson","logout","dispatch","getState","gapi","auth2","getAuthInstance","signOut","payload","_setDataset","getDatasetFilterArray","datasetFilter","allPoints","operation","getFilterJson","combineDatasetFilters","setDotPlotSortOrder","setCombineDatasetFilters","_setCombineDatasetFilters","handleFilterUpdated","setPrimaryChartSize","setPrimaryTraceKey","setDatasetFilter","setSelection","setFeatureSummary","_setLoading","searchTokens","item","isCurrentSelectionEmpty","chart","dotPlotData","_setDotPlotData","slice","_setSelectedDotPlotData","selectedEmbeddings","api","getDataPromise","handleSelectionResult","catch","err","handleError","finally","handleBrushFilterUpdated","cachedData","convertIndicesToBins","update","_handleCategoricalNameChange","setUser","loadDefaultDatasetEmbedding","embeddingNames","priority","setSelectedEmbedding","loadDefaultDataset","datasetChoices","setDataset","restoreSavedView","savedView","colorScheme","interpolator","uiValue","names","_updateCharts","setMessage","_loadSavedView","location","search","parse","decodeURIComponent","initLogin","loadSavedView","isSignedIn","email","currentUser","getBasicProfile","getEmail","_setEmail","serverInfo","getUserPromise","user","listDatasets","getAuthResponse","id_token","saveDataset","readers","description","updatePermissions","permissionsResponse","upsertDatasetPromise","importDatasetResult","dsUpdate","owner","updateDataset","_addDataset","setDialog","deleteDataset","deleteDatasetPromise","_deleteDataset","setEmbeddingData","setMarkers","_setLoadingApp","prior","setDatasetFilters","loadDefaultView","setLoading","savedDatasetState","selectedChoice","categoryNameResults","newDataset","datasetFilters","isByteRangeDataset","categoriesRenamePromise","getCategoryNamesPromise","filtersPromise","getFiltersPromise","schemaPromise","getSchemaPromise","_nbins","var","toLowerCase","oldValue","original","new","onPromisesComplete","selectionResult","chartSelection","selectedIndicesOrBins","indices_or_bins","userPoints","selectionSummary","featureSummary","selectedDotPlotData","updateDotPlotData","newDotplotData","categoryKeys","join","dotPlotKeys","categoryItem","uniqBy","categoryIndex","nfeatures","featureSortOrder","onError","selectionStats","embeddingData","globalFeatureSummary","embeddingCoordinatesToFetch","valuesToFetch","binnedEmbeddingValuesToFetch","embeddingKeys","selectedEmbedding","embeddingKey","date","Date","dotplotMeasuresCacheMiss","dotPlotCategories","dotPlotCategoryKeys","selectedMeasuresCacheMiss","cachedDotPlotKeys","dotPlotDataItem","datum","cachedSelectedDotPlotMeasures","embeddingCoordinatesToFetchKeys","embeddingJson","coords","binnedEmbeddingValuesToFetchKeys","globalFeatureSummaryXCacheMiss","globalFeatureSummaryObsContinuousCacheMiss","globalFeatureSummaryDimensionsCacheMiss","filterJson","newSummary","existingKeys","embeddingDatum","isBinned","featureKey","isSpatial","spatial","traceSummary","purity","traceUniqueValues","schemeCategory10","schemePaired","scaleOrdinal","isPlainObject","newValues","customMin","customMax","scaleSequential","chartData","ranks","xExtent","Infinity","yExtent","zExtent","getRange","extent","xRange","yRange","zRange","maxRange","makeScaleRange","base","xScale","SCATTER_PLOT_CUBE_LENGTH","yScale","zScale","getPositions","getFileUrl","image","tileSource","OpenSeadragon","ImageTileSource","buildPyramid","crossOriginPolicy","updateEmbedingData","activeEmbedding","activeTrace","splice","message","status","getDatasetsPromise","choices","DatasetSelector","handleClick","searchText","handleClose","handleListItemClick","onChange","handleClearSearchText","onSearchChange","target","selectedId","filteredChoices","searchTextLower","trim","choice","Button","variant","startIcon","Popover","anchorOrigin","vertical","horizontal","transformOrigin","TextField","placeholder","fullWidth","InputProps","endAdornment","InputAdornment","List","dense","disablePadding","component","ListItem","alignItems","selected","button","ListItemText","primary","textOverflow","connect","DEFAULT_BIN_SUMMARY","DEFAULT_NUMBER_BINS","DEFAULT_UNSELECTED_MARKER_OPACITY","DEFAULT_INTERPOLATOR","DEFAULT_DOT_PLOT_INTERPOLATOR","DEFAULT_INTERPOLATOR_OBJ","DEFAULT_DOT_PLOT_INTERPOLATOR_OBJ","DEFAULT_PRIMARY_CHART_SIZE","innerWidth","innerHeight","DEFAULT_CHART_OPTIONS","updateDotPlotDataRange","fractionRange","meanRange","combineReducers","binSummary","action","binValues","dialog","sortBy","dotPlotInterpolator","stateIndex","loading","loadingApp","progress","newResults","categoryName","readonly","markers_read_only","numberOfBins","primaryChartSize","primaryTraceKey","traces","tab","AntTab","minWidth","textTransform","fontWeight","typography","fontWeightRegular","marginRight","opacity","fontWeightMedium","Tab","disableRipple","AppHeader","handleTabChange","handleTab","handleEmbeddingsChange","numberOfBinsUI","handleEmbeddings","handleUserMenuClose","userMenuOpen","handleMoreMenuClose","moreMenuOpen","handleHelp","handleDialog","handleUserMenuOpen","userMenuAnchorEl","handleMoreMenuOpen","moreMenuAnchorEl","getLinkJson","_bin","chartRef","getCameraDef","jsonChartOptions","defaultChartOptions","datasetFilterJson","sortOrder","handleDataset","link","handleSavedDatasetState","copyLink","linkText","protocol","host","pathname","encodeURIComponent","container","activeElement","fakeElem","isRTL","documentElement","getAttribute","border","setAttribute","yPosition","pageYOffset","scrollTop","appendChild","select","setSelectionRange","execCommand","fakeHandlerCallback","blur","getSelection","removeAllRanges","removeChild","removeEventListener","onDarkMode","handleChartOptions","handleLogout","handleImportDataset","handleSettings","handleDelete","handleShowDatasetDetails","datasetDetailsEl","handleCloseDatasetDetails","datasetDetailsOpen","hasDatasetDetails","hasSelection","showNewDataset","importer","showEditDeleteDataset","showMoreMenu","isSignedOut","clientId","AppBar","appBar","Toolbar","linkTarget","children","aria-owns","Tabs","indicatorColor","marginLeft","Divider","handleLogin","flexWrap","drawerWidth","ownProps","signIn","DeleteDatasetDialog","handleCancel","Dialog","aria-labelledby","DialogTitle","DialogContent","DialogActions","disabled","stripInterpolate","ColorSchemeSelector","handleInterpolatorChange","handleInterpolator","Select","input","Input","multiple","divider","getScale","formControl","drawSizeLegend","steps","valueToX","valueToRadius","pix","radius","stroke","SizeLegend","svgFont","canvasFont","DotPlotCanvas","onSortOrderChanged","getSize","colorScaleHeight","sizeScale","divRef","node","maxRadius","getBoundingClientRect","xy","clientX","clientLeft","clientY","clientTop","col","floor","row","featureDatum","categoryOrder","append","renamedCategories","drawCircles","diameter","featureIndex","xpix","ypix","frac","newName","save","rotate","restore","maxFeatureWidth","xoffset","renamed","sortByDatum","val1","val2","sorter","renamed1","renamed2","sortChoices","subtitle","FormControl","InputLabel","shrink","DotPlotGroup","onMinChange","updateMin","minCustom","parseFloat","onMaxChange","updateMax","maxCustom","onMinSizeChange","minSize","updateMinSize","minSizeCustom","onMaxSizeChange","sizeMax","updateMaxSize","maxSizeCustom","onHeatmapChange","checked","debounce","selectedData","legend","float","InputLabelProps","paddingTop","marginTop","maxSize","Grid","alignContent","Switch","DotPlots","selectedDotPlotNameToData","TabPanel","other","role","hidden","Box","EditDatasetDialog","handleSave","split","s","getUniqueArray","onTabChanged","tabValue","onEmailChanged","onUrlChanged","onNameChanged","onDescriptionChanged","onTitleChanged","myIndex","CircularProgress","autoComplete","required","helperText","inputProps","maxLength","FormHelperText","Link","href","rows","rowsMax","multiline","CategoricalLegend","handlePopoverClose","contextmenuEl","handleColorChange","handleNameChange","handleColorChangeApply","categoryValue","handleNameChangeApply","handleEditColor","menu","handleEditName","handleContextmenuClose","clickEnabled","shiftKey","metaKey","handleContextmenu","stopPropagation","maxHeight","nObs","nObsSelected","categoricalFilterValues","selectedDimensionToCount","globalDimensionSummary","renamedCategoryValue","categoryCount","selectedCategoryCount","fractionSelected","globalTitle","categoryText","selectionTitle","cursor","onContextMenu","userSelect","ContinuousLegend","summaryNames","globalSummary","summaryName","getTable","MeasureFilter","handleOperationChanged","handleUpdate","handleValueUpdate","getFilter","handleValueChange","NaN","labelId","ColorSchemeLegendWrapper","onMinUpdate","handleDomain","onMaxUpdate","CanvasOverlayHd","viewer","options","_viewer","_containerWidth","_containerHeight","_canvas","onRedraw","clearBeforeRedraw","addHandler","_updateCanvas","backingScaleUpdated","clientWidth","clientHeight","viewportZoom","viewport","getZoom","world","getItemCount","getItemAt","viewportToImageZoom","vp","imageToViewportCoordinates","pixelFromPoint","webPoint","viewportPos","pointFromPixel","tiledImage","viewportPosRect","Rect","tileSourcePos","_viewportToTiledImageRectangle","getTopLeft","source","svgNS","OpenseadragonSvgOverlay","self","_svg","createElementNS","_node","evt","Point","rotation","getRotation","getSpotRadius","spot_diameter","ceil","drawSpots","spotRadius","setLineDash","globalAlpha","ImageChart","img","levels","context2D","zoomBy","zoomPerClick","applyConstraints","goHome","uniqueId","x2","y2","px","py","findPointIndex","drawImage","_drawOverlay","opts","destroy","ready","addOnceHandler","src","gestureSettingsMouse","dblClickToZoom","clickToZoom","autoResize","showFullPageControl","collectionMode","showNavigationControl","tileSources","_this","canvasOverlay","startCoordinates","lastBoundingBox","innerTracker","moveHandler","viewportPoint","imagePoint","viewportToImageCoordinates","setTooltip","preventDefaultAction","lassoPath","rectElement","findPointsInPolygon","findPointsInRectangle","removeAttribute","svgOverlay","elem","createViewer","zIndex","EmbeddingChart","setChartRef","element","handleExpandClick","showDetails","onChartOptions","onDomain","onDimensionFilterUpdated","onColorChange","onNameChange","onMeasureFilterUpdated","onSelect","displayName","showColorScheme","onInitialized","embeddingChartSize","onPrimaryChartSize","selectedValues","lastIndex","currentIndex","dataset_id","fancy","setCategoryNamePromise","o","emptySet","EmbeddingCharts","resizeListener","handlePrimaryChartSize","primaryTraces","primaryTrace","GalleryImage","overlayUrl","canvasRef","toDataURL","zoomFactor","labelCanvas","borderColor","alt","createContainer","GalleryCharts","onChartSelected","handlePrimaryTraceKey","scrollTo","onSortEnd","galleryTraces","oldIndex","sortIndex","newIndex","handleEmbeddingData","SortableItem","sortableElement","SortableList","sortableContainer","items","distance","axis","HelpDialog","rel","MoreOptionsDialog","onLabelFontSizeUpdate","onLabelFontSize","onLabelStrokeWidth","onLabelStrokeWidthUpdate","SaveDatasetFilterDialog","onNotesChanged","notes","savedFilter","create","savedDatasetFilter","filterValue","requestBody","sendRequest","isEqual","upsertDatasetFilterPromise","SaveSetDialog","onCategoryChanged","upsertFeatureSet","renderRow","cloneElement","OuterElementContext","createContext","OuterElementType","forwardRef","outerProps","useContext","ListboxComponent","itemData","Children","toArray","useTheme","smUp","useMediaQuery","breakpoints","noSsr","itemCount","itemSize","getChildSize","child","Provider","reduce","outerElementType","innerElementType","overscanCount","useStyles","paper","listbox","renderGroup","params","ListSubheader","disableGutters","noWrap","group","AutocompleteVirtualized","enterTokens","replace","showDragIndicator","show","onDragEnd","filterOptions","createFilterOptions","matchFrom","getOptionSelected","groupBy","option","getChipText","Autocomplete","disableListWrap","openOnFocus","filterSelectedOptions","getOptionLabel","blurOnSelect","ChipProps","autoHighlight","renderTags","onChipClick","getTagProps","Chip","renderInput","renderOption","onPaste","clipboardData","getData","onDrop","files","dataTransfer","reader","FileReader","onload","onerror","alert","readAsText","onDragOver","onDragLeave","pointSizeOptions","gallerySizeOptions","summaryOptions","getEmbeddingKeys","memoize","getAnnotationOptions","item1","item2","getFeatureSetOptions","Accordion","boxShadow","borderBottom","expanded","MuiAccordionPanel","AccordionPanelSummary","backgroundColor","marginBottom","minHeight","content","MuiAccordionPanelSummary","AccordionPanelDetails","MuiAccordionPanelDetails","SideBar","onMarkerOpacityChange","updateMarkerOpacity","handleMarkerOpacity","onUnselectedMarkerOpacityChange","unselectedOpacity","updateUnselectedMarkerOpacity","handleUnselectedMarkerOpacity","openDatasetFilter","handleOpenDatasetFilter","deleteDatasetFilter","handleDeleteDatasetFilter","onPointSizeChange","handlePointSize","onFeaturesChange","handleSearchTokens","onObservationsChange","onSaveFeatureList","onFeatureSetsChange","onFeatureSetClick","isReadOnly","found","featureSetAnchorEl","onFeatureSetMenuClose","onDeleteFeatureSet","handleDeleteFeatureSet","onFilterChipClicked","onFeatureClick","innerText","onChartSizeChange","handleChartSize","onBinSummaryChange","handleBinSummary","handleBinValuesChange","handleBinValues","handleSelectedCellsClick","downloadSelectedIds","onDatasetFilterChipDeleted","removeDatasetFilter","onDatasetFilterCleared","onDatasetFilterSaved","handleCombineDatasetFilters","currentDatasetFilters","datasetFilterKeys","isBrushing","splitTokens","featureOptions","availableEmbeddings","isSummarized","annotationOptions","featureSetOptions","renderValue","Checkbox","defaultExpanded","onDelete","Slider","step","valueLabelDisplay","htmlFor","data-key","ListItemSecondaryAction","handleExportDatasetFilters","flexDirection","getSelectedIdsPromise","filterKey","handleNumberOfBins","removeType","setSearchTokens","getDatasetFilterPromise","filterOperation","slashIndex","deleteDatasetFilterPromise","exportDatasetFiltersPromise","deleteFeatureSet","lightTheme","createMuiTheme","darkTheme","App","handleMessageClose","galleryRef","offsetTop","palette","main","bgcolor","ThemeProvider","Drawer","drawer","drawerPaper","anchor","LinearProgress","Snackbar","ContentProps","autoHideDuration","flexShrink","toolbar","mixins","flexGrow","store","createStore","rootReducer","applyMiddleware","thunkMiddleware","startTime","getTime","setTimeout","loadingAppProgress","elapsed","script","load","client","scope","getElementsByTagName","getElementById"],"mappings":"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","file":"static/js/main.b5949559.chunk.js","sourcesContent":["class CustomError extends Error {\n\n}\n\nexport default CustomError;\n","export class SlicedVector {\n    constructor(vector, indices) {\n        this.vector = vector;\n        this.indices = indices;\n    }\n\n    getName() {\n        return this.vector.getName();\n    }\n\n    size() {\n        return this.indices.length;\n    }\n\n    get(i) {\n        return this.vector.get(this.indices[i]);\n    }\n}\n","import natsort from 'natsort';\nimport {SlicedVector} from './SlicedVector';\n\n\nexport function valueCounts(v) {\n    let valueToCount = {};\n    for (let i = 0, size = v.size(); i < size; i++) {\n        let value = v.get(i);\n        let count = valueToCount[value] || 0;\n        valueToCount[value] = count + 1;\n    }\n    let keys = Object.keys(valueToCount);\n    keys.sort(natsort());\n    let counts = keys.map(key => valueToCount[key]);\n    return {categories: keys, counts: counts};\n}\n\nexport function getIndices(v, f) {\n    let result = new Set();\n    for (let i = 0, size = v.size(); i < size; i++) {\n        if (f(v.get(i))) {\n            result.add(i);\n        }\n    }\n    return result;\n}\n\nexport function groupedStats(dimensions, varMeasures) {\n    let allResults = [];\n    dimensions.forEach(v => {\n\n        let valueToIndices = {};\n        for (let i = 0, size = v.size(); i < size; i++) {\n            let value = v.get(i);\n            let indices = valueToIndices[value];\n            if (indices === undefined) {\n                indices = [];\n                valueToIndices[value] = indices;\n            }\n            indices.push(i);\n        }\n        let categories = Object.keys(valueToIndices);\n        categories.sort(natsort());\n        const results = {'categories': categories, 'name': v.getName(), 'values': []};\n        varMeasures.forEach(v => {\n            results.values.push({fractionExpressed: [], mean: [], name: v.getName()});\n        });\n        categories.forEach(category => {\n            let indices = valueToIndices[category];\n            varMeasures.forEach((v, index) => {\n                let slicedVector = new SlicedVector(v, indices);\n                let xStats = stats(slicedVector);\n                results.values[index].mean.push(xStats.mean);\n                results.values[index].fractionExpressed.push(xStats.numExpressed / slicedVector.size());\n            });\n        });\n\n        allResults.push(results);\n    });\n    return allResults;\n}\n\nexport function stats(v) {\n    let min = Number.MAX_VALUE;\n    let max = -Number.MAX_VALUE;\n    let sum = 0;\n    let numExpressed = 0;\n\n    for (let i = 0, size = v.size(); i < size; i++) {\n        const value = v.get(i);\n        min = value < min ? value : min;\n        max = value > max ? value : max;\n        sum += value;\n        if (value !== 0) {\n            numExpressed++;\n        }\n    }\n    return {\n        'min': min, 'max': max, 'sum': sum, 'mean': sum / v.size(), 'numExpressed': numExpressed,\n    };\n}\n\n\n\n","import {isObject} from 'lodash';\nimport {getBasis} from './JsonDataset';\nimport {getIndices} from './VectorUtil';\n\nfunction combine(a, b, op) {\n    return op === 'or' ? new Set([...a, ...b]) : new Set(\n        [...a].filter(x => b.has(x)));\n}\n\n\nexport function getPassingFilterIndices(df, data_filter) {\n    let passingIndices = null;\n    if (data_filter) {\n        let user_filters = data_filter.filters || [];\n        let combine_filters = data_filter.combine || 'and';\n        for (let i = 0; i < user_filters.length; i++) {\n            let filter_obj = user_filters[i];\n            let field = filter_obj[0];\n            let op = filter_obj[1];\n            let value = filter_obj[2];\n            let keep = null;\n            if (isObject(field)) { // selection box\n\n                let selected_points_basis = getBasis(field['basis'], field.nbins,\n                    field.agg, field.ndim || 2, field.precomputed);\n                let coordinate_columns = selected_points_basis.coordinate_columns;\n                if (value.points) {\n                    // let p = new Set(value.points);\n                    let field = selected_points_basis['nbins'] ? selected_points_basis['full_name'] : 'index';\n                    if (field == 'index') {\n                        keep = value.points;\n                    } else {\n                        throw 'Not implemented';\n                    }\n                    // keep = getIndices(df[field], (val) => p.has(val));\n                } else {\n                    let selection_keep;\n                    let path = value.path;\n                    for (let j = 0; j < path.length; j++) {\n                        let p = path[j];\n                        let xKeep = getIndices(df[coordinate_columns[0]], (val) => val >= p.x && val <= p.x + p.width);\n                        let yKeep = getIndices(df[coordinate_columns[1]], (val) => val >= p.y && val <= p.y + p.height);\n                        selection_keep = combine(xKeep, yKeep, 'and');\n                        if (p.z) {  // 3d\n                            let zKeep = getIndices(df[coordinate_columns[2]], (val) => val >= p.z && val <= p.z + p.depth);\n                            selection_keep = combine(selection_keep, zKeep, 'and');\n                        }\n                    }\n                    keep = keep ? combine(selection_keep, keep, combine_filters) : selection_keep;\n                }\n            } else {\n                let series = df[field];\n                let applyFunction;\n                if (op === 'in') {\n                    value = new Set(value);\n                    applyFunction = (d) => value.has(d);\n                } else if (op === '>') {\n                    applyFunction = (d) => d > value;\n                } else if (op === '=') {\n                    applyFunction = (d) => d === value;\n                } else if (op === '<') {\n                    applyFunction = (d) => d < value;\n                } else if (op === '!=') {\n                    applyFunction = (d) => d !== value;\n                } else if (op === '>=') {\n                    applyFunction = (d) => d >= value;\n                } else if (op === '<=') {\n                    applyFunction = (d) => d <= value;\n                } else {\n                    throw('Unknown filter');\n                }\n                keep = getIndices(series, applyFunction);\n            }\n\n\n            if (passingIndices) {\n                passingIndices = combine(passingIndices, keep, combine_filters);\n            } else {\n                passingIndices = keep;\n            }\n        }\n    }\n\n    return passingIndices != null ? Array.from(passingIndices) : null;\n}\n","export class Vector {\n    constructor(name, values) {\n        this.name = name;\n        this.values = values;\n    }\n\n    getName() {\n        return this.name;\n    }\n\n    size() {\n        return this.values.length;\n    }\n\n    get(i) {\n        return this.values[i];\n    }\n\n    asArray() {\n        return this.values;\n    }\n\n\n}\n","import {isArray, isObject} from 'lodash';\nimport {getPassingFilterIndices} from './dataset_filter';\nimport {SlicedVector} from './SlicedVector';\nimport {Vector} from './Vector';\nimport {groupedStats, stats, valueCounts} from './VectorUtil';\n\n\nfunction getVarNameType(key) {\n    let index = key.indexOf('/');\n    if (index === -1) {\n        return {name: key, type: 'X'};\n    } else {\n        let key_type = key.substring(0, index);\n        let name = key.substring(index + 1);\n        return {name: name, type: key_type};\n    }\n}\n\nexport function getBasis(basis, nbins = null, agg = null, dimensions = 2, precomputed = false) {\n    dimensions = parseInt(dimensions);\n    let coordinate_columns = [];\n    for (let i = 0; i < dimensions; i++) {\n        coordinate_columns.push(basis + '_' + i + 1);\n    }\n    let full_name = basis + '_' + dimensions;\n    if (nbins != null) {\n        full_name = full_name + '_' + nbins + '_' + agg;\n    }\n    return {\n        'name': basis, 'dimensions': dimensions, 'coordinate_columns': coordinate_columns, 'nbins': nbins,\n        'agg': agg, 'full_name': full_name, 'precomputed': precomputed\n    };\n}\n\nfunction splitDataFilter(data_filter) {\n    let var_keys = new Set();\n    let obs_keys = new Set();\n    let basis_list = [];\n    if (data_filter) {\n        let user_filters = data_filter.filters || [];\n        for (let i = 0; i < user_filters.length; i++) {\n            let user_filter = user_filters[i];\n            let key = user_filter[0];\n            if (isObject(key)) {\n                let basis = getBasis(key.basis, key.nbins, key.agg,\n                    key.ndim || 2, key.precomputed);\n                basis_list.push(basis);\n            } else {\n\n                const {name, type} = getVarNameType(key);\n\n                user_filter[0] = name;\n                if (type === 'X') {\n                    var_keys.add(name);\n                } else {\n                    obs_keys.add(name);\n                }\n            }\n        }\n    }\n    return {basis: basis_list, X: Array.from(var_keys), obs: Array.from(obs_keys)};\n//    return list(var_keys), list(obs_keys), basis_list\n}\n\nfunction splitMeasures(measures) {\n    let obsMeasures = [];\n    let varMeasures = [];\n    for (let i = 0; i < measures.length; i++) {\n        const {name, type} = getVarNameType(measures[i]);\n        if (type === 'X') {\n            varMeasures.push(name);\n        } else if (type === 'obs') {\n            obsMeasures.push(name);\n        } else {\n            throw('Unknown key type ' + type);\n        }\n    }\n    return {obsMeasures: obsMeasures, varMeasures: varMeasures};\n}\n\n\nfunction getStats(dimensions, obsMeasures, varMeasures) {\n    const results = {};\n    dimensions.forEach(v => {\n        results[v.getName()] = valueCounts(v);\n    });\n    obsMeasures.forEach(v => {\n        results[v.getName()] = stats(v);\n    });\n    varMeasures.forEach(v => {\n        results[v.getName()] = stats(v);\n    });\n    return results;\n}\n\nexport class JsonDataset {\n\n    init(id, url) {\n        this.id = id;\n        this.key2vector = {}; // maps key to vector\n\n        this.schema = null;\n        if (!url.endsWith('.json')) {\n            url = url + 'schema.json';\n        }\n        this.url = url;\n        this.baseUrl = this.url.substring(0, this.url.lastIndexOf('/') + 1);\n        // return new Promise((resolve, reject) => {\n        //     fetch(url + '.idx.json').then(r => r.json()).then(result => {\n        //         this.key2bytes = result.index;\n        //     }).then(() => {\n        //         fetch(url, this.getByteRange('schema')).then(response => {\n        //             return response.json();\n        //         }).then(result => {\n        //             this.schema = result[\"schema\"];\n        //             resolve();\n        //         });\n        //     });\n        // });\n        return new Promise((resolve, reject) => {\n            fetch(url).then(r => r.json()).then(result => {\n                this.schema = result;\n                resolve();\n            });\n        });\n    }\n\n    // getByteRange(key) {\n    //     let range = this.key2bytes[key];\n    //     if (!range) {\n    //         throw key + ' not found';\n    //     }\n    //     return {headers: {'Range': 'bytes=' + range[0] + '-' + range[1]}};\n    // }\n\n    _fetch(key) {\n        return fetch(this.baseUrl + key + '.json').then(r => r.json());\n    }\n\n    fetchData(keys) {\n        let promises = [];\n        keys.forEach(key => {\n            if (this.key2vector[key] == null && key !== '__count') {\n                let p = this._fetch(key).then(data => {\n                    if (isArray(data)) {\n                        this.key2vector[key] = new Vector(key, data);\n                    } else {\n                        // sparse\n                        if (data.index) {\n                            let values = new Float32Array(this.schema.shape[0]);\n                            for (let i = 0, n = data.index.length; i < n; i++) {\n                                values[data.index[i]] = data.value[i];\n                            }\n                            this.key2vector[key] = new Vector(key, values);\n                        } else {\n                            this.key2vector[key] = new Vector(key, data);\n                        }\n                    }\n\n                });\n                promises.push(p);\n            }\n        });\n        return new Promise(resolve => {\n            Promise.all(promises).then(() => resolve());\n        });\n\n    }\n\n    getSelectedIdsPromise(q) {\n        const dataFilter = q.filter;\n        const {basis, X, obs} = splitDataFilter(dataFilter);\n        let keys = [];\n        basis.forEach(embedding => {\n            keys.push(embedding.name);\n        });\n        keys.push('index');\n\n        keys = keys.concat(X).concat(obs);\n        return new Promise(resolve => {\n            this.fetchData(keys).then(() => {\n                let indices = getPassingFilterIndices(this.key2vector, dataFilter);\n                let idVector = this.getVector('index', indices);\n                let ids = [];\n                for (let i = 0, n = idVector.size(); i < n; i++) {\n                    ids.push(idVector.get(i));\n                }\n                resolve({ids: ids});\n            });\n\n        });\n    }\n\n    getDataPromise(q) {\n        let dimensions = [];\n        let measures = [];\n        let queryKeys = ['stats', 'groupedStats', 'embedding', 'selection'];\n        const results = {};\n        queryKeys.forEach(key => {\n            if (key in q) {\n                let obj = q[key];\n                if (!isArray(obj)) {\n                    obj = [obj];\n                }\n                obj.forEach(value => {\n                    if (value.dimensions) {\n                        dimensions = dimensions.concat(value.dimensions);\n                    }\n                    if (value.measures) {\n                        measures = measures.concat(value.measures);\n                    }\n                });\n\n            }\n        });\n\n        const {obsMeasures, varMeasures} = splitMeasures(measures);\n        let basisKeys = new Set();\n\n        if (q.selection) { // get any embeddings\n            const dataFilter = q.selection.filter;\n            const {basis, X, obs} = splitDataFilter(dataFilter);\n\n            dimensions = dimensions.concat(obs);\n            measures = measures.concat(X);\n            const embeddings = q.selection.embeddings || [];\n            let mappedEmbeddings = [];\n            embeddings.forEach(embedding => {\n                let basis = getBasis(embedding.basis, embedding.nbins, embedding.agg,\n                    embedding.ndim || 2, embedding.precomputed);\n                basisKeys.add(basis.name);\n                mappedEmbeddings.push(basis);\n            });\n            q.selection.embeddings = mappedEmbeddings;\n            basis.forEach(embedding => {\n                basisKeys.add(embedding.name);\n            });\n\n        }\n        if (q.embedding) {\n            q.embedding.forEach(embedding => {\n                let basis = getBasis(embedding.basis, embedding.nbins, embedding.agg,\n                    embedding.ndim || 2, embedding.precomputed);\n                basisKeys.add(basis.name);\n                embedding.basis = basis;\n            });\n\n        }\n\n\n        return new Promise(resolve => {\n\n            this.fetchData(dimensions.concat(obsMeasures).concat(varMeasures).concat(Array.from(basisKeys))).then(() => {\n\n                if (q.embedding) {\n                    results.embedding = [];\n                    q.embedding.forEach(embedding => {\n                        let dimensions = embedding.dimensions || [];\n                        let measures = embedding.measures || [];\n                        const {obsMeasures, varMeasures} = splitMeasures(measures);\n                        let values = {};\n                        let coordinates = this.getVector(embedding.basis.name).asArray();\n                        dimensions.concat(obsMeasures).concat(varMeasures).forEach(key => {\n                            if (key === '__count') {\n                                values[key] = new Int8Array(coordinates[Object.keys(coordinates)[0]].length);\n                                values[key].fill(1);\n                            } else {\n                                values[key] = this.getVector(key).asArray();\n                            }\n                        });\n                        results.embedding.push({coordinates: coordinates, values: values});\n                    });\n                }\n                if (q.stats) {\n                    let dimensions = q.stats.dimensions || [];\n                    let measures = q.stats.measures || [];\n                    const {obsMeasures, varMeasures} = splitMeasures(measures);\n                    results.summary = getStats(this.getVectors(dimensions), this.getVectors(obsMeasures), this.getVectors(varMeasures));\n                }\n\n                if (q.groupedStats) {\n                    let dimensions = q.groupedStats.dimensions || [];\n                    let measures = q.groupedStats.measures || [];\n                    if (dimensions.length > 0 && measures.length > 0) {\n                        results.dotplot = groupedStats(this.getVectors(dimensions), this.getVectors(measures));\n                    }\n\n                }\n\n                if (q.selection) {\n                    let dimensions = q.selection.dimensions || [];\n                    let measures = q.selection.measures || [];\n                    const embeddings = q.selection.embeddings || [];\n                    const {obsMeasures, varMeasures} = splitMeasures(measures);\n                    results.selection = {};\n\n                    let indices = getPassingFilterIndices(this.key2vector, q.selection.filter);\n\n                    if (embeddings.length > 0) {\n                        results.selection.coordinates = {};\n                        embeddings.forEach(embedding => {\n                            results.selection.coordinates[embedding.full_name] = {'indices_or_bins': indices};\n                        });\n                    }\n\n                    if (dimensions.length > 0 && varMeasures.length > 0) {\n                        results.selection.dotplot = groupedStats(this.getVectors(dimensions, indices), this.getVectors(measures, indices));\n                    }\n\n                    results.selection.count = indices.length;\n                    results.selection.summary = getStats(this.getVectors(dimensions, indices), this.getVectors(obsMeasures, indices), this.getVectors(varMeasures, indices));\n                }\n                resolve(results);\n            });\n        });\n    }\n\n    getSchemaPromise() {\n        return Promise.resolve(this.schema);\n    }\n\n    getVector(key, indices = null) {\n        let v = this.key2vector[key];\n        return indices == null ? v : new SlicedVector(v, indices);\n    }\n\n    getFileUrl(file) {\n        return this.baseUrl + file;\n    }\n\n    getVectors(keys, indices = null) {\n        let result = [];\n        keys.forEach(key => {\n            let v = this.key2vector[key];\n            if (indices != null) {\n                v = new SlicedVector(v, indices);\n            }\n            result.push(v);\n        });\n        return result;\n    }\n\n\n}\n\n\n\n\n","import {API, getIdToken} from './actions';\n\nexport class RestDataset {\n\n    init(id) {\n        this.id = id;\n        return Promise.resolve();\n    }\n\n    getSelectedIdsPromise(data) {\n        data.id = this.id;\n        return fetch(API + '/selected_ids',\n            {\n                body: JSON.stringify(data),\n                method: 'POST',\n                headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + getIdToken()},\n            }).result(result => result.json());\n    }\n\n    getFileUrl(file) {\n        return API + '/file?id=' + this.id + '&file=' + file + '&access_token=' + getIdToken();\n    }\n\n    getDataPromise(data) {\n        data.id = this.id;\n        return fetch(API + '/data',\n            {\n                body: JSON.stringify(data),\n                method: 'POST',\n                headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + getIdToken()},\n            }).then(result => result.json());\n    }\n\n    getSchemaPromise() {\n        return fetch(API + '/schema?id=' + this.id, {headers: {'Authorization': 'Bearer ' + getIdToken()}}).then(response => {\n            return response.json();\n        });\n    }\n}\n\n\n\n\n\n","// general server stuff\n\nimport {API, getIdToken} from './actions';\n\nexport class RestServerApi {\n\n    getUserPromise() {\n        return fetch(API + '/user', {\n            headers: {\n                'Authorization': 'Bearer ' + getIdToken(),\n                'Content-Type': 'application/json'\n            }\n        }).then(result => result.json());\n    }\n\n\n    getDatasetsPromise() {\n        return fetch(API + '/datasets', {headers: {'Authorization': 'Bearer ' + getIdToken()}})\n            .then(response => {\n                return response.json();\n            });\n    }\n\n    deleteDatasetPromise(datasetId) {\n        return fetch(API + '/dataset',\n            {\n                body: JSON.stringify(\n                    {id: datasetId}),\n                method: 'DELETE',\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            });\n    }\n\n    upsertDatasetPromise(datasetId, dataset) {\n        let isEdit = datasetId != null;\n        if (datasetId != null) {\n            dataset.id = datasetId;\n        }\n        return fetch(API + '/dataset',\n            {\n                body: JSON.stringify(dataset),\n                method: isEdit ? 'PUT' : 'POST',\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            }).then(importDatasetResponse => importDatasetResponse.json());\n    }\n\n\n    getDatasetPromise(datasetId) {\n        return fetch(API + '/dataset?id=' + datasetId,\n            {\n                method: 'GET',\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            }).then(result => result.json());\n    }\n\n\n// categories and filters\n    setCategoryNamePromise(data) {\n        return fetch(API + '/category_name',\n            {\n                body: JSON.stringify(data),\n                method: 'PUT',\n                headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + getIdToken()},\n            });\n    }\n\n    upsertDatasetFilterPromise(data, isUpdate) {\n        return fetch(API + '/filter',\n            {\n                body: JSON.stringify(data),\n                method: isUpdate ? 'PUT' : 'POST',\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            }).then(response => response.json());\n    }\n\n    upsertFeatureSet(data, isUpdate) {\n        return fetch(API + '/feature_set',\n            {\n                body: JSON.stringify(data),\n                method: isUpdate ? 'PUT' : 'POST',\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            }).then(response => response.json());\n    }\n\n    deleteFeatureSet(setId, datasetId) {\n        return fetch(API + '/feature_set',\n            {\n                body: JSON.stringify({id: setId, ds_id: datasetId}),\n                method: 'DELETE',\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            });\n    }\n\n\n    exportDatasetFiltersPromise(datasetId) {\n        return fetch(API + '/export_filters?id=' + datasetId, {\n            headers: {'Authorization': 'Bearer ' + getIdToken()},\n        }).then(result => {\n            if (!result.ok) {\n                return null;\n            }\n            return result.text();\n        });\n    }\n\n    deleteDatasetFilterPromise(filterId, datasetId) {\n        return fetch(API + '/filter',\n            {\n                body: JSON.stringify({id: filterId, ds_id: datasetId}),\n                method: 'DELETE',\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            });\n    }\n\n    getDatasetFilterPromise(filterId, datasetId) {\n        return fetch(API + '/filter?id=' + filterId + '&ds_id=' + datasetId,\n            {\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            }).then(response => response.json());\n    }\n\n    getCategoryNamesPromise(datasetId) {\n        return fetch(API + '/category_name?id=' + datasetId,\n            {\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            }).then(result => result.json());\n    }\n\n    getFiltersPromise(datasetId) {\n        return fetch(API + '/filters?id=' + datasetId,\n            {\n                headers: {'Authorization': 'Bearer ' + getIdToken()},\n            }).then(result => result.json());\n    }\n\n}\n","import {Tooltip} from '@material-ui/core';\nimport IconButton from '@material-ui/core/IconButton';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nimport BorderInnerIcon from '@material-ui/icons/BorderInner';\nimport CloudQueueIcon from '@material-ui/icons/CloudQueue';\nimport ExposureIcon from '@material-ui/icons/Exposure';\nimport FontDownloadIcon from '@material-ui/icons/FontDownload';\nimport HomeIcon from '@material-ui/icons/Home';\nimport PauseIcon from '@material-ui/icons/Pause';\nimport PhotoCameraIcon from '@material-ui/icons/PhotoCamera';\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary';\nimport PhotoSizeSelectSmallIcon from '@material-ui/icons/PhotoSizeSelectSmall';\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport ZoomInIcon from '@material-ui/icons/ZoomIn';\nimport ZoomOutIcon from '@material-ui/icons/ZoomOut';\nimport React from 'react';\n\nconst active = 'cirro-active';\n\n\n//\"zoom\" | \"pan\" | \"select\" | \"lasso\" | \"orbit\" | \"turntable\"\nclass ChartToolbar extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.state = {saveImageEl: null};\n    }\n\n    setDragMode = (mode) => {\n        this.props.onDragMode(mode);\n    };\n\n    onShowLabels = () => {\n        this.props.onShowLabels();\n    };\n\n    onShowAxis = () => {\n        this.props.onShowAxis();\n    };\n\n\n    onShowFog = () => {\n        this.props.onShowFog();\n    };\n\n\n    onGallery = () => {\n        this.props.onGallery();\n    };\n\n    handleMoreOptions = () => {\n        this.props.onMoreOptions();\n    };\n\n    setEditSelection = () => {\n        this.props.onEditSelection();\n    };\n    handleSaveImageMenu = (event) => {\n        this.setState({saveImageEl: event.currentTarget});\n    };\n    handleSaveImageMenuClose = (event) => {\n        this.setState({saveImageEl: null});\n    };\n\n    handleSaveImage = (format) => {\n        this.setState({saveImageEl: null});\n        this.props.onSaveImage(format);\n    };\n\n    render() {\n\n        const {dragmode, editSelection, showLabels, showAxis} = this.props;\n        const {saveImageEl} = this.state;\n        return (<React.Fragment>\n\n            {this.props.onZoomIn && <Tooltip title={\"Zoom In\"}>\n                <IconButton edge={false} size={'small'}\n                            aria-label=\"Zoom In\" onClick={this.props.onZoomIn}>\n                    <ZoomInIcon/>\n                </IconButton>\n            </Tooltip>}\n\n            {this.props.onZoomOut && <Tooltip title={\"Zoom Out\"}>\n                <IconButton edge={false} size={'small'}\n                            aria-label=\"Zoom In\" onClick={this.props.onZoomOut}>\n                    <ZoomOutIcon/>\n                </IconButton>\n            </Tooltip>}\n\n            {this.props.onHome && <Tooltip title={\"Home\"}>\n                <IconButton edge={false} size={'small'}\n                            aria-label=\"Home\" onClick={this.props.onHome}>\n                    <HomeIcon/>\n                </IconButton>\n            </Tooltip>}\n\n\n            <Tooltip title={\"Lasso Select\"}>\n                <IconButton edge={false} size={'small'} className={dragmode === 'lasso' ? active : ''}\n                            aria-label=\"Lasso Select\" onClick={() => this.setDragMode('lasso')}>\n                    <svg className={\"MuiSvgIcon-root\"} width=\"24\" height=\"21\" viewBox=\"0 0 1031 1000\">\n                        <path\n                            d=\"m1018 538c-36 207-290 336-568 286-277-48-473-256-436-463 10-57 36-108 76-151-13-66 11-137 68-183 34-28 75-41 114-42l-55-70 0 0c-2-1-3-2-4-3-10-14-8-34 5-45 14-11 34-8 45 4 1 1 2 3 2 5l0 0 113 140c16 11 31 24 45 40 4 3 6 7 8 11 48-3 100 0 151 9 278 48 473 255 436 462z m-624-379c-80 14-149 48-197 96 42 42 109 47 156 9 33-26 47-66 41-105z m-187-74c-19 16-33 37-39 60 50-32 109-55 174-68-42-25-95-24-135 8z m360 75c-34-7-69-9-102-8 8 62-16 128-68 170-73 59-175 54-244-5-9 20-16 40-20 61-28 159 121 317 333 354s407-60 434-217c28-159-121-318-333-355z\"\n                            transform=\"matrix(1 0 0 -1 0 850)\"></path>\n\n                    </svg>\n                </IconButton>\n            </Tooltip>\n            <Tooltip title={\"Box Select\"}>\n                <IconButton edge={false} size={'small'}\n                            aria-label=\"Box Select\" onClick={() => this.setDragMode('select')}>\n                    <PhotoSizeSelectSmallIcon className={dragmode === 'select' ? active : ''}/>\n                </IconButton>\n            </Tooltip>\n\n            <Tooltip title={\"Append to selection\"}>\n                <IconButton edge={false} size={'small'} aria-label=\"Append to selection\"\n                            onClick={this.setEditSelection}>\n                    <ExposureIcon className={editSelection ? active : ''}/>\n                </IconButton>\n            </Tooltip>\n            {this.props.is3d && <Tooltip title={this.props.animating ? 'Pause' : 'Animate'}>\n                <IconButton edge={false} size={'small'}\n                            aria-label={this.props.animating ? 'Pause' : 'Animate'}\n                            onClick={this.props.toggleAnimation}>\n                    {!this.props.animating && <PlayArrowIcon/>}\n                    {this.props.animating && <PauseIcon/>}\n                </IconButton>\n            </Tooltip>}\n\n            <Tooltip title={\"Pan\"}>\n                <IconButton edge={false} size={'small'} className={dragmode === 'pan' ? active : ''}\n                            aria-label=\"Pan\" onClick={() => this.setDragMode('pan')}>\n                    <svg className={\"MuiSvgIcon-root\"} viewBox=\"0 0 1000 1000\" height=\"16\" width=\"16\">\n                        <path\n                            d=\"m1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z\"\n                            transform=\"matrix(1 0 0 -1 0 850)\"></path>\n                    </svg>\n                </IconButton>\n            </Tooltip>\n\n            {this.props.onShowLabels && <Tooltip title={\"Show Categorical Labels\"}>\n                <IconButton edge={false} size={'small'} className={showLabels ? active : ''}\n                            aria-label=\"Show Labels\" onClick={() => this.onShowLabels()}>\n                    <FontDownloadIcon/>\n                </IconButton>\n            </Tooltip>}\n\n\n            {this.props.is3d && this.props.onShowAxis && <Tooltip title={\"Show Axis\"}>\n                <IconButton edge={false} size={'small'} className={showAxis ? active : ''}\n                            aria-label=\"Show Axis\" onClick={() => this.onShowAxis()}>\n                    <BorderInnerIcon/>\n                </IconButton>\n            </Tooltip>}\n\n\n            {this.props.is3d && this.props.onShowFog && <Tooltip title={\"Show Fog\"}>\n                <IconButton edge={false} size={'small'} className={this.props.showFog ? active : ''}\n                            aria-label=\"Show Fog\" onClick={() => this.onShowFog()}>\n                    <CloudQueueIcon/>\n                </IconButton>\n            </Tooltip>}\n\n\n            {/*<Tooltip title={\"Zoom\"}>*/}\n            {/*    <IconButton className={dragmode === 'zoom' ? active : ''}*/}\n            {/*                aria-label=\"Zoom\" onClick={() => this.setDragMode('zoom')}>*/}\n            {/*        <svg viewBox=\"0 0 1000 1000\" height=\"16\" width=\"16\">*/}\n            {/*            <path*/}\n            {/*                d=\"m1000-25l-250 251c40 63 63 138 63 218 0 224-182 406-407 406-224 0-406-182-406-406s183-406 407-406c80 0 155 22 218 62l250-250 125 125z m-812 250l0 438 437 0 0-438-437 0z m62 375l313 0 0-312-313 0 0 312z\"*/}\n            {/*                transform=\"matrix(1 0 0 -1 0 850)\"></path>*/}\n            {/*        </svg>*/}\n            {/*    </IconButton>*/}\n            {/*</Tooltip>*/}\n            {/*<IconButton className={dragmode === ChartToolbar.MODE_ZOOM_OUT ? active : ''}*/}\n            {/*            aria-label=\"Zoom Out\" onClick={this.onZoomOut}>*/}\n            {/*    <svg viewBox=\"0 0 875 1000\" height=\"16\" width=\"16\">*/}\n            {/*        <path d=\"m0 788l0-876 875 0 0 876-875 0z m688-500l-500 0 0 125 500 0 0-125z\"*/}\n            {/*              transform=\"matrix(1 0 0 -1 0 850)\"></path>*/}\n            {/*    </svg>*/}\n            {/*</IconButton>*/}\n\n            <Tooltip title={\"Save Image\"}>\n                <IconButton aria-controls=\"save-image-menu\" aria-haspopup=\"true\" edge={false} size={'small'}\n                            aria-label=\"Save Image\" onClick={this.handleSaveImageMenu}>\n                    <PhotoCameraIcon/>\n                </IconButton>\n            </Tooltip>\n\n            <Menu\n                id=\"save-image-menu\"\n                anchorEl={saveImageEl}\n                keepMounted\n                open={Boolean(saveImageEl)}\n                onClose={this.handleSaveImageMenuClose}\n            >\n                <MenuItem onClick={e => this.handleSaveImage('png')}>PNG</MenuItem>\n                <MenuItem onClick={e => this.handleSaveImage('svg')}>SVG</MenuItem>\n\n            </Menu>\n\n\n            <Tooltip title={\"More Options\"}>\n                <IconButton edge={false} size={'small'}\n                            aria-label=\"More Options\" onClick={this.handleMoreOptions}>\n                    <SettingsIcon/>\n                </IconButton>\n            </Tooltip>\n\n\n            <Tooltip title={\"Scroll To Gallery\"}>\n                <IconButton edge={false} size={'small'}\n                            aria-label=\"Scroll To Gallery\" onClick={this.onGallery}>\n                    <PhotoLibraryIcon/>\n                </IconButton>\n            </Tooltip>\n            {/*<Tooltip title={\"Copy Image\"}>*/}\n            {/*    <IconButton edge={false} size={'small'} aria-label=\"Copy Image\" onClick={this.props.onCopyImage}>*/}\n            {/*        <FileCopyIcon/>*/}\n            {/*    </IconButton>*/}\n            {/*</Tooltip>*/}\n\n            {/*<Tooltip title={*/}\n            {/*    <React.Fragment>*/}\n            {/*        <h6>3D controls</h6>*/}\n            {/*        <b>Rotate</b> Mouse left click.*/}\n            {/*        <b>Pan</b> Mouse right click.*/}\n            {/*        <b>Zoom</b> Mouse wheel.*/}\n            {/*        Holding <b>ctrl</b> reverses the mouse clicks.*/}\n            {/*        <h6>2D controls</h6>*/}\n            {/*        <b>Pan</b> Mouse left click.*/}\n            {/*        <b>Zoom</b> Mouse wheel.*/}\n            {/*    </React.Fragment>*/}\n            {/*}>*/}\n            {/*    <IconButton edge={false} size={'small'} aria-label=\"Help\">*/}\n            {/*        <HelpIcon/>*/}\n            {/*    </IconButton>*/}\n            {/*</Tooltip>*/}\n            {/*<Tooltip title={\"Reset\"}>*/}\n            {/*    <IconButton aria-label=\"Reset\" onClick={this.props.onHome}>*/}\n            {/*        <svg viewBox=\"0 0 928.6 1000\" height=\"16\" width=\"16\">*/}\n            {/*            <path*/}\n            {/*                d=\"m786 296v-267q0-15-11-26t-25-10h-214v214h-143v-214h-214q-15 0-25 10t-11 26v267q0 1 0 2t0 2l321 264 321-264q1-1 1-4z m124 39l-34-41q-5-5-12-6h-2q-7 0-12 3l-386 322-386-322q-7-4-13-4-7 2-12 7l-35 41q-4 5-3 13t6 12l401 334q18 15 42 15t43-15l136-114v109q0 8 5 13t13 5h107q8 0 13-5t5-13v-227l122-102q5-5 6-12t-4-13z\"*/}\n            {/*                transform=\"matrix(1 0 0 -1 0 850)\"></path>*/}\n\n            {/*        </svg>*/}\n            {/*    </IconButton>*/}\n            {/*</Tooltip>*/}\n        </React.Fragment>);\n    }\n}\n\n\nexport default ChartToolbar;\n","import {format} from 'd3-format';\n\nexport const numberFormat = format('.1f');\nexport const intFormat = format(',');\nexport const numberFormat0 = format('.0f');","import {scaleLinear} from 'd3-scale';\nimport React from 'react';\nimport {numberFormat} from './formatters';\n\nexport function drawColorScheme(context, width, height, colorScale, label, nsteps = 10, textColor = 'black') {\n    let domain = colorScale.domain();\n    if (domain[0] === domain[1]) {\n        return;\n    }\n    let value = domain[0];\n    let stepSize = (domain[1] - domain[0]) / nsteps;\n    let legendHeight = 18;\n    let gradient = context.createLinearGradient(0, 0, width, legendHeight);\n    let valueToFraction = scaleLinear().range([0, 1]).domain(domain).clamp(true);\n    for (let i = 0; i < nsteps; i++) {\n        if (i === (nsteps - 1)) {\n            value = domain[1];\n        }\n        let f = valueToFraction(value);\n        if (!isNaN(f)) {\n            let color = colorScale(value);\n            gradient.addColorStop(f, color);\n        }\n        value += stepSize;\n    }\n    context.fillStyle = gradient;\n    context.fillRect(0, 0, width, legendHeight);\n    context.strokeStyle = 'LightGrey';\n    context.strokeRect(0, 0, width, legendHeight);\n    if (label > 0) {\n\n        context.textBaseline = 'top';\n        context.fillStyle = textColor;\n\n        context.textAlign = 'left';\n        context.fillText(numberFormat(domain[0]), 0, legendHeight + 2);\n        context.textAlign = 'right';\n        context.fillText(numberFormat(domain[1]), width, legendHeight + 2);\n    }\n}\n\nclass ColorSchemeLegend extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.ref = React.createRef();\n        this.backingScale = 1;\n    }\n\n    redraw() {\n        let backingScale = this.backingScale;\n        let node = this.ref.current;\n        const context = node.getContext('2d');\n        const height = this.props.height;\n        const width = this.props.width;\n        const textColor = this.props.textColor || 'black';\n        context\n            .clearRect(0, 0, width * backingScale, height * backingScale);\n        context.scale(backingScale, backingScale);\n\n        const colorScale = this.props.scale;\n        if (colorScale == null) {\n            return;\n        }\n\n        context.font = '12px Roboto Condensed,Helvetica,Arial,sans-serif';\n        drawColorScheme(context, width, height, colorScale, this.props.label, 10, textColor);\n        context.setTransform(1, 0, 0, 1, 0, 0);\n    }\n\n    componentDidMount() {\n        this.redraw();\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        this.redraw();\n    }\n\n    render() {\n        if (typeof window !== 'undefined' && 'devicePixelRatio' in window) {\n            this.backingScale = window.devicePixelRatio;\n        }\n\n        let height = this.props.height;\n        let width = this.props.width;\n        let style = {width: width, height: height};\n        if (this.props.style) {\n            style = Object.assign({}, style, this.props.style);\n        }\n        return (\n            <canvas width={width * this.backingScale} height={height * this.backingScale} ref={this.ref}\n                    style={style}></canvas>\n        );\n\n    }\n}\n\nexport default ColorSchemeLegend;\n\n","import C2S from 'canvas2svg';\nimport {drawColorScheme} from './ColorSchemeLegend';\nimport {drawCategoricalLegend, getCategoricalLegendSize} from './LegendDrawer';\n\nexport function saveImage(traceInfo, chartSize, draw, format) {\n\n    let context;\n    let canvas = null;\n    const totalSize = {width: chartSize.width, height: chartSize.height};\n    let name = traceInfo.name;\n    if (name === '__count') {\n        name = 'count';\n    }\n    if (format !== 'svg') {\n        canvas = document.createElement('canvas');\n        canvas.width = 100;\n        canvas.height = 100;\n        context = canvas.getContext('2d');\n    } else {\n        context = new C2S(100, 100);\n    }\n    if (!traceInfo.continuous) {\n        const legendSize = getCategoricalLegendSize(context, name, traceInfo.colorScale.domain());\n        totalSize.width += legendSize.width;\n        totalSize.height = Math.max(legendSize.height, chartSize.height);\n    } else {\n        totalSize.height += 150;\n\n    }\n    if (format === 'svg') {\n        context = new window.C2S(totalSize.width, totalSize.height);\n    } else {\n        canvas.width = totalSize.width * window.devicePixelRatio;\n        canvas.height = totalSize.height * window.devicePixelRatio;\n        context = canvas.getContext('2d');\n        context.scale(window.devicePixelRatio, window.devicePixelRatio);\n        context.fillStyle = 'white';\n        context.fillRect(0, 0, totalSize.width, totalSize.height);\n    }\n\n    draw(context, chartSize, format);\n\n    if (!traceInfo.continuous) {\n        context.translate(chartSize.width, 2);\n        drawCategoricalLegend(context, traceInfo.colorScale, name, traceInfo.colorScale.domain());\n    } else {\n        context.translate(chartSize.width / 2 - 75, chartSize.height + 2);\n        drawColorScheme(context, 150, 20, traceInfo.colorScale, true);\n    }\n\n    if (format === 'svg') {\n        let svg = context.getSerializedSvg();\n        // let prefix = [];\n        // prefix.push('<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n');\n        // prefix.push('<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"' +\n        //     ' \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n');\n        // svg = prefix.join('') + svg;\n        let blob = new Blob([svg], {\n            type: 'text/plain;charset=utf-8'\n        });\n        window.saveAs(blob, name + '.svg');\n    } else {\n        canvas.toBlob(blob => {\n            window.saveAs(blob, name + '.png', true);\n        });\n    }\n\n}","export function getCategoricalLegendSize(context, name, categories) {\n    context.font = '14px Helvetica';\n    let maxWidth = context.measureText(name).width;\n    categories.forEach(value => maxWidth = Math.max(maxWidth, context.measureText(value).width));\n    return {width: maxWidth + 14, height: categories.length * 12 + 4};\n}\n\nexport function drawCategoricalLegend(context, scale, name, categories) {\n\n    context.font = '14px Helvetica';\n    context.textAlign = 'left';\n    context.textBaseline = 'bottom';\n    const height = 12;\n    for (let i = 0; i < categories.length; i++) {\n        const category = categories[i];\n        context.fillStyle = scale(category);\n        context.fillRect(0, i * height, 10, 10);\n        context.fillStyle = 'black';\n        context.fillText('' + category, 12, i * height + height);\n    }\n}\n\n\n","import {shuffle} from 'd3-array';\nimport {color} from 'd3-color';\nimport {scaleLinear} from 'd3-scale';\nimport * as scaleChromatic from 'd3-scale-chromatic';\nimport simplify from 'simplify-js';\nimport {getColors} from './ThreeUtil';\n\nexport const interpolators = {};\ninterpolators['Diverging'] = [\n    'interpolateBrBG',\n    'interpolatePRGn',\n    'interpolatePiYG',\n    'interpolatePuOr',\n    'interpolateRdBu',\n    'interpolateRdGy',\n    'interpolateRdYlBu',\n    'interpolateRdYlGn',\n    'interpolateSpectral'];\n\ninterpolators['Sequential (Single Hue)'] = [\n    'interpolateBlues',\n    'interpolateGreens',\n    'interpolateGreys',\n    'interpolateOranges',\n    'interpolatePurples',\n    'interpolateReds'];\n\ninterpolators['Sequential (Multi-Hue)'] = [\n    'interpolateViridis',\n    'interpolateInferno',\n    'interpolateMagma',\n    'interpolatePlasma',\n    'interpolateWarm',\n    'interpolateCool',\n    'interpolateCubehelixDefault',\n    'interpolateBuGn',\n    'interpolateBuPu',\n    'interpolateGnBu',\n    'interpolateOrRd',\n    'interpolatePuBuGn',\n    'interpolatePuBu',\n    'interpolatePuRd',\n    'interpolateRdPu',\n    'interpolateYlGnBu',\n    'interpolateYlGn',\n    'interpolateYlOrBr',\n    'interpolateYlOrRd'];\n\ninterpolators['Cyclical'] = ['interpolateRainbow', 'interpolateSinebow'];\n\n\n// const TWENTY_COLORS = [\n//     '#1f77b4', '#aec7e8', '#ff7f0e',\n//     '#ffbb78', '#2ca02c', '#98df8a', '#d62728', '#ff9896', '#9467bd',\n//     '#c5b0d5', '#8c564b', '#c49c94', '#e377c2', '#f7b6d2', '#7f7f7f',\n//     '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5'];\n\nexport const CATEGORY_20B = [\n    '#393b79', '#5254a3', '#6b6ecf',\n    '#9c9ede', '#637939', '#8ca252', '#b5cf6b', '#cedb9c', '#8c6d31',\n    '#bd9e39', '#e7ba52', '#e7cb94', '#843c39', '#ad494a', '#d6616b',\n    '#e7969c', '#7b4173', '#a55194', '#ce6dbd', '#de9ed6'];\nexport const CATEGORY_20C = [\n    '#3182bd', '#6baed6', '#9ecae1',\n    '#c6dbef', '#e6550d', '#fd8d3c', '#fdae6b', '#fdd0a2', '#31a354',\n    '#74c476', '#a1d99b', '#c7e9c0', '#756bb1', '#9e9ac8', '#bcbddc',\n    '#dadaeb', '#636363', '#969696', '#bdbdbd', '#d9d9d9'];\n\n/**\n *\n * @param array. Array of format,data\n */\nexport function setClipboardData(clipboardData) {\n    const container = document.activeElement;\n    const isRTL = document.documentElement.getAttribute('dir') == 'rtl';\n    const fakeElem = document.createElement('div');\n    fakeElem.contentEditable = true;\n\n    // Prevent zooming on iOS\n    fakeElem.style.fontSize = '12pt';\n    // Reset box model\n\n    fakeElem.style.border = '0';\n    fakeElem.style.padding = '0';\n    fakeElem.style.margin = '0';\n    // Move element out of screen horizontally\n    fakeElem.style.position = 'absolute';\n    fakeElem.style[isRTL ? 'right' : 'left'] = '-999999px';\n    // Move element to the same position vertically\n    fakeElem.style.top = (window.pageYOffset || document.documentElement.scrollTop) + 'px';\n    fakeElem.setAttribute('readonly', '');\n    //fakeElem.innerHTML = html;\n    const copyListener = (e) => {\n\n        clipboardData.forEach(function (elem) {\n            e.clipboardData.setData(elem.format, elem.data);\n        });\n\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n        fakeElem.removeEventListener('copy', copyListener);\n    };\n    fakeElem.addEventListener('copy', copyListener);\n\n    container.appendChild(fakeElem);\n\n    const selection = window.getSelection();\n    const range = document.createRange();\n    range.selectNodeContents(fakeElem);\n    selection.removeAllRanges();\n    selection.addRange(range);\n    const fakeHandlerCallback = (event) => {\n        container.removeChild(fakeElem);\n        container.removeEventListener('click', fakeHandlerCallback);\n    };\n    document.execCommand('copy');\n    container.addEventListener('click', fakeHandlerCallback);\n};\n\nexport function updateTraceColors(traceInfo) {\n    if (traceInfo.isImage) {\n        let colors = [];\n        let colorScale = traceInfo.colorScale;\n        const colorMapper = rgb => rgb.formatHex();\n        for (let i = 0, n = traceInfo.npoints; i < n; i++) {\n            let rgb = color(colorScale(traceInfo.values[i]));\n            colors.push(colorMapper(rgb));\n        }\n        traceInfo.colors = colors;\n    } else {\n        traceInfo.colors = getColors(traceInfo);\n    }\n}\n\n\n/**\n * Computes the rank using the given index array. The index array can be\n * obtained from the indexSort method. Does not handle ties.\n *\n */\nexport function rankIndexArray(index) {\n    const n = index.length;\n    const rank = new Uint32Array(n);\n    for (let j = 0; j < n; j++) {\n        rank[index[j]] = j + 1;\n    }\n    return rank;\n};\n\nexport function indexSort(array, ascending) {\n    const pairs = [];\n    for (let i = 0, length = array.length; i < length; i++) {\n        pairs.push({\n            value: array[i],\n            index: i\n        });\n    }\n    return indexSortPairs(pairs, ascending);\n};\n\nfunction indexSortPairs(array, ascending) {\n    if (ascending) {\n        array.sort(function (a, b) {\n            return (a.value < b.value ? -1 : (a.value === b.value ? (a.index < b.index ? -1 : 1) : 1));\n        });\n    } else {\n        array.sort(function (a, b) {\n            return (a.value < b.value ? 1 : (a.value === b.value ? (a.index < b.index ? 1 : -1) : -1));\n        });\n    }\n    const indices = new Uint32Array(array.length);\n    for (let i = 0, n = array.length; i < n; i++) {\n        indices[i] = array[i].index;\n    }\n    return indices;\n};\n\nexport function randomSeq(n, start = 0) {\n    const indices = new Uint32Array(n);\n    for (let i = 0; i < n; i++, start++) {\n        indices[i] = start;\n    }\n    shuffle(indices);\n    return indices;\n}\n\n/**\n * Computes the False Discovery Rate using the BH procedure.\n *\n * @param nominalPValues\n *            Array of nominal p-values.\n */\nexport function fdr(nominalPValues) {\n    const size = nominalPValues.length;\n    const pValueIndices = indexSort(nominalPValues, true);\n    const ranks = rankIndexArray(pValueIndices);\n\n    // check for ties\n    for (let i = pValueIndices.length - 1; i > 0; i--) {\n        const bigPValue = nominalPValues[pValueIndices[i]];\n        const smallPValue = nominalPValues[pValueIndices[i - 1]];\n        if (bigPValue === smallPValue) {\n            ranks[pValueIndices[i - 1]] = ranks[pValueIndices[i]];\n        }\n    }\n\n    const fdr = new Float32Array(size);\n    for (let i = 0; i < size; i++) {\n        const rank = ranks[i];\n        const p = nominalPValues[i];\n        fdr[i] = (p * size) / rank;\n    }\n\n    // ensure fdr is monotonically decreasing\n    const pIndices = indexSort(nominalPValues, false);\n    for (let i = 0; i < pIndices.length - 1; i++) {\n        const highIndex = pIndices[i];\n        const lowIndex = pIndices[i + 1];\n        fdr[lowIndex] = Math.min(fdr[lowIndex], fdr[highIndex]);\n    }\n    for (let i = 0; i < size; i++) {\n        fdr[i] = Math.min(fdr[i], 1);\n    }\n    return fdr;\n};\n\nexport function isPointInside(point, vs) {\n    // ray-casting algorithm based on\n    // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\n\n    const x = point.x, y = point.y;\n\n    let inside = false;\n    for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {\n        const xi = vs[i].x, yi = vs[i].y;\n        const xj = vs[j].x, yj = vs[j].y;\n\n        const intersect = ((yi > y) != (yj > y))\n            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n        if (intersect) {\n            inside = !inside;\n        }\n    }\n\n    return inside;\n}\n\n\nexport function arrayToSvgPath(lassoPathArray) {\n    if (lassoPathArray.length > 1) {\n        lassoPathArray = simplify(lassoPathArray);\n    }\n    let svgPath = 'M ' + lassoPathArray[0].x + ' ' + lassoPathArray[0].y;\n    for (let i = 1; i < lassoPathArray.length; i++) {\n        svgPath += ' L ' + lassoPathArray[i].x + ' ' + lassoPathArray[i].y;\n    }\n    svgPath += ' Z';\n    return svgPath;\n}\n\nexport function getRgbScale() {\n    return scaleLinear().domain([0, 255]).range([0, 1]);\n}\n\nexport function fixInterpolatorName(name) {\n    if (!name.startsWith(\"interpolate\")) {\n        name = \"interpolate\" + name;\n    }\n    return name;\n}\n\nexport function getInterpolator(name) {\n    return scaleChromatic[fixInterpolatorName(name)];\n}\n\nexport function convertIndicesToBins(points, bins) {\n    let selectedBins = [];\n    for (let i = 0, n = points.length; i < n; i++) {\n        selectedBins.push(bins[points[i]]);\n    }\n    return selectedBins;\n}\n\nexport function convertBinsToIndices(bins, selectedBins) {\n    let points = [];\n    selectedBins = new Set(selectedBins);\n    for (let i = 0, n = bins.length; i < n; i++) {\n        if (selectedBins.has(bins[i])) {\n            points.push(i);\n        }\n    }\n\n    return points;\n}\n\n// add to X, maintaining insertion order\nexport function addFeatureSetsToX(featureSets, X) {\n    const uniqueX = new Set(X);\n    featureSets.forEach(featureSet => {\n        let features = featureSet.features;\n        if (features) {\n            features.forEach(feature => {\n                if (!uniqueX.has(feature)) {\n                    X.push(feature);\n                    uniqueX.add(feature);\n                }\n            });\n        }\n\n    });\n}\n\nexport function getFeatureSets(markers, featureSetIds) {\n    let featureSets = [];\n    featureSetIds.forEach(featureSetId => {\n        for (let i = 0; i < markers.length; i++) {\n            if (markers[i].id === featureSetId) {\n                featureSets.push(markers[i]);\n                break;\n            }\n        }\n    });\n    return featureSets;\n}\n\nexport function splitSearchTokens(tokens) {\n    let X = [];\n    let obs = [];\n    let obsCat = [];\n    let featureSets = [];\n    tokens.forEach(token => {\n        if (token.type === 'X') {\n            X.push(token.value);\n        } else if (token.type === 'obs') {\n            obs.push(token.value);\n        } else if (token.type === 'obsCat') {\n            obsCat.push(token.value);\n        } else if (token.type === 'featureSet') {\n            featureSets.push(token.value);\n        } else {\n            console.log('Unknown type: ' + token);\n        }\n    });\n    return {X: X, obs: obs, obsCat: obsCat, featureSets: featureSets};\n}\n","import {color} from 'd3-color';\nimport {makeStyles, ScatterPlot, ScatterPlotVisualizerSprites, ScatterPlotVisualizerSvgLabels} from 'scatter-gl';\nimport {Color, OrthographicCamera, Vector3} from 'three';\nimport {getVisualizer} from './ScatterChartThree';\nimport {getRgbScale, indexSort, randomSeq, rankIndexArray} from './util';\n\nexport const POINT_VISUALIZER_ID = 'SPRITES';\n\nexport const LABELS_VISUALIZER_ID = 'SVG_LABELS';\n\nfunction scaleLinear(value, domain, range) {\n    const domainDifference = domain[1] - domain[0];\n    const rangeDifference = range[1] - range[0];\n\n    const percentDomain = (value - domain[0]) / domainDifference;\n    return percentDomain * rangeDifference + range[0];\n}\n\n\nexport function getScaleFactor(size) {\n    const ORTHO_CAMERA_FRUSTUM_HALF_EXTENT = 1.2;\n    const aspectRatio = size.width / size.height;\n    let left = -ORTHO_CAMERA_FRUSTUM_HALF_EXTENT;\n    let right = ORTHO_CAMERA_FRUSTUM_HALF_EXTENT;\n    let bottom = -ORTHO_CAMERA_FRUSTUM_HALF_EXTENT;\n    let top = ORTHO_CAMERA_FRUSTUM_HALF_EXTENT;\n    // Scale up the larger of (w, h) to match the aspect ratio.\n    if (aspectRatio > 1) {\n        left *= aspectRatio;\n        right *= aspectRatio;\n    } else {\n        top /= aspectRatio;\n        bottom /= aspectRatio;\n    }\n    let camera = new OrthographicCamera(\n        left,\n        right,\n        top,\n        bottom,\n        -1000,\n        1000\n    );\n    camera.up = new Vector3(0, 0, 1);\n\n    camera.updateProjectionMatrix();\n    return camera.projectionMatrix.elements[0];\n}\n\nexport function createScatterPlot(containerElement, premultipliedAlpha, labels, interactive = true) {\n    const styles = makeStyles();\n    styles.label3D.fontSize = 40;\n\n    const scatterPlot = new ScatterPlot(containerElement, {\n        camera: {},\n        selectEnabled: false,\n        styles: styles,\n        interactive: interactive\n\n    }, premultipliedAlpha); // toDataUrl images are flipped on Safari when premultipliedAlpha is false\n    let visualizers = [new ScatterPlotVisualizerSprites(styles)];\n    if (labels) {\n        // visualizers.push(new ScatterPlotVisualizerCanvasLabels(containerElement, styles));\n        visualizers.push(new ScatterPlotVisualizerSvgLabels(containerElement, styles));\n    }\n    scatterPlot.setActiveVisualizers(visualizers);\n    return scatterPlot;\n}\n\nexport function getColors(trace) {\n    const RGBA_NUM_ELEMENTS = 4;\n    const rgbScale = getRgbScale();\n\n    let dst = 0;\n    let colorScale = trace.colorScale;\n    const n = trace.x.length;\n    const colors = new Float32Array(n * RGBA_NUM_ELEMENTS);\n\n    for (let i = 0; i < n; ++i) {\n        let c = color(colorScale(trace.values[i]));\n        colors[dst++] = rgbScale(c.r);\n        colors[dst++] = rgbScale(c.g);\n        colors[dst++] = rgbScale(c.b);\n        colors[dst++] = 1;\n    }\n    return colors;\n}\n\nexport function getPositions(trace) {\n    const SCATTER_PLOT_CUBE_LENGTH = 2;\n    let xExtent = [Infinity, -Infinity];\n    let yExtent = [Infinity, -Infinity];\n    let zExtent = [Infinity, -Infinity];\n    const npoints = trace.x.length;\n    const is3d = trace.z != null;\n    let ranks;\n    if (!is3d) {\n        ranks = !trace.isCategorical ? rankIndexArray(indexSort(trace.values, true)) : randomSeq(trace.values.length, 1);\n        // ranks go from 1 to values.length. Higher rank means higher value.\n        zExtent[0] = 0;\n        zExtent[1] = 1;\n    }\n    // Determine max and min of each axis of our data.\n    for (let i = 0; i < npoints; i++) {\n        const x = trace.x[i];\n        if (x < xExtent[0]) {\n            xExtent[0] = x;\n        }\n        if (x > xExtent[1]) {\n            xExtent[1] = x;\n        }\n\n        const y = trace.y[i];\n        if (y < yExtent[0]) {\n            yExtent[0] = y;\n        }\n        if (y > yExtent[1]) {\n            yExtent[1] = y;\n        }\n        if (is3d) {\n            const z = trace.z[i];\n            if (z < zExtent[0]) {\n                zExtent[0] = z;\n            }\n            if (z > zExtent[1]) {\n                zExtent[1] = z;\n            }\n        }\n    }\n\n    const getRange = (extent) => Math.abs(extent[1] - extent[0]);\n    const xRange = getRange(xExtent);\n    const yRange = getRange(yExtent);\n    const zRange = getRange(zExtent);\n    const maxRange = Math.max(xRange, yRange, zRange);\n    const halfCube = SCATTER_PLOT_CUBE_LENGTH / 2;\n    const makeScaleRange = (range, base) => [\n        -base * (range / maxRange),\n        base * (range / maxRange),\n    ];\n    const xScale = makeScaleRange(xRange, halfCube);\n    const yScale = makeScaleRange(yRange, halfCube);\n    const zScale = makeScaleRange(zRange, halfCube);\n\n    const positions = new Float32Array(npoints * 3);\n    let dst = 0;\n\n    for (let i = 0; i < npoints; i++) {\n\n        positions[dst++] = scaleLinear(trace.x[i], xExtent, xScale);\n        positions[dst++] = scaleLinear(trace.y[i], yExtent, yScale);\n        positions[dst++] = scaleLinear(is3d ? trace.z[i] : ranks[i] / (ranks.length + 1), zExtent, zScale);\n    }\n    return positions;\n\n}\n\nexport function getCategoryLabelsPositions(traceInfo, categoricalNames) {\n    const categoryToPosition = {};\n    let ncategories = 0;\n    const isImage = traceInfo.isImage;\n    for (let i = 0, j = 0; i < traceInfo.npoints; i++, j += 3) {\n        let value = traceInfo.values[i];\n        let p = categoryToPosition[value];\n        if (p === undefined) {\n            p = {x: [], y: [], z: []};\n            categoryToPosition[value] = p;\n            ncategories++;\n        }\n        p.count++;\n        if (isImage) {\n            p.x.push(traceInfo.x[i]);\n            p.y.push(traceInfo.y[i]);\n        } else {\n            p.x.push(traceInfo.positions[j]);\n            p.y.push(traceInfo.positions[j + 1]);\n            p.z.push(traceInfo.positions[j + 2]);\n        }\n    }\n    let labelStrings = [];\n    let labelPositions = new Float32Array(ncategories * 3);\n    let positionIndex = 0;\n    let categoryObject = categoricalNames[traceInfo.name];\n    if (categoryObject === undefined) {\n        categoryObject = {};\n    }\n    for (let category in categoryToPosition) {\n        let renamedCategory = categoryObject[category];\n        if (renamedCategory !== undefined) {\n            labelStrings.push(renamedCategory);\n        } else {\n            labelStrings.push(category);\n        }\n        let p = categoryToPosition[category];\n        p.x.sort((a, b) => a - b);\n        p.y.sort((a, b) => a - b);\n        p.z.sort((a, b) => a - b);\n        const mid = p.x.length / 2;\n        labelPositions[positionIndex] = mid % 1 ? p.x[mid - 0.5] : (p.x[mid - 1] + p.x[mid]) / 2;\n        labelPositions[positionIndex + 1] = mid % 1 ? p.y[mid - 0.5] : (p.y[mid - 1] + p.y[mid]) / 2;\n        labelPositions[positionIndex + 2] = mid % 1 ? p.z[mid - 0.5] : (p.z[mid - 1] + p.z[mid]) / 2;\n        positionIndex += 3;\n    }\n\n    return {labels: labelStrings, positions: labelPositions};\n}\n\nexport function updateScatterChart(scatterPlot, traceInfo, selection, markerOpacity, unselectedMarkerOpacity, pointSize, categoricalNames = {}, chartOptions) {\n    const colors = traceInfo.colors;\n    let positions = traceInfo.positions;\n\n    const npoints = traceInfo.npoints;\n    const isSelectionEmpty = selection.size === 0;\n\n    for (let i = 0, j = 3, k = 2; i < npoints; i++, j += 4, k += 3) {\n        const isSelected = isSelectionEmpty || selection.has(i);\n        colors[j] = isSelected ? markerOpacity : unselectedMarkerOpacity;\n    }\n    scatterPlot.scene.background = chartOptions.darkMode ? new Color(\"rgb(0, 0, 0)\") : null;\n    scatterPlot.setDimensions(traceInfo.dimensions);\n    let spriteVisualizer = getVisualizer(scatterPlot, POINT_VISUALIZER_ID);\n    spriteVisualizer.styles.fog.enabled = chartOptions.showFog;\n    const axes = scatterPlot.scene.getObjectByName('axes');\n    if (axes) {\n        axes.visible = chartOptions.showAxis;\n    }\n    scatterPlot.setPointColors(colors);\n    scatterPlot.setPointPositions(positions);\n\n    // const {scaleDefault, scaleSelected, scaleHover} = scatterPlot.styles.point;\n\n    const scale = new Float32Array(traceInfo.npoints);\n    scale.fill(pointSize);\n    scatterPlot.setPointScaleFactors(scale);\n\n    const showLabels = chartOptions.showLabels && traceInfo.isCategorical;\n    const labelsVisualizer = getVisualizer(scatterPlot, LABELS_VISUALIZER_ID);\n    if (labelsVisualizer) {\n        labelsVisualizer.labelsActive = showLabels;\n        if (showLabels) {\n            const labelsPositions = getCategoryLabelsPositions(traceInfo, categoricalNames);\n            labelsVisualizer.fillStyle = chartOptions.darkMode ? 'white' : 'black';\n            labelsVisualizer.shadowColor = chartOptions.darkMode ? 'rgba(0,0,0,0.9)' : 'rgba(255,255,255,0.9)';\n            labelsVisualizer.shadowStroke = chartOptions.labelStrokeWidth;\n            labelsVisualizer.setLabels(labelsPositions.labels, labelsPositions.positions);\n            labelsVisualizer.font = 'bold ' + chartOptions.labelFontSize + 'px Roboto Condensed';\n        }\n    }\n\n    scatterPlot.render();\n}\n","import {Typography} from '@material-ui/core';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport {scaleLinear} from 'd3-scale';\nimport {bind} from 'lodash';\nimport React from 'react';\nimport {Vector3, Vector4} from 'three';\nimport {getEmbeddingKey} from './actions';\nimport ChartToolbar from './ChartToolbar';\nimport {saveImage} from './ChartUtil';\nimport {numberFormat} from './formatters';\nimport {createScatterPlot, getCategoryLabelsPositions, POINT_VISUALIZER_ID, updateScatterChart} from './ThreeUtil';\nimport {indexSort, isPointInside} from './util';\n\nfunction clamp(x, min_v, max_v) {\n    return Math.min(Math.max(x, min_v), max_v);\n}\n\nfunction smoothstep(edge0, edge1, x) {\n    const t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return t * t * (3 - 2 * t);\n};\n\nfunction mix(x, y, a) {\n    return x * (1.0 - a) + y * a;\n}\n\nexport function drawLabels(context, labelsPositions, chartOptions, chartSize, camera) {\n    const pos = new Vector3();\n    context.fillStyle = chartOptions.darkMode ? 'white' : 'black';\n    context.strokeStyle = chartOptions.darkMode ? 'rgba(0,0,0,0.9)' : 'rgba(255,255,255,0.9)';\n    context.lineWidth = chartOptions.labelStrokeWidth;\n    context.textAlign = 'center';\n    context.textBaseline = \"middle\";\n    const width = chartSize.width;\n    const height = chartSize.height;\n    const widthHalf = width / 2;\n    const heightHalf = height / 2;\n    for (let i = 0, k = 0; i < labelsPositions.labels.length; i++, k += 3) {\n        pos.x = labelsPositions.positions[k];\n        pos.y = labelsPositions.positions[k + 1];\n        pos.z = labelsPositions.positions[k + 2];\n        pos.project(camera);\n        pos.x = (pos.x * widthHalf) + widthHalf;\n        pos.y = -(pos.y * heightHalf) + heightHalf;\n\n        context.strokeText(labelsPositions.labels[i], pos.x, pos.y);\n        context.fillText(labelsPositions.labels[i], pos.x, pos.y);\n    }\n}\n\nexport function getVisualizer(scatterPlot, id) {\n    for (let i = 0; i < scatterPlot.visualizers.length; i++) {\n        if (scatterPlot.visualizers[i].id === id) {\n            return scatterPlot.visualizers[i];\n        }\n    }\n}\n\nconst styles = theme => ({\n\n    root: {\n        '& > *': {\n            margin: theme.spacing(.4),\n        },\n        '& > .MuiIconButton-root': {\n            padding: 0,\n        },\n        '& > .cirro-active': {\n            fill: 'rgb(220, 0, 78)',\n            color: 'rgb(220, 0, 78)',\n        },\n        '& > .cirro-inactive': {\n            fill: 'rgba(0, 0, 0, 0.26)',\n            color: 'rgba(0, 0, 0, 0.26)'\n        },\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        display: 'inline-block',\n        verticalAlign: 'top',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n    }\n});\n\nclass ScatterChartThree extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.containerElementRef = React.createRef();\n        this.tooltipElementRef = React.createRef();\n        this.scatterPlot = null;\n        this.lastHoverIndex = -1;\n        this.state = {forceUpdate: false};\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (prevProps.chartSize !== this.props.chartSize) {\n            this.scatterPlot.resize();\n        }\n        this.init();\n        this.draw();\n    }\n\n    componentDidMount() {\n        this.init();\n        this.draw(); // TODO fix 2x draw\n        this.draw();\n        if (this.props.chartOptions.camera) {\n            this.scatterPlot.updateFromCameraDef(this.props.chartOptions.camera);\n            this.props.chartOptions.camera = null;\n            this.draw();\n        }\n    }\n\n\n    componentWillUnmount() {\n        // if (this.scatterGL != null) {\n        //     this.scatterGL.dispose();\n        // }\n    }\n\n\n    calculatePointSize(traceInfo) {\n        const n = traceInfo.npoints;\n        const SCALE = 200;\n        const LOG_BASE = 8;\n        const DIVISOR = 1.5;\n        // Scale point size inverse-logarithmically to the number of points.\n        const pointSize = SCALE / Math.log(n) / Math.log(LOG_BASE);\n        return traceInfo.dimensions === 3 ? pointSize : pointSize / DIVISOR;\n    }\n\n    drawContext(context, chartSize, format) {\n        const {traceInfo, markerOpacity, unselectedMarkerOpacity, selection, categoricalNames, chartOptions} = this.props;\n        const showLabels = this.props.chartOptions.showLabels && traceInfo.isCategorical;\n        const pointSize = this.calculatePointSize(traceInfo);\n        const scaleFactor = this.props.pointSize;\n        const PI2 = 2 * Math.PI;\n        const colors = traceInfo.colors;\n        const positions = traceInfo.positions;\n        const camera = this.scatterPlot.camera;\n        const width = chartSize.width;\n        const height = chartSize.height;\n        if (chartOptions.darkMode) {\n            context.fillStyle = 'black';\n            context.fillRect(0, 0, width, height);\n        }\n        const widthHalf = width / 2;\n        const heightHalf = height / 2;\n        const colorScale = scaleLinear().domain([0, 1]).range([0, 255]);\n        const npoints = traceInfo.npoints;\n        const is3d = traceInfo.dimensions === 3;\n        let outputPointSize;\n        let fog = this.scatterPlot.scene.fog;\n        let spriteVisualizer = getVisualizer(this.scatterPlot, POINT_VISUALIZER_ID);\n\n        if (!is3d) {\n            const PI = 3.1415926535897932384626433832795;\n            const minScale = 0.1;  // minimum scaling factor\n            const outSpeed = 2.0;  // shrink speed when zooming out\n            const outNorm = (1. - minScale) / Math.atan(outSpeed);\n            const maxScale = 15.0;  // maximum scaling factor\n            const inSpeed = 0.02;  // enlarge speed when zooming in\n            const zoomOffset = 0.3;  // offset zoom pivot\n            let zoom = camera.projectionMatrix.elements[0] + zoomOffset;  // zoom pivot\n            let scale = zoom < 1. ? 1. + outNorm * Math.atan(outSpeed * (zoom - 1.)) :\n                1. + 2. / PI * (maxScale - 1.) * Math.atan(inSpeed * (zoom - 1.));\n            outputPointSize = pointSize * scale;\n        }\n        let gl_PointSize = (outputPointSize * scaleFactor) / 4;\n        const pos = new Vector3();\n        let cameraSpacePos = new Vector4();\n        let object = spriteVisualizer.points;\n        let modelViewMatrix = object.modelViewMatrix.clone();\n        modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\n        const showFog = chartOptions.showFog;\n        const isSelectionEmpty = selection.size === 0;\n        let pointOrder;\n        if (is3d) {\n            pointOrder = new Uint32Array(npoints);\n            for (let i = 0; i < npoints; i++) {\n                pointOrder[i] = i;\n            }\n        } else {\n            const z = new Float32Array(npoints);\n            for (let i = 0; i < npoints; i++) {\n                z[i] = positions[i * 3 + 2];\n            }\n            pointOrder = indexSort(z, true);\n        }\n        for (let j = 0; j < npoints; j++) {\n            const index = pointOrder[j];\n            const positionIndex = index * 3;\n            const colorIndex = index * 4;\n            const isSelected = isSelectionEmpty || selection.has(index);\n            pos.x = positions[positionIndex];\n            pos.y = positions[positionIndex + 1];\n            pos.z = positions[positionIndex + 2];\n            pos.project(camera);\n\n            let r = colors[colorIndex];\n            let g = colors[colorIndex + 1];\n            let b = colors[colorIndex + 2];\n            let a = isSelected ? markerOpacity : unselectedMarkerOpacity;\n            if (is3d) {\n                cameraSpacePos.x = positions[positionIndex];\n                cameraSpacePos.y = positions[positionIndex + 1];\n                cameraSpacePos.z = positions[positionIndex + 2];\n                cameraSpacePos.w = 1;\n                cameraSpacePos.applyMatrix4(modelViewMatrix);\n                outputPointSize = -pointSize / cameraSpacePos.z;\n                gl_PointSize = (outputPointSize * scaleFactor) / 4;\n                if (showFog) {\n                    const fogDepth = pointSize / outputPointSize * 1.2;\n                    const fogFactor = smoothstep(fog.near, fog.far, fogDepth);\n                    r = mix(r, fog.color.r, fogFactor);\n                    g = mix(g, fog.color.g, fogFactor);\n                    b = mix(b, fog.color.b, fogFactor);\n                }\n            }\n            pos.x = (pos.x * widthHalf) + widthHalf;\n            pos.y = -(pos.y * heightHalf) + heightHalf;\n\n            r = Math.round(colorScale(r));\n            g = Math.round(colorScale(g));\n            b = Math.round(colorScale(b));\n\n            context.fillStyle = 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n            context.beginPath();\n            context.arc(pos.x, pos.y, gl_PointSize, 0, PI2);\n            context.closePath();\n            context.fill();\n        }\n        if (showLabels) {\n            const labelsPositions = getCategoryLabelsPositions(traceInfo, categoricalNames);\n            let font = format === 'svg' ? 'serif' : 'Roboto Condensed';\n            context.font = 'bold ' + chartOptions.labelFontSize + 'px ' + font;\n            drawLabels(context, labelsPositions, chartOptions, chartSize, camera);\n        }\n    }\n\n    // onCopyImage = (event) => {\n    //     const size = this.chartSize;\n    //     const canvas = document.createElement('canvas');\n    //     canvas.width = size.width; // * window.devicePixelRatio;\n    //     canvas.height = size.height; // * window.devicePixelRatio;\n    //     const context = canvas.getContext('2d');\n    //     this.drawContext(context, this.chartSize);\n    //     const url = canvas.toDataURL();\n    //     setClipboardData([{\n    //         format: 'image/png',\n    //         data: '<img src=\"' + url + '\">'\n    //     }]);\n    // };\n\n\n    onSaveImage = (format) => {\n        const {traceInfo, chartSize} = this.props;\n        saveImage(traceInfo, chartSize, bind(this.drawContext, this), format);\n    };\n\n\n    onEditSelection = () => {\n        this.props.chartOptions.editSelection = !this.props.chartOptions.editSelection;\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n\n    resetCamera = () => {\n        this.scatterPlot.resetZoom();\n    };\n\n    onShowLabels = () => {\n        this.props.chartOptions.showLabels = !this.props.chartOptions.showLabels;\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n\n    onShowAxis = () => {\n        const axes = this.scatterPlot.scene.getObjectByName('axes');\n        this.props.chartOptions.showAxis = !this.props.chartOptions.showAxis;\n        if (axes) {\n            axes.visible = this.props.chartOptions.showAxis;\n        }\n\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n    onShowFog = () => {\n        let spriteVisualizer = getVisualizer(this.scatterPlot, POINT_VISUALIZER_ID);\n        this.props.chartOptions.showFog = !this.props.chartOptions.showFog;\n        spriteVisualizer.styles.fog.enabled = this.props.chartOptions.showFog;\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n\n    onDragMode = (mode) => {\n\n        if (mode === 'pan') {\n            this.scatterPlot.setInteractionMode('PAN');\n        } else if (mode === 'select') {\n            this.scatterPlot.setInteractionMode('SELECT');\n            this.scatterPlot.rectangleSelector.setSelectionMode('BOX');\n        } else if (mode === 'lasso') {\n            this.scatterPlot.rectangleSelector.setSelectionMode('LASSO');\n            this.scatterPlot.setInteractionMode('SELECT');\n        }\n        this.props.chartOptions.dragmode = mode;\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n    onToggleAnimation = () => {\n        if (this.scatterPlot.orbitIsAnimating()) {\n            this.scatterPlot.stopOrbitAnimation();\n            this.props.chartOptions.animating = false;\n        } else {\n            this.scatterPlot.startOrbitAnimation();\n            this.props.chartOptions.animating = true;\n        }\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n\n    init() {\n        if (this.scatterPlot == null) {\n            const containerElement = this.containerElementRef.current;\n            this.scatterPlot = createScatterPlot(containerElement, window.ApplePaySession, true);\n            if (this.props.chartOptions.dragmode === 'pan') {\n                this.scatterPlot.setInteractionMode('PAN');\n            } else if (this.props.chartOptions.dragmode === 'select') {\n                this.scatterPlot.setInteractionMode('SELECT');\n                this.scatterPlot.rectangleSelector.setSelectionMode('BOX');\n            } else if (this.props.chartOptions.dragmode === 'lasso') {\n                this.scatterPlot.setInteractionMode('SELECT');\n                this.scatterPlot.rectangleSelector.setSelectionMode('LASSO');\n\n            }\n            const axes = this.scatterPlot.scene.getObjectByName('axes');\n            if (axes) {\n                axes.visible = this.props.chartOptions.showAxis;\n            }\n            let spriteVisualizer = getVisualizer(this.scatterPlot, POINT_VISUALIZER_ID);\n            spriteVisualizer.styles.fog.enabled = this.props.chartOptions.showFog;\n            this.scatterPlot.hoverCallback = (point) => {\n                if (point == null) {\n                    this.tooltipElementRef.current.innerHTML = ' ';\n                } else {\n                    const traceInfo = this.props.traceInfo;\n                    const positions = traceInfo.positions;\n                    const camera = this.scatterPlot.camera;\n                    const widthHalf = this.props.chartSize.width / 2;\n                    const heightHalf = this.props.chartSize.height / 2;\n                    const pos = new Vector3();\n                    let selectedIndex = -1;\n                    const tolerance = 2;\n                    if (this.lastHoverIndex !== -1) {\n                        pos.x = positions[this.lastHoverIndex * 3];\n                        pos.y = positions[this.lastHoverIndex * 3 + 1];\n                        pos.z = positions[this.lastHoverIndex * 3 + 2];\n                        pos.project(camera);\n                        pos.x = (pos.x * widthHalf) + widthHalf;\n                        pos.y = -(pos.y * heightHalf) + heightHalf;\n                        if (Math.abs(pos.x - point.x) <= tolerance && Math.abs(pos.y - point.y) <= tolerance) {\n                            selectedIndex = this.lastHoverIndex;\n                        }\n                    }\n\n                    if (selectedIndex === -1) {\n                        for (let i = 0, j = 0, k = 0; i < traceInfo.npoints; i++, j += 4, k += 3) {\n                            pos.x = positions[k];\n                            pos.y = positions[k + 1];\n                            pos.z = positions[k + 2];\n                            pos.project(camera);\n                            pos.x = (pos.x * widthHalf) + widthHalf;\n                            pos.y = -(pos.y * heightHalf) + heightHalf;\n                            if (Math.abs(pos.x - point.x) <= tolerance && Math.abs(pos.y - point.y) <= tolerance) {\n                                selectedIndex = i;\n                                break;\n                            }\n                        }\n                    }\n                    this.lastHoverIndex = selectedIndex;\n                    if (selectedIndex !== -1) {\n                        let value = traceInfo.values[selectedIndex];\n                        let categoryObject = this.props.categoricalNames[traceInfo.name];\n                        if (categoryObject) {\n                            let renamedValue = categoryObject[value];\n                            if (renamedValue != null) {\n                                value = renamedValue;\n                            }\n                        }\n\n                        if (typeof value === 'number') {\n                            value = numberFormat(value);\n                        }\n                        this.tooltipElementRef.current.innerHTML = '' + value;\n                    } else {\n                        this.tooltipElementRef.current.innerHTML = ' ';\n                    }\n\n                }\n\n            };\n            this.scatterPlot.lassoCallback = (points) => {\n                const traceInfo = this.props.traceInfo;\n                const positions = traceInfo.positions;\n                const camera = this.scatterPlot.camera;\n                const widthHalf = this.props.chartSize.width / 2;\n                const heightHalf = this.props.chartSize.height / 2;\n                const pos = new Vector3();\n                const selectedIndices = [];\n\n                for (let i = 0, j = 0, k = 0; i < traceInfo.npoints; i++, j += 4, k += 3) {\n                    pos.x = positions[k];\n                    pos.y = positions[k + 1];\n                    pos.z = positions[k + 2];\n                    pos.project(camera);\n                    pos.x = (pos.x * widthHalf) + widthHalf;\n                    pos.y = -(pos.y * heightHalf) + heightHalf;\n                    if (isPointInside(pos, points)) {\n                        selectedIndices.push(i);\n                    }\n                }\n\n                if (selectedIndices.length === 0) {\n                    this.props.onDeselect({name: getEmbeddingKey(traceInfo.embedding)});\n                } else {\n                    this.props.onSelected({\n                        name: getEmbeddingKey(traceInfo.embedding),\n                        clear: !this.props.chartOptions.editSelection,\n                        value: {basis: traceInfo.embedding, points: selectedIndices}\n                    });\n                }\n            };\n            this.scatterPlot.boxCallback = (rect) => {\n                if (this.scatterPlot.interactionMode === 'PAN') {\n                    return;\n                }\n                const traceInfo = this.props.traceInfo;\n                const positions = traceInfo.positions;\n                const camera = this.scatterPlot.camera;\n                const widthHalf = this.props.chartSize.width / 2;\n                const heightHalf = this.props.chartSize.height / 2;\n                const pos = new Vector3();\n                const selectedPoints = [];\n\n                for (let i = 0, j = 0, k = 0; i < traceInfo.npoints; i++, j += 4, k += 3) {\n                    pos.x = positions[k];\n                    pos.y = positions[k + 1];\n                    pos.z = positions[k + 2];\n                    pos.project(camera);\n                    pos.x = (pos.x * widthHalf) + widthHalf;\n                    pos.y = -(pos.y * heightHalf) + heightHalf;\n                    if (pos.x >= rect.x && pos.x <= (rect.x + rect.width) && pos.y >= rect.y && pos.y <= (rect.y + rect.height)) {\n                        selectedPoints.push(i);\n                    }\n                }\n\n                if (selectedPoints.length === 0) {\n                    this.props.onDeselect({name: getEmbeddingKey(traceInfo.embedding)});\n                } else {\n                    this.props.onSelected({\n                        name: getEmbeddingKey(traceInfo.embedding),\n                        clear: !this.props.chartOptions.editSelection,\n                        value: {basis: traceInfo.embedding, points: selectedPoints}\n                    });\n                }\n            };\n            const canvas = this.containerElementRef.current.querySelector('canvas');\n            canvas.style.outline = '0px';\n            const webglcontextlost = (e) => {\n                e.preventDefault();\n                this.scatterPlot = null;\n            };\n            const webglcontextrestored = (e) => {\n                this.setState({forceUpdate: !this.state.forceUpdate});\n            };\n            canvas.addEventListener('webglcontextlost', webglcontextlost);\n            canvas.addEventListener('webglcontextrestored', webglcontextrestored);\n        }\n\n    }\n\n\n    draw() {\n        const {traceInfo, markerOpacity, unselectedMarkerOpacity, selection, pointSize, chartOptions, categoricalNames} = this.props;\n        updateScatterChart(this.scatterPlot, traceInfo, selection, markerOpacity, unselectedMarkerOpacity, pointSize,\n            categoricalNames, chartOptions);\n    }\n\n\n    render() {\n        return <React.Fragment>\n            <div className={this.props.classes.root}>\n                <ChartToolbar\n                    dragmode={this.props.chartOptions.dragmode}\n                    editSelection={this.props.chartOptions.editSelection}\n                    showLabels={this.props.chartOptions.showLabels}\n                    onMoreOptions={this.props.onMoreOptions}\n                    onGallery={this.props.onGallery}\n                    animating={this.props.chartOptions.animating}\n                    showFog={this.props.chartOptions.showFog}\n                    onShowFog={this.onShowFog}\n                    is3d={this.props.traceInfo && this.props.traceInfo.z != null}\n                    toggleAnimation={this.onToggleAnimation}\n                    onSaveImage={this.onSaveImage}\n                    onShowLabels={this.onShowLabels}\n                    onDragMode={this.onDragMode}\n                    onCopyImage={this.onCopyImage}\n                    onEditSelection={this.onEditSelection}\n                    onShowAxis={this.onShowAxis}\n                    onHome={this.resetCamera}\n                    showAxis={this.props.chartOptions.showAxis}\n                >\n                </ChartToolbar>\n                <Typography color=\"textPrimary\" ref={this.tooltipElementRef} style={{\n                    display: 'inline-block',\n                    paddingLeft: 5,\n                    verticalAlign: 'top'\n                }}>&nbsp;</Typography>\n            </div>\n\n            <div style={{\n                display: 'inline-block',\n                width: this.props.chartSize.width,\n                height: this.props.chartSize.height\n            }}\n                 ref={this.containerElementRef}>\n            </div>\n        </React.Fragment>;\n    }\n}\n\nexport default withStyles(styles)(ScatterChartThree);\n\n\n","import {scaleOrdinal, scaleSequential} from 'd3-scale';\nimport {schemeCategory10, schemePaired} from 'd3-scale-chromatic';\nimport {saveAs} from 'file-saver';\nimport {isEqual, uniqBy} from 'lodash';\nimport OpenSeadragon from 'openseadragon';\nimport isPlainObject from 'react-redux/lib/utils/isPlainObject';\nimport CustomError from '../CustomError';\nimport {JsonDataset} from '../JsonDataset';\nimport {RestDataset} from '../RestDataset';\nimport {RestServerApi} from '../RestServerApi';\n\n\nimport {getPositions} from '../ThreeUtil';\n\nimport {\n    addFeatureSetsToX,\n    CATEGORY_20B,\n    CATEGORY_20C,\n    convertBinsToIndices,\n    convertIndicesToBins,\n    getFeatureSets,\n    getInterpolator,\n    indexSort,\n    randomSeq,\n    splitSearchTokens,\n    updateTraceColors\n} from '../util';\n\n// export const API = 'http://localhost:5000/api';\nexport const API = 'api';\n\nconst authScopes = [\n    'email',\n    // 'profile',\n    // 'https://www.googleapis.com/auth/userinfo.profile',\n    // 'https://www.googleapis.com/auth/contacts.readonly',\n    // 'https://www.googleapis.com/auth/devstorage.full_control',\n];\nexport const SET_DOT_PLOT_INTERPOLATOR = 'SET_DOT_PLOT_INTERPOLATOR';\nexport const SET_CHART_OPTIONS = 'SET_CHART_OPTIONS';\nexport const SET_COMBINE_DATASET_FILTERS = 'SET_COMBINE_DATASET_FILTERS';\nexport const SET_DATASET_FILTERS = 'SET_DATASET_FILTERS'; // saved dataset filters\nexport const SET_UNSELECTED_MARKER_SIZE = 'SET_UNSELECTED_MARKER_SIZE';\n\nexport const SET_PRIMARY_TRACE_KEY = 'SET_PRIMARY_TRACE_KEY';\nexport const SET_CHART_SIZE = 'SET_CHART_SIZE';\nexport const SET_PRIMARY_CHART_SIZE = 'SET_PRIMARY_CHART_SIZE';\nexport const SET_SERVER_INFO = \"SET_SERVER_INFO\";\nexport const SET_DATASET_FILTER = 'SET_DATASET_FILTER';\nexport const ADD_DATASET = 'ADD_DATASET';\nexport const DELETE_DATASET = 'DELETE_DATASET';\nexport const UPDATE_DATASET = 'UPDATE_DATASET';\nexport const SET_GLOBAL_FEATURE_SUMMARY = 'SET_GLOBAL_FEATURE_SUMMARY';\nexport const SET_SAVED_DATASET_STATE = 'SET_SAVED_DATASET_STATE';\n\nexport const SET_DOMAIN = 'SET_DOMAIN';\nexport const SET_CATEGORICAL_COLOR = 'SET_CATEGORICAL_COLOR';\nexport const SET_CATEGORICAL_NAME = 'SET_CATEGORICAL_NAME';\nexport const SET_MARKER_SIZE = 'SET_MARKER_SIZE';\nexport const SET_MARKER_OPACITY = 'SET_MARKER_OPACITY';\n\nexport const SET_EMBEDDING_CHART_SIZE = \"SET_EMBEDDING_CHART_SIZE\";\n\nexport const SET_UNSELECTED_MARKER_OPACITY = 'SET_UNSELECTED_MARKER_OPACITY';\n\n// update chart\n\nexport const SET_SELECTION = 'SET_SELECTION';\nexport const SET_FEATURE_SUMMARY = 'SET_FEATURE_SUMMARY';\nexport const SET_SAVED_DATASET_FILTER = 'SET_SAVED_DATASET_FILTER';\nexport const SET_SEARCH_TOKENS = 'SET_SEARCH_TOKENS';\n\nexport const SET_SELECTED_EMBEDDING = 'SET_SELECTED_EMBEDDING';\nexport const SET_NUMBER_OF_BINS = 'SET_NUMBER_OF_BINS';\nexport const SET_BIN_VALUES = 'SET_BIN_VALUES';\nexport const SET_BIN_SUMMARY = 'SET_BIN_SUMMARY';\nexport const SET_MESSAGE = 'SET_MESSAGE';\nexport const SET_INTERPOLATOR = 'SET_INTERPOLATOR';\nexport const SET_POINT_SIZE = 'SET_POINT_SIZE';\n\n// update ui\nexport const SET_EMAIL = 'SET_EMAIL';\nexport const SET_USER = 'SET_USER';\nexport const SET_DATASET = 'SET_DATASET';\nexport const SET_MARKERS = 'SET_MARKERS';\nexport const SET_DIALOG = 'SET_DIALOG';\n\nexport const MORE_OPTIONS_DIALOG = 'MORE_OPTIONS_DIALOG';\nexport const EDIT_DATASET_DIALOG = 'EDIT_DATASET_DIALOG';\nexport const IMPORT_DATASET_DIALOG = 'IMPORT_DATASET_DIALOG';\nexport const SAVE_DATASET_FILTER_DIALOG = 'SAVE_DATASET_FILTER_DIALOG';\nexport const SAVE_FEATURE_SET_DIALOG = 'SAVE_FEATURE_SET_DIALOG';\nexport const HELP_DIALOG = 'HELP_DIALOG';\nexport const DELETE_DATASET_DIALOG = 'DELETE_DATASET_DIALOG';\n\nexport const SET_DATASET_CHOICES = 'SET_DATASET_CHOICES';\nexport const RESTORE_VIEW = 'RESTORE_VIEW';\n\nexport const SET_DOT_PLOT_DATA = 'SET_DOT_PLOT_DATA';\nexport const SET_SELECTED_DOT_PLOT_DATA = 'SET_SELECTED_DOT_PLOT_DATA';\n\nexport const SET_DOT_PLOT_SORT_ORDER = 'SET_DOT_PLOT_SORT_ORDER';\nexport const SET_EMBEDDING_DATA = 'SET_EMBEDDING_DATA';\n\nexport const SET_LOADING = 'SET_LOADING';\nexport const SET_TAB = 'SET_TAB';\n\nexport const SET_LOADING_APP = 'LOADING_APP';\nexport const SET_CACHED_DATA = 'SET_CACHED_DATA';\n\n\nfunction isEmbeddingBinned(embedding) {\n    return embedding.bin || embedding.precomputed;\n}\n\nexport function getEmbeddingKey(embedding) {\n    let fullName = embedding.name + '_' + embedding.dimensions;\n    if (embedding.bin || embedding.precomputed) {\n        fullName = fullName + '_' + embedding.nbins + '_' + embedding.agg;\n    }\n    return fullName;\n}\n\nexport function getTraceKey(traceInfo) {\n    return traceInfo.name + '_' + getEmbeddingKey(traceInfo.embedding);\n}\n\nfunction getEmbeddingJson(embedding) {\n    let value = {basis: embedding.name, ndim: embedding.dimensions};\n    if (embedding.precomputed) {\n        value.precomputed = true;\n    }\n    if (embedding.bin) {\n        value.nbins = embedding.nbins;\n        value.agg = embedding.agg;\n    }\n\n    return value;\n}\n\n\nfunction getUser() {\n    return function (dispatch, getState) {\n        getState().serverInfo.api.getUserPromise().then(user => dispatch(setUser(user)));\n    };\n}\n\nexport function initGapi() {\n    return function (dispatch, getState) {\n        dispatch(_setLoadingApp({loading: true, progress: 0}));\n        const startTime = new Date().getTime();\n        const approximateColdBootTime = 32;\n\n        function loadingAppProgress() {\n            if (getState().loadingApp.loading) {\n                let elapsed = (new Date().getTime() - startTime) / 1000;\n                let p = Math.min(100, 100 * (elapsed / approximateColdBootTime));\n                dispatch(_setLoadingApp({loading: true, progress: p}));\n                if (p < 100) {\n                    window.setTimeout(loadingAppProgress, 300);\n                }\n            }\n        }\n\n        window.setTimeout(loadingAppProgress, 500);\n\n        return fetch(API + '/server').then(result => result.json()).then(serverInfo => {\n            serverInfo.api = new RestServerApi();\n            if (serverInfo.clientId == null) {\n                serverInfo.clientId = '';\n            }\n            if (serverInfo.fancy == null) {\n                serverInfo.fancy = true;\n            }\n            dispatch(setServerInfo(serverInfo));\n            if (serverInfo.clientId === '') { // no login required\n\n\n                dispatch(_setLoadingApp({loading: false}));\n                dispatch(_setEmail(serverInfo.mode === 'server' ? '' : null));\n                if (serverInfo.mode === 'server') {\n                    dispatch(setUser({importer: true}));\n                }\n                dispatch(listDatasets()).then(() => {\n                    dispatch(_loadSavedView());\n                });\n\n\n            } else {\n                console.log((new Date().getTime() - startTime) / 1000 + \" startup time\");\n                let script = document.createElement('script');\n                script.type = 'text/javascript';\n                script.src = 'https://apis.google.com/js/api.js';\n                script.onload = (e) => {\n                    window.gapi.load('client:auth2', () => {\n                        window.gapi.client.init({\n                            clientId: serverInfo.clientId,\n                            scope: authScopes.join(' '),\n                        }).then(() => {\n                            dispatch(_setLoadingApp({loading: false, progress: 0}));\n                            dispatch(initLogin(true));\n                        });\n                    });\n                };\n                document.getElementsByTagName('head')[0].appendChild(script);\n            }\n        }).catch(err => {\n            console.log(err);\n            dispatch(_setLoadingApp({loading: false, progress: 0}));\n            handleError(dispatch, 'Unable to load app. Please try again.');\n        });\n    };\n}\n\nexport function logout() {\n    return function (dispatch, getState) {\n        window.gapi.auth2.getAuthInstance().signOut().then(() => {\n            dispatch({type: SET_EMAIL, payload: null});\n            dispatch(_setDataset(null));\n        });\n    };\n}\n\nexport function login() {\n    return function (dispatch, getState) {\n        window.gapi.auth2.getAuthInstance().signIn().then(e => {\n            dispatch(initLogin());\n        });\n    };\n}\n\nexport function openDatasetFilter(filterId) {\n    return function (dispatch, getState) {\n\n        dispatch(_setLoading(true));\n\n        getState().serverInfo.api.getDatasetFilterPromise(filterId, getState().dataset.id)\n            .then(result => {\n                result.id = filterId;\n                let filterValue = JSON.parse(result.value);\n                let datasetFilter = {};\n\n                filterValue.filters.forEach(item => {\n                    let filterOperation = item[1];\n                    let field = item[0];\n                    let slashIndex = field.indexOf('/');\n                    if (slashIndex !== -1) {\n                        field = field.substring(slashIndex + 1);\n                    }\n                    if (filterOperation === 'in') {\n                        datasetFilter[field] = item[2];\n                    } else {\n                        datasetFilter[field] = {operation: item[1], value: item[2]};\n                    }\n                });\n                dispatch(setDatasetFilter(datasetFilter));\n                dispatch(handleFilterUpdated());\n\n\n            }).finally(() => {\n            dispatch(_setLoading(false));\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to retrieve filter. Please try again.');\n        });\n    };\n}\n\nexport function deleteDatasetFilter(filterId) {\n    return function (dispatch, getState) {\n        dispatch(_setLoading(true));\n        getState().serverInfo.api.deleteDatasetFilterPromise(filterId, getState().dataset.id)\n            .then(() => {\n                let datasetFilters = getState().datasetFilters;\n                for (let i = 0; i < datasetFilters.length; i++) {\n                    if (datasetFilters[i].id === filterId) {\n                        datasetFilters.splice(i, 1);\n                        break;\n                    }\n                }\n\n                dispatch(setDatasetFilters(datasetFilters.slice()));\n                dispatch(setMessage('Filter deleted'));\n\n            }).finally(() => {\n            dispatch(_setLoading(false));\n            dispatch(setDialog(null));\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to delete filter. Please try again.');\n        });\n    };\n}\n\nexport function deleteFeatureSet(id) {\n    return function (dispatch, getState) {\n        dispatch(_setLoading(true));\n        getState().serverInfo.api.deleteFeatureSet(id, getState().dataset.id)\n            .then(result => {\n\n                let markers = getState().markers;\n                for (let i = 0; i < markers.length; i++) {\n                    if (markers[i].id === id) {\n                        markers.splice(i, 1);\n                        // remove from searchTokens\n                        break;\n                    }\n                }\n                dispatch(setMarkers(markers.slice()));\n                dispatch(setMessage('Set deleted'));\n            }).finally(() => {\n            dispatch(_setLoading(false));\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to delete set. Please try again.');\n        });\n    };\n}\n\nexport function saveFeatureSet(payload) {\n    return function (dispatch, getState) {\n        const state = getState();\n        const searchTokens = state.searchTokens;\n        const splitTokens = splitSearchTokens(searchTokens);\n        let features = splitTokens.X;\n        const requestBody = {\n            ds_id: state.dataset.id,\n            name: payload.name,\n            features: features,\n            category: payload.category\n        };\n\n        dispatch(_setLoading(true));\n        getState().serverInfo.api.upsertFeatureSet(requestBody, false)\n            .then(result => {\n\n                let markers = getState().markers;\n                markers.push({\n                    category: payload.category,\n                    name: payload.name,\n                    features: features,\n                    id: result.id\n                });\n                dispatch(setMarkers(markers.slice()));\n                dispatch(setMessage('Set saved'));\n            }).finally(() => {\n            dispatch(_setLoading(false));\n            dispatch(setDialog(null));\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to save set. Please try again.');\n        });\n    };\n}\n\nexport function saveDatasetFilter(payload) {\n    return function (dispatch, getState) {\n        const state = getState();\n        let filterValue = getFilterJson(state, true);\n\n        let requestBody = {ds_id: state.dataset.id};\n        if (payload.filterId != null) {\n            requestBody.id = payload.filterId;\n        }\n        let savedDatasetFilter = {};\n\n        let sendRequest = false;\n        if (payload.name !== savedDatasetFilter.name) {\n            requestBody.name = payload.name;\n            sendRequest = true;\n        }\n        if (payload.notes !== savedDatasetFilter.notes) {\n            requestBody.notes = payload.notes;\n            sendRequest = true;\n        }\n        if (!isEqual(filterValue, savedDatasetFilter.value)) {\n            requestBody.value = filterValue;\n            sendRequest = true;\n        }\n        if (!sendRequest) {\n            dispatch(setDialog(null));\n            return;\n        }\n        for (let key in requestBody) {\n            savedDatasetFilter[key] = requestBody[key];\n        }\n        dispatch(_setLoading(true));\n        getState().serverInfo.api.upsertDatasetFilterPromise(requestBody, payload.filterId != null)\n            .then(result => {\n                requestBody.id = result.id;\n                let datasetFilters = getState().datasetFilters;\n                if (payload.filterId != null) {\n                    for (let i = 0; i < datasetFilters.length; i++) {\n                        if (datasetFilters[i].id === result.id) {\n                            datasetFilters[i] = requestBody;\n                            break;\n                        }\n                    }\n                } else {\n                    datasetFilters.push(requestBody);\n                }\n                dispatch(setDatasetFilters(datasetFilters.slice()));\n                dispatch(setMessage('Filter saved'));\n            }).finally(() => {\n            dispatch(_setLoading(false));\n            dispatch(setDialog(null));\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to save filter. Please try again.');\n        });\n    };\n}\n\nexport function removeDatasetFilter(filterKey) {\n    return function (dispatch, getState) {\n        if (filterKey == null) {\n            // clear all\n            dispatch(setDatasetFilter({}));\n        } else {\n            let datasetFilter = getState().datasetFilter;\n            if (filterKey === 'selection') {\n                for (let key in datasetFilter) {\n                    if (datasetFilter[key].basis != null) {\n                        delete datasetFilter[key];\n                    }\n                }\n            } else {\n                delete datasetFilter[filterKey];\n            }\n            dispatch(setDatasetFilter(Object.assign({}, datasetFilter)));\n        }\n        dispatch(handleFilterUpdated());\n    };\n}\n\nexport function getDatasetFilterArray(datasetFilter) {\n    let filters = [];\n    for (let key in datasetFilter) {\n        // basis, path for brush filter\n        const value = datasetFilter[key];\n        let f = null;\n        if (window.Array.isArray(value)) {\n            f = [key, 'in', value];\n        } else if (value.basis != null) {\n            let points = value.points;\n            if (points.length > 1) { // take \"or\"\n                let allPoints = new Set();\n                points.forEach(p => p.forEach(i => allPoints.add(i)));\n                points = Array.from(allPoints);\n            } else {\n                points = points[0];\n            }\n\n            f = [getEmbeddingJson(value.basis), 'in', {points: points}];\n        } else {\n            if (value.operation !== '' && !isNaN(value.value) && value.value != null) {\n                f = [key, value.operation, value.value];\n            }\n        }\n\n        if (f != null) {\n            filters.push(f);\n        }\n    }\n    return filters;\n}\n\n\nfunction getFilterJson(state) {\n    let filters = getDatasetFilterArray(state.datasetFilter);\n    if (filters.length > 0) {\n        const obs = state.dataset.obs;\n        const obsCat = state.dataset.obsCat;\n        for (let i = 0; i < filters.length; i++) {\n            // add obs/ prefix\n            if (obsCat.indexOf(filters[i][0]) !== -1 || obs.indexOf(filters[i][0]) !== -1) {\n                filters[i][0] = 'obs/' + filters[i][0];\n            }\n        }\n        return {filters: filters, combine: state.combineDatasetFilters};\n    }\n}\n\n\nexport function downloadSelectedIds() {\n    return function (dispatch, getState) {\n        dispatch(_setLoading(true));\n        let filter = getFilterJson(getState(), true);\n        getState().dataset.api.getSelectedIdsPromise({\n            filter: filter\n        }).then(result => {\n            const blob = new Blob([result.ids.join('\\n')], {type: \"text/plain;charset=utf-8\"});\n            saveAs(blob, \"selection.txt\");\n        }).finally(() => {\n            dispatch(_setLoading(false));\n        }).catch(err => {\n            handleError(dispatch, err);\n        });\n    };\n}\n\nexport function exportDatasetFilters() {\n    return function (dispatch, getState) {\n        dispatch(_setLoading(true));\n        getState().serverInfo.api.exportDatasetFiltersPromise(getState().dataset.id).then(result => {\n            if (result == null) {\n                handleError(dispatch, 'Unable to export filters');\n                return;\n            }\n            const blob = new Blob([result], {type: \"text/plain;charset=utf-8\"});\n            saveAs(blob, \"filters.csv\");\n        }).finally(() => {\n            dispatch(_setLoading(false));\n        }).catch(err => {\n            handleError(dispatch, err);\n        });\n    };\n}\n\n\nexport function setDotPlotSortOrder(payload) {\n    return {type: SET_DOT_PLOT_SORT_ORDER, payload: payload};\n}\n\nexport function setChartOptions(payload) {\n    return {type: SET_CHART_OPTIONS, payload: payload};\n}\n\n\nfunction _setCombineDatasetFilters(payload) {\n    return {type: SET_COMBINE_DATASET_FILTERS, payload: payload};\n}\n\nexport function setCombineDatasetFilters(payload) {\n    return function (dispatch, getState) {\n        dispatch(_setCombineDatasetFilters(payload));\n        dispatch(handleFilterUpdated());\n    };\n}\n\nexport function setChartSize(payload) {\n    return {type: SET_CHART_SIZE, payload: payload};\n}\n\n\nexport function setPrimaryChartSize(payload) {\n    return {type: SET_PRIMARY_CHART_SIZE, payload: payload};\n}\n\nexport function setPrimaryTraceKey(payload) {\n    return {type: SET_PRIMARY_TRACE_KEY, payload: payload};\n}\n\nfunction setGlobalFeatureSummary(payload) {\n    return {type: SET_GLOBAL_FEATURE_SUMMARY, payload: payload};\n}\n\nfunction setDatasetFilter(payload) {\n    return {type: SET_DATASET_FILTER, payload: payload};\n}\n\nfunction setSelection(payload) {\n    return {type: SET_SELECTION, payload: payload};\n}\n\nfunction setFeatureSummary(payload) {\n    return {type: SET_FEATURE_SUMMARY, payload: payload};\n}\n\n\nfunction handleFilterUpdated() {\n    return function (dispatch, getState) {\n        dispatch(_setLoading(true));\n        // whenever filter is updated, we need to get selection statistics\n        const state = getState();\n\n        const searchTokens = splitSearchTokens(state.searchTokens);\n        let filter = getFilterJson(state);\n        addFeatureSetsToX(getFeatureSets(state.markers, searchTokens.featureSets), searchTokens.X);\n\n        let q = {\n            selection: {\n                measures: searchTokens.X.concat(searchTokens.obs.map(item => 'obs/' + item)),\n                dimensions: searchTokens.obsCat\n            }\n        };\n\n        if (filter) {\n            q.selection.filter = filter;\n        }\n        const isCurrentSelectionEmpty = state.selection.chart == null || Object.keys(state.selection.chart).length === 0;\n\n        if (filter == null) {\n            state.dotPlotData.forEach(data => {\n                data.selection = null;\n            });\n            dispatch(_setDotPlotData(state.dotPlotData.slice()));\n            if (!isCurrentSelectionEmpty) {\n                dispatch(setSelection({chart: {}}));\n            }\n            dispatch(_setSelectedDotPlotData([]));\n            dispatch(setFeatureSummary({}));\n            dispatch(_setLoading(false));\n            return;\n        }\n        let selectedEmbeddings = state.embeddings;\n        q.selection.embeddings = selectedEmbeddings.map(e => {\n            return getEmbeddingJson(e);\n        });\n\n        getState().dataset.api.getDataPromise(q).then(result => {\n            dispatch(handleSelectionResult(result.selection, true));\n        }).catch(err => {\n            handleError(dispatch, err);\n        }).finally(() => dispatch(_setLoading(false)));\n    };\n}\n\n\nexport function handleBrushFilterUpdated(payload) {\n    return function (dispatch, getState) {\n        const name = payload.name; // full basis name\n        const value = payload.value;  // value has basis and points\n        const clear = payload.clear;\n        let datasetFilter = getState().datasetFilter;\n        if (value && isEmbeddingBinned(value.basis)) {\n            const bins = getState().cachedData[getEmbeddingKey(value.basis)].bins;\n            value.points = convertIndicesToBins(value.points, bins);\n        }\n        let update = true;\n        if (value == null) { // remove\n            update = datasetFilter[name] != null;\n            delete datasetFilter[name];\n        } else {\n            if (clear) {\n                datasetFilter[name] = {basis: value.basis, points: [value.points]};\n            } else {\n                const prior = datasetFilter[name];\n                if (prior != null) {\n                    datasetFilter[name].points.push(value.points);\n                } else {\n                    datasetFilter[name] = {basis: value.basis, points: [value.points]};\n                }\n            }\n        }\n        if (update) {\n            dispatch(setDatasetFilter(Object.assign({}, datasetFilter)));\n            dispatch(handleFilterUpdated());\n        }\n    };\n}\n\n\nexport function handleMeasureFilterUpdated(payload) {\n    return function (dispatch, getState) {\n        const name = payload.name;\n        const operation = payload.operation;\n        const value = payload.value;\n        let update = payload.update;\n\n        let datasetFilter = getState().datasetFilter;\n        let filter = datasetFilter[name];\n\n        if (filter == null) {\n            filter = {operation: '>', value: NaN};\n            datasetFilter[name] = filter;\n        }\n        if (update) {\n            if (value != null) {\n                update = (!isNaN(value) ? value !== filter.value : isNaN(value) !== isNaN(filter.value));\n            }\n            if (operation != null) {\n                update = update || (operation !== filter.operation && !isNaN(filter.value));\n            }\n        }\n        if (operation != null) {\n            filter.operation = operation;\n        }\n        if (value != null) {\n            filter.value = value;\n        }\n\n        dispatch(setDatasetFilter(Object.assign({}, datasetFilter)));\n        if (update) {\n            dispatch(handleFilterUpdated());\n        }\n    };\n}\n\nexport function handleColorChange(payload) {\n    return {type: SET_CATEGORICAL_COLOR, payload: payload};\n}\n\nexport function handleDomainChange(payload) {\n    return {type: SET_DOMAIN, payload: payload};\n}\n\nfunction _handleCategoricalNameChange(payload) {\n    return {type: SET_CATEGORICAL_NAME, payload: payload};\n\n}\n\nexport function handleCategoricalNameChange(payload) {\n    return function (dispatch, getState) {\n        const dataset_id = getState().dataset.id;\n        const p = getState().serverInfo.fancy ? getState().serverInfo.api.setCategoryNamePromise({\n            c: payload.name,\n            o: payload.oldValue,\n            n: payload.value,\n            id: dataset_id\n        }) : Promise.resolve();\n        p.then(() => dispatch(_handleCategoricalNameChange(payload)));\n    };\n}\n\nexport function handleDimensionFilterUpdated(payload) {\n    return function (dispatch, getState) {\n        let name = payload.name;\n        let value = payload.value;\n        let shiftKey = payload.shiftKey;\n        let metaKey = payload.metaKey;\n        let datasetFilter = getState().datasetFilter;\n        let embeddingData = getState().embeddingData;\n        let categories;\n        for (let i = 0; i < embeddingData.length; i++) {\n            if (embeddingData[i].name === name) {\n                categories = embeddingData[i].colorScale.domain();\n                break;\n            }\n        }\n        let selectedValues = datasetFilter[name];\n        if (selectedValues == null) {\n            selectedValues = [];\n            datasetFilter[name] = selectedValues;\n        }\n\n        if (shiftKey && selectedValues.length > 0) {\n            // add last click to current\n            let lastIndex = categories.indexOf(selectedValues[selectedValues.length - 1]);\n            let currentIndex = categories.indexOf(value);\n            // put clicked category at end of array\n            if (currentIndex > lastIndex) {\n                for (let i = lastIndex; i <= currentIndex; i++) {\n                    let index = selectedValues.indexOf(value);\n                    if (index !== -1) {\n                        selectedValues.splice(index, 1);\n                    }\n                    selectedValues.push(categories[i]);\n                }\n            } else {\n                for (let i = lastIndex; i >= currentIndex; i--) {\n                    let index = selectedValues.indexOf(value);\n                    if (index !== -1) {\n                        selectedValues.splice(index, 1);\n                    }\n                    selectedValues.push(categories[i]);\n                }\n            }\n        } else {\n            let selectedIndex = selectedValues.indexOf(value);\n            if (!metaKey) { // clear and toggle current\n                selectedValues = [];\n                datasetFilter[name] = selectedValues;\n            }\n            if (selectedIndex !== -1) { // exists, remove\n                selectedValues.splice(selectedIndex, 1);\n                if (selectedValues.length === 0) {\n                    delete datasetFilter[name];\n                }\n            } else {\n                selectedValues.push(value);\n            }\n        }\n        dispatch(setDatasetFilter(datasetFilter));\n        dispatch(handleFilterUpdated());\n    };\n}\n\n\nexport function restoreView(payload) {\n    return {type: RESTORE_VIEW, payload: payload};\n}\n\n\nexport function setPointSize(payload) {\n    return {type: SET_POINT_SIZE, payload: payload};\n}\n\nexport function setMarkerSize(payload) {\n    return {type: SET_MARKER_SIZE, payload: payload};\n}\n\n\nexport function setUser(payload) {\n    return {type: SET_USER, payload: payload};\n}\n\n\nexport function setServerInfo(payload) {\n    return {type: SET_SERVER_INFO, payload: payload};\n}\n\nfunction loadDefaultDatasetEmbedding() {\n    return function (dispatch, getState) {\n        const dataset = getState().dataset;\n        const embeddingNames = dataset.embeddings.map(e => e.name);\n        let priority = {'tissue_hires': 1, 'X_fle': 2, 'X_umap': 3, 'X_tsne': 4, 'X_fitsne': 5};\n\n        embeddingNames.sort((a, b) => {\n            a = priority[a] || Number.MAX_VALUE;\n            b = priority[b] || Number.MAX_VALUE;\n            return a - b;\n        });\n\n        if (embeddingNames.length > 0) {\n            dispatch(setSelectedEmbedding([dataset.embeddings[dataset.embeddings.map(e => e.name).indexOf(embeddingNames[0])]]));\n        }\n    };\n}\n\nfunction loadDefaultDataset() {\n    return function (dispatch, getState) {\n        if (getState().dataset == null && getState().datasetChoices.length === 1) {\n            dispatch(setDataset(getState().datasetChoices[0].id));\n        }\n    };\n}\n\nfunction restoreSavedView(savedView) {\n    return function (dispatch, getState) {\n        if (savedView.colorScheme != null) {\n            let interpolator = getInterpolator(savedView.colorScheme);\n            if (interpolator != null) {\n                savedView.colorScheme = {\n                    name: savedView.colorScheme,\n                    value: interpolator,\n                };\n            }\n        }\n\n        if (savedView.datasetFilter != null) {\n            for (let key in savedView.datasetFilter) {\n                let value = savedView.datasetFilter[key];\n                if (!window.Array.isArray(value)) {\n                    value.uiValue = value.value;\n                }\n            }\n        } else {\n            savedView.datasetFilter = {};\n        }\n\n        dispatch(_setLoading(true));\n        let datasetPromise;\n        if (savedView.dataset != null) {\n            datasetPromise = dispatch(setDataset(savedView.dataset, false, false));\n        } else {\n            datasetPromise = Promise.resolve();\n        }\n        datasetPromise\n            .then(() => {\n                let dataset = getState().dataset;\n                if (savedView.embeddings) {\n                    let names = dataset.embeddings.map(e => getEmbeddingKey(e));\n                    let embeddings = [];\n                    savedView.embeddings.forEach(embedding => {\n                        let index = names.indexOf(getEmbeddingKey(embedding));\n                        if (index !== -1) {\n                            embeddings.push(dataset.embeddings[index]);\n                        }\n                    });\n                    savedView.embeddings = embeddings;\n                    if (savedView.camera != null) {\n                        savedView.chartOptions.camera = savedView.camera;\n                    }\n                }\n            })\n            .then(() => dispatch(setDatasetFilter(savedView.datasetFilter)))\n            .then(() => dispatch(restoreView(savedView)))\n            .then(() => dispatch(_updateCharts()))\n            .then(() => dispatch(handleFilterUpdated()))\n            .then(() => {\n                if (savedView.sort != null) {\n                    for (let name in savedView.sort) {\n                        dispatch(setDotPlotSortOrder({name: name, value: savedView.sort[name]}));\n                    }\n                }\n\n            })\n            .finally(() => dispatch(_setLoading(false)))\n            .catch(err => {\n                console.log(err);\n                dispatch(setMessage('Unable to restore saved view.'));\n                dispatch(loadDefaultDataset());\n            });\n    };\n}\n\nfunction _loadSavedView() {\n    return function (dispatch, getState) {\n        let savedView = {dataset: null};\n        let q = window.location.search.substring(3);\n        if (q.length > 0) {\n            try {\n                savedView = JSON.parse(window.decodeURIComponent(q));\n            } catch (err) {\n                return dispatch(setMessage('Unable to restore saved view.'));\n            }\n        }\n\n        if (savedView.dataset != null) {\n            dispatch(restoreSavedView(savedView));\n        } else {\n            dispatch(loadDefaultDataset());\n        }\n    };\n}\n\nexport function initLogin(loadSavedView) {\n    return function (dispatch, getState) {\n        let isSignedIn = window.gapi.auth2.getAuthInstance().isSignedIn.get();\n        if (isSignedIn) {\n            let googleUser = window.gapi.auth2.getAuthInstance().currentUser.get();\n            let email = googleUser.getBasicProfile().getEmail();\n            dispatch(_setEmail(email));\n            dispatch(getUser());\n            dispatch(listDatasets()).then(() => {\n                if (loadSavedView) {\n                    dispatch(_loadSavedView());\n                }\n            });\n\n        }\n    };\n}\n\nexport function getAccessToken() {\n    return window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;\n}\n\nexport function getIdToken() {\n    return typeof window.gapi !== 'undefined' ? window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token : '';\n}\n\nexport function saveDataset(payload) {\n    return function (dispatch, getState) {\n\n        const name = payload.name;\n        const url = payload.url;\n\n        if (name === '' || url === '') {\n            return;\n        }\n        const readers = payload.readers;\n        const description = payload.description;\n        const title = payload.title;\n        // let bucket = url.substring('gs://'.length);\n        // let slash = bucket.indexOf('/');\n        // let object = encodeURIComponent(bucket.substring(slash + 1));\n        // bucket = encodeURIComponent(bucket.substring(0, slash));\n\n        dispatch(_setLoading(true));\n        const isEdit = payload.dataset != null;\n        const serverInfo = getState().serverInfo;\n        const updatePermissions = !isEdit || url !== payload.dataset.url;\n        // if (updatePermissions) {\n\n        // updateDatasetPermissionPromise = fetch(\n        //     'https://www.googleapis.com/storage/v1/b/' + bucket + '/o/' + object,\n        //     {\n        //         body: JSON.stringify({\n        //             'acl': [{\n        //                 'entity': 'user-' + serverEmail,\n        //                 'role': 'READER'\n        //             }]\n        //         }),\n        //         method: 'PATCH',\n        //         headers: {'Authorization': 'Bearer ' + getAccessToken(), 'Content-Type': 'application/json'},\n        //     });\n\n        // } else {\n        let updateDatasetPermissionPromise = Promise.resolve({ok: true});\n\n        // }\n        updateDatasetPermissionPromise.then(permissionsResponse => {\n\n            // if (!permissionsResponse.ok) {\n            //     dispatch(setMessage('Unable to set dataset read permissions. Please ensure that you are the dataset owner or manually add ' + serverEmail + ' as a reader.'));\n            // }\n        }).then(() => getState().serverInfo.api.upsertDatasetPromise(payload.dataset ? payload.dataset.id : null,\n            {\n                name: name,\n                readers: readers,\n                description: description,\n                title: title,\n                url: url\n            })).then(importDatasetResult => {\n            const dsUpdate = {\n                name: name,\n                id: importDatasetResult.id,\n                title: title,\n                url: url,\n                readers: readers,\n                description: description,\n                owner: true\n            };\n            if (isEdit) {\n                dispatch(updateDataset(dsUpdate));\n                dispatch(setMessage('Dataset updated'));\n            } else {\n                dispatch(_addDataset(dsUpdate));\n                if (serverInfo.email) {\n                    dispatch(setMessage(updatePermissions ? 'Please ensure that ' + serverInfo.email + ' is a \"Storage Object Viewer\"' : 'Dataset created'));\n                }\n            }\n\n        }).finally(() => {\n            dispatch(_setLoading(false));\n            dispatch(setDialog(null));\n        }).catch(err => {\n            handleError(dispatch, err);\n        });\n    };\n}\n\nexport function deleteDataset(payload) {\n    return function (dispatch, getState) {\n        dispatch(_setLoading(true));\n        getState().serverInfo.api.deleteDatasetPromise(payload.dataset.id).then(() => {\n            dispatch(_setDataset(null));\n            dispatch(_deleteDataset({id: payload.dataset.id}));\n            dispatch(setDialog(null));\n\n            dispatch(setMessage('Dataset deleted'));\n        }).finally(() => {\n            dispatch(_setLoading(false));\n            dispatch(setDialog(null));\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to delete dataset. Please try again.');\n        });\n    };\n}\n\nfunction _addDataset(payload) {\n    return {type: ADD_DATASET, payload: payload};\n}\n\nfunction _deleteDataset(payload) {\n    return {type: DELETE_DATASET, payload: payload};\n}\n\nexport function updateDataset(payload) {\n    return {type: UPDATE_DATASET, payload: payload};\n}\n\nexport function setMessage(payload) {\n    return {type: SET_MESSAGE, payload: payload};\n}\n\nexport function setInterpolator(payload) {\n    return {type: SET_INTERPOLATOR, payload: payload};\n}\n\nexport function setDotPlotInterpolator(payload) {\n    return {type: SET_DOT_PLOT_INTERPOLATOR, payload: payload};\n}\n\nexport function setEmbeddingData(payload) {\n    return {type: SET_EMBEDDING_DATA, payload: payload};\n}\n\nexport function setDialog(payload) {\n    return {type: SET_DIALOG, payload: payload};\n}\n\nexport function setMarkers(payload) {\n    return {type: SET_MARKERS, payload: payload};\n}\n\nfunction _setDatasetChoices(payload) {\n    return {type: SET_DATASET_CHOICES, payload: payload};\n}\n\n\nfunction _setLoading(payload) {\n    return {type: SET_LOADING, payload: payload};\n}\n\nexport function setTab(payload) {\n    return {type: SET_TAB, payload: payload};\n}\n\nfunction _setLoadingApp(payload) {\n    return {type: SET_LOADING_APP, payload: payload};\n}\n\nfunction _setDataset(payload) {\n    return {type: SET_DATASET, payload: payload};\n}\n\n\nexport function setMarkerOpacity(payload) {\n    return {type: SET_MARKER_OPACITY, payload: payload};\n}\n\nexport function setUnselectedMarkerOpacity(payload) {\n    return {type: SET_UNSELECTED_MARKER_OPACITY, payload: payload};\n}\n\n\nfunction _setDotPlotData(payload) {\n    return {type: SET_DOT_PLOT_DATA, payload: payload};\n}\n\nfunction _setSelectedDotPlotData(payload) {\n    return {type: SET_SELECTED_DOT_PLOT_DATA, payload: payload};\n}\n\n\nfunction _setEmail(payload) {\n    return {type: SET_EMAIL, payload: payload};\n}\n\n\n/**\n *\n * @param value\n * @param type one of X, obs, featureSet\n */\nexport function setSearchTokens(value, type) {\n    return function (dispatch, getState) {\n        const state = getState();\n        let searchTokens = state.searchTokens;\n        // keep all other types\n        let removeType = [type];\n        if (type === 'obs') {\n            removeType.push('obsCat');\n        }\n        searchTokens = searchTokens.filter(item => removeType.indexOf(item.type) === -1);\n        if (type === 'X' || type === 'featureSet') {\n            searchTokens = searchTokens.concat(value.map(item => {\n                return {value: item, type: type};\n            }));\n        } else if (type === 'obs') {\n            const obsCat = state.dataset.obsCat;\n            value.forEach(val => {\n                const type = obsCat.indexOf(val) !== -1 ? 'obsCat' : 'obs';\n                searchTokens.push({value: val, type: type});\n            });\n        }\n        dispatch({type: SET_SEARCH_TOKENS, payload: searchTokens.slice()});\n        dispatch(_updateCharts());\n    };\n}\n\n\nexport function setSelectedEmbedding(payload) {\n    return function (dispatch, getState) {\n        let prior = getState().embeddings;\n        dispatch({type: SET_SELECTED_EMBEDDING, payload: payload});\n        dispatch(_updateCharts(err => {\n            dispatch({type: SET_SELECTED_EMBEDDING, payload: prior});\n        }));\n    };\n}\n\n\nexport function setNumberOfBins(payload) {\n    return function (dispatch, getState) {\n        if (getState().numberOfBins !== payload) {\n            dispatch({type: SET_NUMBER_OF_BINS, payload: payload});\n        }\n    };\n}\n\nexport function setBinSummary(payload) {\n    return function (dispatch, getState) {\n        dispatch({type: SET_BIN_SUMMARY, payload: payload});\n\n    };\n}\n\nexport function setBinValues(payload) {\n    return {type: SET_BIN_VALUES, payload: payload};\n}\n\n\nexport function setSavedDatasetState(payload) {\n    return {type: SET_SAVED_DATASET_STATE, payload: payload};\n}\n\nfunction setDatasetFilters(payload) {\n    return {type: SET_DATASET_FILTERS, payload: payload};\n}\n\n\nexport function setDataset(id, loadDefaultView = true, setLoading = true) {\n    return function (dispatch, getState) {\n        if (setLoading) {\n            dispatch(_setLoading(true));\n        }\n        let savedDatasetState = getState().savedDatasetState[id];\n        const datasetChoices = getState().datasetChoices;\n        let selectedChoice = null; // has id, owner, name\n        for (let i = 0; i < datasetChoices.length; i++) {\n            if (datasetChoices[i].id === id) {\n                selectedChoice = datasetChoices[i];\n                break;\n            }\n        }\n        if (selectedChoice == null) {\n            dispatch(_setLoading(false));\n            dispatch(setMessage('Unable to find dataset'));\n            return Promise.reject('Unable to find dataset');\n        }\n        // force re-render selected dataset dropdown\n        let dataset = Object.assign({}, selectedChoice);\n        dataset.id = id;\n        dataset.embeddings = [];\n        dataset.features = [];\n        dataset.obs = [];\n        dataset.obsCat = [];\n        dispatch(_setDataset(dataset));\n        let categoryNameResults;\n        let datasetFilters = [];\n        let newDataset;\n\n        function onPromisesComplete() {\n            newDataset = Object.assign(dataset, newDataset);\n            if (newDataset.embeddings) {\n                for (let i = 0; i < newDataset.embeddings.length; i++) {\n                    if (newDataset.embeddings[i].nbins != null) {\n                        newDataset.embeddings[i].bin = true;\n                        newDataset.embeddings[i].precomputed = true;\n                    } else { // set default values\n                        newDataset.embeddings[i].nbins = 500;\n                        newDataset.embeddings[i]._nbins = 500;\n                        newDataset.embeddings[i].bin = false;\n                        newDataset.embeddings[i].agg = 'max';\n                    }\n                }\n            }\n            newDataset.api = dataset.api;\n            newDataset.features = newDataset.var;\n            newDataset.features.sort((a, b) => {\n                a = a.toLowerCase();\n                b = b.toLowerCase();\n                const aIsDigit = a[0] >= '0' && a[0] <= '9';\n                const bIsDigit = b[0] >= '0' && b[0] <= '9';\n                if (aIsDigit) {\n                    a = 'zzzzzz' + a;\n                }\n                if (bIsDigit) {\n                    b = 'zzzzzz' + b;\n                }\n                // put features that start with a number last\n                return (a < b ? -1 : (a === b ? 0 : 1));\n            });\n            newDataset.id = id;\n            dispatch(_setDataset(newDataset));\n\n            if (categoryNameResults != null) {\n                categoryNameResults.forEach(result => {\n                    dispatch(_handleCategoricalNameChange({\n                        name: result.category,\n                        oldValue: result.original,\n                        value: result.new\n                    }));\n                });\n            }\n            dispatch(setDatasetFilters(datasetFilters));\n            if (savedDatasetState) {\n                dispatch(restoreSavedView(savedDatasetState));\n            } else if (loadDefaultView) {\n                dispatch(loadDefaultDatasetEmbedding());\n            }\n        }\n\n        let url = dataset.url || '';\n        const isByteRangeDataset = url.startsWith(\"http\") || url.startsWith('//');\n        if (isByteRangeDataset) {\n            dataset.api = new JsonDataset();\n        } else {\n            dataset.api = new RestDataset();\n        }\n        const initPromise = dataset.api.init(id, dataset.url);\n\n        return initPromise.then(() => {\n            let promises = [];\n            if (!isByteRangeDataset) {\n                const categoriesRenamePromise = getState().serverInfo.api.getCategoryNamesPromise(dataset.id).then(results => {\n                    categoryNameResults = results;\n                });\n\n                const filtersPromise = getState().serverInfo.api.getFiltersPromise(dataset.id).then(results => {\n                    datasetFilters = results;\n                });\n                promises.push(categoriesRenamePromise);\n                promises.push(filtersPromise);\n            }\n            const schemaPromise = dataset.api.getSchemaPromise().then(result => {\n                newDataset = result;\n            });\n            promises.push(schemaPromise);\n            return promises;\n        }).then(promises => Promise.all(promises)).then(() => onPromisesComplete()).finally(() => {\n            if (setLoading) {\n                dispatch(_setLoading(false));\n            }\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to retrieve dataset. Please try again.');\n        });\n\n    };\n}\n\n\nfunction handleSelectionResult(selectionResult, clear) {\n    return function (dispatch, getState) {\n        const state = getState();\n        if (selectionResult) {\n            const coordinates = selectionResult.coordinates;\n            if (coordinates != null) {\n                let chartSelection = {};\n                for (let key in coordinates) {\n                    const selectedIndicesOrBins = coordinates[key].indices_or_bins;\n                    const embedding = state.embeddings[state.embeddings.map(e => getEmbeddingKey(e)).indexOf(key)];\n                    if (embedding == null) {\n                        console.log(key + ' missing');\n                        continue;\n                    }\n                    let selectedPoints = selectedIndicesOrBins;\n                    if (isEmbeddingBinned(embedding)) {\n                        const coords = state.cachedData[getEmbeddingKey(embedding)];\n                        const bins = coords.bins;\n                        selectedPoints = convertBinsToIndices(bins, selectedIndicesOrBins);\n                    }\n\n                    chartSelection[key] = {\n                        userPoints: new Set(selectedPoints),\n                        points: selectedIndicesOrBins\n                    };\n                }\n                dispatch(setSelection({\n                    count: selectionResult.count,\n                    chart: chartSelection\n                }));\n            } else {\n                const isCurrentSelectionEmpty = state.selection.chart == null || Object.keys(state.selection.chart).length === 0;\n                if (clear && !isCurrentSelectionEmpty) {\n                    dispatch(setSelection({count: selectionResult.count, chart: {}}));\n                }\n            }\n\n            // userPoints are in chart space, points are in server space, count is total number of cells selected\n            if (selectionResult.summary) {\n                // merge or clear selection\n                let selectionSummary = clear ? selectionResult.summary : Object.assign(getState().featureSummary, selectionResult.summary);\n                dispatch(setFeatureSummary(Object.assign({}, selectionSummary)));\n            }\n            if (selectionResult.dotplot) {\n                let selectedDotPlotData = state.selectedDotPlotData;\n                if (clear) {\n                    selectedDotPlotData = [];\n                }\n                const searchTokens = splitSearchTokens(state.searchTokens);\n                addFeatureSetsToX(getFeatureSets(state.markers, searchTokens.featureSets), searchTokens.X);\n                selectedDotPlotData = updateDotPlotData(selectionResult.dotplot, selectedDotPlotData, searchTokens);\n                dispatch(_setSelectedDotPlotData(selectedDotPlotData));\n            }\n\n        }\n    };\n}\n\nfunction updateDotPlotData(newDotplotData, dotPlotData, searchTokens) {\n    let categoryKeys = [searchTokens.obsCat.join('-')];\n    let dotPlotKeys = {}; // category-feature\n\n    categoryKeys.forEach(category => {\n        searchTokens.X.forEach(feature => {\n            if (feature !== '__count') {\n                let key = category + '-' + feature;\n                dotPlotKeys[key] = true;\n            }\n        });\n    });\n\n    // merge with existing data\n    if (newDotplotData) {\n        newDotplotData.forEach(categoryItem => {\n            let index = -1;\n            for (let i = 0; i < dotPlotData.length; i++) {\n                if (dotPlotData[i].name === categoryItem.name) {\n                    index = i;\n                    break;\n                }\n            }\n            if (index === -1) {\n                dotPlotData.push(categoryItem);\n            } else {\n                dotPlotData[index].values = categoryItem.values.concat(dotPlotData[index].values);\n                dotPlotData[index].values = uniqBy(dotPlotData[index].values, (value => value.name));\n                dotPlotData[index] = Object.assign({}, dotPlotData[index]);\n            }\n        });\n    }\n\n    // keep active categories only\n\n    dotPlotData = dotPlotData.filter(categoryItem => categoryKeys.indexOf(categoryItem.name) !== -1);\n    dotPlotData.forEach((categoryItem, categoryIndex) => {\n        const nfeatures = categoryItem.values.length;\n        categoryItem.values = categoryItem.values.filter(feature => dotPlotKeys[categoryItem.name + '-' + feature.name]);\n        if (nfeatures !== categoryItem.values.length) {\n            dotPlotData[categoryIndex] = Object.assign({}, categoryItem);\n        }\n    });\n    dotPlotData = dotPlotData.filter(categoryItem => categoryItem.values.length > 0);\n    // sort features\n    let featureSortOrder = {};\n    searchTokens.X.forEach((name, index) => {\n        featureSortOrder[name] = index;\n    });\n    dotPlotData.forEach((categoryItem) => {\n        categoryItem.values.sort((a, b) => {\n            a = featureSortOrder[a.name];\n            b = featureSortOrder[b.name];\n            return a - b;\n        });\n\n    });\n    return dotPlotData;\n}\n\nfunction _updateCharts(onError) {\n    return function (dispatch, getState) {\n        const state = getState();\n        if (state.dataset == null) {\n            return;\n        }\n        dispatch(_setLoading(true));\n\n        const searchTokens = splitSearchTokens(state.searchTokens);\n        addFeatureSetsToX(getFeatureSets(state.markers, searchTokens.featureSets), searchTokens.X);\n\n        let dotplot = (searchTokens.X.length > 0 || searchTokens.featureSets.length > 0) && searchTokens.obsCat.length > 0;\n        const selectionStats = state.featureSummary;\n        const embeddings = state.embeddings;\n        let dotPlotData = state.dotPlotData;\n        let selectedDotPlotData = state.selectedDotPlotData;\n        let embeddingData = state.embeddingData;\n        const globalFeatureSummary = state.globalFeatureSummary;\n        const cachedData = state.cachedData;\n        const embeddingCoordinatesToFetch = [];\n        const valuesToFetch = new Set();\n        const binnedEmbeddingValuesToFetch = [];\n        const embeddingKeys = new Set();\n        const features = new Set();\n        searchTokens.X.concat(searchTokens.obs).concat(searchTokens.obsCat).forEach(feature => {\n            features.add(feature);\n        });\n\n        embeddings.forEach(selectedEmbedding => {\n            const embeddingKey = getEmbeddingKey(selectedEmbedding);\n            embeddingKeys.add(embeddingKey);\n            if (cachedData[embeddingKey] == null) {\n                embeddingCoordinatesToFetch.push(selectedEmbedding);\n            }\n            if (isEmbeddingBinned(selectedEmbedding)) {\n                const data = {values: [], embedding: selectedEmbedding};\n                features.forEach(feature => {\n                    let key = feature + '_' + embeddingKey;\n                    if (cachedData[key] == null) {\n                        data.values.push(feature);\n                    }\n                });\n                if (data.values.length > 0) {\n                    binnedEmbeddingValuesToFetch.push(data);\n                }\n            } else {\n                features.forEach(feature => {\n                    if (cachedData[feature] == null) {\n                        valuesToFetch.add(feature);\n                    }\n                });\n            }\n        });\n\n        // set active flag on cached embedding data\n        embeddingData.forEach(traceInfo => {\n            const embeddingKey = getEmbeddingKey(traceInfo.embedding);\n            const active = embeddingKeys.has(embeddingKey) && (features.has(traceInfo.name) || (features.size === 0 && traceInfo.name === '__count'));\n            if (active) {\n                traceInfo.date = new Date();\n            }\n            traceInfo.active = active;\n        });\n\n        let dotplotMeasuresCacheMiss = new Set();\n        let dotPlotCategories = searchTokens.obsCat.slice();\n        let dotPlotCategoryKeys = [dotPlotCategories.join('-')];\n        let dotPlotKeys = {}; // category-feature\n        let selectedMeasuresCacheMiss = [];\n        if (dotplot) {\n            let cachedDotPlotKeys = {};\n            dotPlotData.forEach(dotPlotDataItem => {\n                dotPlotDataItem.values.forEach(datum => {\n                    cachedDotPlotKeys[dotPlotDataItem.name + '-' + datum.name] = true;\n                });\n            });\n            let cachedSelectedDotPlotMeasures = {};\n            selectedDotPlotData.forEach(dotPlotDataItem => {\n                dotPlotDataItem.values.forEach(datum => {\n                    cachedSelectedDotPlotMeasures[datum.name] = true;\n                });\n            });\n\n            searchTokens.X.forEach(feature => {\n                if (cachedSelectedDotPlotMeasures[feature] == null) {\n                    selectedMeasuresCacheMiss.push(feature);\n                }\n            });\n            searchTokens.obs.forEach(feature => {\n                if (selectionStats[feature] == null) {\n                    selectedMeasuresCacheMiss.push('obs/' + feature);\n                }\n            });\n            dotPlotCategoryKeys.forEach(category => {\n                let added = false;\n                searchTokens.X.forEach(feature => {\n\n                    let key = category + '-' + feature;\n                    dotPlotKeys[key] = true;\n                    if (cachedDotPlotKeys[key] == null) {\n                        dotplotMeasuresCacheMiss.add(feature);\n                        added = true;\n                    }\n\n                });\n            });\n        }\n        let q = {};\n        if (embeddingCoordinatesToFetch.length > 0 || binnedEmbeddingValuesToFetch.length > 0) {\n            q.embedding = [];\n            const embeddingCoordinatesToFetchKeys = embeddingCoordinatesToFetch.map(e => getEmbeddingKey(e));\n            binnedEmbeddingValuesToFetch.forEach(datum => {\n                const embeddingJson = getEmbeddingJson(datum.embedding);\n                embeddingJson.dimensions = [];\n                embeddingJson.measures = [];\n                embeddingJson.coords = embeddingCoordinatesToFetchKeys.indexOf(getEmbeddingKey(datum.embedding)) !== -1;\n                q.embedding.push(embeddingJson);\n                datum.values.forEach(value => {\n                    if (searchTokens.obsCat.indexOf(value) !== -1) {\n                        embeddingJson.dimensions.push(value);\n                    } else if (searchTokens.obs.indexOf(value) !== -1) {\n                        embeddingJson.measures.push('obs/' + value);\n                    } else {\n                        embeddingJson.measures.push(value);\n                    }\n                });\n            });\n            const binnedEmbeddingValuesToFetchKeys = binnedEmbeddingValuesToFetch.map(e => getEmbeddingKey(e.embedding));\n            embeddingCoordinatesToFetch.forEach(embedding => {\n                if (binnedEmbeddingValuesToFetchKeys.indexOf(getEmbeddingKey(embedding)) === -1) {\n                    const embeddingJson = getEmbeddingJson(embedding);\n                    embeddingJson.coords = true;\n                    q.embedding.push(embeddingJson);\n                }\n            });\n        }\n        if (valuesToFetch.size > 0) {\n            q.values = {measures: [], dimensions: []};\n            valuesToFetch.forEach(value => {\n                if (searchTokens.obsCat.indexOf(value) !== -1) {\n                    q.values.dimensions.push(value);\n                } else if (searchTokens.obs.indexOf(value) !== -1) {\n                    q.values.measures.push('obs/' + value);\n                } else {\n                    q.values.measures.push(value);\n                }\n            });\n        }\n\n        let globalFeatureSummaryXCacheMiss = [];\n        let globalFeatureSummaryObsContinuousCacheMiss = [];\n        let globalFeatureSummaryDimensionsCacheMiss = [];\n        searchTokens.X.forEach(feature => {\n            if (globalFeatureSummary[feature] == null) {\n                globalFeatureSummaryXCacheMiss.push(feature);\n            }\n        });\n        searchTokens.obs.forEach(feature => {\n            if (globalFeatureSummary[feature] == null) {\n                globalFeatureSummaryObsContinuousCacheMiss.push('obs/' + feature);\n            }\n        });\n        searchTokens.obsCat.forEach(feature => {\n            if (globalFeatureSummary[feature] == null) {\n                globalFeatureSummaryDimensionsCacheMiss.push(feature);\n            }\n        });\n\n\n        if (globalFeatureSummaryXCacheMiss.length > 0 || globalFeatureSummaryObsContinuousCacheMiss.length > 0 || globalFeatureSummaryDimensionsCacheMiss.length > 0) {\n            q.stats = {\n                measures: globalFeatureSummaryXCacheMiss.concat(globalFeatureSummaryObsContinuousCacheMiss),\n                dimensions: globalFeatureSummaryDimensionsCacheMiss\n            };\n        }\n\n        if (dotPlotCategories.length > 0 && dotplotMeasuresCacheMiss.size > 0) {\n            q.groupedStats = {\n                measures: Array.from(dotplotMeasuresCacheMiss),\n                dimensions: [dotPlotCategories]\n            };\n        }\n\n        const filterJson = getFilterJson(state);\n        // TODO update selection in new embedding space\n        if (filterJson != null && (globalFeatureSummaryXCacheMiss.length > 0 || globalFeatureSummaryDimensionsCacheMiss.length > 0 || selectedMeasuresCacheMiss.length > 0)) {\n            q.selection = {\n                filter: filterJson,\n                measures: globalFeatureSummaryDimensionsCacheMiss.length > 0 ? searchTokens.X : selectedMeasuresCacheMiss,\n                dimensions: searchTokens.obsCat\n            };\n        }\n        let dataPromise = Object.keys(q).length > 0 ? state.dataset.api.getDataPromise(q) : Promise.resolve({});\n        return dataPromise.then(result => {\n               if (result.embeddings != null) {\n                result.embeddings.forEach(embedding => {\n                    if (embedding.coordinates && Object.keys(embedding.coordinates).length>0) {\n                        cachedData[embedding.name] = embedding.coordinates;\n                    }\n                    if (embedding.values) { // binned values\n                        for (let feature in embedding.values) {\n                            cachedData[feature + '_' + embedding.name] = embedding.values[feature];\n                        }\n                    }\n                });\n            }\n            if (result.values) { // binned values\n                for (let feature in result.values) {\n                    cachedData[feature] = result.values[feature];\n                }\n            }\n\n\n            dispatch(_setDotPlotData(updateDotPlotData(result.dotplot, dotPlotData, searchTokens)));\n\n            const newSummary = result.summary || {};\n            for (let key in newSummary) {\n                globalFeatureSummary[key] = newSummary[key];\n            }\n            dispatch(setGlobalFeatureSummary(globalFeatureSummary));\n\n\n            updateEmbedingData(state, features);\n\n            if (state.chartOptions.activeEmbedding != null) { // when restoring view - put last so that it becomes active\n                let index = -1;\n                for (let i = 0; i < embeddingData.length; i++) {\n                    if (state.chartOptions.activeEmbedding === getTraceKey(embeddingData[i])) {\n                        index = i;\n                        break;\n                    }\n                }\n                if (index !== -1) {\n                    let activeTrace = embeddingData[index];\n                    embeddingData.splice(index, 1);\n                    embeddingData.push(activeTrace);\n                }\n                state.chartOptions.activeEmbedding = null;\n            }\n            dispatch(setEmbeddingData(embeddingData.slice()));\n            if (result.selection) {\n                dispatch(handleSelectionResult(result.selection));\n            } else {\n                dispatch(_setSelectedDotPlotData(updateDotPlotData(null, selectedDotPlotData, searchTokens)));\n            }\n        }).finally(() => {\n            dispatch(_setLoading(false));\n        }).catch(err => {\n            handleError(dispatch, err, 'Unable to retrieve data. Please try again.');\n            if (onError) {\n                onError(err);\n            }\n        });\n\n    };\n\n}\n\n// depends on global feature summary\nfunction updateEmbedingData(state, features) {\n    const embeddings = state.embeddings;\n    let embeddingData = state.embeddingData;\n    const obsCat = state.dataset.obsCat;\n    const globalFeatureSummary = state.globalFeatureSummary;\n    const interpolator = state.interpolator;\n    const dataset = state.dataset;\n    const cachedData = state.cachedData;\n    const existingKeys = new Set();\n    embeddingData.forEach(embeddingDatum => {\n        const embeddingKey = getEmbeddingKey(embeddingDatum.embedding);\n        const key = embeddingDatum.name + '_' + embeddingKey;\n        existingKeys.add(key);\n    });\n    if (features.size === 0) {\n        features.add('__count');\n    }\n    embeddings.forEach(embedding => {\n        const embeddingKey = getEmbeddingKey(embedding);\n        const isBinned = isEmbeddingBinned(embedding);\n        const coordinates = cachedData[embeddingKey];\n        const x = coordinates[embedding.name + '_1'];\n        const y = coordinates[embedding.name + '_2'];\n        const z = coordinates[embedding.name + '_3'];\n        const bins = isBinned ? coordinates.bins : null;\n        features.forEach(feature => {\n            let key = feature + '_' + embeddingKey;\n            let featureKey = feature;\n            if (!existingKeys.has(key)) {\n                const isSpatial = embedding.spatial != null;\n                if (isBinned) {\n                    featureKey = key;\n                }\n                let traceSummary = globalFeatureSummary[feature];\n                let values = cachedData[featureKey];\n                if (values == null && feature === '__count' && !isBinned) {\n                    values = new Float32Array(x.length);\n                    for (let i = 0, n = values.length; i < n; i++) {\n                        values[i] = 1;\n                    }\n                }\n                let purity = null;\n\n                if (values.value !== undefined) {\n                    purity = values.purity;\n                    values = values.value;\n                }\n\n                let isCategorical = feature !== '__count' && obsCat.indexOf(feature) !== -1;\n                let colorScale = null;\n\n                if (!isCategorical) {\n                    // __count range is per embedding so we always recompute for now\n                    if (isPlainObject(values)) {\n                        let newValues = new Float32Array(dataset.shape[0]);\n                        for (let i = 0, n = values.index.length; i < n; i++) {\n                            newValues[values.index[i]] = values.values[i];\n                        }\n                        values = newValues;\n                    }\n                    if (traceSummary == null || feature === '__count') {\n\n                        let min = Number.MAX_VALUE;\n                        let max = -Number.MAX_VALUE;\n                        for (let i = 0, n = values.length; i < n; i++) {\n                            let value = values[i];\n                            min = value < min ? value : min;\n                            max = value > max ? value : max;\n                        }\n                        traceSummary = {min: min, max: max};\n                        globalFeatureSummary[feature] = traceSummary;\n                    }\n                    let domain = [traceSummary.min, traceSummary.max];\n                    if (traceSummary.customMin != null && !isNaN(traceSummary.customMin)) {\n                        domain[0] = traceSummary.customMin;\n                    }\n                    if (traceSummary.customMax != null && !isNaN(traceSummary.customMax)) {\n                        domain[1] = traceSummary.customMax;\n                    }\n                    colorScale = scaleSequential(interpolator.value).domain(domain);\n\n                } else {\n                    let traceUniqueValues = traceSummary.categories;\n                    // if (traceUniqueValues.length === 1 && traceUniqueValues[0] === true) {\n                    //     traceUniqueValues = traceUniqueValues.concat([null]);\n                    //     traceSummary.categories = traceUniqueValues;\n                    //     traceSummary.counts = traceSummary.counts.concat([state.dataset.shape[0] - traceSummary.counts[0]]);\n                    // }\n\n                    let colors;\n                    if (traceUniqueValues.length <= 10) {\n                        colors = schemeCategory10;\n                    } else if (traceUniqueValues.length <= 12) {\n                        colors = schemePaired;\n                    } else if (traceUniqueValues.length <= 20) {\n                        colors = CATEGORY_20B;\n                    } else {\n                        colors = CATEGORY_20B.concat(CATEGORY_20C);\n                    }\n\n                    colorScale = scaleOrdinal(colors).domain(traceUniqueValues);\n                    colorScale.summary = traceSummary;\n                }\n\n\n                let chartData = {\n                    embedding: Object.assign({}, embedding),\n                    name: feature,\n                    x: x,\n                    y: y,\n                    z: z != null ? z : undefined,\n                    bins: bins,\n                    dimensions: z != null ? 3 : 2,\n                    npoints: values.length,\n                    date: new Date(),\n                    active: true,\n                    colorScale: colorScale,\n                    continuous: !isCategorical,\n                    isCategorical: isCategorical,\n                    values: values, // for color\n                    isImage: isSpatial\n                    // purity: purity,\n                    // text: values,\n                };\n                if (!isSpatial) {\n                    chartData.positions = getPositions(chartData);\n                }\n                updateTraceColors(chartData);\n\n                if (isSpatial) {\n                    chartData.indices = !isCategorical ? indexSort(chartData.values, true) : randomSeq(chartData.values.length);\n                    chartData.isImage = true;\n                    const url = dataset.api.getFileUrl(embedding.spatial.image);\n                    let tileSource = new OpenSeadragon.ImageTileSource({\n                        url: url,\n                        buildPyramid: true,\n                        crossOriginPolicy: \"Anonymous\"\n                    });\n                    chartData.tileSource = tileSource;\n                }\n                embeddingData.push(chartData);\n            }\n        });\n    });\n\n}\n\nfunction handleError(dispatch, err, message) {\n    console.log(err);\n    if (err.status === 401) {\n        dispatch(setMessage('Your session has expired. Please login again.'));\n        return dispatch(logout());\n    }\n    if (message == null) {\n        message = err instanceof CustomError ? err.message : 'An unexpected error occurred. Please try again.';\n    }\n    dispatch(setMessage(new Error(message)));\n}\n\nexport function listDatasets() {\n    return function (dispatch, getState) {\n        dispatch(_setLoading(true));\n        return getState().serverInfo.api.getDatasetsPromise()\n            .then(choices => {\n                dispatch(_setDatasetChoices(choices));\n            })\n            .finally(() => {\n                dispatch(_setLoading(false));\n            })\n            .catch(err => {\n                handleError(dispatch, err, 'Unable to retrieve datasets. Please try again.');\n            });\n    };\n}\n\n\n","import Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Popover from '@material-ui/core/Popover';\nimport TextField from '@material-ui/core/TextField';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {setDialog} from './actions';\n\nexport class DatasetSelector extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {anchorEl: null, searchText: ''};\n    }\n\n    handleClick = (event) => {\n        this.setState({anchorEl: event.currentTarget, searchText: ''});\n    };\n\n    handleClose = () => {\n        this.setState({anchorEl: null, searchText: ''});\n    };\n\n    handleListItemClick = (id) => {\n        const selectedId = this.props.dataset != null ? this.props.dataset.id : null;\n        if (id !== selectedId) {\n            this.props.onChange(id);\n        }\n        this.setState({anchorEl: null, searchText: ''});\n    };\n\n    handleClearSearchText = () => {\n        this.setState({searchText: ''});\n    };\n\n    onSearchChange = (event) => {\n        this.setState({searchText: event.target.value});\n    };\n\n    render() {\n        const {dataset, datasetChoices} = this.props;\n        const selectedId = dataset != null ? dataset.id : null;\n\n        if (datasetChoices.length <= 1 && selectedId != null) {\n            return null;\n        }\n        const {anchorEl, searchText} = this.state;\n\n        const open = Boolean(this.state.anchorEl);\n        let filteredChoices = datasetChoices;\n        const searchTextLower = this.state.searchText.toLowerCase().trim();\n        if (searchTextLower != '') {\n            filteredChoices = filteredChoices.filter(choice => choice.name.toLowerCase().indexOf(searchTextLower) !== -1 ||\n                (choice.description != null && choice.description.toLowerCase().indexOf(searchTextLower) !== -1));\n        }\n\n        return (\n            <React.Fragment>\n                <Button variant=\"contained\" onClick={this.handleClick}\n                        color={selectedId == null ? \"primary\" : \"default\"}\n                        startIcon={<FolderOpenIcon/>}>Open</Button>\n                <Popover open={open}\n                         anchorEl={anchorEl}\n                         onClose={this.handleClose}\n                         anchorOrigin={{\n                             vertical: 'bottom',\n                             horizontal: 'center',\n                         }}\n                         transformOrigin={{\n                             vertical: 'top',\n                             horizontal: 'center',\n                         }}\n                >\n\n                    <TextField style={{padding: 6}} type=\"text\" placeholder={\"Search\"} value={searchText}\n                               onChange={this.onSearchChange}\n                               fullWidth={true}\n                               InputProps={searchText.trim() !== '' ? {\n                                   endAdornment:\n                                       <InputAdornment position=\"end\">\n                                           <IconButton\n                                               aria-label=\"clear\"\n                                               onClick={this.handleClearSearchText}\n                                           >\n                                               <ClearIcon/>\n                                           </IconButton>\n                                       </InputAdornment>\n                               } : null}\n                    />\n                    <List style={{width: 500}} dense disablePadding component=\"nav\" aria-label=\"datasets\">\n                        {filteredChoices.map(choice => {\n                            let text = choice.name;\n                            if (choice.title) {\n                                text += ' - ' + choice.title;\n                            }\n                            return <ListItem alignItems=\"flex-start\" selected={choice.id === selectedId} key={choice.id}\n                                             button onClick={(e) => this.handleListItemClick(choice.id)}>\n\n                                <ListItemText\n                                    primary={text}\n                                    style={{textOverflow: 'ellipsis', overflow: 'hidden', whiteSpace: 'nowrap'}}/>\n                            </ListItem>;\n                        })}\n                    </List>\n                </Popover>\n            </React.Fragment>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        dataset: state.dataset,\n        datasetChoices: state.datasetChoices,\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handleClose: value => {\n            dispatch(setDialog(null));\n        }\n\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(DatasetSelector));\n\n","import {scaleSequential} from 'd3-scale';\nimport {isPlainObject} from 'lodash';\nimport {combineReducers} from 'redux';\nimport {\n    ADD_DATASET,\n    DELETE_DATASET,\n    getTraceKey,\n    RESTORE_VIEW,\n    SET_BIN_SUMMARY,\n    SET_BIN_VALUES,\n    SET_CATEGORICAL_COLOR,\n    SET_CATEGORICAL_NAME,\n    SET_CHART_OPTIONS,\n    SET_CHART_SIZE,\n    SET_COMBINE_DATASET_FILTERS,\n    SET_DATASET,\n    SET_DATASET_CHOICES,\n    SET_DATASET_FILTER,\n    SET_DATASET_FILTERS,\n    SET_DIALOG,\n    SET_DOMAIN,\n    SET_DOT_PLOT_DATA,\n    SET_DOT_PLOT_INTERPOLATOR,\n    SET_DOT_PLOT_SORT_ORDER,\n    SET_EMAIL,\n    SET_EMBEDDING_DATA,\n    SET_FEATURE_SUMMARY,\n    SET_GLOBAL_FEATURE_SUMMARY,\n    SET_INTERPOLATOR,\n    SET_LOADING,\n    SET_LOADING_APP,\n    SET_MARKER_OPACITY,\n    SET_MARKERS,\n    SET_MESSAGE,\n    SET_NUMBER_OF_BINS,\n    SET_POINT_SIZE,\n    SET_PRIMARY_CHART_SIZE,\n    SET_PRIMARY_TRACE_KEY,\n    SET_SAVED_DATASET_STATE,\n    SET_SEARCH_TOKENS,\n    SET_SELECTED_DOT_PLOT_DATA,\n    SET_SELECTED_EMBEDDING,\n    SET_SELECTION,\n    SET_SERVER_INFO,\n    SET_TAB,\n    SET_UNSELECTED_MARKER_OPACITY,\n    SET_USER,\n    UPDATE_DATASET,\n} from '../actions';\nimport {getInterpolator, updateTraceColors} from '../util';\n\nexport const DEFAULT_BIN_SUMMARY = 'max';\nexport const DEFAULT_NUMBER_BINS = 500;\nexport const DEFAULT_POINT_SIZE = 1;\nexport const DEFAULT_MARKER_OPACITY = 1;\nexport const DEFAULT_UNSELECTED_MARKER_OPACITY = 0.1;\nexport const DEFAULT_INTERPOLATOR = 'Viridis';\nexport const DEFAULT_DOT_PLOT_INTERPOLATOR = 'Reds';\nexport const DEFAULT_DRAG_MODE = 'pan';\nexport const DEFAULT_SHOW_LABELS = false;\nexport const DEFAULT_SHOW_AXIS = true;\nexport const DEFAULT_SHOW_FOG = false;\nexport const DEFAULT_DARK_MODE = false;\nexport const DEFAULT_LABEL_FONT_SIZE = 14;\nexport const DEFAULT_LABEL_STROKE_WIDTH = 4;\n\nconst DEFAULT_INTERPOLATOR_OBJ = {\n    name: DEFAULT_INTERPOLATOR,\n    value: getInterpolator(DEFAULT_INTERPOLATOR)\n};\n\nconst DEFAULT_DOT_PLOT_INTERPOLATOR_OBJ = {\n    name: DEFAULT_DOT_PLOT_INTERPOLATOR,\n    value: getInterpolator(DEFAULT_DOT_PLOT_INTERPOLATOR)\n};\n\nconst DEFAULT_PRIMARY_CHART_SIZE = {\n    width: window.innerWidth - 280,\n    height: Math.max(300, window.innerHeight - 410)\n};\n\nconst DEFAULT_CHART_OPTIONS = {\n    animating: false,\n    dragmode: DEFAULT_DRAG_MODE,\n    editSelection: false,\n    showLabels: DEFAULT_SHOW_LABELS,\n    showAxis: DEFAULT_SHOW_AXIS,\n    showFog: DEFAULT_SHOW_FOG,\n    darkMode: DEFAULT_DARK_MODE,\n    labelFontSize: DEFAULT_LABEL_FONT_SIZE,\n    labelStrokeWidth: DEFAULT_LABEL_STROKE_WIDTH\n};\n\nfunction chartSize(state = 300, action) {\n    switch (action.type) {\n        case SET_CHART_SIZE:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n\nfunction primaryChartSize(state = DEFAULT_PRIMARY_CHART_SIZE, action) {\n    switch (action.type) {\n        case SET_PRIMARY_CHART_SIZE:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n/**\n *\n * @param state Array of value, type where type can be X, obs, or obsCat\n * @param action\n * @returns {*|*[]}\n */\nfunction searchTokens(state = [], action) {\n    switch (action.type) {\n        case SET_SEARCH_TOKENS:\n            return action.payload;\n        case SET_DATASET:\n            return [];\n        case RESTORE_VIEW:\n            return action.payload.q || [];\n        default:\n            return state;\n    }\n}\n\n\nfunction chartOptions(state = DEFAULT_CHART_OPTIONS, action) {\n    switch (action.type) {\n        case SET_CHART_OPTIONS:\n            return Object.assign({}, action.payload);\n        case RESTORE_VIEW:\n            return action.payload.chartOptions ? Object.assign(DEFAULT_CHART_OPTIONS, action.payload.chartOptions) : state;\n        default:\n            return state;\n    }\n}\n\nfunction dataset(state = null, action) {\n    switch (action.type) {\n        case SET_DATASET:\n            document.title = action.payload == null ? 'Cirro' : action.payload.name + ' - Cirro';\n            return action.payload;\n        case UPDATE_DATASET:\n            if (action.payload.id === state.id) { // update name, description, url\n                document.title = action.payload.name + ' - Cirro';\n                return Object.assign(state, action.payload);\n            }\n        default:\n            return state;\n    }\n}\n\nfunction datasetChoices(state = [], action) {\n    switch (action.type) {\n        case SET_DATASET_CHOICES:\n            action.payload.sort((a, b) => {\n                a = a.name.toLowerCase();\n                b = b.name.toLowerCase();\n                return a === b ? 0 : (a < b ? -1 : 1);\n            });\n\n            return action.payload;\n        case SET_EMAIL:\n            if (action.payload == null) {\n                return [];\n            }\n            return state;\n        case ADD_DATASET:\n            state.push(action.payload);\n            state.sort((a, b) => {\n                a = a.name.toLowerCase();\n                b = b.name.toLowerCase();\n                return a === b ? 0 : (a < b ? -1 : 1);\n            });\n            return state.slice();\n        case UPDATE_DATASET:\n        case DELETE_DATASET:\n            let index = -1;\n            for (let i = 0; i < state.length; i++) {\n                if (state[i].id === action.payload.id) {\n                    index = i;\n                    break;\n                }\n            }\n            if (index !== -1) {\n                if (action.type === UPDATE_DATASET) {\n                    state[index] = action.payload;\n                    state.sort((a, b) => {\n                        a = a.name.toLowerCase();\n                        b = b.name.toLowerCase();\n                        return a === b ? 0 : (a < b ? -1 : 1);\n                    });\n                } else {\n                    state.splice(index, 1);\n                }\n\n                return state.slice();\n            }\n            return state;\n        default:\n            return state;\n    }\n}\n\n// set the selected embeddings, each embedding has name (str) e.g X_umap, nbins (int), _nbins (str), agg (str), bin (boolean), dimensions (int), precomputed (bool)\nfunction embeddings(state = [], action) {\n    switch (action.type) {\n        case SET_SELECTED_EMBEDDING:\n            return action.payload;\n        case SET_DATASET:\n            return [];\n        case RESTORE_VIEW:\n            return action.payload.embeddings != null ? action.payload.embeddings : state;\n        default:\n            return state;\n    }\n}\n\nfunction markers(state = [], action) {\n    switch (action.type) {\n        case SET_MARKERS:\n            return action.payload;\n        case SET_DATASET:\n            let result = action.payload == null ? [] : action.payload.markers || [];\n            if (isPlainObject(result)) { // old style, category=>name=>features\n                let newResults = [];\n                for (let categoryName in result) {\n                    let category = result[categoryName];\n                    for (let name in category) {\n                        newResults.push({\n                            category: categoryName,\n                            name: name,\n                            id: categoryName + '-' + name,\n                            readonly: true,\n                            features: category[name]\n                        });\n                    }\n                }\n                result = newResults;\n            }\n\n            if (action.payload != null && action.payload.markers_read_only != null) {\n                if (isPlainObject(action.payload.markers_read_only)) { // old style, name => features\n                    let markers = action.payload.markers_read_only;\n                    for (let categoryName in markers) {\n                        let category = markers[categoryName];\n                        for (let name in category) {\n                            result.push({\n                                category: categoryName,\n                                name: name,\n                                id: categoryName + '-' + name,\n                                readonly: true,\n                                features: category[name]\n                            });\n                        }\n                    }\n                } else {\n                    action.payload.markers_read_only.forEach(item => {\n                        item.readonly = true;\n                        result.push(item);\n                    });\n                }\n            }\n            result.forEach(item => {\n                if (item.id == null) {\n                    item.id = item.category + '-' + item.name;\n                }\n            });\n\n            return result;\n        default:\n            return state;\n    }\n}\n\n\nfunction binSummary(state = DEFAULT_BIN_SUMMARY, action) {\n    switch (action.type) {\n        case SET_BIN_SUMMARY:\n            return action.payload;\n        case SET_DATASET:\n            return DEFAULT_BIN_SUMMARY;\n        case RESTORE_VIEW:\n            return action.payload.binSummary != null ? action.payload.binSummary : state;\n        default:\n            return state;\n    }\n}\n\n\nfunction binValues(state = false, action) {\n    switch (action.type) {\n        case SET_BIN_VALUES:\n            return action.payload;\n        case SET_DATASET:\n            return false;\n        case RESTORE_VIEW:\n            return action.payload.binValues != null ? action.payload.binValues : state;\n        default:\n            return state;\n    }\n}\n\n\nfunction numberOfBins(state = DEFAULT_NUMBER_BINS, action) {\n    switch (action.type) {\n        case SET_NUMBER_OF_BINS:\n            return action.payload;\n        case SET_DATASET:\n            return DEFAULT_NUMBER_BINS;\n        case RESTORE_VIEW:\n            return action.payload.numberOfBins != null ? action.payload.numberOfBins : state;\n        default:\n            return state;\n    }\n}\n\n\nfunction markerOpacity(state = DEFAULT_MARKER_OPACITY, action) {\n    switch (action.type) {\n        case SET_MARKER_OPACITY:\n            return action.payload;\n        case SET_DATASET:\n            return DEFAULT_MARKER_OPACITY;\n        case RESTORE_VIEW:\n            return action.payload.markerOpacity != null ? action.payload.markerOpacity : state;\n        default:\n            return state;\n    }\n}\n\nfunction unselectedMarkerOpacity(state = DEFAULT_UNSELECTED_MARKER_OPACITY, action) {\n    switch (action.type) {\n        case SET_UNSELECTED_MARKER_OPACITY:\n            return action.payload;\n        case SET_DATASET:\n            return DEFAULT_UNSELECTED_MARKER_OPACITY;\n        case RESTORE_VIEW:\n            return action.payload.unselectedMarkerOpacity != null ? action.payload.unselectedMarkerOpacity : state;\n        default:\n            return state;\n    }\n}\n\n\nfunction message(state = null, action) {\n    switch (action.type) {\n        case SET_MESSAGE:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\nfunction email(state = null, action) {\n    switch (action.type) {\n        case SET_EMAIL:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\nfunction user(state = {}, action) {\n    switch (action.type) {\n        case SET_USER:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n/**\n * Object that contains count (number), chart (object). Each key in chart is the full layout name. Each value contains\n * userPoints (selected points in chart space) and points (the selected points in bin space if binning)\n */\nfunction selection(state = {chart: {}}, action) {\n    switch (action.type) {\n        case SET_SELECTION:\n            return action.payload;\n        case SET_DATASET:\n            return {};\n        default:\n            return state;\n    }\n}\n\n/**\n * Feature summary maps measure and dimension names to another object containing\n * categories and counts for dimensions, and statistics such as min, max for measures.\n * Features summaries are in the space of selected cells.\n */\nfunction featureSummary(state = {}, action) {\n    switch (action.type) {\n        case SET_FEATURE_SUMMARY:\n            return action.payload;\n        case SET_DATASET:\n            return {};\n        default:\n            return state;\n    }\n}\n\n/**\n * Feature summary maps measure and dimension names to another object containing\n * categories and counts for dimensions, and statistics such as min, max for measures.\n * Features summaries are in the space of all cells.\n */\nfunction globalFeatureSummary(state = {}, action) {\n    switch (action.type) {\n        case SET_GLOBAL_FEATURE_SUMMARY:\n            return action.payload;\n        case SET_DATASET:\n            return {};\n        default:\n            return state;\n    }\n}\n\nfunction serverInfo(state = {}, action) {\n    switch (action.type) {\n        case SET_SERVER_INFO:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n\nfunction loadingApp(state = {loading: false, progress: 0}, action) {\n    switch (action.type) {\n        case SET_LOADING_APP:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n\nfunction tab(state = 'embedding', action) {\n    switch (action.type) {\n        case SET_TAB:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\nfunction dialog(state = null, action) {\n    switch (action.type) {\n        case SET_DIALOG:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n// [{\n//     \"categories\": array,\n//     \"name\": str,\n//     \"fractionRange\":[number],\n//     \"meanRange\":[number]\n//     \"values\": [{\n//         \"name\": str,\n//         \"fractionExpressed\": array\n//         \"mean\": array,\n//         \"active\": bool\n//     }]\n// }]\n\nfunction updateDotPlotDataRange(data) {\n    data.forEach(categoryItem => {\n        let fractionRange = [Number.MAX_VALUE, -Number.MAX_VALUE];\n        let meanRange = [Number.MAX_VALUE, -Number.MAX_VALUE];\n        categoryItem.values.forEach(feature => {\n            for (let i = 0, n = feature.mean.length; i < n; i++) {\n                fractionRange[0] = Math.min(feature.fractionExpressed[i], fractionRange[0]);\n                fractionRange[1] = Math.max(feature.fractionExpressed[i], fractionRange[1]);\n                meanRange[0] = Math.min(feature.mean[i], meanRange[0]);\n                meanRange[1] = Math.max(feature.mean[i], meanRange[1]);\n            }\n        });\n        categoryItem.meanRange = meanRange;\n        categoryItem.fractionRange = fractionRange;\n    });\n}\n\n\nfunction dotPlotInterpolator(state = DEFAULT_DOT_PLOT_INTERPOLATOR_OBJ, action) {\n\n    switch (action.type) {\n        case SET_DOT_PLOT_INTERPOLATOR:\n            return action.payload;\n        case RESTORE_VIEW:\n            return action.payload.dotPlotInterpolator != null ? action.payload.dotPlotInterpolator : state;\n        default:\n            return state;\n    }\n}\n\nfunction dotPlotData(state = [], action) {\n    switch (action.type) {\n        case SET_CATEGORICAL_NAME:\n            for (let i = 0; i < state.length; i++) {\n                let item = state[i];\n                state[i] = Object.assign({}, item);\n            }\n            return state.slice();\n        case SET_DOT_PLOT_SORT_ORDER:\n            const name = action.payload.name;\n            const sortBy = action.payload.value;\n            for (let i = 0; i < state.length; i++) {\n                let item = state[i];\n                if (item.name === name) {\n                    item.sortBy = sortBy;\n                    state[i] = Object.assign({}, item);\n                    break;\n                }\n            }\n            return state.slice();\n        case SET_DOT_PLOT_DATA:\n            updateDotPlotDataRange(action.payload);\n            return action.payload;\n        case SET_DATASET:\n            return [];\n        default:\n            return state;\n    }\n}\n\nfunction selectedDotPlotData(state = [], action) {\n    switch (action.type) {\n        case SET_CATEGORICAL_NAME:\n            for (let i = 0; i < state.length; i++) {\n                let item = state[i];\n                state[i] = Object.assign({}, item);\n            }\n            return state.slice();\n        case SET_DOT_PLOT_SORT_ORDER:\n            const name = action.payload.name;\n            const sortBy = action.payload.value;\n            for (let i = 0; i < state.length; i++) {\n                let item = state[i];\n                if (item.name === name) {\n                    item.sortBy = sortBy;\n                    state[i] = Object.assign({}, item);\n                    break;\n                }\n            }\n            return state.slice();\n        case SET_SELECTED_DOT_PLOT_DATA:\n            updateDotPlotDataRange(action.payload);\n            return action.payload;\n        case SET_DATASET:\n            return [];\n        default:\n            return state;\n    }\n}\n\n\nfunction datasetFilters(state = [], action) {\n    switch (action.type) {\n        case SET_DATASET:\n            return [];\n        case SET_DATASET_FILTERS:\n            //action.payload.sort()\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n\nfunction datasetFilter(state = {}, action) {\n    switch (action.type) {\n        case SET_DATASET:\n            return {};\n        case SET_DATASET_FILTER:\n            return action.payload;\n        case RESTORE_VIEW:\n            return action.payload.datasetFilter != null ? action.payload.datasetFilter : state;\n        default:\n            return state;\n    }\n}\n\nfunction combineDatasetFilters(state = 'and', action) {\n    switch (action.type) {\n        case SET_COMBINE_DATASET_FILTERS:\n            return action.payload;\n        case SET_DATASET:\n            return \"and\";\n        case RESTORE_VIEW:\n            return action.payload.combineDatasetFilters != null ? action.payload.combineDatasetFilters : state;\n        default:\n            return state;\n    }\n}\n\n// category -> value -> newValue\nfunction categoricalNames(state = {}, action) {\n    switch (action.type) {\n        case SET_CATEGORICAL_NAME:\n            let category = state[action.payload.name];\n            if (category === undefined) {\n                category = {};\n                state[action.payload.name] = category;\n            }\n            if (action.payload.value == null || action.payload.value === '') {\n                delete category[action.payload.oldValue];\n            } else {\n                category[action.payload.oldValue] = action.payload.value;\n            }\n            return Object.assign({}, state);\n        case SET_DATASET:\n            return {};\n        default:\n            return state;\n    }\n}\n\n// maps keys to values, features=>array, embedding key=>x,y,z, feature_embedding_key=>array for binned embeddings\nfunction cachedData(state = {}, action) {\n    switch (action.type) {\n        case SET_DATASET :\n            return {};\n    }\n    return state;\n\n}\n\n// each item has  data (list of traces, each trace has x, y, etc.), layout\nfunction embeddingData(state = [], action) {\n    switch (action.type) {\n        case SET_EMBEDDING_DATA :\n            return action.payload;\n        case SET_SELECTION:\n            return state.slice();\n        case SET_DOMAIN:\n            state.forEach((traceInfo, stateIndex) => {\n                if (traceInfo.continuous && traceInfo.name === action.payload.name) {\n                    const summary = action.payload.summary;\n                    let domain = [summary.min, summary.max];\n                    if (summary.customMin != null && !isNaN(summary.customMin)) {\n                        domain[0] = summary.customMin;\n                    }\n                    if (summary.customMax != null && !isNaN(summary.customMax)) {\n                        domain[1] = summary.customMax;\n                    }\n                    traceInfo.colorScale.domain(domain);\n                    updateTraceColors(traceInfo);\n                }\n            });\n            return state.slice();\n        case SET_CATEGORICAL_COLOR:\n            state.forEach((traceInfo, stateIndex) => {\n                if (!traceInfo.continuous && traceInfo.name === action.payload.name) {\n                    let index = traceInfo.colorScale.domain().indexOf(action.payload.value);\n                    let range = traceInfo.colorScale.range();\n                    range[index] = action.payload.color;\n                    traceInfo.colorScale.range(range);\n                    updateTraceColors(traceInfo);\n                }\n            });\n            return state.slice();\n\n        case SET_INTERPOLATOR:\n            // update colors for existing continuous traces\n\n            state.forEach((traceInfo, stateIndex) => {\n                if (traceInfo.continuous) {\n                    let domain = traceInfo.colorScale.domain();\n                    traceInfo.colorScale = scaleSequential(action.payload.value).domain(domain);\n                    updateTraceColors(traceInfo);\n                }\n            });\n            return state.slice();\n        case SET_DATASET:\n            return [];\n        default:\n            return state;\n    }\n}\n\nexport function pointSize(state = DEFAULT_POINT_SIZE, action) {\n    switch (action.type) {\n        case SET_POINT_SIZE:\n            return action.payload;\n        case RESTORE_VIEW:\n            return action.payload.pointSize != null ? action.payload.pointSize : state;\n        default:\n            return state;\n    }\n}\n\n\n// used to restore state when toggling datasets\nexport function savedDatasetState(state = {}, action) {\n    switch (action.type) {\n        case SET_SAVED_DATASET_STATE:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\nexport function primaryTraceKey(state = null, action) {\n    switch (action.type) {\n        case SET_DATASET:\n            return null;\n        case SET_PRIMARY_TRACE_KEY:\n            return action.payload;\n        case SET_EMBEDDING_DATA:\n            let traces = action.payload.filter(traceInfo => traceInfo.active);\n            if (traces.length === 0) {\n                return null;\n            }\n            const activeTrace = traces[traces.length - 1];\n            return getTraceKey(activeTrace); // last feature becomes primary\n        default:\n            return state;\n    }\n}\n\nfunction loading(state = false, action) {\n    switch (action.type) {\n        case SET_LOADING:\n            return action.payload;\n        default:\n            return state;\n    }\n}\n\n\nfunction interpolator(state = DEFAULT_INTERPOLATOR_OBJ, action) {\n    switch (action.type) {\n        case SET_INTERPOLATOR:\n            return action.payload;\n        case RESTORE_VIEW:\n            return action.payload.colorScheme != null ? action.payload.colorScheme : state;\n        default:\n            return state;\n    }\n}\n\nexport default combineReducers({\n    binSummary,\n    binValues,\n    cachedData,\n    categoricalNames,\n    chartOptions,\n    chartSize,\n    combineDatasetFilters,\n    dataset,\n    datasetChoices,\n    datasetFilter,\n    datasetFilters,\n    dialog,\n    dotPlotData,\n    dotPlotInterpolator,\n    email,\n    embeddingData,\n    embeddings,\n    featureSummary,\n    globalFeatureSummary,\n    interpolator,\n    loading,\n    loadingApp,\n    markerOpacity,\n    markers,\n    message,\n    numberOfBins,\n    pointSize,\n    primaryChartSize,\n    primaryTraceKey,\n    savedDatasetState,\n    searchTokens,\n    selectedDotPlotData,\n    selection,\n    serverInfo,\n    tab,\n    unselectedMarkerOpacity,\n    user\n\n});\n","import {Divider, IconButton, Menu, Tooltip} from '@material-ui/core';\nimport AppBar from '@material-ui/core/AppBar';\nimport Button from '@material-ui/core/Button';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Popover from '@material-ui/core/Popover';\nimport {withStyles} from '@material-ui/core/styles';\nimport Tab from '@material-ui/core/Tab';\nimport Tabs from '@material-ui/core/Tabs';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport AccountCircle from '@material-ui/icons/AccountCircle';\nimport Brightness2Icon from '@material-ui/icons/Brightness3';\nimport HelpIcon from '@material-ui/icons/Help';\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\nimport React from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport {connect} from 'react-redux';\nimport {\n    DELETE_DATASET_DIALOG,\n    EDIT_DATASET_DIALOG,\n    HELP_DIALOG,\n    IMPORT_DATASET_DIALOG,\n    login,\n    logout,\n    setChartOptions,\n    setDataset,\n    setDialog,\n    setMessage,\n    setSavedDatasetState,\n    setTab,\n} from './actions';\nimport {drawerWidth} from './App';\nimport DatasetSelector from './DatasetSelector';\nimport {intFormat} from './formatters';\nimport {\n    DEFAULT_DARK_MODE,\n    DEFAULT_INTERPOLATOR,\n    DEFAULT_LABEL_FONT_SIZE,\n    DEFAULT_LABEL_STROKE_WIDTH,\n    DEFAULT_MARKER_OPACITY,\n    DEFAULT_SHOW_AXIS,\n    DEFAULT_SHOW_FOG,\n    DEFAULT_SHOW_LABELS,\n    DEFAULT_UNSELECTED_MARKER_OPACITY\n} from \"./reducers\";\n\n\nconst styles = theme => ({\n    root: {\n        display: 'flex',\n        flexWrap: 'wrap',\n        'flex-direction': 'column',\n    },\n    appBar: {\n        width: `calc(100% - ${drawerWidth}px)`,\n        marginLeft: drawerWidth,\n    },\n});\nconst AntTab = withStyles(theme => ({\n    root: {\n        minWidth: 50,\n        textTransform: 'none',\n        fontWeight: theme.typography.fontWeightRegular,\n        marginRight: theme.spacing(0),\n        '&:hover': {\n            color: '#40a9ff',\n            opacity: 1,\n        },\n        '&$selected': {\n            color: '#1890ff',\n            fontWeight: theme.typography.fontWeightMedium,\n        },\n        '&:focus': {\n            color: '#40a9ff',\n        },\n    },\n    selected: {},\n}))(props => <Tab disableRipple {...props} />);\n\nclass AppHeader extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            userMenuOpen: false,\n            userMenuAnchorEl: null,\n            moreMenuOpen: false,\n            moreMenuAnchorEl: null,\n        };\n\n    }\n\n    handleTabChange = (event, value) => {\n        this.props.handleTab(value);\n    };\n\n\n    handleEmbeddingsChange = (event) => {\n\n        const embeddings = event.target.value;\n        const selection = [];\n        embeddings.forEach(embedding => {\n\n            if (!embedding.precomputed) {\n                embedding = Object.assign(embedding, {\n                    bin: this.props.binValues,\n                    nbins: this.props.numberOfBins,\n                    _nbins: this.props.numberOfBinsUI,\n                    agg: this.props.binSummary\n                });\n            }\n            selection.push(embedding);\n\n        });\n        this.props.handleEmbeddings(selection);\n    };\n\n\n    handleUserMenuClose = () => {\n        this.setState({userMenuOpen: false});\n    };\n\n    handleMoreMenuClose = () => {\n        this.setState({moreMenuOpen: false});\n    };\n\n\n    handleHelp = () => {\n        this.props.handleDialog(HELP_DIALOG);\n    };\n\n\n    handleUserMenuOpen = (event) => {\n        this.setState({userMenuOpen: true, userMenuAnchorEl: event.currentTarget});\n    };\n    handleMoreMenuOpen = (event) => {\n        this.setState({moreMenuOpen: true, moreMenuAnchorEl: event.currentTarget});\n    };\n\n    getLinkJson = () => {\n        const {chartOptions, combineDatasetFilters, primaryTraceKey, dataset, embeddings, searchTokens, datasetFilter, interpolator, markerOpacity, pointSize, unselectedMarkerOpacity, dotPlotData} = this.props;\n\n        let json = {\n            dataset: dataset.id,\n            embeddings: embeddings.map(embedding => {\n                if (embedding.bin) {\n                    embedding = Object.assign({}, embedding);\n                    delete embedding._bin;\n                    return embedding;\n                } else {\n                    return {name: embedding.name, dimensions: embedding.dimensions};\n                }\n\n            })\n        };\n\n        const chartRef = chartOptions.ref;\n        if (json.embeddings.length > 0 && chartRef != null && chartRef.scatterPlot) {\n            json.camera = chartRef.scatterPlot.getCameraDef();\n\n        }\n\n        let jsonChartOptions = {};\n        if (json.embeddings.length > 0) {\n            jsonChartOptions.activeEmbedding = primaryTraceKey;\n        }\n        const defaultChartOptions = {\n            showLabels: DEFAULT_SHOW_LABELS, showAxis: DEFAULT_SHOW_AXIS,\n            showFog: DEFAULT_SHOW_FOG, darkMode: DEFAULT_DARK_MODE,\n            labelFontSize: DEFAULT_LABEL_FONT_SIZE,\n            labelStrokeWidth: DEFAULT_LABEL_STROKE_WIDTH\n        };\n\n        for (let key in defaultChartOptions) {\n            let value = chartOptions[key];\n            if (value !== defaultChartOptions[key]) {\n                jsonChartOptions[key] = value;\n            }\n        }\n        if (pointSize !== 1) {\n            json.pointSize = pointSize;\n        }\n        if (Object.keys(jsonChartOptions).length > 0) {\n            json.chartOptions = jsonChartOptions;\n        }\n\n        if (searchTokens.length > 0) {\n            json.q = searchTokens;\n        }\n\n        let datasetFilterJson = {};\n        for (let key in datasetFilter) {\n            let value = datasetFilter[key];\n            if (window.Array.isArray(value)) {\n                datasetFilterJson[key] = value;\n            } else {\n                if (value.operation !== '' && !isNaN(value.value) && value.value != null) {\n                    datasetFilterJson[key] = {operation: value.operation, value: value.value};\n                }\n            }\n        }\n        if (Object.keys(datasetFilterJson).length > 0) {\n            json.datasetFilter = datasetFilterJson;\n\n        }\n        json.combineDatasetFilters = combineDatasetFilters;\n        if (markerOpacity !== DEFAULT_MARKER_OPACITY) {\n            json.markerOpacity = markerOpacity;\n        }\n        if (unselectedMarkerOpacity !== DEFAULT_UNSELECTED_MARKER_OPACITY) {\n            json.unselectedMarkerOpacity = unselectedMarkerOpacity;\n        }\n\n        if (dotPlotData && dotPlotData.length > 0) {\n            let sortOrder = {};\n            dotPlotData.forEach(data => {\n                sortOrder[data.name] = data.sortBy;\n            });\n            json.sort = sortOrder;\n        }\n        if (interpolator.name !== DEFAULT_INTERPOLATOR) {\n            json.colorScheme = interpolator.name;\n        }\n        return json;\n    };\n\n    handleDataset = (id) => {\n        if (this.props.dataset != null) {\n            const savedDatasetState = this.props.savedDatasetState;\n            const link = this.getLinkJson();\n            link.dataset = null;\n            savedDatasetState[this.props.dataset.id] = link;\n            this.props.handleSavedDatasetState(savedDatasetState);\n        }\n        this.props.handleDataset(id);\n    };\n\n    copyLink = (event) => {\n\n        let linkText = window.location.protocol + '//' + window.location.host + window.location.pathname;\n        linkText += '?q=' + encodeURIComponent(JSON.stringify(this.getLinkJson()));\n        const container = document.activeElement;\n        const fakeElem = document.createElement('textarea');\n        const isRTL = document.documentElement.getAttribute('dir') == 'rtl';\n        fakeElem.style.fontSize = '12pt';\n        fakeElem.style.border = '0';\n        fakeElem.style.padding = '0';\n        fakeElem.style.margin = '0';\n        // Move element out of screen horizontally\n        fakeElem.style.position = 'absolute';\n        fakeElem.style[isRTL ? 'right' : 'left'] = '-9999px';\n        fakeElem.setAttribute('readonly', '');\n        // Move element to the same position vertically\n        let yPosition = window.pageYOffset || document.documentElement.scrollTop;\n        fakeElem.style.top = yPosition + 'px';\n        fakeElem.value = linkText;\n        container.appendChild(fakeElem);\n\n        fakeElem.select();\n        fakeElem.setSelectionRange(0, fakeElem.value.length);\n\n        document.execCommand('copy');\n\n        const fakeHandlerCallback = (event) => {\n            document.activeElement.blur();\n            window.getSelection().removeAllRanges();\n            container.removeChild(fakeElem);\n            container.removeEventListener('click', fakeHandlerCallback);\n        };\n        this.props.setMessage('Link copied');\n        container.addEventListener('click', fakeHandlerCallback);\n        this.setState({moreMenuOpen: false});\n\n    };\n\n\n    onDarkMode = () => {\n        this.props.chartOptions.darkMode = !this.props.chartOptions.darkMode;\n        this.props.handleChartOptions(this.props.chartOptions);\n    };\n\n    handleLogout = () => {\n        this.setState({userMenuOpen: false});\n        this.props.handleLogout();\n    };\n\n    handleImportDataset = (event) => {\n        this.props.handleDialog(IMPORT_DATASET_DIALOG);\n        this.setState({moreMenuOpen: false});\n    };\n\n    handleSettings = (event) => {\n        this.props.handleDialog(EDIT_DATASET_DIALOG);\n        this.setState({moreMenuOpen: false});\n    };\n\n    handleDelete = (event) => {\n        this.props.handleDialog(DELETE_DATASET_DIALOG);\n        this.setState({moreMenuOpen: false});\n    };\n\n    handleShowDatasetDetails = (event) => {\n        this.setState({datasetDetailsEl: event.currentTarget});\n    };\n    handleCloseDatasetDetails = (event) => {\n        this.setState({datasetDetailsEl: null});\n    };\n\n    render() {\n        const {\n            dataset, loadingApp, email, selection, classes, serverInfo, tab, user\n        } = this.props;\n\n\n        const datasetDetailsOpen = Boolean(this.state.datasetDetailsEl);\n        const hasDatasetDetails = dataset != null && (dataset.title || dataset.description);\n        const shape = dataset != null && dataset.shape != null ? dataset.shape : null;\n        const hasSelection = dataset != null && shape != null && shape[0] > 0 && !isNaN(selection.count);\n\n        const showNewDataset = user != null && user.importer && !loadingApp.loading;\n        const showEditDeleteDataset = dataset !== null && dataset.owner && !loadingApp.loading;\n        const showMoreMenu = (showNewDataset || dataset != null) && !loadingApp.loading;\n        const isSignedOut = !loadingApp.loading && email == null && serverInfo.clientId !== '';\n        return (\n            <AppBar position=\"fixed\" color=\"default\" className={classes.appBar}>\n                <Toolbar variant=\"dense\">\n\n                    {/*{datasetChoices.length > 0 && <Select*/}\n                    {/*    style={{marginRight: 6}}*/}\n                    {/*    disableUnderline={true}*/}\n                    {/*    displayEmpty={true}*/}\n                    {/*    value={dataset == null ? '' : dataset.id}*/}\n                    {/*    onChange={this.handleDataset}*/}\n                    {/*    inputProps={{*/}\n                    {/*        name: 'dataset',*/}\n                    {/*        id: 'dataset-id',*/}\n                    {/*    }}*/}\n                    {/*>*/}\n                    {/*    <MenuItem key=\"\" value=\"\" disabled>*/}\n                    {/*        Choose a dataset*/}\n                    {/*    </MenuItem>*/}\n                    {/*    {datasetChoices.map(dataset => <MenuItem*/}\n                    {/*        key={dataset.id} value={dataset.id}>{dataset.name}</MenuItem>)}*/}\n                    {/*</Select>}*/}\n                    {dataset != null && <Popover\n                        id={\"dataset-details\"}\n                        open={datasetDetailsOpen}\n                        anchorEl={this.state.datasetDetailsEl}\n                        onClose={this.handleCloseDatasetDetails}\n                        anchorOrigin={{\n                            vertical: 'bottom',\n                            horizontal: 'center',\n                        }}\n                        transformOrigin={{\n                            vertical: 'top',\n                            horizontal: 'center',\n                        }}\n                    >\n                        <div style={{width: 500}}>\n                            {dataset.title && <Typography className={classes.typography}>\n                                {dataset.title}\n                            </Typography>}\n                            {dataset.description &&\n                            <ReactMarkdown linkTarget=\"_blank\" children={dataset.description}/>}\n                        </div>\n                    </Popover>\n                    }\n                    {dataset != null &&\n                    <Typography\n                        aria-owns={this.state.datasetDetailsOpen ? 'dataset-details' : undefined}\n                        aria-haspopup=\"true\"\n                        component={\"h3\"}>\n                        {hasDatasetDetails &&\n                        <Button onClick={this.handleShowDatasetDetails}><b>{dataset.name}</b></Button>}\n                        {!hasDatasetDetails && <b>{dataset.name}</b>}\n                        <small>&nbsp;\n                            {hasSelection && shape != null && intFormat(selection.count) + ' / '}\n                            {shape != null && intFormat(shape[0]) + ' cells'}\n                        </small>\n\n                    </Typography>\n                    }\n\n                    {dataset != null && <Tabs\n                        value={tab}\n                        indicatorColor=\"primary\"\n                        textColor=\"primary\"\n                        onChange={this.handleTabChange}\n                        aria-label=\"view\"\n\n                    >\n                        <AntTab value=\"embedding\" label=\"Embeddings\"/>\n                        <AntTab value=\"dot_plot\" label=\"Dot Plot\"/>\n                    </Tabs>}\n\n                    <div className={\"cirro-condensed\"}>\n                        {/*<CloudIcon style={{verticalAlign: 'bottom'}} fontSize={'large'}/>*/}\n                        {/*<h3*/}\n                        {/*    style={{display: 'inline', marginRight: 20}}>Cirro</h3>*/}\n\n\n                    </div>\n                    <div style={{marginLeft: 'auto'}}>\n                        {!loadingApp.loading && !isSignedOut && <DatasetSelector onChange={this.handleDataset}/>}\n                        {showMoreMenu && <Tooltip title={'More'}>\n                            <IconButton aria-label=\"Menu\" aria-haspopup=\"true\"\n                                        onClick={this.handleMoreMenuOpen}>\n                                <MoreVertIcon/>\n                            </IconButton>\n                        </Tooltip>}\n                        {showMoreMenu && <Menu id=\"more-menu\"\n                                               anchorEl={this.state.moreMenuAnchorEl}\n                                               anchorOrigin={{\n                                                   vertical: 'top',\n                                                   horizontal: 'right',\n                                               }}\n\n                                               transformOrigin={{\n                                                   vertical: 'top',\n                                                   horizontal: 'right',\n                                               }} open={this.state.moreMenuOpen}\n                                               onClose={this.handleMoreMenuClose}>\n                            {showNewDataset && <MenuItem onClick={this.handleImportDataset}>\n                                New Dataset\n                            </MenuItem>}\n\n                            {showEditDeleteDataset && <MenuItem onClick={this.handleSettings}>Edit Dataset</MenuItem>}\n                            {showEditDeleteDataset && <MenuItem onClick={this.handleDelete}>Delete Dataset</MenuItem>}\n                            {(showNewDataset || showEditDeleteDataset) && dataset != null && <Divider/>}\n                            {dataset != null && <MenuItem onClick={this.copyLink}>Copy Link </MenuItem>}\n                        </Menu>}\n\n\n                        {<Tooltip title={\"Toggle Light/Dark Theme\"}>\n                            <IconButton edge={false} className={this.props.chartOptions.darkMode ? 'cirro-active' : ''}\n                                        aria-label=\"Toggle Theme\" onClick={() => this.onDarkMode()}>\n                                <Brightness2Icon/>\n                            </IconButton>\n                        </Tooltip>}\n                        <Tooltip title={'Help'}>\n                            <IconButton aria-label=\"Help\"\n                                        onClick={this.handleHelp}>\n                                <HelpIcon/>\n                            </IconButton>\n                        </Tooltip>\n                        {email != null && email !== '' &&\n                        <Tooltip title={email}>\n                            <IconButton aria-label=\"Menu\" aria-haspopup=\"true\"\n                                        onClick={this.handleUserMenuOpen}>\n                                <AccountCircle/>\n                            </IconButton>\n                        </Tooltip>}\n                        {email != null && email !== '' &&\n                        <Menu id=\"menu-user\"\n                              anchorEl={this.state.userMenuAnchorEl}\n                              anchorOrigin={{\n                                  vertical: 'top',\n                                  horizontal: 'right',\n                              }}\n\n                              transformOrigin={{\n                                  vertical: 'top',\n                                  horizontal: 'right',\n                              }} open={this.state.userMenuOpen}\n                              onClose={this.handleUserMenuClose}>\n                            <MenuItem onClick={this.handleLogout}>Sign Out</MenuItem>\n                        </Menu>}\n\n\n                        {isSignedOut && <Button style={{whiteSpace: 'nowrap'}} variant=\"outlined\" color=\"primary\"\n                                                onClick={this.props.handleLogin}>Sign In</Button>}\n                    </div>\n                </Toolbar>\n            </AppBar>\n\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        dataset: state.dataset,\n        chartOptions: state.chartOptions,\n        embeddings: state.embeddings,\n        searchTokens: state.searchTokens,\n        primaryTraceKey: state.primaryTraceKey,\n        binSummary: state.binSummary,\n        binValues: state.binValues,\n        combineDatasetFilters: state.combineDatasetFilters,\n        datasetFilter: state.datasetFilter,\n        markerOpacity: state.markerOpacity,\n        pointSize: state.pointSize,\n        unselectedMarkerOpacity: state.unselectedMarkerOpacity,\n        savedDatasetState: state.savedDatasetState,\n        datasetChoices: state.datasetChoices,\n        dialog: state.dialog,\n        dotPlotData: state.dotPlotData,\n        email: state.email,\n\n        interpolator: state.interpolator,\n        loading: state.loading,\n        loadingApp: state.loadingApp,\n\n        message: state.message,\n\n        selection: state.selection,\n        serverInfo: state.serverInfo,\n        user: state.user,\n        tab: state.tab\n    };\n};\nconst mapDispatchToProps = (dispatch, ownProps) => {\n    return {\n        handleTab: (value) => {\n            dispatch(setTab(value));\n        },\n        setMessage: (value) => {\n            dispatch(setMessage(value));\n        },\n        handleLogin: () => {\n            dispatch(login());\n        },\n        handleLogout: () => {\n            dispatch(logout());\n        },\n\n        handleSavedDatasetState: value => {\n            dispatch(setSavedDatasetState(value));\n        },\n\n        handleDataset: value => {\n            dispatch(setDataset(value));\n        },\n        handleDialog: (value) => {\n            dispatch(setDialog(value));\n        },\n        handleChartOptions: (value) => {\n            dispatch(setChartOptions(value));\n        }\n    };\n};\n\nexport default withStyles(styles)(connect(\n    mapStateToProps, mapDispatchToProps,\n)(AppHeader));\n\n\n","import Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\n\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {deleteDataset, setDialog} from './actions';\n\nclass DeleteDatasetDialog extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            open: true,\n        };\n    }\n\n    handleClose = () => {\n        this.props.handleCancel();\n    };\n\n    handleDelete = () => {\n        this.setState({loading: true});\n        this.props.handleDelete({dataset: this.props.dataset});\n    };\n\n    render() {\n        return (\n            <Dialog\n                open={this.state.open}\n                onClose={this.handleClose}\n                aria-labelledby=\"delete-dataset-dialog-title\"\n                fullWidth={true}\n                maxWidth={'sm'}\n            >\n                <DialogTitle id=\"delete-dataset-dialog-title\">Delete Dataset</DialogTitle>\n                <DialogContent>\n                    {this.props.dataset && <h3>Are you sure you want to delete {this.props.dataset.name}?</h3>}\n                </DialogContent>\n                <DialogActions>\n                    <Button disabled={this.state.loading} onClick={this.handleClose} color=\"primary\">\n                        Cancel\n                    </Button>\n                    <Button disabled={this.state.loading} onClick={this.handleDelete} color=\"primary\">\n                        Delete\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        dataset: state.dataset,\n        email: state.email,\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n\n        handleDelete: value => {\n            dispatch(deleteDataset(value));\n        },\n\n        handleCancel: value => {\n            dispatch(setDialog(null));\n        },\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(DeleteDatasetDialog));\n\n","import Input from '@material-ui/core/Input';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\n\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport {scaleSequential} from 'd3-scale';\nimport * as scaleChromatic from 'd3-scale-chromatic';\nimport React from 'react';\nimport ColorSchemeLegend from './ColorSchemeLegend';\nimport {fixInterpolatorName, getInterpolator, interpolators} from \"./util\";\n\nconst styles = theme => ({\n    root: {\n        display: 'flex',\n        flexWrap: 'wrap',\n        'flex-direction': 'column',\n    },\n    formControl: {\n        display: 'block',\n        margin: theme.spacing(1)\n    },\n\n});\n\nfunction stripInterpolate(name) {\n    if (name.startsWith(\"interpolate\")) {\n        name = name.substring(\"interpolate\".length);\n    }\n    return name;\n}\n\n\nclass ColorSchemeSelector extends React.PureComponent {\n    handleInterpolatorChange = (event) => {\n        let name = event.target.value;\n        this.props.handleInterpolator({name: name, value: getInterpolator(name)});\n    };\n\n    getScale(name) {\n        return scaleSequential(scaleChromatic[name]).domain([0, 1]);\n    }\n\n    render() {\n        const {classes} = this.props;\n        let interpolator = fixInterpolatorName(this.props.interpolator.name);\n        const width = 174;\n        const height = 20;\n        return (\n            <Select\n                input={<Input id=\"color-scheme\"/>}\n                className={classes.select}\n                onChange={this.handleInterpolatorChange}\n                value={interpolator}\n                multiple={false}>\n                <MenuItem key=\"Diverging\" value=\"Diverging\" divider disabled>\n                    Diverging\n                </MenuItem>\n                {interpolators['Diverging'].map(item => (\n                    <MenuItem title={stripInterpolate(item)} value={item} key={item}>\n                        <ColorSchemeLegend width={width}\n                                           label={false} height={height}\n                                           scale={this.getScale(item)}/>\n\n                    </MenuItem>))}\n\n                <MenuItem key=\"Sequential (Single Hue)\" value=\"Sequential (Single Hue)\" divider disabled>\n                    Sequential (Single Hue)\n                </MenuItem>\n                {interpolators['Sequential (Single Hue)'].map(item => (\n                    <MenuItem title={stripInterpolate(item)} value={item} key={item}>\n                        <ColorSchemeLegend width={width}\n                                           label={false} height={height}\n                                           scale={this.getScale(item)}/>\n                    </MenuItem>))}\n\n                <MenuItem key=\"Sequential (Multi-Hue)\" value=\"Sequential (Multi-Hue)\" divider disabled>\n                    Sequential (Multi-Hue)\n                </MenuItem>\n                {interpolators['Sequential (Multi-Hue)'].map(item => (\n                    <MenuItem title={stripInterpolate(item)} value={item} key={item}>\n\n                        <ColorSchemeLegend width={width}\n                                           label={false} height={height}\n                                           scale={this.getScale(item)}/>\n\n                    </MenuItem>))}\n\n                <MenuItem key=\"Cyclical\" value=\"Cyclical\" divider disabled>\n                    Cyclical\n                </MenuItem>\n                {interpolators['Cyclical'].map(item => (\n                    <MenuItem title={stripInterpolate(item)} value={item} key={item}>\n                        <ColorSchemeLegend width={width}\n                                           label={false} height={height}\n                                           scale={this.getScale(item)}/>\n                    </MenuItem>))}\n\n\n            </Select>\n        );\n    }\n\n}\n\n\nexport default withStyles(styles)(ColorSchemeSelector);\n","import {scaleLinear} from 'd3-scale';\nimport React from 'react';\nimport {numberFormat} from './formatters';\n\nexport function drawSizeLegend(context, scale, nsteps, width, margin = 20, textColor = 'black') {\n    let domain = scale.domain();\n\n    let stepSize = (domain[1] - domain[0]) / (nsteps + 1);\n    let steps = [];\n    steps.push(domain[0]);\n    let value = domain[0];\n    for (let i = 0; i < nsteps; i++) {\n        value += stepSize;\n        steps.push(value);\n    }\n    steps.push(domain[1]);\n\n    let legendHeight = 20;\n    let valueToX = scaleLinear().range([margin, width - margin]).domain([0, steps.length - 1]).clamp(true);\n    let valueToRadius = scaleLinear().range([1, 9]).domain(domain).clamp(true);\n\n    context.textBaseline = 'top';\n    context.fillStyle = textColor;\n    context.strokeStyle = textColor;\n    context.textAlign = 'center';\n\n    for (let i = 0; i < steps.length; i++) {\n        let pix = valueToX(i);\n\n        let radius = valueToRadius(steps[i]);\n        context.beginPath();\n        context.arc(pix, 10, radius, 0, Math.PI * 2);\n        context.stroke();\n        let text = numberFormat(100 * steps[i]);\n        if (text.endsWith(\".0\")) {\n            text = text.substring(0, text.length - 2);\n        }\n        context.fillText(text, pix, legendHeight + 2);\n\n    }\n}\n\nclass SizeLegend extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.ref = React.createRef();\n        this.backingScale = 1;\n    }\n\n    redraw() {\n        let backingScale = this.backingScale;\n        let node = this.ref.current;\n        const context = node.getContext('2d');\n        const height = this.props.height;\n        const width = this.props.width;\n        const textColor = this.props.textColor || 'black';\n        context.font = '12px Roboto Condensed,Helvetica,Arial,sans-serif';\n        context\n            .clearRect(0, 0, width * backingScale, height * backingScale);\n        context.scale(backingScale, backingScale);\n        const scale = this.props.scale;\n        if (scale == null) {\n            return;\n        }\n\n        drawSizeLegend(context, scale, this.props.nsteps || 3, width, 20, textColor);\n        context.setTransform(1, 0, 0, 1, 0, 0);\n\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        this.redraw();\n    }\n\n    componentDidMount() {\n        this.redraw();\n    }\n\n    render() {\n\n        let backingScale = 1;\n        if (typeof window !== 'undefined' && 'devicePixelRatio' in window) {\n            backingScale = window.devicePixelRatio;\n        }\n        this.backingScale = backingScale;\n        let height = this.props.height;\n        let width = this.props.width;\n        let style = {width: width, height: height};\n        if (this.props.style) {\n            style = Object.assign({}, style, this.props.style);\n        }\n        return (\n            <canvas width={width * backingScale} height={height * backingScale} ref={this.ref} style={style}></canvas>);\n\n    }\n}\n\nexport default SizeLegend;\n\n","import {Tooltip, withStyles} from '@material-ui/core';\nimport FormControl from '@material-ui/core/FormControl';\nimport IconButton from '@material-ui/core/IconButton';\nimport Input from '@material-ui/core/Input';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\nimport Typography from '@material-ui/core/Typography';\nimport PhotoCameraIcon from '@material-ui/icons/PhotoCamera';\nimport natsort from 'natsort';\nimport React from 'react';\nimport {drawColorScheme} from './ColorSchemeLegend';\nimport {numberFormat} from './formatters';\nimport {drawSizeLegend} from './SizeLegend';\n\nconst styles = theme => ({\n    root: {},\n    formControl: {\n        display: 'block',\n        margin: theme.spacing(1),\n    }\n\n});\n\nlet svgFont = '12px Helvetica,Arial,sans-serif';\nlet canvasFont = '12px Roboto Condensed,Helvetica,Arial,sans-serif';\n\n\nclass DotPlotCanvas extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.divRef = React.createRef();\n        this.tooltipElementRef = React.createRef();\n        this.canvas = null;\n        this.state = {saveImageEl: null};\n    }\n\n    onSortOrderChanged = (event) => {\n        this.props.onSortOrderChanged({name: this.props.data.name, value: event.target.value});\n    };\n\n\n    redraw() {\n\n        if (this.props.data == null) {\n            return <div/>;\n        }\n        let devicePixelRatio = 1;\n        if (typeof window !== 'undefined' && 'devicePixelRatio' in window) {\n            devicePixelRatio = window.devicePixelRatio;\n        }\n\n        if (this.canvas == null) {\n            let onMouseMove = (event) => {\n                const node = event.target;\n                const maxRadius = this.props.sizeScale.range()[1];\n                var rect = node.getBoundingClientRect();\n                let xy = [event.clientX - rect.left - node.clientLeft, event.clientY - rect.top - node.clientTop];\n                // xy[0] /= devicePixelRatio;\n                // xy[1] /= devicePixelRatio;\n                const col = Math.floor((xy[0] - this.size.x) / (maxRadius * 2));\n                const row = Math.floor((xy[1]) / (maxRadius * 2));\n\n                if (col >= 0 && col < this.dotplot.values.length && row >= 0 && row < this.categories.length) {\n                    this.tooltipElementRef.current.innerHTML = '';\n                    let featureDatum = this.dotplot.values[col];\n                    const mean = featureDatum.mean[this.categoryOrder[row]];\n                    const fractionExpressed = featureDatum.fractionExpressed[this.categoryOrder[row]];\n                    // const renamedCategories = this.props.renamedCategories || {};\n                    // const categories = this.categories;\n                    // let category = categories[this.categoryOrder[row]];\n                    // let newName = renamedCategories[category];\n                    // if (newName != null) {\n                    //     category = newName;\n                    // }\n                    this.tooltipElementRef.current.innerHTML = 'mean: ' + numberFormat(mean) + ', % expressed: ' + numberFormat(100 * fractionExpressed);\n                } else {\n                    this.tooltipElementRef.current.innerHTML = '';\n                }\n            };\n            let onMouseOut = (event) => {\n                this.tooltipElementRef.current.innerHTML = '';\n\n            };\n            // onMouseMove = throttle(onMouseMove);\n            this.canvas = document.createElement('canvas');\n            this.canvas.addEventListener(\"mousemove\", onMouseMove);\n            this.canvas.addEventListener(\"mouseout\", onMouseOut);\n            this.divRef.current.append(this.canvas);\n        }\n\n        const height = this.size.height + this.size.y;\n        const width = this.size.width + this.size.x;\n        let canvas = this.canvas;\n        const context = canvas.getContext('2d');\n        canvas.width = width * devicePixelRatio;\n        canvas.height = height * devicePixelRatio;\n        canvas.style.width = width + 'px';\n        canvas.style.height = height + 'px';\n        context.font = canvasFont;\n\n        context\n            .clearRect(0, 0, width * devicePixelRatio, height * devicePixelRatio);\n        context.scale(devicePixelRatio, devicePixelRatio);\n        this.drawContext(context);\n    }\n\n    drawContext(context) {\n        const renamedCategories = this.props.renamedCategories || {};\n        const dotplot = this.dotplot;\n        const colorScale = this.props.colorScale;\n        const features = this.features;\n        const sizeScale = this.props.sizeScale;\n        const categories = this.categories;\n        const drawCircles = this.props.drawCircles;\n        const categoryOrder = this.categoryOrder;\n        const textColor = this.props.textColor;\n        const maxRadius = sizeScale.range()[1];\n        let diameter = maxRadius * 2;\n        // context.strokeStyle = gridColor;\n        // context.lineWidth = gridThickness;\n        dotplot.values.forEach((datum, featureIndex) => { // each feature\n            for (let i = 0; i < datum.mean.length; i++) { // each category\n                const mean = datum.mean[categoryOrder[i]];\n                const color = colorScale(mean);\n                context.fillStyle = color;\n\n\n                context.beginPath();\n\n                if (drawCircles) {\n                    const xpix = featureIndex * diameter + maxRadius + this.size.x;\n                    const ypix = i * diameter + maxRadius;\n                    const frac = datum.fractionExpressed[categoryOrder[i]];\n                    context.arc(xpix, ypix, sizeScale(frac), 0, 2 * Math.PI);\n                } else {\n                    const xpix = featureIndex * diameter + this.size.x;\n                    const ypix = i * diameter;\n                    context.rect(xpix, ypix, diameter, diameter);\n                }\n                context.fill();\n                // context.stroke();\n            }\n        });\n        // context.lineWidth = 1;\n        context.textAlign = 'right';\n        context.fillStyle = textColor;\n        context.textBaseline = 'middle';\n\n        for (let i = 0; i < categories.length; i++) {\n            let category = categories[categoryOrder[i]];\n            let newName = renamedCategories[category];\n            if (newName != null) {\n                category = newName;\n            }\n            const pix = i * diameter + maxRadius;\n            context.fillText(category, this.size.x - 4, pix);\n        }\n        context.textAlign = 'right';\n        context.textBaseline = 'top';\n        for (let i = 0; i < features.length; i++) {\n            const text = features[i];\n            const pix = i * diameter;\n            context.save();\n            context.translate(this.size.x + pix + 4, this.size.height);\n            context.rotate(-Math.PI / 2);\n            context.fillText(text, 0, 0);\n            context.restore();\n\n        }\n\n        // context.strokeStyle = gridColor;\n        // context.lineWidth = gridThickness;\n        //\n        //\n        // for (let i = 0; i < categories.length; i++) {\n        //     const ypix = i * diameter;\n        //     context.beginPath();\n        //     context.moveTo(this.size.x + 2, ypix);\n        //     context.lineTo(width, ypix);\n        //     context.stroke();\n        // }\n        // for (let i = 0; i < features.length; i++) {\n        //     const xpix = i * diameter + this.size.x + 2;\n        //     context.beginPath();\n        //     context.moveTo(xpix, 0);\n        //     context.lineTo(xpix, dotplotHeight);\n        //     context.stroke();\n        // }\n\n        context.setTransform(1, 0, 0, 1, 0, 0);\n\n    }\n\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        this.redraw();\n    }\n\n    componentDidMount() {\n        this.redraw();\n    }\n\n    getSize(context) {\n        let maxFeatureWidth = 0;\n        const renamedCategories = this.props.renamedCategories || {};\n        this.dotplot.values.forEach(datum => {\n            maxFeatureWidth = Math.max(maxFeatureWidth, context.measureText(datum.name).width);\n        });\n        maxFeatureWidth += 4;\n        let xoffset = 0;\n        this.categories.forEach(category => {\n            let renamed = renamedCategories[category];\n            if (renamed != null) {\n                category = renamed;\n            }\n            xoffset = Math.max(xoffset, context.measureText(category).width);\n        });\n        xoffset += 4;\n        const maxRadius = this.props.sizeScale.range()[1];\n        const diameter = maxRadius * 2;\n        const height = this.categories.length * diameter + 4;\n        const width = this.features.length * diameter + 4;\n        return {x: xoffset, y: maxFeatureWidth, width: width, height: height};\n    }\n\n    update() {\n\n        let dotplot = Object.assign({}, this.props.data);\n        const renamedCategories = this.props.renamedCategories || {};\n        if (dotplot != null && dotplot.selection) {\n            dotplot = dotplot.selection;\n        }\n        this.dotplot = dotplot;\n        const categories = dotplot.categories || [''];\n\n        this.categories = categories;\n        const features = dotplot.values.map(feature => feature.name);\n\n        if (dotplot.sortBy == null) {\n            dotplot.sortBy = dotplot.name;\n        }\n        let categoryOrder = [];\n        for (let i = 0; i < categories.length; i++) {\n            categoryOrder.push(i);\n        }\n        if (dotplot.sortBy !== dotplot.name) { // sort by feature\n            let sortByDatum;\n            for (let i = 0; i < dotplot.values.length; i++) {\n                if (dotplot.values[i].name === dotplot.sortBy) {\n                    sortByDatum = dotplot.values[i];\n                    break;\n                }\n            }\n            if (sortByDatum) {\n                categoryOrder.sort((a, b) => {\n                    let val1 = sortByDatum.mean[a];\n                    let val2 = sortByDatum.mean[b];\n                    let c = val1 === val2 ? 0 : (val1 > val2 ? -1 : 1);\n                    if (c === 0) {\n                        val1 = sortByDatum.fractionExpressed[a];\n                        val2 = sortByDatum.fractionExpressed[b];\n                        c = val1 === val2 ? 0 : (val1 > val2 ? -1 : 1);\n                    }\n                    return c;\n                });\n\n            }\n        } else { // sort by category\n            if (Object.keys(renamedCategories).length > 0) {\n                const sorter = natsort();\n                categoryOrder.sort((a, b) => {\n                    let val1 = categories[a];\n                    let renamed1 = renamedCategories[val1];\n                    if (renamed1 != null) {\n                        val1 = renamed1;\n                    }\n                    let val2 = categories[b];\n                    let renamed2 = renamedCategories[val2];\n                    if (renamed2 != null) {\n                        val2 = renamed2;\n                    }\n                    return sorter(val1, val2);\n                });\n            }\n\n        }\n\n        const canvas = document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        context.font = canvasFont;\n        this.features = features;\n        this.size = this.getSize(context);\n        this.categoryOrder = categoryOrder;\n\n    }\n\n    handleSaveImageMenu = (event) => {\n        this.setState({saveImageEl: event.currentTarget});\n    };\n    handleSaveImageMenuClose = (event) => {\n        this.setState({saveImageEl: null});\n    };\n\n\n    handleSaveImage = (format) => {\n        this.setState({saveImageEl: null});\n        let context;\n\n        let canvas;\n        if (format === 'svg') {\n            context = new window.C2S(10, 10);\n            context.font = svgFont;\n        } else {\n            canvas = document.createElement('canvas');\n            context = canvas.getContext('2d');\n            context.font = canvasFont;\n        }\n\n        const size = this.getSize(context);\n\n        const colorScaleHeight = 40;\n        const sizeScaleHeight = 40;\n        const height = size.height + size.y + colorScaleHeight + sizeScaleHeight + 10;\n        const width = Math.max(200, size.width + size.x);\n        let scale = 1;\n        if (format === 'svg') {\n            context = new window.C2S(width, height);\n            context.font = svgFont;\n        } else {\n            canvas.width = width * window.devicePixelRatio;\n            canvas.height = height * window.devicePixelRatio;\n            context = canvas.getContext('2d');\n            scale = window.devicePixelRatio;\n            context.scale(window.devicePixelRatio, window.devicePixelRatio);\n            context.font = canvasFont;\n        }\n        const textColor = this.props.textColor;\n        if (textColor === 'white') {\n            context.fillStyle = 'black';\n            context.fillRect(0, 0, width, height);\n        }\n        this.drawContext(context);\n\n        // if (format !== 'svg') {\n        //     context.scale(window.devicePixelRatio, window.devicePixelRatio);\n        // }\n\n        context.translate(scale * 10, scale * (size.height + size.y + 4));\n        drawColorScheme(context, 150, colorScaleHeight, this.props.colorScale, true, 10, textColor);\n\n        context.translate(-10, (colorScaleHeight + 4));\n\n        drawSizeLegend(context, this.props.sizeScale, 3, 150, 20, textColor);\n\n        if (format === 'svg') {\n            let svg = context.getSerializedSvg();\n            // let prefix = [];\n            // prefix.push('<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n');\n            // prefix.push('<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"' +\n            //     ' \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n');\n            // svg = prefix.join('') + svg;\n            let blob = new Blob([svg], {\n                type: 'text/plain;charset=utf-8'\n            });\n            window.saveAs(blob, this.dotplot.name + '.svg');\n        } else {\n            canvas.toBlob(blob => {\n                window.saveAs(blob, this.dotplot.name + '.png', true);\n            });\n        }\n    };\n\n    render() {\n        this.update();\n        const {saveImageEl} = this.state;\n        const dotplot = this.dotplot;\n        const features = this.features;\n        const sortChoices = [dotplot.name].concat(features);\n        return (<div style={{position: 'relative'}}>\n            <div>\n                <Typography style={{display: 'inline-block'}} component={\"h4\"}\n                            color=\"textPrimary\">{dotplot.name}{this.props.subtitle &&\n                <small>({this.props.subtitle})</small>}</Typography>\n                <Tooltip title={\"Save Image\"}>\n                    <IconButton aria-controls=\"save-image-menu\" aria-haspopup=\"true\" edge={false}\n                                size={'small'}\n                                aria-label=\"Save Image\" onClick={this.handleSaveImageMenu}>\n                        <PhotoCameraIcon/>\n                    </IconButton>\n                </Tooltip>\n                <Menu\n                    id=\"save-image-menu\"\n                    anchorEl={saveImageEl}\n                    keepMounted\n                    open={Boolean(saveImageEl)}\n                    onClose={this.handleSaveImageMenuClose}\n                >\n                    <MenuItem onClick={e => this.handleSaveImage('png')}>PNG</MenuItem>\n                    <MenuItem onClick={e => this.handleSaveImage('svg')}>SVG</MenuItem>\n\n                </Menu>\n\n                <Typography color=\"textPrimary\" className=\"cirro-condensed\" ref={this.tooltipElementRef} style={{\n                    display: 'inline-block',\n                    paddingLeft: 5,\n                    verticalAlign: 'top',\n                    whiteSpace: 'nowrap',\n                    width: 500,\n                    minWidth: 500,\n                    maxWidth: 500,\n                    textOverflow: 'ellipsis'\n                }}></Typography>\n\n                {this.props.onSortOrderChanged ? <FormControl className={this.props.classes.formControl}>\n                    <InputLabel shrink={true}>Sort By</InputLabel>\n                    <Select\n\n                        input={<Input size={\"small\"}/>}\n                        onChange={this.onSortOrderChanged}\n                        value={dotplot.sortBy}\n                    >\n                        {sortChoices.map(item => (\n                            <MenuItem key={item} value={item}>{item}</MenuItem>\n                        ))}\n                    </Select>\n                </FormControl> : null}\n            </div>\n            <div ref={this.divRef}></div>\n\n        </div>);\n\n    }\n}\n\nexport default withStyles(styles)(DotPlotCanvas);\n\n\n","import {InputLabel} from '@material-ui/core';\nimport Grid from '@material-ui/core/Grid';\nimport Switch from '@material-ui/core/Switch';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\nimport {scaleLinear, scaleSequential} from 'd3-scale';\nimport {debounce} from 'lodash';\nimport React from 'react';\nimport ColorSchemeSelector from './ColorSchemeSelector';\nimport DotPlotCanvas from './DotPlotCanvas';\nimport {numberFormat} from './formatters';\nimport SizeLegend from './SizeLegend';\n\nexport class DotPlotGroup extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {min: '', max: '', minSize: '', sizeMax: '', forceUpdate: false, drawCircles: true};\n        this.updateMinSize = debounce(this.updateMinSize, 500);\n        this.updateMaxSize = debounce(this.updateMaxSize, 500);\n        this.updateMin = debounce(this.updateMin, 500);\n        this.updateMax = debounce(this.updateMax, 500);\n    }\n\n    onMinChange = (event) => {\n        this.setState({min: event.target.value});\n        this.updateMin(event.target.value);\n    };\n\n    updateMin = (value) => {\n        this.props.categoryItem.minCustom = parseFloat(value);\n        this.setState({forceUpdate: !this.state.forceUpdate});\n    };\n\n    onMaxChange = (event) => {\n        this.setState({max: event.target.value});\n        this.updateMax(event.target.value);\n    };\n\n    updateMax = (value) => {\n        this.props.categoryItem.maxCustom = parseFloat(value);\n        this.setState({forceUpdate: !this.state.forceUpdate});\n    };\n\n\n    onMinSizeChange = (event) => {\n        this.setState({minSize: event.target.value});\n        this.updateMinSize(event.target.value);\n    };\n\n    updateMinSize = (value) => {\n        this.props.categoryItem.minSizeCustom = parseFloat(value);\n        if (this.props.categoryItem.minSizeCustom > 1) {\n            this.props.categoryItem.minSizeCustom /= 100; // fraction\n        }\n        this.setState({forceUpdate: !this.state.forceUpdate});\n\n    };\n\n    onMaxSizeChange = (event) => {\n        this.setState({sizeMax: event.target.value});\n        this.updateMaxSize(event.target.value);\n    };\n\n    updateMaxSize = (value) => {\n        this.props.categoryItem.maxSizeCustom = parseFloat(value);\n        if (this.props.categoryItem.maxSizeCustom > 1) {\n            this.props.categoryItem.maxSizeCustom /= 100; // fraction\n        }\n        this.setState({forceUpdate: !this.state.forceUpdate});\n    };\n\n\n    onHeatmapChange = (event) => {\n        this.setState({drawCircles: !event.target.checked});\n    };\n\n\n    render() {\n\n        const {textColor, categoryItem, renamedCategories, selectedData, interpolator} = this.props;\n        let meanRange = categoryItem.meanRange;\n        let fractionRange = categoryItem.fractionRange;\n\n        meanRange = meanRange.slice();\n        fractionRange = fractionRange.slice();\n        if (selectedData != null) {\n\n            meanRange[0] = Math.min(meanRange[0], selectedData.meanRange[0]);\n            meanRange[1] = Math.max(meanRange[1], selectedData.meanRange[1]);\n            fractionRange[0] = Math.min(fractionRange[0], selectedData.fractionRange[0]);\n            fractionRange[1] = Math.max(fractionRange[1], selectedData.fractionRange[1]);\n        }\n        if (meanRange[0] === meanRange[1]) {\n            meanRange[1]++;\n        }\n        if (fractionRange[0] === fractionRange[1]) {\n            fractionRange[0] = 0;\n            fractionRange[1] = 1;\n        }\n        if (meanRange[0] > 0) {\n            meanRange[0] = 0;\n        }\n        if (fractionRange[0] > 0) {\n            fractionRange[0] = 0;\n        }\n        if (fractionRange[1] < 1) {\n            fractionRange[1] = 1;\n        }\n\n\n        if (categoryItem.minCustom != null && !isNaN(categoryItem.minCustom)) {\n            meanRange[0] = categoryItem.minCustom;\n        }\n        if (categoryItem.maxCustom != null && !isNaN(categoryItem.maxCustom)) {\n            meanRange[1] = categoryItem.maxCustom;\n        }\n\n        if (categoryItem.minSizeCustom != null && !isNaN(categoryItem.minSizeCustom)) {\n            fractionRange[0] = categoryItem.minSizeCustom;\n        }\n\n        if (categoryItem.maxSizeCustom != null && !isNaN(categoryItem.maxSizeCustom)) {\n            fractionRange[1] = categoryItem.maxSizeCustom;\n        }\n\n\n        const maxRadius = 9;\n        const minRadius = 1;\n        const colorScale = scaleSequential(interpolator.value).domain(meanRange).clamp(true);\n        const sizeScale = scaleLinear().domain(fractionRange).range([minRadius, maxRadius]).clamp(true);\n        return (\n            <React.Fragment key={categoryItem.name}>\n                <DotPlotCanvas renamedCategories={renamedCategories}\n                               colorScale={colorScale}\n                               sizeScale={sizeScale}\n                               legend={selectedData == null}\n                               meanRange={meanRange}\n                               fractionRange={fractionRange}\n                               textColor={textColor}\n                               drawCircles={this.state.drawCircles}\n                               onSortOrderChanged={this.props.onSortOrderChanged}\n                               data={categoryItem}/>\n                {selectedData != null ?\n                    <DotPlotCanvas renamedCategories={renamedCategories}\n                                   colorScale={colorScale}\n                                   sizeScale={sizeScale}\n                                   subtitle=\"selection\"\n                                   legend={true}\n                                   textColor={textColor}\n                                   drawCircles={this.state.drawCircles}\n                                   meanRange={meanRange}\n                                   fractionRange={fractionRange}\n                                   data={selectedData}/> : null}\n                <ColorSchemeSelector handleInterpolator={this.props.handleInterpolator} interpolator={interpolator}/>\n                <div style={{color: textColor, width: 174}}><Typography\n                    variant={\"caption\"}>{numberFormat(colorScale.domain()[0])}</Typography><Typography\n                    variant={\"caption\"}\n                    style={{float: 'right'}}>{numberFormat(colorScale.domain()[1])}</Typography></div>\n                {/*<ColorSchemeLegend style={{display: 'block', marginLeft: 10}}*/}\n                {/*                   width={186}*/}\n                {/*                   textColor={textColor}*/}\n                {/*                   label={true} height={40}*/}\n                {/*                   scale={colorScale}/>*/}\n\n                <InputLabel shrink={true} variant={\"standard\"}>Custom Mean</InputLabel>\n                <TextField\n                    InputLabelProps={{shrink: true}} style={{width: 90, marginRight: 4}}\n                    size=\"small\" type=\"text\"\n                    onChange={this.onMinChange} label={\"Min\"}\n                    value={this.state.min}/>\n                <TextField InputLabelProps={{shrink: true}} style={{width: 90}} size=\"small\"\n                           type=\"text\"\n                           onChange={this.onMaxChange} label={\"Max\"}\n                           value={this.state.max}/>\n\n\n                {this.state.drawCircles && <div style={{paddingTop: 16}}>\n                    <SizeLegend style={{display: 'block'}}\n                                width={150}\n                                textColor={textColor}\n                                label={true} height={40}\n                                scale={sizeScale}/>\n                    <InputLabel style={{marginTop: 16}} shrink={true} variant={\"standard\"}>Custom Percent\n                        Expressed</InputLabel>\n                    <TextField InputLabelProps={{shrink: true}} style={{width: 90, marginRight: 4}}\n                               size=\"small\" type=\"text\"\n                               onChange={this.onMinSizeChange} label={\"Min\"}\n                               value={this.state.minSize}/>\n                    <TextField InputLabelProps={{shrink: true}} style={{width: 90}} size=\"small\" type=\"text\"\n                               onChange={this.onMaxSizeChange} label={\"Max\"}\n                               value={this.state.maxSize}/>\n                </div>}\n\n                <div style={{paddingTop: 16}}>\n                    <Grid component=\"label\" alignContent={\"flex-start\"} container alignItems=\"center\"\n                          spacing={0}>\n\n                        <Grid item>\n                            <Switch style={{display: 'inline'}} size=\"small\" checked={!this.state.drawCircles}\n                                    onChange={this.onHeatmapChange}\n                                    name=\"heatmap\"/>\n                        </Grid>\n                        <Grid item><InputLabel shrink={false} variant={\"standard\"}>Heat Map</InputLabel></Grid>\n                    </Grid>\n\n                </div>\n            </React.Fragment>\n        );\n    }\n\n}\n","import React from 'react';\n\nimport {connect} from 'react-redux';\nimport {setDotPlotInterpolator, setDotPlotSortOrder} from './actions';\nimport {DotPlotGroup} from './DotPlotGroup';\n\nclass DotPlots extends React.PureComponent {\n    render() {\n        const {chartOptions, dotPlotData, dotPlotInterpolator, categoricalNames, handleInterpolator, onSortOrderChanged, selectedDotPlotData} = this.props;\n\n        if (dotPlotData.length === 0) {\n            return <h4>Please enter one or more categorical observations and one or more features.</h4>;\n        }\n        const textColor = chartOptions.darkMode ? 'white' : 'black';\n        let selectedDotPlotNameToData = {};\n        selectedDotPlotData.forEach(categoryItem => {\n            selectedDotPlotNameToData[categoryItem.name] = categoryItem;\n        });\n        return <div>\n            {dotPlotData.map((categoryItem) => {\n                let selectedData = selectedDotPlotNameToData[categoryItem.name];\n                let renamedCategories = categoricalNames[categoryItem.name];\n                return <DotPlotGroup key={categoryItem.name}\n                                     categoryItem={categoryItem}\n                                     selectedData={selectedData}\n                                     interpolator={dotPlotInterpolator}\n                                     handleInterpolator={handleInterpolator}\n                                     onSortOrderChanged={onSortOrderChanged}\n                                     renamedCategories={renamedCategories}\n                                     textColor={textColor}/>;\n            })}\n        </div>;\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        chartOptions: state.chartOptions,\n        dotPlotInterpolator: state.dotPlotInterpolator,\n        dotPlotData: state.dotPlotData,\n        selectedDotPlotData: state.selectedDotPlotData,\n        categoricalNames: state.categoricalNames\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        onSortOrderChanged: (payload) => {\n            dispatch(setDotPlotSortOrder(payload));\n        },\n        handleInterpolator: value => {\n            dispatch(setDotPlotInterpolator(value));\n        },\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(DotPlots));\n\n","import {CircularProgress, InputLabel} from '@material-ui/core';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\n\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport Link from '@material-ui/core/Link';\nimport Tab from '@material-ui/core/Tab';\nimport Tabs from '@material-ui/core/Tabs';\nimport TextField from '@material-ui/core/TextField';\nimport React from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport {connect} from 'react-redux';\nimport {EDIT_DATASET_DIALOG, saveDataset, setDialog, setMessage} from './actions';\n\nfunction TabPanel(props) {\n    const {children, value, index, ...other} = props;\n\n    return (\n        <div\n            role=\"tabpanel\"\n            hidden={value !== index}\n            id={`editor-tabpanel-${index}`}\n            aria-labelledby={`editor-tab-${index}`}\n            {...other}\n        >\n            {value === index && (\n                <Box>\n                    {children}\n                </Box>\n            )}\n        </div>\n    );\n}\n\n\nfunction getUniqueArray(text) {\n    let tokens = text.split(',');\n    let values = new Set();\n    for (let i = 0; i < tokens.length; i++) {\n        let s = tokens[i].trim().toLowerCase();\n        if (s !== '') {\n            values.add(s);\n        }\n    }\n    return Array.from(values);\n}\n\nclass EditDatasetDialog extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            url: '',\n            tabValue: 0,\n            name: this.props.dataset != null ? this.props.dataset.name : '',\n            title: this.props.title != null ? (this.props.dataset.title != null ? this.props.dataset.title : '') : '',\n            description: this.props.dataset != null ? (this.props.dataset.description != null ? this.props.dataset.description : '') : '',\n            readers: '',\n            loading: this.props.dataset != null,\n        };\n    }\n\n\n    componentDidMount() {\n\n        if (this.props.dataset != null) {\n\n            let readers = this.props.dataset.readers.slice();\n            let myIndex = readers.indexOf(this.props.email);\n            if (myIndex !== -1) {\n                readers.splice(myIndex, 1);\n            }\n            this.setState({\n                name: this.props.dataset.name,\n                description: this.props.dataset.description != null ? this.props.dataset.description : '',\n                title: this.props.dataset.title != null ? this.props.dataset.title : '',\n                loading: false,\n                url: this.props.dataset.url,\n                readers: readers.join(', '),\n            });\n\n        }\n    }\n\n    handleClose = () => {\n        this.props.handleCancel();\n    };\n\n    handleSave = () => {\n        let name = this.state.name.trim();\n        let url = this.state.url.trim();\n        if (name === '' || url === '') {\n            return;\n        }\n        let description = this.state.description.trim();\n        let title = this.state.title.trim();\n        this.setState({loading: true});\n        let readers = getUniqueArray(this.state.readers);\n        this.props.handleSave({\n            dataset: this.props.dataset,\n            name: name,\n            title: title,\n            description: description,\n            url: url,\n            readers: readers\n        });\n    };\n\n    onTabChanged = (event, value) => {\n        this.setState({tabValue: value});\n    };\n    onEmailChanged = (event) => {\n        this.setState({readers: event.target.value});\n    };\n    onUrlChanged = (event) => {\n        this.setState({url: event.target.value});\n    };\n    onNameChanged = (event) => {\n        this.setState({name: event.target.value});\n    };\n    onDescriptionChanged = (event) => {\n        this.setState({description: event.target.value});\n    };\n    onTitleChanged = (event) => {\n        this.setState({title: event.target.value});\n    };\n\n    render() {\n        return (\n            <Dialog\n                open={true}\n                onClose={this.handleClose}\n                aria-labelledby=\"edit-dataset-dialog-title\"\n                fullWidth={true}\n                maxWidth={'lg'}\n            >\n                <DialogTitle id=\"edit-dataset-dialog-title\">{this.props.dataset == null\n                    ? 'New'\n                    : 'Edit'} Dataset</DialogTitle>\n                <DialogContent>\n                    {this.state.loading && <CircularProgress/>}\n                    <TextField\n                        disabled={this.state.loading}\n                        autoComplete=\"off\"\n                        required={true}\n                        value={this.state.name}\n                        helperText={\"asfd\"}\n                        onChange={this.onNameChanged}\n                        margin=\"dense\"\n                        label=\"Name\"\n                        fullWidth\n                    />\n\n                    {!this.state.loading &&\n                    <TextField\n                        required={true}\n                        autoComplete=\"off\"\n                        value={this.state.url}\n                        onChange={this.onUrlChanged}\n                        margin=\"dense\"\n                        helperText={this.props.serverInfo.email ? \"Please ensure that \" + this.props.serverInfo.email + \" has \\\"Storage Object Viewer\\\" permissions\" : ''}\n                        label={\"URL (\" + (this.props.serverInfo.email ? \"gs://my_bucket/my_dataset\" : \"/Users/foo/my_dataset\") + \")\"}\n                        fullWidth\n                    />}\n\n                    <TextField\n                        disabled={this.state.loading}\n                        autoComplete=\"off\"\n                        required={false}\n                        value={this.state.title}\n                        onChange={this.onTitleChanged}\n                        margin=\"dense\"\n                        label=\"Title\"\n                        fullWidth\n                        inputProps={{maxLength: 255}}\n                    />\n                    <div>\n                        <FormControl>\n                            <InputLabel>Summary</InputLabel>\n                            <div style={{marginTop: 36}}></div>\n                            <FormHelperText><Link\n                                href={\"https://www.markdownguide.org/cheat-sheet/\"}\n                                target=\"_blank\">Markdown Cheat Sheet</Link></FormHelperText>\n                        </FormControl>\n\n                    </div>\n\n                    <Tabs value={this.state.tabValue} onChange={this.onTabChanged}\n                          aria-label=\"description-editor\">\n                        <Tab label=\"Write\"/>\n                        <Tab label=\"Preview\"/>\n                    </Tabs>\n\n                    <TabPanel value={this.state.tabValue} index={0}>\n                        <TextField\n                            disabled={this.state.loading}\n                            autoComplete=\"off\"\n                            required={false}\n                            value={this.state.description}\n                            onChange={this.onDescriptionChanged}\n                            margin=\"dense\"\n                            fullWidth\n                            variant=\"outlined\"\n                            rows={8}\n                            rowsMax={8}\n                            multiline={true}\n                            inputProps={{maxLength: 1000}}\n                        />\n                    </TabPanel>\n                    <TabPanel value={this.state.tabValue} index={1}>\n                        {this.state.description !== '' && <Box border={1}>\n                            <ReactMarkdown linkTarget=\"_blank\" children={this.state.description}/>\n                        </Box>}\n                    </TabPanel>\n\n\n                    {!this.state.loading && this.props.serverInfo.clientId !== '' &&\n                    <TextField\n                        value={this.state.readers}\n                        onChange={this.onEmailChanged}\n                        margin=\"dense\"\n                        label=\"Share\"\n                        helperText=\"Enter comma separated list of emails\"\n                        fullWidth\n                        multiline\n                    />}\n                </DialogContent>\n                <DialogActions>\n                    <Button disabled={this.state.loading} onClick={this.handleClose} color=\"primary\">\n                        Cancel\n                    </Button>\n                    <Button disabled={this.state.loading} onClick={this.handleSave} color=\"primary\">\n                        Save\n                    </Button>\n                </DialogActions>\n\n\n            </Dialog>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        dataset: state.dialog === EDIT_DATASET_DIALOG ? state.dataset : null,\n        serverInfo: state.serverInfo,\n        email: state.email\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handleSave: value => {\n            dispatch(saveDataset(value));\n        },\n        handleCancel: value => {\n            dispatch(setDialog(null));\n        },\n        handleError: value => {\n            dispatch(setMessage(value));\n        },\n\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(EditDatasetDialog));\n\n","import {Tooltip} from '@material-ui/core';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport IconButton from '@material-ui/core/IconButton';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport TextField from '@material-ui/core/TextField';\nimport ArrowDropDownIcon from '@material-ui/icons/ArrowDropDown';\nimport React from 'react';\nimport {intFormat, numberFormat} from './formatters';\n\nclass CategoricalLegend extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            contextmenuEl: null,\n            anchorEl: null,\n            color: null,\n            name: '',\n            categoryValue: null,\n            forceUpdate: false,\n            menu: null\n        };\n    }\n\n\n    handlePopoverClose = (e) => {\n        this.setState({contextmenuEl: null, anchorEl: null});\n    };\n\n    handleColorChange = (e) => {\n        this.setState({color: e.target.value});\n    };\n    handleNameChange = (e) => {\n        this.setState({name: e.target.value});\n    };\n\n    handleColorChangeApply = (e) => {\n        this.props.handleColorChange({\n            name: this.props.name,\n            value: this.state.categoryValue,\n            color: this.state.color\n        });\n        this.setState({forceUpdate: !this.state.forceUpdate});\n    };\n    handleNameChangeApply = (e) => {\n        this.props.handleNameChange({\n            name: this.props.name,\n            oldValue: this.state.categoryValue,\n            value: this.state.name\n        });\n        this.setState({name: '', contextmenuEl: null, anchorEl: null});\n    };\n\n    handleEditColor = (e) => {\n        this.setState((prevState, props) => ({\n            anchorEl: prevState.contextmenuEl,\n            contextmenuEl: null,\n            menu: 'color'\n        }), () => {\n            // this.inputElement.click();\n        });\n    };\n    handleEditName = (e) => {\n        this.setState((prevState, props) => ({\n            anchorEl: prevState.contextmenuEl,\n            contextmenuEl: null,\n            menu: 'name',\n            name: ''\n        }), () => {\n            // this.inputElement.click();\n        });\n    };\n\n    handleContextmenuClose = (e) => {\n        this.setState({contextmenuEl: null});\n    };\n\n    handleClick = (value, index, e) => {\n        if (this.props.clickEnabled) {\n            e.preventDefault();\n            this.props.handleClick({name: this.props.name, value: value, shiftKey: e.shiftKey, metaKey: e.metaKey});\n        }\n    };\n\n    handleContextmenu = (value, index, e) => {\n        if (this.props.clickEnabled) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.setState({contextmenuEl: e.target, categoryValue: value, color: this.props.scale(value)});\n        }\n    };\n\n\n    render() {\n        const {scale, datasetFilter, name, featureSummary, maxHeight, globalFeatureSummary, nObs, nObsSelected, categoricalNames} = this.props;\n        let clickEnabled = this.props.clickEnabled;\n        const categoricalFilterValues = datasetFilter[name];\n        const selectionSummary = featureSummary[name];\n        let selectedDimensionToCount = {};\n        if (selectionSummary != null) {\n            for (let i = 0; i < selectionSummary.counts.length; i++) {\n                selectedDimensionToCount[selectionSummary.categories[i]] = selectionSummary.counts[i];\n            }\n        }\n        const globalDimensionSummary = globalFeatureSummary[name];\n        // if (globalDimensionSummary.max == null) {\n        //     let max = 0;\n        //     let min = Number.MAX_VALUE;\n        //     for (let i = 0; i < globalDimensionSummary.counts.length; i++) {\n        //         max = Math.max(max, globalDimensionSummary[i]);\n        //         min = Math.min(min, globalDimensionSummary[i]);\n        //     }\n        //     globalDimensionSummary.min = min;\n        //     globalDimensionSummary.max = max;\n        // }\n        const categories = globalDimensionSummary.categories;\n        const renamedCategories = categoricalNames[name] || {};\n        clickEnabled = clickEnabled && categories.length > 1;\n        let style = {maxHeight: maxHeight, display: 'inline-block'};\n        if (this.props.style) {\n            style = Object.assign({}, style, this.props.style);\n        }\n\n        let renamedCategoryValue = renamedCategories[this.state.categoryValue] || this.state.categoryValue;\n        return (\n            <div className=\"cirro-chart-legend\" style={style}>\n                <Dialog open={Boolean(this.state.anchorEl)} onClose={this.handlePopoverClose}\n                        aria-labelledby=\"edit-category-dialog-title\">\n\n                    {Boolean(this.state.anchorEl) && this.state.menu == 'color' && <React.Fragment>\n                        <DialogTitle id=\"edit-category-dialog-title\">Edit {renamedCategoryValue} Color</DialogTitle>\n                        <DialogContent>\n                            <input type=\"color\" value={this.state.color}\n                                   onChange={this.handleColorChange} style={{width: 100}}/>\n                        </DialogContent>\n                        <DialogActions>\n                            <Button onClick={this.handlePopoverClose} color=\"primary\">\n                                Close\n                            </Button>\n                            <Button onClick={this.handleColorChangeApply} color=\"primary\">\n                                Apply\n                            </Button>\n                        </DialogActions>\n                    </React.Fragment>}\n                    {Boolean(this.state.anchorEl) && this.state.menu == 'name' && <React.Fragment>\n                        <DialogTitle id=\"edit-category-dialog-title\">Edit {renamedCategoryValue} Name</DialogTitle>\n                        <DialogContent>\n                            <TextField type=\"text\" onChange={this.handleNameChange} value={this.state.name}/>\n                        </DialogContent>\n                        <DialogActions>\n                            <Button onClick={this.handlePopoverClose} color=\"primary\">\n                                Cancel\n                            </Button>\n                            <Button onClick={this.handleNameChangeApply} color=\"primary\">\n                                OK\n                            </Button>\n                        </DialogActions>\n                    </React.Fragment>}\n                </Dialog>\n\n                {/*<Popover*/}\n                {/*    open={Boolean(this.state.anchorEl)}*/}\n                {/*    anchorEl={this.state.anchorEl}*/}\n                {/*    onClose={this.handlePopoverClose}*/}\n                {/*    anchorOrigin={{*/}\n                {/*        vertical: 'bottom',*/}\n                {/*        horizontal: 'center',*/}\n                {/*    }}*/}\n                {/*    transformOrigin={{*/}\n                {/*        vertical: 'top',*/}\n                {/*        horizontal: 'center',*/}\n                {/*    }}*/}\n                {/*>*/}\n                {/*    <Typography>Edit {this.state.categoryValue} Color</Typography>*/}\n                {/*    <input ref={input => this.inputElement = input} type=\"color\" value={this.state.color}*/}\n                {/*           onChange={this.handleColorChange} style={{width: 100}}/>*/}\n                {/*    <Button onClick={handleClose} color=\"primary\">*/}\n                {/*        Cancel*/}\n                {/*    </Button>*/}\n                {/*    <Button onClick={handleClose} color=\"primary\">*/}\n                {/*        Apply*/}\n                {/*    </Button>*/}\n                {/*</Popover>*/}\n                <Menu\n                    anchorEl={this.state.contextmenuEl}\n                    open={Boolean(this.state.contextmenuEl)}\n                    onClose={this.handleContextmenuClose}\n                >\n                    <MenuItem onClick={this.handleEditName}>Edit Name</MenuItem>\n                    <MenuItem onClick={this.handleEditColor}>Edit Color</MenuItem>\n\n                </Menu>\n                <table style={{textAlign: 'left'}}>\n                    <thead>\n                    <tr>\n                        {clickEnabled && <td></td>}\n                        <td></td>\n                        <td><small>{'all'}</small></td>\n                        <td><small>{selectionSummary != null ? 'selection' : null}</small></td>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    {categories.map((category, i) => {\n\n                        const opacity = categoricalFilterValues == null || categoricalFilterValues.indexOf(category) !== -1 ? 1 : 0.4;\n                        // const fractionUnselected = unselectedCategoryCounts != null ? unselectedCategoryCounts[i] / unselectedTotal : null;\n                        // const unselectedSize = unselectedCategoryCounts == null ? 0 : fractionScale(fractionUnselected);\n                        // const unselectedTitle = unselectedCategoryCounts == null ? null : intFormat(unselectedCategoryCounts[i]) + ' / ' + intFormat(unselectedTotal) + (unselectedCategoryCounts[i] > 0 ? (' ( ' + numberFormat(100 * fractionUnselected) + '%)') : '');\n                        const categoryCount = globalDimensionSummary.counts[i];\n                        const selectedCategoryCount = selectedDimensionToCount[category] || 0;\n\n                        //            not-selected, selected\n                        // in category      a       b\n                        // not in category  c       d\n                        const a = categoryCount - selectedCategoryCount;\n                        const b = selectedCategoryCount;\n                        const c = nObs - nObsSelected - selectedCategoryCount;\n                        const d = nObsSelected - selectedCategoryCount;\n                        // const pValue = fisherTest(a, b, c, d);\n\n                        const fractionSelected = selectionSummary == null ? 0 : selectedCategoryCount / nObsSelected;\n                        // const selectedSize = fractionScale(fractionSelected);\n                        // const globalSize = fractionScale(count / nObs);\n                        const globalTitle = numberFormat(100 * categoryCount / nObs) + '%';\n                        let categoryText = category;\n                        let renamed = renamedCategories[category];\n                        if (renamed !== undefined) {\n                            categoryText = renamed;\n                        }\n                        const selectionTitle = selectionSummary == null ? null : numberFormat(100 * fractionSelected) + '%';\n                        return <tr\n                            style={{cursor: clickEnabled ? 'pointer' : null, opacity: opacity}}\n                            onContextMenu={(e) => this.handleContextmenu(category, i, e)}\n                            onClick={(e) => this.handleClick(category, i, e)} key={category}>\n                            {clickEnabled && <td>\n                                <div style={{\n                                    display: 'inline-block',\n                                    width: 10,\n                                    height: 10,\n                                    background: scale(category)\n                                }}/>\n\n                            </td>}\n                            <td>\n                                <div style={{\n                                    maxWidth: 140,\n                                    textOverflow: 'ellipsis',\n                                    overflow: 'hidden',\n                                    display: 'inline-block',\n                                    userSelect: 'none'\n                                }} title={'' + categoryText}>{'' + categoryText}</div>\n                                <IconButton style={{padding: 0, fontSize: 14}} size=\"small\"\n                                            onClick={(e) => this.handleContextmenu(category, i, e)} aria-label=\"Menu\"\n                                            aria-haspopup=\"true\">\n                                    <ArrowDropDownIcon fontSize={\"inherit\"}/>\n                                </IconButton>\n                            </td>\n\n                            <td>\n                                <Tooltip title={globalTitle}>\n                                    <span>{intFormat(categoryCount)}</span>\n                                </Tooltip>\n\n                                {/*<div*/}\n                                {/*    title={globalTitle}*/}\n                                {/*    style={{*/}\n                                {/*        display: 'inline-block',*/}\n                                {/*        position: 'relative',*/}\n                                {/*        width: maxSize,*/}\n                                {/*        border: '1px solid black',*/}\n                                {/*        height: 9*/}\n                                {/*    }}>*/}\n\n                                {/*    <div style={{*/}\n                                {/*        position: 'absolute',*/}\n                                {/*        width: globalSize,*/}\n                                {/*        left: 0,*/}\n                                {/*        top: 0,*/}\n                                {/*        backgroundColor: 'LightGrey',*/}\n                                {/*        height: 9*/}\n                                {/*    }}/>*/}\n                                {/*</div>*/}\n                            </td>\n                            {selectionSummary && <td>\n                                <Tooltip title={selectionTitle}>\n                                    <div>{intFormat(selectedCategoryCount)}</div>\n                                </Tooltip>\n                                {/*<div*/}\n                                {/*    title={selectionTitle}*/}\n                                {/*    style={{*/}\n                                {/*        display: 'inline-block',*/}\n                                {/*        position: 'relative',*/}\n                                {/*        width: maxSize,*/}\n                                {/*        border: '1px solid black',*/}\n                                {/*        height: 9*/}\n                                {/*    }}>*/}\n\n                                {/*    <div style={{*/}\n                                {/*        position: 'absolute',*/}\n                                {/*        width: selectedSize,*/}\n                                {/*        left: 0,*/}\n                                {/*        top: 0,*/}\n                                {/*        backgroundColor: 'LightGrey',*/}\n                                {/*        height: 9*/}\n                                {/*    }}/>*/}\n                                {/*</div>*/}\n                            </td>}\n                        </tr>;\n                    })\n                    }</tbody>\n\n                </table>\n            </div>\n        );\n    }\n}\n\nexport default CategoricalLegend;\n\n\n","import React from 'react';\nimport {numberFormat, numberFormat0} from './formatters';\n\n\nclass ContinuousLegend extends React.PureComponent {\n\n\n    getTable(summaryNames, selectionSummary, globalSummary) {\n        return (\n            <table>\n                <thead>\n                <tr>\n                    <td></td>\n                    {summaryNames.map(summaryName => {\n                        return <td key={summaryName}><small>{summaryName}</small></td>;\n                    })}\n                </tr>\n                </thead>\n                <tbody>\n                <tr>\n                    <td style={{textAlign: 'right'}}>{'Mean'}:</td>\n                    <td>{numberFormat(globalSummary.mean)}</td>\n                    {selectionSummary && <td>{numberFormat(selectionSummary.mean)}</td>}\n                </tr>\n\n                {globalSummary.numExpressed != null && <tr>\n                    <td style={{textAlign: 'right'}}>{'% Expressed'}:</td>\n                    <td>{numberFormat0(100 * globalSummary.numExpressed / this.props.nObs)}</td>\n                    {selectionSummary &&\n                    <td>{numberFormat0(100 * selectionSummary.numExpressed / this.props.nObsSelected)}</td>}\n                </tr>}\n                {(globalSummary.numExpressed == null || globalSummary.min !== 0) && <tr>\n                    <td style={{textAlign: 'right'}}>{'Min'}:</td>\n                    <td>{numberFormat(globalSummary.min)}</td>\n                    {selectionSummary && <td>{numberFormat(selectionSummary.min)}</td>}\n                </tr>}\n                <tr>\n                    <td style={{textAlign: 'right'}}>{'Max'}:</td>\n                    <td>{numberFormat(globalSummary.max)}</td>\n                    {selectionSummary && <td>{numberFormat(selectionSummary.max)}</td>}\n                </tr>\n\n                </tbody>\n\n            </table>\n        );\n    }\n\n    render() {\n        const {name, featureSummary, globalFeatureSummary} = this.props;\n        const selectionSummary = featureSummary[name];\n        const globalSummary = globalFeatureSummary[name];\n        const summaryNames = ['all'];\n        // TODO compute unselected mean and % expressed from globals\n        if (selectionSummary != null) {\n            summaryNames.push('selection');\n            //  summaryNames.push('rest');\n        }\n\n        return (\n            <React.Fragment>\n                {globalSummary != null && name !== '__count' && this.getTable(summaryNames, selectionSummary, globalSummary)}\n            </React.Fragment>);\n    }\n}\n\nexport default ContinuousLegend;\n\n\n","import {InputLabel} from '@material-ui/core';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\nimport TextField from '@material-ui/core/TextField';\nimport {debounce} from 'lodash';\nimport React from 'react';\n\n\nclass MeasureFilter extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.handleValueUpdate = debounce(this.handleValueUpdate, 500);\n    }\n\n    getFilter() {\n        let filter = this.props.datasetFilter[this.props.name];\n        if (filter == null) {\n            filter = {operation: \">\", value: NaN, uiValue: \"\"};\n            this.props.datasetFilter[this.props.name] = filter;\n        }\n        return filter;\n    }\n\n    handleOperationChanged = (event) => {\n        const operation = event.target.value;\n        this.props.handleUpdate({name: this.props.name, operation: operation, update: true});\n    };\n\n    handleValueUpdate = () => {\n        const filter = this.getFilter();\n        let value = parseFloat(filter.uiValue);\n        this.props.handleUpdate({name: this.props.name, value: value, update: true});\n\n    };\n\n    handleValueChange = (event) => {\n        const filter = this.getFilter();\n        filter.uiValue = event.target.value;\n        this.props.handleUpdate({\n            name: this.props.name,\n            operation: filter.operation,\n            value: filter.value,\n            update: false\n        });\n        this.handleValueUpdate();\n    };\n\n    render() {\n        const {name} = this.props;\n        const filter = this.getFilter();\n        const id = name + '_filter';\n\n        return (\n\n            <div style={{display: 'flex'}}>\n                <InputLabel shrink={true} id={id + '_label'}>Filter</InputLabel>\n\n                <Select\n                    labelId={id + '_label'}\n                    id={id}\n                    style={{marginRight: 6}}\n                    value={filter.operation}\n                    onChange={this.handleOperationChanged}\n                >\n                    <MenuItem value={\"\"}></MenuItem>\n                    <MenuItem value={\">\"}>{\">\"}</MenuItem>\n                    <MenuItem value={\"<\"}>{\"<\"}</MenuItem>\n                    <MenuItem value={\"=\"}>{\"=\"}</MenuItem>\n                    <MenuItem value={\">=\"}>{\">=\"}</MenuItem>\n                    <MenuItem value={\"<=\"}>{\"<=\"}</MenuItem>\n                    <MenuItem value={\"!=\"}>{\"!=\"}</MenuItem>\n                </Select>\n\n                <TextField\n                    onChange={this.handleValueChange} value={filter.uiValue} style={{maxWidth: 60}}/>\n\n            </div>\n        );\n    }\n}\n\nexport default MeasureFilter;\n\n\n\n","import {InputLabel} from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField';\nimport {debounce} from 'lodash';\nimport React from 'react';\nimport ContinuousLegend from './ContinuousLegend';\nimport MeasureFilter from './MeasureFilter';\n\nclass ColorSchemeLegendWrapper extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {min: '', max: ''};\n        this.onMinUpdate = debounce(this.onMinUpdate, 500);\n        this.onMaxUpdate = debounce(this.onMaxUpdate, 500);\n\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (prevProps.name !== this.props.name) {\n            this.setState({\n                min: '',\n                max: ''\n            });\n        }\n    }\n\n    onMinChange = (event) => {\n        this.setState({min: event.target.value});\n        this.onMinUpdate(event.target.value);\n    };\n\n    onMinUpdate = (value) => {\n        if (isNaN(value)) {\n            delete this.props.globalFeatureSummary[this.props.name].customMin;\n        } else {\n            this.props.globalFeatureSummary[this.props.name].customMin = value;\n        }\n        this.props.handleDomain({name: this.props.name, summary: this.props.globalFeatureSummary[this.props.name]});\n    };\n\n    onMaxChange = (event) => {\n        this.setState({max: event.target.value});\n        this.onMaxUpdate(event.target.value);\n    };\n\n    onMaxUpdate = (value) => {\n\n        if (isNaN(value)) {\n            delete this.props.globalFeatureSummary[this.props.name].customMax;\n        } else {\n            this.props.globalFeatureSummary[this.props.name].customMax = value;\n        }\n\n\n        this.props.handleDomain({name: this.props.name, summary: this.props.globalFeatureSummary[this.props.name]});\n\n\n    };\n\n    render() {\n        const {scale, name, nObs, nObsSelected, featureSummary, globalFeatureSummary, maxHeight, datasetFilter, handleUpdate, selected} = this.props;\n        let style = {display: 'inline-block', verticalAlign: 'top'};\n        if (this.props.style) {\n            style = Object.assign({}, style, this.props.style);\n        }\n\n        return (\n            <div className=\"cirro-condensed\" style={style}>\n                {/*ContinuousLegend shows stats table */}\n                <ContinuousLegend name={name}\n                                  selected={selected}\n                                  summary={scale.summary}\n                                  featureSummary={featureSummary}\n                                  nObs={nObs}\n                                  nObsSelected={nObsSelected}\n                                  globalFeatureSummary={globalFeatureSummary}\n                                  maxHeight={maxHeight}></ContinuousLegend>\n                {name !== '__count' && this.props.handleDomain &&\n                <InputLabel shrink={true} variant={\"standard\"}>Custom Color Scale</InputLabel>}\n                {name !== '__count' && this.props.handleDomain &&\n                <TextField InputLabelProps={{shrink: true}} margin=\"none\"\n                           style={{maxWidth: 60, marginRight: 4, marginTop: 0}}\n                           size=\"small\" type=\"text\"\n\n                           onChange={this.onMinChange} label=\"Min\"\n                           value={this.state.min}/>}\n                {name !== '__count' && this.props.handleDomain &&\n                <TextField InputLabelProps={{shrink: true}} margin=\"none\" style={{maxWidth: 60, marginTop: 0}}\n                           size=\"small\"\n                           type=\"text\"\n\n                           onChange={this.onMaxChange} label=\"Max\"\n                           value={this.state.max}/>}\n                {name !== '__count' &&\n                <MeasureFilter datasetFilter={datasetFilter} name={name} handleUpdate={handleUpdate}/>}\n                {/*{this.props.showColorScheme &&*/}\n                {/*<ColorSchemeLegend width={this.props.width} height={this.props.height} style={{paddingLeft: 10}}*/}\n                {/*                   scale={scale}*/}\n                {/*                   label={this.props.label}></ColorSchemeLegend>}*/}\n            </div>);\n\n    }\n}\n\nexport default ColorSchemeLegendWrapper;\n","class CanvasOverlayHd {\n    constructor(viewer, options) {\n        this._viewer = viewer;\n        this.backingScale = 1;\n        this._containerWidth = 0;\n        this._containerHeight = 0;\n\n\n        // this._canvasdiv.style.left = 0;\n        // this._canvasdiv.style.top = 0;\n\n\n        this._canvas = document.createElement('canvas');\n        this._canvas.style.position = 'absolute';\n        this._canvas.style.width = '100%';\n        this._canvas.style.height = '100%';\n        this._viewer.canvas.appendChild(this._canvas);\n        this.onRedraw = options.onRedraw || function () {\n        };\n        this.clearBeforeRedraw = (typeof (options.clearBeforeRedraw) !== 'undefined') ?\n            options.clearBeforeRedraw : true;\n\n        this._viewer.addHandler('update-viewport', () => {\n            this.resize();\n            this._updateCanvas();\n        });\n        this._viewer.addHandler('open', () => {\n            this.resize();\n            this._updateCanvas();\n        });\n    }\n\n    static getTileIndexFromPixel(viewer, webPoint) {\n        let viewportPos = viewer.viewport.pointFromPixel(webPoint);\n        for (let i = 0, count = viewer.world.getItemCount(); i < count; i++) {\n            let tiledImage = viewer.world.getItemAt(i);\n            // box = viewer.world.getItemAt(i).getBounds();\n            // if (viewportPos.x > box.x &&\n            //   viewportPos.y > box.y &&\n            //   viewportPos.x < box.x + box.width &&\n            //   viewportPos.y < box.y + box.height) {\n            //\n            // }\n            // tiledImage.lastDrawn.forEach(function (tile) {\n            //   if (tile.bounds.containsPoint(viewportPos)) {\n            //     console.log('lastDrawn', tile);\n            //   }\n            // });\n\n            let viewportPosRect = new window.OpenSeadragon.Rect(viewportPos.x, viewportPos.y, 0, 0);\n            let tileSourcePosRect = tiledImage._viewportToTiledImageRectangle(viewportPosRect);\n            let tileSourcePos = tileSourcePosRect.getTopLeft();\n            let source = tiledImage.source;\n            if (tileSourcePos.x >= 0 && tileSourcePos.x <= 1 && tileSourcePos.y >= 0 &&\n                tileSourcePos.y <= 1 / source.aspectRatio) {\n                return i;\n                // for (let level = source.minLevel; level <= source.maxLevel; level++) {\n                //   let tilePoint = source.getTileAtPoint(level, tileSourcePos);\n                //   return i;\n                // }\n            }\n        }\n        return -1;\n    }\n\n    canvas() {\n        return this._canvas;\n    }\n\n    context2d() {\n        return this._canvas.getContext('2d');\n    }\n\n    clear() {\n        this._canvas.getContext('2d').clearRect(0, 0, this._containerWidth * this.backingScale, this._containerHeight * this.backingScale);\n    }\n\n    resize() {\n        let backingScale = 1;\n        if (typeof window !== 'undefined' && 'devicePixelRatio' in window) {\n            backingScale = window.devicePixelRatio;\n        }\n        let backingScaleUpdated = this.backingScale !== backingScale;\n        this.backingScale = backingScale;\n        if (this._containerWidth !== this._viewer.container.clientWidth || backingScaleUpdated) {\n            this._containerWidth = this._viewer.container.clientWidth;\n            this._canvas.setAttribute('width', backingScale * this._containerWidth);\n            this._canvas.setAttribute('width', backingScale * this._containerWidth);\n            // this._canvas.style.width = this._containerWidth + 'px';\n        }\n\n        if (this._containerHeight !== this._viewer.container.clientHeight || backingScaleUpdated) {\n            this._containerHeight = this._viewer.container.clientHeight;\n            this._canvas.setAttribute('height', backingScale * this._containerHeight);\n            this._canvas.setAttribute('height', backingScale * this._containerHeight);\n            // this._canvas.style.height = this._containerHeight + 'px';\n        }\n    }\n\n    _updateCanvas() {\n        let viewportZoom = this._viewer.viewport.getZoom(true);\n        if (this.clearBeforeRedraw) {\n            this.clear();\n        }\n        let context = this._canvas.getContext('2d');\n        for (let i = 0, count = this._viewer.world.getItemCount(); i < count; i++) {\n            let image = this._viewer.world.getItemAt(i);\n            if (image) {\n                let zoom = image.viewportToImageZoom(viewportZoom);\n                let vp = image.imageToViewportCoordinates(0, 0, true);\n                let p = this._viewer.viewport.pixelFromPoint(vp, true);\n                context.scale(this.backingScale, this.backingScale);\n                context.translate(p.x, p.y);\n                context.scale(zoom, zoom);\n                this.onRedraw({index: i, context: context, x: p.x, y: p.y, zoom: zoom});\n                context.setTransform(1, 0, 0, 1, 0, 0);\n            }\n        }\n    }\n}\n\nexport default CanvasOverlayHd;\n","import OpenSeadragon from 'openseadragon';\nconst svgNS = 'http://www.w3.org/2000/svg';\n\n\nclass OpenseadragonSvgOverlay {\n\n    constructor(viewer) {\n        let self = this;\n\n        this._viewer = viewer;\n        this._containerWidth = 0;\n        this._containerHeight = 0;\n\n        this._svg = document.createElementNS(svgNS, 'svg');\n        this._svg.style.position = 'absolute';\n        this._svg.style.left = 0;\n        this._svg.style.top = 0;\n        this._svg.style.width = '100%';\n        this._svg.style.height = '100%';\n        this._viewer.canvas.appendChild(this._svg);\n\n        this._node = document.createElementNS(svgNS, 'g');\n        this._svg.appendChild(this._node);\n\n        this._viewer.addHandler('update-viewport', () => {\n            self.resize();\n        });\n\n        this._viewer.addHandler('open', function () {\n            self.resize();\n        });\n\n        this._viewer.addHandler('rotate', function (evt) {\n            self.resize();\n        });\n\n        this._viewer.addHandler('resize', function () {\n            self.resize();\n        });\n\n        this.resize();\n    }\n\n    node() {\n        return this._node;\n    }\n\n\n    resize() {\n        if (this._containerWidth !== this._viewer.container.clientWidth) {\n            this._containerWidth = this._viewer.container.clientWidth;\n            this._svg.setAttribute('width', this._containerWidth);\n        }\n\n        if (this._containerHeight !== this._viewer.container.clientHeight) {\n            this._containerHeight = this._viewer.container.clientHeight;\n            this._svg.setAttribute('height', this._containerHeight);\n        }\n\n        let p = this._viewer.viewport.pixelFromPoint(new OpenSeadragon.Point(0, 0), true);\n        let zoom = this._viewer.viewport.getZoom(true);\n        if (this._viewer.world.getItemCount() > 0) {\n            zoom = this._viewer.world.getItemAt(0).viewportToImageZoom(zoom);\n        }\n        // TODO: Expose an accessor for _containerInnerSize in the OSD API so we don't have to use the private variable.\n        //  let scale = this._viewer.viewport._containerInnerSize.x * zoom;\n\n        let rotation = this._viewer.viewport.getRotation();\n        this._node.setAttribute('transform',\n            'translate(' + p.x + ',' + p.y + ') scale(' + zoom + ') rotate(' + rotation + ')');\n    }\n}\n\n\nexport default OpenseadragonSvgOverlay;","import {Typography} from '@material-ui/core';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport {bind, uniqueId} from 'lodash';\nimport OpenSeadragon from 'openseadragon';\nimport React from 'react';\nimport simplify from 'simplify-js';\nimport {getEmbeddingKey} from './actions';\nimport CanvasOverlayHd from './CanvasOverlayHd';\nimport ChartToolbar from './ChartToolbar';\nimport {saveImage} from './ChartUtil';\nimport {numberFormat} from './formatters';\nimport OpenseadragonSvgOverlay from './OpenseadragonSvgOverlay';\nimport {getCategoryLabelsPositions} from './ThreeUtil';\nimport {arrayToSvgPath, isPointInside} from './util';\n\n\nexport function getSpotRadius(trace, pointSize) {\n    return pointSize * (trace.embedding.spatial.spot_diameter ? trace.embedding.spatial.spot_diameter / 2 : 20);\n}\n\nexport function drawImage(context, chartSize, traceInfo, selection, markerOpacity, unselectedMarkerOpacity, chartOptions, categoricalNames, spotRadius) {\n    if (traceInfo.tileSource.ready) {\n        const img = traceInfo.tileSource.levels[traceInfo.tileSource.levels.length - 1].context2D.canvas;\n        if (chartSize == null) {\n            chartSize = {width: img.width, height: img.height};\n        }\n        const zoom = Math.min(chartSize.width / img.width, chartSize.height / img.height);\n        context.drawImage(img, 0, 0, img.width * zoom, img.height * zoom);\n        context.scale(zoom, zoom);\n        drawSpots(context, zoom, traceInfo, selection, markerOpacity, unselectedMarkerOpacity, spotRadius);\n        drawLabels(context, zoom, traceInfo, chartOptions, categoricalNames);\n        context.setTransform(1, 0, 0, 1, 0, 0);\n    }\n}\n\nfunction drawLabels(context, zoom, traceInfo, chartOptions, categoricalNames) {\n    const showLabels = chartOptions.showLabels && traceInfo.isCategorical;\n    if (showLabels) {\n        context.textAlign = 'center';\n        context.textBaseline = \"middle\";\n        const darkMode = true;\n        const fontSize = Math.ceil(chartOptions.labelFontSize / zoom);\n        context.fillStyle = darkMode ? 'white' : 'black';\n        context.strokeStyle = darkMode ? 'rgba(0,0,0,0.9)' : 'rgba(255,255,255,0.9)';\n        context.lineWidth = chartOptions.labelStrokeWidth;\n        context.font = fontSize + 'px Roboto Condensed,Helvetica,Arial,sans-serif';\n        const labelsPositions = getCategoryLabelsPositions(traceInfo, categoricalNames);\n        for (let i = 0, index = 0, n = labelsPositions.labels.length; i < n; i++, index += 3) {\n            let x = labelsPositions.positions[index];\n            let y = labelsPositions.positions[index + 1];\n            context.strokeText('' + labelsPositions.labels[i], x, y);\n            context.fillText('' + labelsPositions.labels[i], x, y);\n        }\n    }\n}\n\nfunction drawSpots(context, zoom, traceInfo, selection, markerOpacity, unselectedMarkerOpacity, spotRadius) {\n    context.lineWidth = 2 * 1 / zoom;\n    if (context.setLineDash) {\n        context.setLineDash([2, 2]);\n    }\n    const isSelectionEmpty = selection.size === 0;\n    const indices = traceInfo.indices;\n    if (!isSelectionEmpty) { // draw unselected cells 1st\n        context.globalAlpha = unselectedMarkerOpacity;\n\n        for (let i = 0; i < traceInfo.x.length; i++) {\n            let index = indices[i];\n            let x = traceInfo.x[index];\n            let y = traceInfo.y[index];\n            const isSelected = selection.has(index);\n            if (!isSelected) {\n                context.fillStyle = traceInfo.colors[index];\n                context.beginPath();\n                context.arc(x, y, spotRadius, 0, Math.PI * 2, true);\n                context.fill();\n            }\n        }\n        context.globalAlpha = markerOpacity;\n        for (let i = 0; i < traceInfo.x.length; i++) {\n            let index = indices[i];\n            let x = traceInfo.x[index];\n            let y = traceInfo.y[index];\n            const isSelected = selection.has(index);\n            if (isSelected) {\n                context.fillStyle = traceInfo.colors[index];\n                context.beginPath();\n                context.arc(x, y, spotRadius, 0, Math.PI * 2, true);\n                context.fill();\n            }\n        }\n    } else {\n        context.globalAlpha = markerOpacity;\n        for (let i = 0; i < traceInfo.x.length; i++) {\n            let index = indices[i];\n            let x = traceInfo.x[index];\n            let y = traceInfo.y[index];\n            context.fillStyle = traceInfo.colors[index];\n            context.beginPath();\n            context.arc(x, y, spotRadius, 0, Math.PI * 2, true);\n            context.fill();\n        }\n    }\n    context.globalAlpha = 1;\n    if (context.setLineDash) {\n        context.setLineDash([]);\n    }\n};\nconst styles = theme => ({\n\n    root: {\n        '& > *': {\n            margin: theme.spacing(.4),\n        },\n        '& > .MuiIconButton-root': {\n            padding: 0,\n        },\n        position: 'absolute',\n        zIndex: 1,\n        top: 0,\n        left: 0,\n        display: 'inline-block',\n        verticalAlign: 'top',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n    }\n});\n\nclass ImageChart extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.id = uniqueId('cirro-image');\n        this.tooltipElementRef = React.createRef();\n        this.state = {loading: false};\n    }\n\n    findPointsInPolygon(points) {\n        let data = this.props.traceInfo;\n        // let spotRadius = data[0].embedding.spotDiameter / 2;\n        let indices = [];\n        for (let i = 0; i < data.x.length; i++) {\n            if (isPointInside({x: data.x[i], y: data.y[i]}, points)) {\n                indices.push(i);\n            }\n        }\n        return indices;\n    }\n\n    findPointsInRectangle(rect) {\n        let data = this.props.traceInfo;\n        const spotRadius = getSpotRadius(data, this.props.pointSize);\n        let indices = [];\n        const x = parseFloat(rect.getAttribute('x'));\n        const y = parseFloat(rect.getAttribute('y'));\n        const x2 = x + parseFloat(rect.getAttribute('width'));\n        const y2 = y + parseFloat(rect.getAttribute('height'));\n        for (let i = 0; i < data.x.length; i++) {\n            const px = data.x[i];\n            const py = data.y[i];\n            if (px <= x2 && x <= px + spotRadius && py <= y2 && y <= py + spotRadius) {\n                indices.push(i);\n            }\n        }\n        return indices;\n    }\n\n\n    findPointIndex(xpix, ypix) {\n        let data = this.props.traceInfo;\n        const spotRadius = getSpotRadius(data, this.props.pointSize);\n        for (let i = 0; i < data.x.length; i++) {\n            if (Math.abs(data.x[i] - xpix) <= spotRadius && Math.abs(data.y[i] - ypix) <= spotRadius) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    setTooltip(xpix, ypix) {\n        let traceInfo = this.props.traceInfo;\n        const point = this.findPointIndex(xpix, ypix);\n        if (point != -1) {\n            let value = traceInfo.values[point];\n            let categoryObject = this.props.categoricalNames[traceInfo.name];\n            if (categoryObject) {\n                let renamedValue = categoryObject[value];\n                if (renamedValue != null) {\n                    value = renamedValue;\n                }\n            }\n            if (typeof value === 'number') {\n                value = numberFormat(value);\n            }\n            this.tooltipElementRef.current.innerHTML = '' + value;\n        } else {\n            this.tooltipElementRef.current.innerHTML = ' ';\n        }\n    }\n\n\n    drawContext(context, chartSize) {\n        const img = this.viewer.source.levels[this.viewer.source.levels.length - 1].context2D.canvas;\n        if (chartSize == null) {\n            chartSize = {width: img.width, height: img.height};\n        }\n        const zoom = Math.min(chartSize.width / img.width, chartSize.height / img.height);\n        context.drawImage(img, 0, 0, img.width * zoom, img.height * zoom);\n        this._drawOverlay({context: context, zoom: zoom});\n    }\n\n    _drawOverlay(opts) {\n        let context = opts.context;\n        let traceInfo = this.props.traceInfo;\n        const selection = this.props.selection;\n        let markerOpacity = this.props.markerOpacity;\n        let unselectedMarkerOpacity = this.props.unselectedMarkerOpacity;\n        const spotRadius = getSpotRadius(traceInfo, this.props.pointSize);\n        drawSpots(context, opts.zoom, traceInfo, selection, markerOpacity, unselectedMarkerOpacity, spotRadius);\n        drawLabels(context, opts.zoom, traceInfo, this.props.chartOptions, this.props.categoricalNames);\n    }\n\n    createViewer() {\n        if (this.viewer) {\n            this.viewer.destroy();\n        }\n        // let tileSource = new OpenSeadragon.ImageTileSource({\n        //     url: url,\n        //     buildPyramid: true,\n        //     crossOriginPolicy: \"Anonymous\"\n        // });\n        if (!this.props.traceInfo.tileSource.ready) {\n            this.setState({loading: true});\n            this.props.traceInfo.tileSource.addOnceHandler('ready', (src) => {\n                this.setState({loading: false});\n            });\n        } else {\n            this.setState({loading: false});\n        }\n        this.viewer = new OpenSeadragon({\n            id: this.id,\n            gestureSettingsMouse: {dblClickToZoom: true, clickToZoom: false},\n            autoResize: true,\n            showFullPageControl: false,\n            collectionMode: false,\n            // visibilityRatio: 0.2,\n            showNavigationControl: false,\n            // prefixUrl: 'https://cdn.jsdelivr.net/npm/openseadragon@2.4/build/openseadragon/images/',\n            tileSources: this.props.traceInfo.tileSource\n        });\n        let viewer = this.viewer;\n\n        let _this = this;\n        this.canvasOverlay = new CanvasOverlayHd(this.viewer, {\n            onRedraw: function (opts) {\n                _this._drawOverlay(opts);\n            },\n        });\n        // let tooltip = document.createElement(\"div\");\n        // tooltip.style.background = 'rgba(0,0,0,0.5)';\n        // tooltip.style.color = 'white';\n        // tooltip.style.position = 'absolute';\n        // this.viewer.canvas.appendChild(tooltip);\n\n        let lassoPathArray = [];\n        let startCoordinates = [0, 0];\n        let lastBoundingBox = {x: 0, y: 0, width: 0, height: 0};\n\n        this.viewer.innerTracker.moveHandler = function (event) {\n            if (_this.tooltipElementRef.current == null) {\n                _this.tooltipElementRef.current.innerHTML = ' ';\n            } else if (_this.props.chartOptions.dragmode === 'pan' && viewer.world.getItemCount() > 0) {\n                let webPoint = event.position;\n                let viewportPoint = viewer.viewport.pointFromPixel(webPoint);\n                let imagePoint = viewer.world.getItemAt(0).viewportToImageCoordinates(viewportPoint, true);\n                _this.setTooltip(imagePoint.x, imagePoint.y);\n                // if (title !== '') {\n                //     tooltip.innerHTML = title;\n                //     tooltip.style.left = (webPoint.x + 8) + 'px';\n                //     tooltip.style.top = (webPoint.y + 8) + 'px';\n                //     tooltip.style.display = '';\n                // } else {\n                //     tooltip.style.display = 'none';\n                // }\n            } else {\n                _this.tooltipElementRef.current.innerHTML = ' ';\n            }\n        };\n        //\n        // this.viewer.innerTracker.scrollHandler = function (event) {\n        //     if (lassoState > -1) {\n        //         event.preventDefaultAction = true;\n        //     }\n        // };\n\n\n        this.viewer.addHandler('canvas-drag', function (event) {\n            if ((_this.props.chartOptions.dragmode === 'lasso' || _this.props.chartOptions.dragmode === 'select') && viewer.world.getItemCount() > 0) {\n                event.preventDefaultAction = true;\n                let webPoint = event.position;\n                let viewportPoint = viewer.viewport.pointFromPixel(webPoint);\n                let imagePoint = viewer.world.getItemAt(0).viewportToImageCoordinates(viewportPoint, true);\n                lassoPathArray.push({x: imagePoint.x, y: imagePoint.y});\n                if (_this.props.chartOptions.dragmode === 'lasso') {\n                    lassoPathArray = simplify(lassoPathArray);\n                    lassoPath.setAttribute('d', arrayToSvgPath(lassoPathArray));\n                } else {\n                    lastBoundingBox.x = Math.min(imagePoint.x, startCoordinates[0]);\n                    lastBoundingBox.y = Math.max(imagePoint.y, startCoordinates[1]);\n                    lastBoundingBox.width =\n                        Math.max(imagePoint.x, startCoordinates[0]) - lastBoundingBox.x;\n                    lastBoundingBox.height =\n                        lastBoundingBox.y - Math.min(imagePoint.y, startCoordinates[1]);\n\n                    rectElement.setAttribute('x', '' + lastBoundingBox.x);\n                    rectElement.setAttribute(\n                        'y',\n                        '' + (lastBoundingBox.y - lastBoundingBox.height)\n                    );\n                    rectElement.setAttribute('width', '' + lastBoundingBox.width);\n                    rectElement.setAttribute('height', '' + lastBoundingBox.height);\n                }\n            }\n        });\n\n        this.viewer.addHandler('canvas-press', function (event) {\n            if (_this.props.chartOptions.dragmode === 'lasso' || _this.props.chartOptions.dragmode === 'select') {\n                event.preventDefaultAction = true;\n\n                let webPoint = event.position;\n                let viewportPoint = viewer.viewport.pointFromPixel(webPoint);\n                let imagePoint = viewer.world.getItemAt(0).viewportToImageCoordinates(viewportPoint, true);\n\n                if (_this.props.chartOptions.dragmode === 'lasso') {\n                    lassoPathArray = [];\n                    lassoPathArray.push({x: imagePoint.x, y: imagePoint.y});\n                    lassoPathArray = simplify(lassoPathArray);\n                    lassoPath.setAttribute('d', arrayToSvgPath(lassoPathArray));\n                } else {\n                    startCoordinates = [imagePoint.x, imagePoint.y];\n                    lastBoundingBox = {\n                        x: startCoordinates[0],\n                        y: startCoordinates[1],\n                        width: 1,\n                        height: 1,\n                    };\n\n                }\n            }\n        });\n\n        this.viewer.addHandler('canvas-release', function (event) {\n            if (_this.props.chartOptions.dragmode === 'lasso') {\n                event.preventDefaultAction = true;\n                const points = _this.findPointsInPolygon(lassoPathArray);\n                lassoPathArray = [];\n                lassoPath.setAttribute('d', '');\n                _this.props.onSelected({\n                    name: getEmbeddingKey(_this.props.traceInfo.embedding),\n                    clear: !_this.props.chartOptions.editSelection,\n                    value: {basis: _this.props.traceInfo.embedding, points: points}\n                });\n            } else if (_this.props.chartOptions.dragmode === 'select') {\n                event.preventDefaultAction = true;\n                const points = _this.findPointsInRectangle(rectElement);\n                rectElement.removeAttribute('x');\n                rectElement.removeAttribute('y');\n                rectElement.removeAttribute('width');\n                rectElement.removeAttribute('height');\n                _this.props.onSelected({\n                    name: getEmbeddingKey(_this.props.traceInfo.embedding),\n                    clear: !_this.props.chartOptions.editSelection,\n                    value: {basis: _this.props.traceInfo.embedding, points: points}\n                });\n            }\n        });\n\n        // this.viewer.innerTracker.clickHandler = function (event) {\n        //     if (_this.props.chartOptions.dragmode === 'pan') {\n        //         let webPoint = event.position;\n        //         let viewportPoint = viewer.viewport.pointFromPixel(webPoint);\n        //         let imagePoint = viewer.world.getItemAt(0).viewportToImageCoordinates(viewportPoint, true);\n        //         const point = _this.findPointIndex(imagePoint.x, imagePoint.y);\n        //         if (point === -1) {\n        //             //   this.props.onDeselect({name: getEmbeddingKey(traceInfo.embedding)});\n        //         } else {\n        //             _this.props.onSelected({\n        //                 name: getEmbeddingKey(_this.props.traceInfo.embedding),\n        //                 clear: !_this.props.chartOptions.editSelection,\n        //                 value: {basis: _this.props.traceInfo.embedding, points: [point]}\n        //             });\n        //         }\n        //     }\n        // };\n\n        viewer.addHandler('canvas-exit', function (event) {\n            if (_this.tooltipElementRef.current) {\n                _this.tooltipElementRef.current.innerHTML = ' ';\n            }\n        });\n\n        let svgOverlay = new OpenseadragonSvgOverlay(viewer);\n        let lassoPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        let rectElement = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n        [lassoPath, rectElement].forEach(elem => {\n            elem.setAttribute('stroke', 'black');\n            elem.setAttribute('stroke-width', '3px');\n            elem.setAttribute('fill', '#0bb');\n            elem.setAttribute('fill-opacity', '0.3');\n            elem.setAttribute('stroke-dasharray', '2 2');\n            svgOverlay.node().appendChild(elem);\n        });\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (this.canvasOverlay) {\n            this.canvasOverlay._updateCanvas();\n        }\n        // if (this.viewer && prevProps.chartSize !== this.props.chartSize) {\n        //     this.viewer.viewport.resize();\n        // }\n    }\n\n    componentWillUnmount() {\n        if (this.viewer) {\n            this.viewer.destroy();\n        }\n        this.viewer = null;\n    }\n\n    componentDidMount() {\n        if (this.viewer == null) {\n            this.createViewer(this.props.traceInfo.url);\n        }\n    }\n\n\n    onSaveImage = (format) => {\n        const {traceInfo} = this.props;\n        const img = this.viewer.source.levels[this.viewer.source.levels.length - 1].context2D.canvas;\n        saveImage(traceInfo, {width: img.width, height: img.height}, bind(this.drawContext, this), format);\n    };\n\n    onEditSelection = () => {\n        this.props.chartOptions.editSelection = !this.props.chartOptions.editSelection;\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n\n    onShowLabels = () => {\n        this.props.chartOptions.showLabels = !this.props.chartOptions.showLabels;\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n    onZoomIn = () => {\n        this.viewer.viewport.zoomBy(this.viewer.zoomPerClick / 1.0);\n        this.viewer.viewport.applyConstraints();\n    };\n\n    onZoomOut = () => {\n        this.viewer.viewport.zoomBy(1.0 / this.viewer.zoomPerClick);\n        this.viewer.viewport.applyConstraints();\n    };\n\n    onHome = () => {\n        this.viewer.viewport.goHome();\n        this.viewer.viewport.applyConstraints();\n    };\n\n    onDragMode = (mode) => {\n        this.props.chartOptions.dragmode = mode;\n        this.props.setChartOptions(this.props.chartOptions);\n    };\n\n\n    render() {\n        return <React.Fragment>\n            <div className={this.props.classes.root}>\n                <ChartToolbar\n                    dragmode={this.props.chartOptions.dragmode}\n                    editSelection={this.props.chartOptions.editSelection}\n                    showLabels={this.props.chartOptions.showLabels}\n                    onMoreOptions={this.props.onMoreOptions}\n                    onGallery={this.props.onGallery}\n                    animating={false}\n                    onZoomIn={this.onZoomIn}\n                    onZoomOut={this.onZoomOut}\n                    is3d={false}\n                    onHome={this.onHome}\n                    onSaveImage={this.onSaveImage}\n                    onShowLabels={this.onShowLabels}\n                    onDragMode={this.onDragMode}\n                    onEditSelection={this.onEditSelection}\n                >\n                </ChartToolbar>\n                <Typography color=\"textPrimary\" ref={this.tooltipElementRef} style={{\n                    display: 'inline-block',\n                    paddingLeft: 5,\n                    verticalAlign: 'top'\n                }}>&nbsp;</Typography>\n            </div>\n\n            <div style={{\n                display: 'inline-block',\n                width: this.props.chartSize.width,\n                height: this.props.chartSize.height\n            }}\n                 id={this.id}>\n            </div>\n            {this.state.loading && <CircularProgress style={{position:'absolute', left:this.props.chartSize.width/2, top:this.props.chartSize.height/2}} size={20}/>}\n        </React.Fragment>;\n    }\n}\n\n\nexport default withStyles(styles)(ImageChart);\n","import {Tooltip, Typography} from '@material-ui/core';\nimport Box from '@material-ui/core/Box';\nimport Link from '@material-ui/core/Link';\nimport React from 'react';\n\n\nimport {connect} from 'react-redux';\nimport {\n    handleBrushFilterUpdated,\n    handleCategoricalNameChange,\n    handleColorChange,\n    handleDimensionFilterUpdated,\n    handleDomainChange,\n    handleMeasureFilterUpdated,\n    MORE_OPTIONS_DIALOG,\n    setChartOptions,\n    setDialog,\n    setPrimaryChartSize\n} from './actions';\nimport CategoricalLegend from './CategoricalLegend';\nimport ColorSchemeLegendWrapper from './ColorSchemeLegendWrapper';\nimport ImageChart from './ImageChart';\nimport ScatterChartThree from './ScatterChartThree';\n\nclass EmbeddingChart extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {showDetails: true};\n    }\n\n    setChartRef = (element) => {\n        this.props.chartOptions.ref = element;\n\n    };\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (prevProps.traceInfo.name !== this.props.traceInfo.name) {\n            this.setState({showDetails: true});\n        }\n    }\n\n    handleExpandClick = (e) => {\n        e.preventDefault();\n        this.setState({showDetails: !this.state.showDetails});\n    };\n\n    render() {\n        const {\n            onChartOptions, onMoreOptions, onDomain, onDimensionFilterUpdated,\n            onColorChange, onNameChange, onMeasureFilterUpdated, onSelect, onDeselect, onGallery,\n            traceInfo, selection, datasetFilter, chartOptions, featureSummary, markerOpacity, unselectedMarkerOpacity, pointSize, globalFeatureSummary, shape, nObsSelected, categoricalNames, primaryChartSize\n        } = this.props;\n        const displayName = traceInfo.name === '__count' ? '' : traceInfo.name;\n\n        return (\n            <div  style={{position: 'relative'}}>\n                <Box color=\"text.primary\" style={{\n                    marginTop: '3.2px',\n                    position: 'absolute',\n                    textAlign: 'right',\n                    right: 8,\n                    zIndex: 1000\n                }}>\n                    {displayName !== '' ? <Tooltip title={\"Embedding: \" + traceInfo.embedding.name}>\n                        <Link onClick={this.handleExpandClick}>\n                            <Typography\n                                color=\"textPrimary\" style={{marginRight: 14}}\n                                component={\"h4\"}>{displayName} {!traceInfo.continuous ?\n                                <small>({globalFeatureSummary[traceInfo.name].categories.length})</small> : null}</Typography></Link>\n                    </Tooltip> : null}\n\n                    {traceInfo.continuous ?\n                        <ColorSchemeLegendWrapper\n                            key={traceInfo.name}\n                            handleDomain={onDomain}\n                            width={140}\n                            showColorScheme={false}\n                            height={30}\n                            style={{\n                                display: this.state.showDetails ? 'block' : 'none',\n                            }}\n                            handleUpdate={onMeasureFilterUpdated}\n                            datasetFilter={datasetFilter}\n                            scale={traceInfo.colorScale}\n                            featureSummary={featureSummary}\n                            globalFeatureSummary={globalFeatureSummary}\n                            nObs={shape[0]}\n                            nObsSelected={nObsSelected}\n                            maxHeight={null}\n                            name={traceInfo.name}\n                        /> :\n                        <CategoricalLegend\n                            key={traceInfo.name}\n                            style={{\n                                display: this.state.showDetails ? 'block' : 'none',\n                            }}\n                            datasetFilter={datasetFilter}\n                            handleClick={onDimensionFilterUpdated}\n                            handleColorChange={onColorChange}\n                            handleNameChange={onNameChange}\n                            categoricalNames={categoricalNames}\n                            name={traceInfo.name}\n                            scale={traceInfo.colorScale}\n                            maxHeight={300}\n                            clickEnabled={true}\n                            nObs={shape[0]}\n                            nObsSelected={nObsSelected}\n                            globalFeatureSummary={globalFeatureSummary}\n                            featureSummary={featureSummary}/>\n                    }\n                </Box>\n\n\n                {!traceInfo.isImage &&\n                <ScatterChartThree traceInfo={traceInfo}\n                                   chartSize={primaryChartSize}\n                                   setChartOptions={onChartOptions}\n                                   chartOptions={chartOptions}\n                                   categoricalNames={categoricalNames}\n                                   selection={selection}\n                                   onDeselect={onDeselect}\n                                   onSelected={onSelect}\n                                   pointSize={pointSize}\n                                   markerOpacity={markerOpacity}\n                                   unselectedMarkerOpacity={unselectedMarkerOpacity}\n                                   color={traceInfo.colors}\n                                   onGallery={onGallery}\n                                   onMoreOptions={onMoreOptions}\n                                   ref={this.setChartRef}\n\n                />}\n\n\n                {traceInfo.isImage && <ImageChart\n                    setChartOptions={onChartOptions}\n                    chartOptions={chartOptions}\n                    style={{display: 'inline-block'}}\n                    traceInfo={traceInfo}\n                    pointSize={pointSize}\n                    chartSize={primaryChartSize}\n                    categoricalNames={categoricalNames}\n                    selection={selection}\n                    onInitialized={this.onInitialized}\n                    markerOpacity={markerOpacity}\n                    unselectedMarkerOpacity={unselectedMarkerOpacity}\n                    onDeselect={onDeselect}\n                    onSelected={onSelect}\n                    onGallery={onGallery}\n                    onMoreOptions={onMoreOptions}\n                    ref={this.setChartRef}\n                />}\n\n\n            </div>);\n\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        chartOptions: state.chartOptions,\n        embeddingChartSize: state.embeddingChartSize,\n        pointSize: state.pointSize,\n        embeddingData: state.embeddingData,\n        primaryChartSize: state.primaryChartSize,\n        markerOpacity: state.markerOpacity,\n        unselectedMarkerOpacity: state.unselectedMarkerOpacity,\n        primaryTraceKey: state.primaryTraceKey,\n        categoricalNames: state.categoricalNames,\n        globalFeatureSummary: state.globalFeatureSummary,\n        featureSummary: state.featureSummary,\n        shape: state.dataset.shape,\n        nObsSelected: state.selection.count,\n        dataset: state.dataset,\n        datasetFilter: state.datasetFilter\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        onChartOptions: (options) => {\n            dispatch(setChartOptions(options));\n        },\n        onMoreOptions: () => {\n            dispatch(setDialog(MORE_OPTIONS_DIALOG));\n        },\n        onPrimaryChartSize: value => {\n            dispatch(setPrimaryChartSize(value));\n        },\n        onDomain: (value) => {\n            dispatch(handleDomainChange(value));\n        },\n        onDimensionFilterUpdated: (e) => {\n            dispatch(handleDimensionFilterUpdated(e));\n        },\n        onColorChange: (e) => {\n            dispatch(handleColorChange(e));\n        },\n        onNameChange: (e) => {\n            dispatch(handleCategoricalNameChange(e));\n        },\n        onMeasureFilterUpdated: (e) => {\n            dispatch(handleMeasureFilterUpdated(e));\n        },\n        onSelect: (e) => {\n            dispatch(handleBrushFilterUpdated(e));\n        },\n        onDeselect: (e) => {\n            dispatch(handleBrushFilterUpdated(e));\n        },\n\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(EmbeddingChart));\n\n","import React from 'react';\n\nimport {connect} from 'react-redux';\nimport {getEmbeddingKey, getTraceKey, setPrimaryChartSize} from './actions';\nimport EmbeddingChart from './EmbeddingChart';\n\n\nconst emptySet = new Set();\n\nclass EmbeddingCharts extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.resizeListener = () => {\n            let width = window.innerWidth - 280;\n\n            // let height = Math.max(1, this.containerElementRef.offsetHeight);\n            let height = Math.max(300, window.innerHeight - 410);\n            this.props.handlePrimaryChartSize({width: width, height: height});\n        };\n        window.addEventListener('resize', this.resizeListener);\n\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('resize', this.resizeListener);\n    }\n\n\n    render() {\n        const {primaryTraceKey, embeddingData, selection, onGallery, primaryChartSize} = this.props;\n        let primaryTraces = embeddingData.filter(traceInfo => getTraceKey(traceInfo) === primaryTraceKey);\n        const primaryTrace = primaryTraces.length === 1 ? primaryTraces[0] : null;\n        let userPoints = emptySet;\n        if (primaryTrace) {\n            const embedding = primaryTrace.embedding;\n            const fullName = getEmbeddingKey(embedding);\n            const chartSelection = selection != null && selection.chart != null ? selection.chart[fullName] : null;\n            userPoints = chartSelection ? chartSelection.userPoints : emptySet;\n        }\n\n        if (primaryTrace == null) {\n            return <div style={{height: primaryChartSize.height}}></div>;\n        }\n\n        return (<EmbeddingChart\n                onGallery={onGallery}\n                traceInfo={primaryTrace}\n                selection={userPoints}\n            />\n        );\n    }\n\n}\n\nconst mapStateToProps = state => {\n    return {\n        embeddingData: state.embeddingData,\n        primaryTraceKey: state.primaryTraceKey,\n        primaryChartSize: state.primaryChartSize,\n        selection: state.selection\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handlePrimaryChartSize: value => {\n            dispatch(setPrimaryChartSize(value));\n        }\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(EmbeddingCharts));\n\n","import {Tooltip} from '@material-ui/core';\nimport Box from '@material-ui/core/Box';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Typography from '@material-ui/core/Typography';\nimport React from 'react';\nimport {getEmbeddingKey} from './actions';\nimport {drawImage, getSpotRadius} from './ImageChart';\nimport {drawLabels, getVisualizer} from './ScatterChartThree';\nimport {getCategoryLabelsPositions, getScaleFactor, POINT_VISUALIZER_ID, updateScatterChart} from './ThreeUtil';\n\n\nclass GalleryImage extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.state = {url: null, overlayUrl: null, loading: false};\n        this.canvasRef = React.createRef();\n    }\n\n\n    draw() {\n        const {scatterPlot, chartSize, categoricalNames, containerElement, traceInfo, markerOpacity, unselectedMarkerOpacity, selection, chartOptions, pointSize} = this.props;\n        const embedding = traceInfo.embedding;\n        const fullName = getEmbeddingKey(embedding);\n        const chartSelection = selection != null && selection.chart != null ? selection.chart[fullName] : null;\n        const userPoints = chartSelection ? chartSelection.userPoints : new Set();\n        if (!traceInfo.isImage) {\n            let spriteVisualizer = getVisualizer(scatterPlot, POINT_VISUALIZER_ID);\n            spriteVisualizer.zoomFactor = this.zoomFactor;\n            updateScatterChart(scatterPlot, traceInfo, userPoints, markerOpacity, unselectedMarkerOpacity, pointSize,\n                categoricalNames, chartOptions);\n            const canvas = containerElement.querySelector('canvas');\n            const showLabels = chartOptions.showLabels && traceInfo.isCategorical;\n            let overlayUrl = null;\n\n            if (showLabels) {\n                const labelsPositions = getCategoryLabelsPositions(traceInfo, categoricalNames);\n                const labelCanvas = document.createElement('canvas');\n                labelCanvas.width = chartSize * window.devicePixelRatio;\n                labelCanvas.height = chartSize * window.devicePixelRatio;\n                const context = labelCanvas.getContext('2d');\n                context.scale(window.devicePixelRatio, window.devicePixelRatio);\n                context.font = 'bold ' + chartOptions.labelFontSize + 'px Roboto Condensed';\n                drawLabels(context, labelsPositions, chartOptions, {\n                    width: chartSize,\n                    height: chartSize\n                }, scatterPlot.camera);\n                overlayUrl = labelCanvas.toDataURL();\n            }\n\n            this.setState({url: canvas.toDataURL(), overlayUrl: overlayUrl, loading: false});\n        } else {\n            if (!traceInfo.tileSource.ready) {\n                this.setState({url: null, overlayUrl: null, loading: true});\n                traceInfo.tileSource.addOnceHandler('ready', () => {\n                    this.setState({loading: false});\n                });\n            } else {\n                let canvas = document.createElement('canvas');\n                canvas.width = chartSize * window.devicePixelRatio;\n                canvas.height = chartSize * window.devicePixelRatio;\n                const context = canvas.getContext('2d');\n                context.scale(window.devicePixelRatio, window.devicePixelRatio);\n                drawImage(context, {\n                    width: chartSize,\n                    height: chartSize\n                }, traceInfo, userPoints, markerOpacity, unselectedMarkerOpacity, chartOptions, categoricalNames, getSpotRadius(traceInfo, pointSize));\n                this.setState({url: canvas.toDataURL(), overlayUrl: null, loading: false});\n                canvas = null;\n            }\n        }\n\n        // canvas.toBlob(function (blob) {\n        //     // let newImg = document.createElement('img');\n        //     let url = URL.createObjectURL(blob);\n        //     _this.setState({url: url});\n        //     // newImg.onload = function () {\n        //     //     // no longer need to read the blob so it's revoked\n        //     //     URL.revokeObjectURL(url);\n        //     // };\n        //     //\n        //     // newImg.src = url;\n        //     // document.body.appendChild(newImg);\n        // });\n\n    }\n\n\n    componentDidMount() {\n        this.zoomFactor = getScaleFactor(this.props.primaryChartSize);\n        this.draw();\n    }\n\n\n    componentDidUpdate(prevProps, prevState) {\n        if (prevProps.primaryChartSize !== this.props.primaryChartSize) {\n            this.zoomFactor = getScaleFactor(this.props.primaryChartSize);\n        }\n        this.draw();\n    }\n\n\n    onSelect = (event) => {\n        event.preventDefault();\n        this.props.onSelect(this.props.traceInfo);\n    };\n\n    render() {\n\n        let name = this.props.traceInfo.name;\n        if (name === '__count') {\n            name = 'count';\n        }\n        return (\n            <Box borderColor=\"text.primary\" border={1}\n                 style={{display: 'inline-block', margin: 2}}>\n                <div style={{position: 'relative', width: this.props.chartSize, height: this.props.chartSize, cursor:'pointer'}}>\n\n                    <Tooltip title={\"Embedding: \" + this.props.traceInfo.embedding.name}>\n                        <Typography color=\"textPrimary\" component={\"h4\"}\n                                    onClick={this.onSelect}\n                                    style={{\n                                        marginTop: '3.2px',\n                                        position: 'absolute',\n                                        right: 4,\n                                        zIndex: 1000\n                                    }}>{name}</Typography>\n                    </Tooltip>\n\n                    {this.state.url &&\n                    <div style={{position: 'absolute', left: 0, top: 0}}>\n                        <img alt=\"\" src={this.state.url}\n                             width={this.props.chartSize * window.devicePixelRatio}\n                             height={this.props.chartSize * window.devicePixelRatio}\n                             onClick={this.onSelect}\n                             style={{\n                                 width: this.props.chartSize,\n                                 height: this.props.chartSize\n                             }}/>\n                    </div>}\n\n                    {this.state.loading && <CircularProgress\n                        style={{position: 'absolute', left: this.props.chartSize / 2, top: this.props.chartSize / 2}}\n                        size={20}/>}\n                    {this.state.url &&\n                    <div style={{position: 'absolute', left: 0, top: 0}}>\n                        <img alt=\"\" src={this.state.url}\n                             width={this.props.chartSize * window.devicePixelRatio}\n                             height={this.props.chartSize * window.devicePixelRatio}\n                             onClick={this.onSelect}\n                             style={{\n                                 width: this.props.chartSize,\n                                 height: this.props.chartSize\n                             }}/>\n                    </div>}\n                    {this.state.overlayUrl &&\n                    <div style={{position: 'absolute', left: 0, top: 0}}>\n                        <img alt=\"\" src={this.state.overlayUrl}\n                             onClick={this.onSelect}\n                             style={{\n                                 width: this.props.chartSize,\n                                 height: this.props.chartSize\n                             }}/></div>}\n\n\n                </div>\n            </Box>\n        );\n\n    }\n}\n\nexport default GalleryImage;\n\n","import {Tooltip} from '@material-ui/core';\nimport Typography from '@material-ui/core/Typography';\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline';\nimport React from 'react';\n\nimport {connect} from 'react-redux';\nimport {sortableContainer, sortableElement} from 'react-sortable-hoc';\nimport {getTraceKey, setEmbeddingData, setPrimaryTraceKey} from './actions';\nimport GalleryImage from './GalleryImage';\nimport {createScatterPlot} from './ThreeUtil';\n\nfunction createContainer(chartSize) {\n    const containerElement = document.createElement('div');\n    containerElement.style.position = 'absolute';\n    containerElement.style.left = '-9999px';\n    containerElement.style.width = chartSize + 'px';\n    containerElement.style.height = chartSize + 'px';\n    return containerElement;\n}\n\nclass GalleryCharts extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.containerElement = createContainer(this.props.chartSize);\n        document.body.appendChild(this.containerElement);\n        this.scatterPlot = createScatterPlot(this.containerElement, window.ApplePaySession, false, false);\n        this.emptySet = new Set();\n\n    }\n\n    onChartSelected = (traceInfo) => {\n        this.props.handlePrimaryTraceKey(getTraceKey(traceInfo));\n        window.scrollTo(0, 0);\n    };\n\n    onSortEnd = (galleryTraces, e) => {\n        galleryTraces[e.oldIndex].sortIndex = e.newIndex;\n        galleryTraces[e.newIndex].sortIndex = e.oldIndex;\n        this.props.handleEmbeddingData(this.props.embeddingData.slice());\n    };\n\n\n    render() {\n        let {categoricalNames, chartSize, embeddingData, primaryChartSize, markerOpacity, unselectedMarkerOpacity, pointSize, chartOptions, selection} = this.props;\n        if (this.containerElement.style.width !== this.props.chartSize + 'px') {\n            document.body.removeChild(this.containerElement);\n            this.containerElement = createContainer(this.props.chartSize);\n            document.body.appendChild(this.containerElement);\n            this.scatterPlot = createScatterPlot(this.containerElement, window.ApplePaySession, false, false);\n        }\n        let galleryTraces = embeddingData.filter(traceInfo => traceInfo.active);\n\n        for (let i = 0; i < galleryTraces.length; i++) {\n            if (galleryTraces[i].sortIndex == null) {\n                galleryTraces[i].sortIndex = i;\n            }\n        }\n        galleryTraces.sort((a, b) => a.sortIndex - b.sortIndex);\n\n        // const DragHandle = sortableHandle(() => <span>::</span>);\n\n        const SortableItem = sortableElement(({traceInfo}) => <GalleryImage\n            traceInfo={traceInfo}\n            color={traceInfo.colors}\n            scatterPlot={this.scatterPlot}\n            markerOpacity={markerOpacity}\n            chartOptions={chartOptions}\n            pointSize={pointSize}\n            chartSize={chartSize}\n            categoricalNames={categoricalNames}\n            primaryChartSize={primaryChartSize}\n            unselectedMarkerOpacity={unselectedMarkerOpacity}\n            selection={selection}\n            containerElement={this.containerElement}\n            onSelect={this.onChartSelected}\n            key={getTraceKey(traceInfo)}/>);\n\n        const SortableList = sortableContainer(({items}) => {\n            return (\n                <ul style={{padding: 0}}>\n                    {items.map((traceInfo, index) => (\n                        <SortableItem key={getTraceKey(traceInfo)} index={index} traceInfo={traceInfo}/>\n                    ))}\n                </ul>\n            );\n        });\n\n        return (\n            <React.Fragment><Typography variant=\"subtitle1\">Gallery<Tooltip\n                title=\"Drag gallery charts to reorder. Click chart to set primary view.\"><HelpOutlineIcon\n                style={{verticalAlign: 'text-bottom'}}/></Tooltip></Typography>\n                <SortableList\n                    distance={2}\n                    axis=\"xy\" items={galleryTraces}\n                    onSortEnd={(e) => this.onSortEnd(galleryTraces, e)}/></React.Fragment>);\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        categoricalNames: state.categoricalNames,\n        embeddingData: state.embeddingData,\n        markerOpacity: state.markerOpacity,\n        unselectedMarkerOpacity: state.unselectedMarkerOpacity,\n        selection: state.selection,\n        primaryTraceKey: state.primaryTraceKey,\n        pointSize: state.pointSize,\n        chartSize: state.chartSize,\n        primaryChartSize: state.primaryChartSize,\n        chartOptions: state.chartOptions\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handlePrimaryTraceKey: (value) => {\n            dispatch(setPrimaryTraceKey(value));\n        },\n        handleEmbeddingData: (value) => {\n            dispatch(setEmbeddingData(value));\n        }\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(GalleryCharts));\n\n","import Dialog from '@material-ui/core/Dialog';\nimport DialogContent from '@material-ui/core/DialogContent';\n\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Divider from '@material-ui/core/Divider';\nimport Typography from '@material-ui/core/Typography';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {setDialog} from './actions';\n\nclass HelpDialog extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            open: true,\n        };\n    }\n\n    handleClose = () => {\n        this.props.handleClose();\n    };\n\n\n    render() {\n        return (\n            <Dialog\n                open={this.state.open}\n                onClose={this.handleClose}\n                aria-labelledby=\"help-dataset-dialog-title\"\n                fullWidth={true}\n                maxWidth={'sm'}\n            >\n                <DialogTitle id=\"help-dataset-dialog-title\">Help</DialogTitle>\n                <DialogContent>\n                    <Typography variant=\"h6\">Primary Embedding Controls</Typography>\n                    <Typography variant=\"subtitle1\">3-d Plot</Typography>\n                    Rotate: Mouse left click.<br/>\n                    Pan: Mouse right click.<br/>\n                    Zoom: Mouse wheel.<br/>\n\n                    <Typography variant=\"subtitle1\">2-d Plot</Typography>\n                    Pan: Mouse left click.<br/>\n                    Zoom: Mouse wheel.<br/>\n                    <Divider/>\n                    <Typography variant=\"h6\">Gallery</Typography>\n                    Drag chart to reorder. Click plot to set primary view.\n                    <Divider/>\n                    <Typography variant=\"h6\">Dot Plot</Typography>\n                    Enter one or more categorical observations and one or more features.\n                    <Divider/>\n                    <Typography variant=\"h6\">Additional documentation is available <a target=\"_blank\"\n                                                                                      rel=\"noopener noreferrer\"\n                                                                                      href=\"http://cirrocumulus.readthedocs.io/\">here</a>.</Typography>\n                </DialogContent>\n\n            </Dialog>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {};\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n\n\n        handleClose: value => {\n            dispatch(setDialog(null));\n        },\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(HelpDialog));\n\n","import Dialog from '@material-ui/core/Dialog';\nimport DialogContent from '@material-ui/core/DialogContent';\n\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport TextField from '@material-ui/core/TextField';\nimport {debounce} from 'lodash';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {setChartOptions, setDialog} from './actions';\n\n\nclass MoreOptionsDialog extends React.PureComponent {\n\n    constructor(props) {\n        super(props);\n        this.state = {labelFontSize: '', labelStrokeWidth: ''};\n        this.onLabelFontSizeUpdate = debounce(this.onLabelFontSizeUpdate, 500);\n        this.onLabelStrokeWidthUpdate = debounce(this.onLabelStrokeWidthUpdate, 500);\n    }\n\n    componentDidMount() {\n        this.setState({\n            labelFontSize: this.props.chartOptions.labelFontSize,\n            labelStrokeWidth: this.props.chartOptions.labelStrokeWidth\n        });\n    }\n\n    handleClose = () => {\n        this.props.handleClose();\n    };\n\n    onLabelFontSizeUpdate = (value) => {\n        if (!isNaN(value) && value > 0) {\n            this.props.chartOptions.labelFontSize = value;\n            this.props.handleChartOptions(this.props.chartOptions);\n            this.setState({labelFontSize: value});\n        }\n    };\n\n    onLabelFontSize = (event) => {\n        this.setState({labelFontSize: event.target.value});\n        this.onLabelFontSizeUpdate(event.target.value);\n    };\n\n    onLabelStrokeWidth = (event) => {\n        this.setState({labelStrokeWidth: event.target.value});\n    };\n\n    onLabelStrokeWidthUpdate = (value) => {\n        if (!isNaN(value) && value >= 0) {\n            this.props.chartOptions.labelStrokeWidth = value;\n            this.props.handleChartOptions(this.props.chartOptions);\n            this.setState({labelStrokeWidth: value});\n        }\n\n    };\n\n    render() {\n        return (\n            <Dialog\n                open={true}\n                onClose={this.handleClose}\n                aria-labelledby=\"more-options-dialog-title\"\n                fullWidth={true}\n                maxWidth={'sm'}\n            >\n                <DialogTitle id=\"more-options-dialog-title\">More Options</DialogTitle>\n                <DialogContent>\n\n                    <TextField\n                        value={this.state.labelFontSize}\n                        onChange={this.onLabelFontSize}\n                        margin=\"dense\"\n                        label=\"Label Font Size\"\n                        fullWidth\n                    />\n\n                    <TextField\n                        value={this.state.labelStrokeWidth}\n                        onChange={this.onLabelStrokeWidth}\n                        margin=\"dense\"\n                        label=\"Label Shadow Size\"\n                        fullWidth\n                    />\n\n                </DialogContent>\n\n            </Dialog>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        chartOptions: state.chartOptions,\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handleChartOptions: value => {\n            dispatch(setChartOptions(value));\n        },\n        handleClose: () => {\n            dispatch(setDialog(null));\n        },\n\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(MoreOptionsDialog));\n\n","import Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\n\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport TextField from '@material-ui/core/TextField';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {saveDatasetFilter, setDialog, setMessage} from './actions';\n\nclass SaveDatasetFilterDialog extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.state = {\n            open: true,\n            name: '',\n            notes: ''\n        };\n    }\n\n    componentDidMount() {\n        if (this.props.savedFilter == null) {\n            this.setState({name: '', notes: '', create: true});\n        } else {\n            this.setState({name: this.props.savedFilter.name, notes: this.props.savedFilter.notes});\n        }\n    }\n\n    onNameChanged = (event) => {\n        this.setState({name: event.target.value});\n    };\n\n    onNotesChanged = (event) => {\n        this.setState({notes: event.target.value});\n    };\n\n    handleClose = () => {\n        this.props.handleCancel();\n    };\n\n    handleSave = () => {\n        let name = this.state.name.trim();\n        let notes = this.state.notes;\n        if (notes != null) {\n            notes = notes.trim();\n        }\n        this.setState({loading: true});\n        this.props.handleSave({name: name, notes: notes});\n    };\n\n\n    render() {\n        let {name, notes, create} = this.state;\n        return (\n            <Dialog\n                open={true}\n                onClose={this.handleClose}\n                aria-labelledby=\"edit-dataset-filter-dialog-title\"\n                fullWidth={true}\n                maxWidth={'sm'}\n            >\n                <DialogTitle id=\"edit-dataset-filter-dialog-title\">{create\n                    ? 'Create'\n                    : 'Edit'} Filter</DialogTitle>\n                <DialogContent>\n\n                    <TextField\n                        required={true}\n                        value={name}\n                        autoComplete=\"off\"\n                        onChange={this.onNameChanged}\n                        margin=\"dense\"\n                        label=\"Name\"\n                        fullWidth\n                    />\n\n                    <TextField\n                        required={false}\n                        autoComplete=\"off\"\n                        value={notes}\n                        onChange={this.onNotesChanged}\n                        margin=\"dense\"\n                        label=\"Notes\"\n                        fullWidth\n                    />\n\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={this.handleClose} color=\"primary\">\n                        Cancel\n                    </Button>\n                    <Button disabled={name.trim().length === 0} onClick={this.handleSave} color=\"primary\">\n                        Save\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        savedFilter: state.savedDatasetFilter,\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handleSave: value => {\n            dispatch(saveDatasetFilter(value));\n        },\n        handleCancel: value => {\n            dispatch(setDialog(null));\n        },\n        handleError: value => {\n            dispatch(setMessage(value));\n        },\n\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(SaveDatasetFilterDialog));\n\n","import Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\n\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport TextField from '@material-ui/core/TextField';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {saveFeatureSet, setDialog, setMessage} from './actions';\n\nclass SaveSetDialog extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.state = {\n            open: true,\n            name: '',\n            category: ''\n        };\n    }\n\n\n    onNameChanged = (event) => {\n        this.setState({name: event.target.value});\n    };\n\n    onCategoryChanged = (event) => {\n        this.setState({category: event.target.value});\n    };\n\n    handleClose = () => {\n        this.props.handleCancel();\n    };\n\n    handleSave = () => {\n        let name = this.state.name.trim();\n        let category = this.state.category;\n        if (category != null) {\n            category = category.trim();\n        }\n        this.setState({loading: true});\n        this.props.handleSave({name: name, category: category});\n    };\n\n\n    render() {\n        let {name, category} = this.state;\n        return (\n            <Dialog\n                open={true}\n                onClose={this.handleClose}\n                aria-labelledby=\"edit-set-dialog-title\"\n                fullWidth={true}\n                maxWidth={'sm'}\n            >\n                <DialogTitle id=\"edit-set-dialog-title\">Create Set</DialogTitle>\n                <DialogContent>\n\n                    <TextField\n                        required={true}\n                        autoComplete=\"off\"\n                        value={name}\n                        onChange={this.onNameChanged}\n                        margin=\"dense\"\n                        label=\"Set Name\"\n                        fullWidth\n                    />\n\n                    <TextField\n                        required={true}\n                        autoComplete=\"off\"\n                        value={category}\n                        onChange={this.onCategoryChanged}\n                        margin=\"dense\"\n                        label=\"Set Category\"\n                        fullWidth\n                    />\n\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={this.handleClose} color=\"primary\">\n                        Cancel\n                    </Button>\n                    <Button disabled={name.trim().length === 0 || category.trim().length === 0}\n                            onClick={this.handleSave} color=\"primary\">\n                        Save\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        savedFilter: state.savedDatasetFilter,\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handleSave: value => {\n            dispatch(saveFeatureSet(value));\n        },\n        handleCancel: value => {\n            dispatch(setDialog(null));\n        },\n        handleError: value => {\n            dispatch(setMessage(value));\n        },\n\n    };\n};\n\nexport default (connect(\n    mapStateToProps, mapDispatchToProps,\n)(SaveSetDialog));\n\n","import {Typography} from '@material-ui/core';\nimport Chip from '@material-ui/core/Chip';\nimport ListSubheader from '@material-ui/core/ListSubheader';\nimport {makeStyles, useTheme} from '@material-ui/core/styles';\nimport TextField from '@material-ui/core/TextField';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport Autocomplete, {createFilterOptions} from '@material-ui/lab/Autocomplete';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport {VariableSizeList} from 'react-window';\n\nconst LISTBOX_PADDING = 0; // px\n\nfunction renderRow(props) {\n    const {data, index, style} = props;\n    return React.cloneElement(data[index], {\n        style: {\n            ...style,\n            top: style.top + LISTBOX_PADDING,\n        },\n    });\n}\n\nconst OuterElementContext = React.createContext({});\n\nconst OuterElementType = React.forwardRef((props, ref) => {\n    const outerProps = React.useContext(OuterElementContext);\n    return <div ref={ref} {...props} {...outerProps} />;\n});\n\n// Adapter for react-window\nconst ListboxComponent = React.forwardRef(function ListboxComponent(props, ref) {\n    const {children, ...other} = props;\n    const itemData = React.Children.toArray(children);\n    const theme = useTheme();\n    const smUp = useMediaQuery(theme.breakpoints.up('sm'), {noSsr: true});\n    const itemCount = itemData.length;\n    const itemSize = smUp ? 24 : 36;\n\n    const getChildSize = (child) => {\n        // if (React.isValidElement(child) && child.type === ListSubheader) {\n        //     return 48;\n        // }\n\n        return itemSize;\n    };\n\n    const getHeight = () => {\n        if (itemCount > 8) {\n            return 8 * itemSize;\n        }\n        return itemData.map(getChildSize).reduce((a, b) => a + b, 0);\n    };\n\n    return (\n        <div ref={ref}>\n            <OuterElementContext.Provider value={other}>\n                <VariableSizeList\n                    itemData={itemData}\n                    height={getHeight() + LISTBOX_PADDING}\n                    width=\"100%\"\n                    key={itemCount}\n                    outerElementType={OuterElementType}\n                    innerElementType=\"ul\"\n                    itemSize={(index) => getChildSize(itemData[index])}\n                    overscanCount={5}\n                    itemCount={itemCount}\n                >\n                    {renderRow}\n                </VariableSizeList>\n            </OuterElementContext.Provider>\n        </div>\n    );\n});\n\nListboxComponent.propTypes = {\n    children: PropTypes.node,\n};\n\n\nconst useStyles = makeStyles({\n    paper: {width: 230},\n    listbox: {\n        '& ul': {\n            padding: 0,\n            margin: 0,\n        },\n    },\n});\n\n\nconst renderGroup = (params) => [\n    <ListSubheader disableGutters component=\"div\">\n        <Typography noWrap>{params.group}</Typography>\n    </ListSubheader>,\n    params.children,\n];\n\n\nexport default function AutocompleteVirtualized(props) {\n    const classes = useStyles();\n    const ref = React.createRef();\n\n    function onDrop(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        let dt = event.dataTransfer;\n        let files = dt.files;\n        let reader = new FileReader();\n        reader.onload = function (event) {\n            let text = event.target.result;\n            let tokens = text.split(/[\\n,\\t]/);\n            enterTokens(event, tokens);\n        };\n\n        reader.onerror = function (event) {\n            alert(\"Unable to read file.\");\n        };\n\n        reader.readAsText(files[0]);\n        showDragIndicator(false);\n    };\n\n    function enterTokens(event, tokens) {\n        let results = [];\n        tokens.forEach(token => {\n            token = token.toLowerCase().trim().replace(/\"/g, '');\n            if (token !== '') {\n                for (let i = 0; i < props.options.length; i++) {\n                    if (props.options[i].toLowerCase() === token) {\n                        results.push(props.options[i]);\n                        break;\n                    }\n\n                }\n            }\n        });\n        props.onChange(event, results);\n    }\n\n    function onPaste(event) {\n        let text = event.clipboardData.getData('text/plain');\n        if (text != null && text.length > 0) {\n            event.preventDefault();\n            event.stopPropagation();\n            let tokens = text.split(/[\\n,\\t]/);\n            enterTokens(event, tokens);\n        }\n    };\n\n    function showDragIndicator(show) {\n        ref.current.style.background = show ? '#1976d2' : '';\n    }\n\n    function onDragOver(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        showDragIndicator(true);\n\n    };\n\n    function onDragEnd(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        showDragIndicator(false);\n    };\n\n    const filterOptions = createFilterOptions({matchFrom: 'start'});\n    const onClick = (event, option) => {\n        props.onChipClick(event, option);\n    };\n\n    let getOptionSelected = props.getOptionSelected;\n    if (getOptionSelected == null) {\n        getOptionSelected = props.groupBy ? (option, value) => option.id === value.id && option.group === value.group : (option, value) => option === value;\n    }\n    let getChipText = props.getChipText;\n    if (getChipText == null) {\n        getChipText = (option) => option;\n    }\n    return (\n        <Autocomplete\n            multiple\n            ref={ref}\n            filterOptions={filterOptions}\n            disableListWrap\n            classes={classes}\n            getOptionSelected={getOptionSelected}\n            value={props.value}\n            openOnFocus={true}\n            filterSelectedOptions={true}\n            getOptionLabel={props.groupBy ? (option) => option.text : (option) => option}\n            groupBy={props.groupBy ? (option) => option.group : null}\n            blurOnSelect={true}\n            ChipProps={{size: 'small'}}\n            ListboxComponent={ListboxComponent}\n            renderGroup={renderGroup}\n            options={props.options}\n            autoHighlight={true}\n            onChange={props.onChange}\n            renderTags={props.onChipClick == null ? null : (value, getTagProps) =>\n                value.map((option, index) => {\n                    return (\n                        <Chip\n                            variant=\"default\"\n                            onClick={event => onClick(event, option)}\n                            label={getChipText(option)}\n                            size=\"small\"\n                            {...getTagProps({index})}\n                        />);\n                })\n            }\n            renderInput={(params) => <TextField margin=\"dense\" {...params} label={props.label}\n                                                helperText={props.helperText}/>}\n            renderOption={props.groupBy ? (option) => <Typography title={option.text}\n                                                                  noWrap>{option.text}</Typography> : (option) =>\n                <Typography\n                    noWrap>{option}</Typography>}\n            onPaste={onPaste}\n            onDrop={onDrop}\n            onDragOver={onDragOver}\n            onDragEnd={onDragEnd}\n            onDragLeave={onDragEnd}\n        />\n    );\n}\n","import {InputLabel, Switch} from '@material-ui/core';\nimport MuiAccordionPanel from '@material-ui/core/Accordion';\nimport MuiAccordionPanelDetails from '@material-ui/core/AccordionDetails';\nimport MuiAccordionPanelSummary from '@material-ui/core/AccordionSummary';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Chip from '@material-ui/core/Chip';\nimport Divider from '@material-ui/core/Divider';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Grid from '@material-ui/core/Grid';\nimport IconButton from '@material-ui/core/IconButton';\nimport Input from '@material-ui/core/Input';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\nimport Slider from '@material-ui/core/Slider';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport CloudDownloadIcon from '@material-ui/icons/CloudDownload';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport HighlightOffIcon from '@material-ui/icons/HighlightOff';\nimport SaveIcon from '@material-ui/icons/Save';\nimport {debounce} from 'lodash';\nimport memoize from \"memoize-one\";\nimport natsort from 'natsort';\nimport React from 'react';\nimport {connect} from 'react-redux';\nimport {\n    deleteDatasetFilter,\n    deleteFeatureSet,\n    downloadSelectedIds,\n    exportDatasetFilters,\n    getDatasetFilterArray,\n    getEmbeddingKey,\n    getTraceKey,\n    openDatasetFilter,\n    removeDatasetFilter,\n    SAVE_DATASET_FILTER_DIALOG,\n    SAVE_FEATURE_SET_DIALOG,\n    setBinSummary,\n    setBinValues,\n    setChartSize,\n    setCombineDatasetFilters,\n    setDialog,\n    setInterpolator,\n    setMarkerOpacity,\n    setNumberOfBins,\n    setPointSize,\n    setPrimaryTraceKey,\n    setSearchTokens,\n    setSelectedEmbedding,\n    setUnselectedMarkerOpacity\n} from './actions';\nimport AutocompleteVirtualized from './AutocompleteVirtualized';\nimport ColorSchemeSelector from './ColorSchemeSelector';\nimport {intFormat} from './formatters';\nimport {getFeatureSets, splitSearchTokens} from './util';\n\nconst sorter = natsort();\nconst pointSizeOptions = [{value: 0.1, label: '10%'}, {value: 0.25, label: '25%'}, {value: 0.5, label: '50%'}, {\n    value: 0.75,\n    label: '75%'\n}, {value: 1, label: '100%'}, {value: 1.5, label: '150%'}, {value: 2, label: '200%'}, {\n    value: 3,\n    label: '300%'\n}, {value: 4, label: '400%'}];\nconst gallerySizeOptions = [{value: 300, label: 'Small'}, {value: 500, label: 'Medium'}, {\n    value: 800,\n    label: 'Large'\n}];\nconst summaryOptions = [\n    {value: 'max', label: 'Maximum'},\n    {value: 'mean', label: 'Mean'},\n    {value: 'sum', label: 'Sum'}];\nconst styles = theme => ({\n    root: {\n        display: 'flex',\n        flexWrap: 'nowrap',\n        width: '100%',\n        flexDirection: 'column'\n    },\n    formControl: {\n        display: 'block',\n        minWidth: 200,\n        margin: theme.spacing(1),\n    },\n    select: {\n        minWidth: 200,\n    },\n});\n\nconst getEmbeddingKeys = memoize(\n    (embeddings) => {\n        const embeddingKeys = embeddings.map(e => getEmbeddingKey(e));\n        embeddingKeys.sort(sorter);\n        return embeddingKeys;\n    }\n);\n\nconst getAnnotationOptions = memoize(\n    (obs, obsCat) => {\n        const options = [];\n        obs.forEach(item => {\n            options.push({group: 'Continuous', text: item, id: item});\n        });\n        obsCat.forEach(item => {\n            options.push({group: 'Categorical', text: item, id: item});\n        });\n        options.sort((item1, item2) => {\n            const c = sorter(item1.group, item2.group);\n            if (c !== 0) {\n                return c;\n            }\n            return sorter(item1.text, item2.text);\n        });\n        return options;\n    }\n);\nconst getFeatureSetOptions = memoize((markers) => {\n        const options = markers.map(item => ({group: item.category, text: item.name, id: item.id}));\n        options.sort((item1, item2) => {\n            const c = sorter(item1.group, item2.group);\n            if (c !== 0) {\n                return c;\n            }\n            return sorter(item1.text, item2.text);\n        });\n        return options;\n    }\n);\nconst Accordion = withStyles({\n    root: {\n        border: '1px solid rgba(0, 0, 0, .125)',\n        boxShadow: 'none',\n        '&:not(:last-child)': {\n            borderBottom: 0,\n        },\n        '&:before': {\n            display: 'none',\n        },\n        '&$expanded': {\n            margin: 0,\n        },\n    },\n    expanded: {},\n})(MuiAccordionPanel);\n\nconst AccordionPanelSummary = withStyles({\n    root: {\n        backgroundColor: 'rgba(0, 0, 0, .03)',\n        borderBottom: '1px solid rgba(0, 0, 0, .125)',\n        marginBottom: -1,\n        minHeight: 43,\n        '&$expanded': {\n            minHeight: 43,\n        },\n    },\n    content: {\n        '&$expanded': {\n            margin: 0,\n        },\n    },\n    expanded: {},\n})(MuiAccordionPanelSummary);\n\nconst AccordionPanelDetails = withStyles(theme => ({\n    root: {\n        padding: 0,\n    },\n}))(MuiAccordionPanelDetails);\n\n\nclass SideBar extends React.PureComponent {\n\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            featureSetAnchorEl: null,\n            readonly: false,\n            opacity: props.markerOpacity,\n            unselectedOpacity: props.unselectedMarkerOpacity\n        };\n        this.updateMarkerOpacity = debounce(this.updateMarkerOpacity, 500);\n        this.updateUnselectedMarkerOpacity = debounce(this.updateUnselectedMarkerOpacity, 500);\n        // this.updateNumberOfBins = debounce(this.updateNumberOfBins, 200);\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (prevProps.markerOpacity !== this.props.markerOpacity) {\n            this.setState({opacity: this.props.markerOpacity});\n        }\n        if (prevProps.unselectedMarkerOpacity !== this.props.unselectedMarkerOpacity) {\n            this.setState({unselectedOpacity: this.props.unselectedMarkerOpacity});\n        }\n    }\n\n    onMarkerOpacityChange = (event, value) => {\n\n        this.setState({opacity: value});\n        this.updateMarkerOpacity(value);\n    };\n\n    updateMarkerOpacity = (value) => {\n        let opacity = parseFloat(value);\n        if (opacity >= 0 && opacity <= 1) {\n            this.props.handleMarkerOpacity(opacity);\n        }\n    };\n\n    onUnselectedMarkerOpacityChange = (event, value) => {\n        this.setState({unselectedOpacity: value});\n        this.updateUnselectedMarkerOpacity(value);\n    };\n\n    updateUnselectedMarkerOpacity = (value) => {\n        let opacity = parseFloat(value);\n        if (opacity >= 0 && opacity <= 1) {\n            this.props.handleUnselectedMarkerOpacity(opacity);\n        }\n\n    };\n\n\n    openDatasetFilter = (filterId) => {\n        this.props.handleOpenDatasetFilter(filterId);\n    };\n\n    deleteDatasetFilter = (filterId) => {\n        this.props.handleDeleteDatasetFilter(filterId);\n    };\n\n\n    onPointSizeChange = (event) => {\n        this.props.handlePointSize(event.target.value);\n    };\n\n    onFeaturesChange = (event, value) => {\n        this.props.handleSearchTokens(value, 'X');\n    };\n\n    onObservationsChange = (event, value) => {\n        let values = [];\n        value.forEach(val => {\n            if (val.text !== undefined) {\n                values.push(val.text);\n            } else {\n                values.push(val);\n            }\n        });\n        this.props.handleSearchTokens(values, 'obs');\n    };\n\n    onSaveFeatureList = () => {\n        this.props.handleDialog(SAVE_FEATURE_SET_DIALOG);\n    };\n\n    onFeatureSetsChange = (event, value) => {\n        let values = [];\n        value.forEach(val => {\n            if (val.id !== undefined) {\n                values.push(val.id);\n            } else {\n                values.push(val);\n            }\n        });\n        this.props.handleSearchTokens(values, 'featureSet');\n    };\n\n\n    onFeatureSetClick = (event, option) => {\n        const id = option.id;\n        const target = event.target;\n        let markers = this.props.markers;\n        let isReadOnly = false;\n        let found = false;\n        for (let i = 0; i < markers.length; i++) {\n            if (markers[i].id === id) {\n                isReadOnly = markers[i].readonly;\n                found = true;\n                break;\n            }\n        }\n        if (!found) {\n            console.log(id + ' not found');\n        }\n        this.setState({featureSetAnchorEl: target, featureSetId: id, readonly: isReadOnly || !found});\n\n    };\n\n    onFeatureSetMenuClose = (event) => {\n        this.setState({featureSetAnchorEl: null, readonly: false});\n    };\n\n    onDeleteFeatureSet = (event) => {\n        event.stopPropagation();\n        let searchTokens = this.props.searchTokens;\n        let value = searchTokens.filter(token => token.type === 'featureSet' && token.value.id !== this.state.featureSetId);\n        this.props.handleSearchTokens(value, 'featureSet');\n        this.props.handleDeleteFeatureSet(this.state.featureSetId);\n        this.setState({featureSetAnchorEl: null, featureSetId: null, readonly: false});\n    };\n\n    onFilterChipClicked = (event) => {\n        this.onFeatureClick(event, event.target.innerText);\n    };\n\n    onFeatureClick = (event, option) => {\n        const value = option.text !== undefined ? option.text : option;\n        let galleryTraces = this.props.embeddingData.filter(traceInfo => traceInfo.active);\n        for (let i = 0; i < galleryTraces.length; i++) {\n            if (galleryTraces[i].name == value) {\n                this.props.handlePrimaryTraceKey(getTraceKey(galleryTraces[i]));\n                break;\n            }\n        }\n    };\n\n    // onNumberOfBinsChange = (event) => {\n    //     this.props.handleNumberOfBinsUI(event.target.value);\n    //     this.updateNumberOfBins(event.target.value);\n    // };\n    //\n    // updateNumberOfBins = (value) => {\n    //\n    //     value = parseInt(value);\n    //     if (value >= 0) {\n    //         this.props.handleNumberOfBins(value);\n    //         let embeddings = this.props.embeddings;\n    //         for (let i = 0; i < embeddings.length; i++) {\n    //             if (!embeddings[i].precomputed) {\n    //                 embeddings[i] = Object.assign(embeddings[i], {nbins: value, _nbins: value});\n    //             }\n    //         }\n    //         this.props.handleEmbeddings(embeddings.slice(0));\n    //\n    //     }\n    // };\n\n    onChartSizeChange = (event) => {\n        const value = event.target.value;\n        this.props.handleChartSize(value);\n\n    };\n\n    onBinSummaryChange = (event) => {\n        const value = event.target.value;\n        this.props.handleBinSummary(value);\n        let embeddings = this.props.embeddings;\n        for (let i = 0; i < embeddings.length; i++) {\n            if (!embeddings[i].precomputed) {\n                embeddings[i] = Object.assign(embeddings[i], {agg: value});\n            }\n        }\n        this.props.handleEmbeddings(embeddings.slice(0));\n    };\n\n    handleBinValuesChange = (event) => {\n        const value = event.target.checked;\n        this.props.handleBinValues(value);\n        let embeddings = this.props.embeddings;\n        for (let i = 0; i < embeddings.length; i++) {\n            if (!embeddings[i].precomputed) {\n                embeddings[i] = Object.assign(embeddings[i], {bin: value});\n            }\n        }\n        this.props.handleEmbeddings(embeddings.slice(0));\n    };\n\n    handleEmbeddingsChange = (event) => {\n        const embeddings = event.target.value;\n        const selection = [];\n\n        embeddings.forEach(embedding => {\n            if (!embedding.precomputed) {\n                embedding = Object.assign(embedding, {\n                    bin: this.props.binValues,\n                    nbins: this.props.numberOfBins,\n                    agg: this.props.binSummary\n                });\n            }\n            selection.push(embedding);\n        });\n\n\n        this.props.handleEmbeddings(selection);\n    };\n\n    handleSelectedCellsClick = (event) => {\n        event.preventDefault();\n        this.props.downloadSelectedIds();\n    };\n\n\n    onDatasetFilterChipDeleted = (name) => {\n        this.props.removeDatasetFilter(name);\n    };\n\n    onDatasetFilterCleared = () => {\n        this.props.removeDatasetFilter(null);\n    };\n\n    onDatasetFilterSaved = () => {\n        this.props.handleDialog(SAVE_DATASET_FILTER_DIALOG);\n    };\n\n    handleCombineDatasetFilters = (event) => {\n        this.props.handleCombineDatasetFilters(event.target.checked ? 'or' : 'and');\n    };\n\n\n    render() {\n        const {\n            chartSize, binValues, binSummary, embeddings, classes,\n            searchTokens, datasetFilter, datasetFilters, interpolator, markers, dataset, pointSize, combineDatasetFilters, selection, serverInfo\n        } = this.props;\n\n        let currentDatasetFilters = getDatasetFilterArray(datasetFilter);\n\n        const datasetFilterKeys = [];\n        let isBrushing = false;\n        currentDatasetFilters.forEach(f => {\n            if (typeof f[0] === 'object') {\n                isBrushing = true;\n            } else {\n                datasetFilterKeys.push(f[0]);\n            }\n        });\n        datasetFilterKeys.sort((a, b) => {\n            a = a.toLowerCase();\n            b = b.toLowerCase();\n            return a < b ? -1 : (a === b ? 0 : 1);\n        });\n        if (isBrushing) {\n            datasetFilterKeys.push('selection');\n        }\n\n        // for filters we only need one embedding trace per feature\n        // const traceNames = new Set();\n        // const filterTraces = [];\n        // let primaryTraceName;\n        // embeddingData.forEach(trace => {\n        //     if (primaryTraceKey === getTraceKey(trace)) {\n        //         primaryTraceName = trace.name;\n        //     }\n        //     if (trace.active && trace.name !== '__count' && !traceNames.has(trace.name)) {\n        //         traceNames.add(trace.name);\n        //         filterTraces.push(trace);\n        //     }\n        // });\n        // // put active trace 1st\n        // filterTraces.sort((a, b) => {\n        //     if (a.name === primaryTraceName) {\n        //         return -1;\n        //     }\n        //     if (b.name === primaryTraceName) {\n        //         return 1;\n        //     }\n        //     a = a.name.toLowerCase();\n        //     b = b.name.toLowerCase();\n        //     return a < b ? -1 : (a === b ? 0 : 1);\n        // });\n\n\n        let savedDatasetFilter = this.props.savedDatasetFilter;\n        if (savedDatasetFilter == null) {\n            savedDatasetFilter = {};\n        }\n        const splitTokens = splitSearchTokens(searchTokens);\n        const featureSets = getFeatureSets(markers, splitTokens.featureSets);\n        const featureOptions = dataset.features;\n        const availableEmbeddings = dataset.embeddings;\n\n        const isSummarized = dataset.precomputed != null;\n        const obsCat = dataset.obsCat;\n        const obs = dataset.obs;\n        const embeddingKeys = getEmbeddingKeys(embeddings);\n        const annotationOptions = getAnnotationOptions(obs, obsCat);\n        const featureSetOptions = getFeatureSetOptions(markers);\n\n        const fancy = serverInfo.fancy;\n        const showBinPlot = false;\n        const featureSetAnchorEl = this.state.featureSetAnchorEl;\n        return (\n            <div className={classes.root}>\n                <Menu\n                    id=\"delete-set-menu\"\n                    anchorEl={featureSetAnchorEl}\n                    open={Boolean(featureSetAnchorEl)}\n                    onClose={this.onFeatureSetMenuClose}\n                >\n                    <MenuItem disabled={this.state.readonly} onClick={this.onDeleteFeatureSet}>Delete</MenuItem>\n\n                </Menu>\n                <FormControl className={classes.formControl}>\n                    <InputLabel id=\"embedding-label\">Embeddings</InputLabel>\n                    <Select\n                        className={classes.select}\n                        labelId=\"embedding-label\"\n                        multiple\n                        value={embeddings}\n                        onChange={this.handleEmbeddingsChange}\n                        input={<Input/>}\n                        renderValue={selected => selected.map(e => e.name + (e.dimensions === 3 ? ' 3d' : '')).join(', ')}\n                    >\n                        {availableEmbeddings.map(embedding => (\n                            <MenuItem key={getEmbeddingKey(embedding)}\n                                      value={embedding}>\n                                <Checkbox checked={embeddingKeys.indexOf(getEmbeddingKey(embedding)) !== -1}/>\n                                <ListItemText primary={embedding.name + (embedding.dimensions === 3 ? ' 3d' : '')}/>\n                            </MenuItem>\n                        ))}\n                    </Select>\n                </FormControl>\n                <FormControl className={classes.formControl}>\n\n                    {/*<AutocompleteSelect label=\"Features\" options={allOptions}*/}\n                    {/*                    defaultOptions={defaultOptions} value={featureValue}*/}\n                    {/*                    onChange={this.props.handleFeatures}*/}\n                    {/*                    helperText={'Enter or paste list'}*/}\n                    {/*                    isMulti={true}/>*/}\n                    <AutocompleteVirtualized onChipClick={this.onFeatureClick} label={\"Features/Genes\"}\n                                             options={featureOptions} value={splitTokens.X}\n                                             onChange={this.onFeaturesChange}\n                                             helperText={\"Enter or paste list\"}\n                    />\n                </FormControl>\n\n                <FormControl className={classes.formControl}>\n\n                    {/*<AutocompleteSelect label=\"Features\" options={allOptions}*/}\n                    {/*                    defaultOptions={defaultOptions} value={featureValue}*/}\n                    {/*                    onChange={this.props.handleFeatures}*/}\n                    {/*                    helperText={'Enter or paste list'}*/}\n                    {/*                    isMulti={true}/>*/}\n                    <AutocompleteVirtualized label={\"Cell Metadata\"}\n                                             options={annotationOptions}\n                                             value={splitTokens.obs.concat(splitTokens.obsCat)}\n                                             onChipClick={this.onFeatureClick}\n                                             groupBy={true}\n                                             getOptionSelected={(option, value) => option.id === value}\n                                             onChange={this.onObservationsChange}/>\n                </FormControl>\n\n                {(fancy || featureSetOptions.length > 0) && <FormControl className={classes.formControl}>\n\n                    <AutocompleteVirtualized label={\"Sets\"}\n                                             options={featureSetOptions}\n                                             value={featureSets}\n                                             onChipClick={this.onFeatureSetClick}\n                                             groupBy={true}\n                                             onChange={this.onFeatureSetsChange}\n                                             getOptionSelected={(option, value) => option.id === value.id}\n                                             getChipText={option => option.name}/>\n                    {fancy && splitTokens.X.length > 0 &&\n                    <Tooltip title={\"Save Current Feature List\"}>\n                        <IconButton size={'small'} onClick={this.onSaveFeatureList}>\n                            <SaveIcon/>\n                        </IconButton>\n                    </Tooltip>\n                    }\n                </FormControl>}\n\n                <Accordion defaultExpanded>\n                    <AccordionPanelSummary\n                        aria-controls=\"filter-content\"\n                        id=\"filter-header\"\n                    >\n                        <div>Filters</div>\n                    </AccordionPanelSummary>\n                    <AccordionPanelDetails>\n                        <div style={{marginLeft: 10, maxHeight: 500}}>\n\n                            <Grid component=\"label\" alignContent={\"flex-start\"} container alignItems=\"center\"\n                                  spacing={0}>\n                                <Grid item><InputLabel shrink={true} variant={\"standard\"}>Combine\n                                    Filters</InputLabel></Grid>\n                                <Grid item>AND</Grid>\n                                <Grid item>\n                                    <Switch\n                                        size=\"small\"\n                                        checked={combineDatasetFilters === 'or'}\n                                        onChange={this.handleCombineDatasetFilters}\n                                    />\n                                </Grid>\n                                <Grid item>OR</Grid>\n                            </Grid>\n\n                            {datasetFilterKeys.length > 0 && !isNaN(selection.count) &&\n                            <React.Fragment>\n                                <div style={{marginBottom: 2}}>\n                                    {intFormat(selection.count) + \" / \" + intFormat(dataset.shape[0]) + \": \"}\n                                    {datasetFilterKeys.map(key => {\n                                        return <Chip\n                                            onDelete={() => {\n                                                this.onDatasetFilterChipDeleted(key);\n                                            }}\n                                            onClick={this.onFilterChipClicked} size={\"small\"} variant={\"default\"}\n                                            style={{marginRight: 2, verticalAlign: 'bottom'}}\n                                            key={key}\n                                            label={key}\n\n                                        />;\n                                    })}\n                                    <Divider/>\n                                    <Tooltip title={\"Clear All\"}>\n                                        <IconButton size={'small'} disabled={datasetFilterKeys.length === 0}\n                                                    onClick={this.onDatasetFilterCleared}><HighlightOffIcon/></IconButton>\n                                    </Tooltip>\n                                    {fancy && <Tooltip title={\"Save Filter\"}>\n                                        <IconButton size={'small'} disabled={datasetFilterKeys.length === 0}\n                                                    onClick={this.onDatasetFilterSaved}><SaveIcon/></IconButton>\n                                    </Tooltip>}\n                                    <Tooltip title={\"Download Selected IDs\"}>\n                                        <IconButton size={'small'} disabled={datasetFilterKeys.length === 0}\n                                                    onClick={this.handleSelectedCellsClick}><CloudDownloadIcon/></IconButton>\n                                    </Tooltip>\n                                    <Divider/>\n                                </div>\n                            </React.Fragment>\n                            }\n\n\n                        </div>\n                    </AccordionPanelDetails>\n                </Accordion>\n                <Accordion defaultExpanded>\n                    <AccordionPanelSummary\n                        aria-controls=\"view-options-content\"\n                        id=\"view-options-header\"\n                    >\n                        <div>View Options</div>\n                    </AccordionPanelSummary>\n                    <AccordionPanelDetails>\n                        <div>\n\n\n                            {/*<TextField type=\"text\" onKeyPress={this.onMarkerSizeKeyPress}*/}\n                            {/*           onChange={this.onMarkerSizeChange} label=\"Marker Size\"*/}\n                            {/*           className={classes.formControl} value={markerSize}/>*/}\n                            {/*<TextField type=\"text\" onKeyPress={this.onUnselectedMarkerSizeKeyPress}*/}\n                            {/*           onChange={this.onUnselectedMarkerSizeChange} label=\"Unselected Marker Size\"*/}\n                            {/*           className={classes.formControl} value={unselectedMarkerSize}/>*/}\n                            {/*<TextField type=\"text\"*/}\n                            {/*           onChange={this.onMarkerOpacityChange} label=\"Marker Opacity\"*/}\n                            {/*           className={classes.formControl} value={this.state.opacity}/>*/}\n\n                            <InputLabel style={{marginLeft: 8, marginTop: 8}} shrink={true}>Marker Opacity</InputLabel>\n                            <Slider\n                                min={0.0}\n                                max={1}\n                                step={0.01}\n                                style={{marginLeft: 10, width: '90%'}}\n                                valueLabelDisplay=\"auto\"\n                                value={this.state.opacity}\n                                onChange={this.onMarkerOpacityChange} aria-labelledby=\"continuous-slider\"/>\n\n\n                            <InputLabel style={{marginLeft: 8, marginTop: 8}} shrink={true}>Filtered Marker\n                                Opacity</InputLabel>\n                            <Slider\n                                min={0.0}\n                                max={1}\n                                step={0.01}\n                                style={{marginLeft: 10, width: '90%'}}\n                                valueLabelDisplay=\"auto\"\n                                value={this.state.unselectedOpacity}\n                                onChange={this.onUnselectedMarkerOpacityChange} aria-labelledby=\"continuous-slider\"/>\n\n\n                            <FormControl className={classes.formControl}>\n                                <InputLabel htmlFor=\"point_size\">Marker Size</InputLabel>\n                                <Select\n                                    className={classes.select}\n                                    input={<Input id=\"point_size\"/>}\n                                    onChange={this.onPointSizeChange}\n                                    value={pointSize}\n                                    multiple={false}>\n                                    {pointSizeOptions.map(item => (\n                                        <MenuItem key={item.label} value={item.value}>\n                                            <ListItemText primary={item.label}/>\n                                        </MenuItem>\n                                    ))}\n                                </Select>\n                            </FormControl>\n\n                            <FormControl className={classes.formControl}>\n                                <InputLabel htmlFor=\"chart_size\">Gallery Chart Size</InputLabel>\n                                <Select\n                                    className={classes.select}\n                                    input={<Input id=\"chart_size\"/>}\n                                    onChange={this.onChartSizeChange}\n                                    value={chartSize}\n                                    multiple={false}>\n                                    {gallerySizeOptions.map(item => (\n                                        <MenuItem key={item.label} value={item.value}>\n                                            <ListItemText primary={item.label}/>\n                                        </MenuItem>\n                                    ))}\n                                </Select>\n                            </FormControl>\n\n                            <FormControl className={classes.formControl}>\n                                <InputLabel htmlFor=\"color-scheme\">Color Scale</InputLabel>\n                                <ColorSchemeSelector handleInterpolator={this.props.handleInterpolator}\n                                                     interpolator={interpolator}/>\n                            </FormControl>\n\n                            {!isSummarized && showBinPlot && <div><FormControlLabel\n                                control={\n                                    <Switch\n                                        checked={binValues}\n                                        value={'binPlot'}\n                                        onChange={this.handleBinValuesChange}\n                                    />\n                                }\n                                label=\"Bin Plot\"\n                            /></div>}\n\n                            {/*{!isSummarized && binValues &&*/}\n                            {/*<TextField max=\"1000\" min=\"20\" step=\"100\"*/}\n                            {/*           value={numberOfBins}*/}\n                            {/*           onChange={this.onNumberOfBinsChange} label=\"# Bins Per Axis\"*/}\n                            {/*           className={classes.formControl}/>}*/}\n\n\n                            {!isSummarized && binValues && <FormControl className={classes.formControl}>\n                                <InputLabel htmlFor=\"summary\">Bin Summary</InputLabel>\n                                <Select\n                                    className={classes.select}\n                                    input={<Input id=\"summary\"/>}\n                                    onChange={this.onBinSummaryChange}\n                                    value={binSummary}\n                                >\n                                    {summaryOptions.map(c => (\n                                        <MenuItem key={c.value} value={c.value}>\n                                            <ListItemText primary={c.label}/>\n                                        </MenuItem>\n                                    ))}\n                                </Select>\n                            </FormControl>}\n\n\n                            <Divider/>\n\n                            {/*<Typography*/}\n                            {/*    color=\"textSecondary\"*/}\n                            {/*    display=\"block\"*/}\n                            {/*    variant=\"caption\"*/}\n                            {/*>*/}\n                            {/*    Unselected Chart Properties*/}\n                            {/*</Typography>*/}\n\n\n                        </div>\n\n                    </AccordionPanelDetails>\n                </Accordion>\n                {fancy && <Accordion defaultExpanded>\n                    <AccordionPanelSummary\n                        aria-controls=\"filter-options-content\"\n                        id=\"filter-options-header\"\n                    >\n                        <div>Saved Filters</div>\n                    </AccordionPanelSummary>\n                    <AccordionPanelDetails>\n                        <div>\n                            {datasetFilters.length === 0 &&\n                            <Box color=\"text.secondary\" style={{paddingLeft: 10}}>No saved filters</Box>}\n                            {datasetFilters.length > 0 && <div><List dense={true}>\n                                {datasetFilters.map(item => (\n                                    <ListItem key={item.id} data-key={item.id} button\n                                              selected={item.id === savedDatasetFilter.id}\n                                              onClick={e => this.openDatasetFilter(item.id)}>\n                                        <ListItemText primary={item.name}/>\n                                        <ListItemSecondaryAction onClick={e => this.deleteDatasetFilter(item.id)}>\n                                            <IconButton edge=\"end\" aria-label=\"delete\">\n                                                <DeleteIcon/>\n                                            </IconButton>\n                                        </ListItemSecondaryAction>\n                                    </ListItem>\n                                ))}\n                            </List>\n                                <Button onClick={this.props.handleExportDatasetFilters}>Export Filters</Button>\n                            </div>}\n                        </div>\n                    </AccordionPanelDetails>\n                </Accordion>}\n            </div>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        dataset: state.dataset,\n        markers: state.markers,\n        binValues: state.binValues,\n        binSummary: state.binSummary,\n        numberOfBins: state.numberOfBins,\n        embeddingData: state.embeddingData,\n        embeddingChartSize: state.embeddingChartSize,\n        interpolator: state.interpolator,\n        markerOpacity: state.markerOpacity,\n        pointSize: state.pointSize,\n        primaryTraceKey: state.primaryTraceKey,\n        savedDatasetFilter: state.savedDatasetFilter,\n        serverInfo: state.serverInfo,\n        embeddings: state.embeddings,\n        searchTokens: state.searchTokens,\n        unselectedMarkerOpacity: state.unselectedMarkerOpacity,\n        combineDatasetFilters: state.combineDatasetFilters,\n        datasetFilter: state.datasetFilter,\n        datasetFilters: state.datasetFilters,\n        selection: state.selection,\n        chartSize: state.chartSize\n    };\n};\nconst mapDispatchToProps = (dispatch, ownProps) => {\n    return {\n        handleDialog: (value) => {\n            dispatch(setDialog(value));\n        },\n        handlePrimaryTraceKey: (value) => {\n            dispatch(setPrimaryTraceKey(value));\n        },\n        handleInterpolator: value => {\n            dispatch(setInterpolator(value));\n        },\n        handleChartSize: (value) => {\n            dispatch(setChartSize(value));\n        },\n        handleCombineDatasetFilters: (value) => {\n            dispatch(setCombineDatasetFilters(value));\n        },\n        downloadSelectedIds: () => {\n            dispatch(downloadSelectedIds());\n        },\n        removeDatasetFilter: (filter) => {\n            dispatch(removeDatasetFilter(filter));\n        },\n        handleEmbeddings: value => {\n            dispatch(setSelectedEmbedding(value));\n        },\n\n        handleNumberOfBins: value => {\n            dispatch(setNumberOfBins(value));\n        },\n        handlePointSize: value => {\n            dispatch(setPointSize(value));\n        },\n\n        handleMarkerOpacity: value => {\n            dispatch(setMarkerOpacity(value));\n        },\n\n        handleUnselectedMarkerOpacity: value => {\n            dispatch(setUnselectedMarkerOpacity(value));\n        },\n\n        handleBinSummary: value => {\n            dispatch(setBinSummary(value));\n        },\n        handleBinValues: value => {\n            dispatch(setBinValues(value));\n        },\n        handleSearchTokens: (value, type) => {\n            dispatch(setSearchTokens(value == null ? [] : value, type));\n        },\n        handleOpenDatasetFilter: value => {\n            dispatch(openDatasetFilter(value));\n        },\n        handleDeleteDatasetFilter: value => {\n            dispatch(deleteDatasetFilter(value));\n        },\n        handleExportDatasetFilters: () => {\n            dispatch(exportDatasetFilters());\n        },\n        handleDeleteFeatureSet: value => {\n            dispatch(deleteFeatureSet(value));\n        },\n\n    };\n};\n\nexport default withStyles(styles)(connect(\n    mapStateToProps, mapDispatchToProps,\n)(SideBar));\n\n\n","import {IconButton, Snackbar} from '@material-ui/core';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Drawer from '@material-ui/core/Drawer';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport {createMuiTheme, withStyles} from '@material-ui/core/styles';\nimport CloseIcon from '@material-ui/icons/Close';\nimport {ThemeProvider} from '@material-ui/styles';\nimport React, {PureComponent} from 'react';\nimport {connect} from 'react-redux';\nimport {\n    DELETE_DATASET_DIALOG,\n    EDIT_DATASET_DIALOG,\n    HELP_DIALOG,\n    IMPORT_DATASET_DIALOG,\n    MORE_OPTIONS_DIALOG,\n    SAVE_DATASET_FILTER_DIALOG,\n    SAVE_FEATURE_SET_DIALOG,\n    setDialog,\n    setMessage,\n} from './actions';\nimport AppHeader from './AppHeader';\nimport DeleteDatasetDialog from './DeleteDatasetDialog';\nimport DotPlots from './DotPlots';\nimport EditDatasetDialog from './EditDatasetDialog';\nimport EmbeddingCharts from './EmbeddingCharts';\nimport GalleryCharts from './GalleryCharts';\nimport HelpDialog from './HelpDialog';\nimport MoreOptionsDialog from './MoreOptionsDialog';\nimport SaveDatasetFilterDialog from './SaveDatasetFilterDialog';\nimport SaveSetDialog from './SaveSetDialog';\nimport SideBar from './SideBar';\n\nconst lightTheme = createMuiTheme(\n    {\n        \"palette\": {\n            \"type\": \"light\"\n        }\n    }\n);\n\nconst darkTheme = createMuiTheme(\n    {\n        \"palette\": {\n            \"type\": \"dark\"\n        }\n    }\n);\nexport const drawerWidth = 240;\n\n\nconst styles = (theme) => {\n    return {\n        root: {\n            display: 'flex',\n        },\n        appBar: {\n            width: `calc(100% - ${drawerWidth}px)`,\n            marginLeft: drawerWidth,\n        },\n        drawer: {\n            width: drawerWidth,\n            flexShrink: 0,\n        },\n        drawerPaper: {\n            width: drawerWidth,\n        },\n        toolbar: theme.mixins.toolbar,\n        content: {\n            flexGrow: 1,\n            paddingTop: theme.spacing(6.5),\n            paddingLeft: theme.spacing(1)\n        }\n    };\n};\n\nclass App extends PureComponent {\n\n\n    constructor(props) {\n        super(props);\n        this.state = {tab: 'embedding'};\n        this.galleryRef = React.createRef();\n    }\n\n    handleMessageClose = () => {\n        this.props.setMessage(null);\n    };\n\n\n    onGallery = () => {\n        window.scrollTo(0, this.galleryRef.current.offsetTop);\n    };\n\n\n    render() {\n\n        // tabs: 1. embedding, 2. grouped table with kde per feature, dotplot\n        // need to add filter, selection\n        const {classes, chartOptions, dataset, dialog, loading, loadingApp, message, tab} = this.props;\n        const theme = !chartOptions.darkMode ? lightTheme : darkTheme;\n        const color = theme.palette.primary.main;\n        const bgcolor = chartOptions.darkMode ? 'black' : 'white';\n        return (<ThemeProvider theme={theme}>\n                <div className={classes.root}>\n                    {(dialog === EDIT_DATASET_DIALOG || dialog === IMPORT_DATASET_DIALOG) &&\n                    <EditDatasetDialog/>}\n                    {dialog === DELETE_DATASET_DIALOG && <DeleteDatasetDialog/>}\n                    {dialog === SAVE_DATASET_FILTER_DIALOG && <SaveDatasetFilterDialog/>}\n                    {dialog === HELP_DIALOG && <HelpDialog/>}\n                    {dialog === MORE_OPTIONS_DIALOG && <MoreOptionsDialog/>}\n                    {dialog === SAVE_FEATURE_SET_DIALOG && <SaveSetDialog/>}\n                    <AppHeader/>\n                    <Drawer\n                        className={classes.drawer}\n                        variant=\"permanent\"\n                        classes={{\n                            paper: classes.drawerPaper,\n                        }}\n                        anchor=\"left\"\n                    >\n                        {dataset != null && <SideBar key={dataset.id}/>}\n                    </Drawer>\n\n                    <main style={{backgroundColor: bgcolor, color: color}} className={classes.content}>\n                        {loadingApp.loading &&\n                        <div><h2>Loading<LinearProgress style={{width: '90%'}} variant=\"determinate\"\n                                                        value={loadingApp.progress}/></h2>\n                        </div>}\n\n                        {dataset != null && <React.Fragment>\n                            <div\n                                role=\"tabpanel\"\n                                hidden={tab !== 'embedding'}\n                            >\n                                <EmbeddingCharts onGallery={this.onGallery}/>\n                                <div ref={this.galleryRef}>\n                                    <GalleryCharts/>\n                                </div>\n\n                            </div>\n                            <div\n                                role=\"tabpanel\"\n                                hidden={tab !== 'dot_plot'}\n                            >\n                                <DotPlots/>\n                            </div>\n                        </React.Fragment>}\n\n\n                    </main>\n\n                    {loading && <Dialog aria-labelledby=\"loading-dialog-title\" open={true}>\n                        <DialogTitle id=\"loading-dialog-title\"><CircularProgress size={20}/> Loading...</DialogTitle>\n                    </Dialog>}\n\n\n                    {message != null && <Snackbar\n                        anchorOrigin={{\n                            vertical: 'bottom',\n                            horizontal: 'left',\n                        }}\n                        ContentProps={{\n                            'aria-describedby': 'message-id',\n                        }}\n                        onClose={this.handleMessageClose}\n                        open={true}\n                        autoHideDuration={6000}\n                        action={[\n                            <IconButton\n                                key=\"close\"\n                                aria-label=\"Close\"\n                                color=\"inherit\"\n                                onClick={this.handleMessageClose}\n                            >\n                                <CloseIcon/>\n                            </IconButton>,\n                        ]}\n                        message={<span id=\"message-id\">{message instanceof Error\n                            ? message.message\n                            : message}</span>}\n                    />}\n                </div>\n            </ThemeProvider>\n        );\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        dataset: state.dataset,\n        dialog: state.dialog,\n        loading: state.loading,\n        loadingApp: state.loadingApp,\n        message: state.message,\n        tab: state.tab,\n        chartOptions: state.chartOptions\n    };\n};\nconst mapDispatchToProps = dispatch => {\n    return {\n        handleDialog: (value) => {\n            dispatch(setDialog(value));\n        },\n\n        setMessage: (value) => {\n            dispatch(setMessage(value));\n        }\n    };\n};\n\nexport default withStyles(styles)(connect(\n    mapStateToProps, mapDispatchToProps,\n)(App));\n","import React from 'react';\nimport {render} from 'react-dom';\nimport {Provider} from 'react-redux';\nimport {applyMiddleware, createStore} from 'redux';\nimport thunkMiddleware from 'redux-thunk';\nimport {initGapi} from './actions';\nimport App from './App';\nimport rootReducer from './reducers';\n// import * as serviceWorker from './serviceWorker';\n\n\nconst logger = store => next => action => {\n    console.log(action);\n    let result = next(action);\n    return result;\n};\nconst store = createStore(\n    rootReducer,\n    applyMiddleware(\n        thunkMiddleware\n    ),\n);\n\nfunction main() {\n    render(\n        <Provider store={store}>\n            {/*<React.StrictMode>*/}\n            <App/>\n            {/*</React.StrictMode>*/}\n        </Provider>,\n        document.getElementById('root'),\n    );\n}\n\n// if (module.hot) {\n//   if (process.env.NODE_ENV !== 'production' && module.hot) {\n//     module.hot.accept('./reducers', () => store.replaceReducer(rootReducer));\n//   }\n//   if (process.env.NODE_ENV !== 'production' && module.hot) {\n//     module.hot.accept('./App', main);\n//   }\n// }\nstore.dispatch(initGapi());\nmain();\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}